<!DOCTYPE HTML>
<html lang="en-us" manifest="cache.manifest">
    <head>
        <title>IIS BattleCard</title>
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        
        <meta name="apple-mobile-web-app-title" content="IIS BattleCard">
		<link rel="shortcut icon" sizes="16x16" href="images/icon16.png">
		<link rel="shortcut icon" sizes="196x196" href="images/icon196.png">
		<link rel="apple-touch-icon-precomposed" href="images/icon152.png">
		<link rel="apple-touch-startup-image" href="images/splash.png">

		<link rel="stylesheet" type="text/css" href="styles/app.css" />
		<script type="text/javascript" src="lib/c.js"></script>
		<script src="//tinymce.cachefly.net/4.1/tinymce.min.js"></script>
    </head>
    <body>
	<img src="./images/swipe.png" style="display:none">
	<script defer="defer">
function setCookie(e,t,n){var o=new Date;o.setDate(o.getDate()+n);var i=escape(t)+(null==n?"":";     expires="+o.toUTCString());document.cookie=e+"="+i}function getCookie(e){var t,n,o,i=document.cookie.split(";");for(t=0;t<i.length;t++)if(n=i[t].substr(0,i[t].indexOf("=")),o=i[t].substr(i[t].indexOf("=")+1),n=n.replace(/^\s+|\s+$/g,""),n==e)return unescape(o)}function _pushContentSurface(e,t,n,o){if(tab[e]._dataSource)for(var i=0;i<tab[e]._dataSource.length;i++)if(tab[e]._dataSource[i].attributes.id==t){tab[e].remove(i);break}var a=new ContainerSurface({size:[void 0,40],attributes:{id:t}});a.addClass("article-cell"),a.on("click",function(e){openModal(e)});var r=new SequentialLayout({direction:0}),s=[];r.sequenceFrom(s);var u=new Modifier;u.sizeFrom(function(){var e=a.getSize();return[e[0]-65,void 0]});var c=new Surface({content:'<img src="images/bullet.png">',size:[30,void 0]}),d=new Surface({properties:{wordWrap:"break-word"},content:n.title});s.push(c),s.push(d),a.add(u).add(r),tab[e].insert(o,a,{size:[0,0]})}function _createContentList(e){tab[e]=new FlexScrollView({layout:ListLayout,layoutOptions:{margins:[5,10,0,5],spacing:5},autoPipeEvents:!0,useContainer:!0,flow:!0,mouseMove:!0,debug:!1,insertSpec:{size:[0,0]},nodeSpring:{dampingRatio:.8,period:1e3}})}function _createHelp(){questionSurface=new ContainerSurface({size:[290,420],properties:{backgroundColor:"white",border:"3px solid gray",overflow:"hidden",zIndex:"50"},classes:["rounded"]});var e=new SequentialLayout({direction:1}),t=[];e.sequenceFrom(t),t.push(new Surface({size:[270,110],properties:{textAlign:"center"},classes:["help-cell"],content:"Welcome to the BattleCard.  This application is designed to keep you informed and up-to-date on sales plays and reference documentation.  Content is arranged by tabs."})),t.push(new Surface({size:[270,80],classes:["help-cell"],content:"<div class='helpPics'><img src='./images/questions.png'></div><div style='width:200px; float:left;'>This tab features deal-closers, elevator pitches, and meeting prep information</div>"})),t.push(new Surface({size:[270,55],classes:["help-cell"],content:"<div class='helpPics'><img src='./images/documentation.png'></div><div style='width:200px; float:left;'>This tab features reference information and links</div>"})),t.push(new Surface({size:[270,100],classes:["help-cell"],content:"<div class='helpPics'><img src='./images/user.png'></div><div style='width:200px; float:left;'>This tab features user contributed content.  Click on the plus arrow in the top right of the screen to contribute!</div>"})),t.push(new Surface({size:[270,50],properties:{textAlign:"center",paddingTop:"37px",backgroundImage:'url("./images/swipe.png")',backgroundRepeat:"no-repeat",backgroundPosition:"center top"},classes:["help-cell"],content:"Swipe to close this screen"})),questionSurface.add(e)}function _addHeader(){var e=new ContainerSurface({size:[void 0,60],properties:{margin:"7px 0px 0px 0px"}}),t=new SequentialLayout({direction:0}),n=[];t.sequenceFrom(n);var o=new Surface({content:'<img style="margin: 5px 5px 0px 10px;" src="images/plus.png">',size:[50,void 0]});o.on("click",function(e){openUsrInput(e)});var i=new Surface({content:'<img style="margin: 5px 5px 0px 5px;" src="images/question.png">',size:[50,void 0]});i.on("click",function(){openQuestion()});var a=new Modifier;a.sizeFrom(function(){var t=e.getSize();return[t[0]-100,void 0]});var r=(new Modifier({align:[.5,.5],origin:[.5,.5]}),!1);search=new InputSurface({size:[void 0,35],name:"inputSurface",placeholder:"Search...",value:"",type:"text",classes:["search","rounded"]}),search.on("keydown",function(e){13!=e.which||r?13==e.which&&r||(r=!1):(r=!0,doSearch(e))}),search.on("keyup",function(){r=!1}),search.on("blur",function(e){doSearch(e)}),n.push(search),n.push(o),n.push(i),e.add(a).add(t),layout.header.add(e)}function doSearch(){for(var e=0;e<tab.length;e++)tab[e].removeAll();if(""==search.getValue())_pumpList({include_docs:!0},-1);else{for(var e=0;e<tab.length;e++)tab[e].push(new Surface({size:[void 0,void 0],content:"<center><img src='./images/loading.gif'></center>"}));pd.search({query:search.getValue(),fields:searchFields,include_docs:!0}).then(function(e){for(var t=0;t<tab.length;t++)tab[t].removeAll();mpd.post({time_stamp:new Date,search:{search_str:search.getValue(),hit_count:e.rows.length}}),_loadTabs(e,-1);for(var t=0;t<tab.length;t++)tab[t]._dataSource?0==tab[t]._dataSource.length&&tab[t].push(new Surface({size:[250,60],properties:{margin:"7px 10px 0px 10px"},content:"No search results found on this tab.<br>Check the other tabs for results"})):tab[t].push(new Surface({size:[250,60],properties:{margin:"7px 10px 0px 10px"},content:"No search results found on this tab.<br>Check the other tabs for results"}))})["catch"](function(){})}}function _addUserInput(){usrInput=new ContainerSurface({size:[window.innerWidth-20,window.innerHeight-20],properties:{backgroundColor:"WhiteSmoke",border:"3px solid gray",padding:"2px 10px 2px 10px",wordWrap:"break-word",zIndex:"50"},classes:["rounded"]}),usrInput.lightbox=new Lightbox({inTransform:Transform.translate(50,-500,50),outTransform:Transform.translate(50,-500,50),inTransition:{duration:500,curve:Easing.outBounce},outTransition:{duration:800,curve:Easing.outElastic}});var e=new SequentialLayout({direction:1}),t=[];e.sequenceFrom(t),t.push(new Surface({size:[window.innerWidth-45,25],properties:{textAlign:"center"},content:"<strong>Submit a new entry to the BattleCard</strong>"})),userInputTitle=new InputSurface({size:[window.innerWidth-45,35],placeholder:"Add in a title for the entry, and then all of your great content below",classes:["rounded","uinput"]}),t.push(userInputTitle),t.push(new Surface({size:[5,5]})),userInputContent=new Surface({size:[window.innerWidth-45,window.innerHeight-160],properties:{backgroundColor:"white",overflow:"auto",border:"1px solid black",WebkitOverflowScrolling:"touch"},content:"<div class='editme' id='tinymceeditwindow'></div>"}),t.push(userInputContent);var n=new SequentialLayout({direction:0}),o=[];n.sequenceFrom(o);var i=new RenderNode(new Modifier({align:[1,.5],origin:[1,.5]}));submitMessages=new Surface({size:[window.innerWidth-160,45],properties:{wordWrap:"break-word",margin:"5px 5px 5px 5px",textAlign:"center",fontSize:"small"}}),o.push(submitMessages),o.push(new Surface({size:[50,45],properties:{margin:"7px 10px 0px 10px"},content:"<img onclick='javascript:closeUsrInput();'  src='./images/cancel.png'>"})),o.push(new Surface({size:[60,45],properties:{margin:"7px 10px 0px 10px"},content:"<img onclick='javascript:submitUsrInput();'  src='./images/ok.png'>"})),t.push(i.add(n)),usrInput.add(e)}function _addFooter(){tb=new TabBar({size:[void 0,50]}),tb.defineSection(0,{content:"",onClasses:["tabbuton","tab1"],offClasses:["tabbutoff","tab1off"]}),tb.defineSection(1,{content:"",onClasses:["tabbuton","tab2"],offClasses:["tabbutoff","tab2off"]}),tb.defineSection(2,{content:"",onClasses:["tabbuton","tab3"],offClasses:["tabbutoff","tab3off"]}),tb.select(0),ehTab.subscribe(tb),ehTab.on("select",function(e){this.rc.setOptions({inTransition:!1,outTransition:!1}),rc.show(tab[e.id])}.bind()),rc=new EdgeSwapper({overlap:!1,inTransition:!1,outTransition:!1,size:[void 0,void 0]}),layout.content.add(rc),_createContentList(0),_createContentList(1),_createContentList(2),rc.show(tab[0]),layout.footer.add(tb)}function _loadTabs(e,t){if(!dataLoaded){dataLoaded=!0;for(var n=0;n<tab.length;n++)tab[n].removeAll()}for(var n=0;n<e.rows.length;n++)for(var o=0;o<tabMapping.length;o++)"undefined"!=typeof e.rows[n].doc[tabMapping[o]]&&_pushContentSurface(o,e.rows[n].id,e.rows[n].doc[tabMapping[o]],t)}function _pumpList(e,t){pd.allDocs(e,function(e,n){_loadTabs(n,t)})}function _pumpDetailContent(e){var t={include_docs:!0,key:e};pd.allDocs(t,function(e,t){Object.keys(t.rows[0].doc).forEach(function(e){"object"==typeof t.rows[0].doc[e]&&(modalTitle.setContent("<h3>"+t.rows[0].doc[e].title+"</h3><hr width=92%>"),modal.setContent("<div>"+t.rows[0].doc[e].content+"</div>"))})})}function _BuildSearchIndex(){pd.search({fields:searchFields,build:!0}).then(function(){})["catch"](function(){})}function _addModal(){modalscrollview=new ContainerSurface({size:[window.innerWidth-20,window.innerHeight-20],properties:{backgroundColor:"white",border:"3px solid gray",overflow:"hidden",zIndex:"50"},classes:["rounded"]}),modalscrollview.contentscroll=new FlexScrollView({layout:ListLayout,layoutOptions:{isSectionCallback:function(e){return e.isSection},margins:[1,5,0,5],spacing:5},dataSource:[_createTitle(),_createSection(),new Surface({})],autoPipeEvents:!0,useContainer:!1,flow:!0,mouseMove:!0,debug:!1,nodeSpring:{dampingRatio:.8,period:1e3}}),modalscrollview.add(modalscrollview.contentscroll)}function _createTitle(){modalTitle=new Surface({size:[void 0,60],properties:{backgroundColor:"white",textAlign:"center",zIndex:"51"}});var e=new RenderNode(new Modifier({transform:Transform.infront}));return e.add(modalTitle),e}function _createSection(){return modal=new Surface({size:[void 0,5e3],properties:{wordWrap:"break-word"}})}function openModal(e){_pumpDetailContent(e.currentTarget.id),modalscrollview.contentscroll.goToFirstPage(),viewid=e.currentTarget.id,startview=Date.now(),lightbox.show(modalscrollview)}function openUsrInput(){usrInputOpen||(usrInputOpen=!0,usrInput.lightbox.show(usrInput),usrInputFired?setTimeout(function(){tinymce.EditorManager.execCommand("mceAddEditor",!0,"tinymceeditwindow")},500):(usrInputFired=!0,setTimeout(function(){tinymce.init({selector:"div.editme",height:window.innerHeight-180,inline:!1,menubar:!1,resize:!1,statusbar:!1})},500)))}function openQuestion(){usrInputOpen||(usrInputOpen=!0,lightbox.show(questionSurface))}function closeUsrInput(){usrInputOpen=!1,usrInput.lightbox.hide(),userInputTitle.setValue(""),tinymce.get("tinymceeditwindow").setContent(""),tinymce.EditorManager.execCommand("mceRemoveEditor",!0,"tinymceeditwindow"),submitMessages.setContent("")}function closeLightbox(){viewid&&(mpd.post({time_stamp:new Date,docview:{doc_id:viewid,time:Date.now()-startview}}),viewid=void 0,startview=void 0),usrInputOpen=!1,lightbox.hide()}function _createLightbox(){lightbox=new Lightbox({inTransform:Transform.translate(-500,0,500),outTransform:Transform.translate(-500,0,500),inTransition:{duration:800,curve:Easing.outElastic},outTransition:{duration:800,curve:Easing.outElastic}});var e=new Transitionable([0,0]);lbmod=new Modifier({transform:function(){var t=e.get();return Transform.translate(t[0],t[1],50)}}),modalscrollview.pipe(getLbSync(e)),questionSurface.pipe(getLbSync(e))}function getLbSync(e){var t=e.get();GenericSync.register({mouse:MouseSync,touch:TouchSync});var n=new GenericSync(["mouse","touch"]);return n.on("update",function(t){var n=e.get();Math.abs(t.velocity[0])>.5&&e.set([n[0]+t.delta[0],n[1]])}),n.on("end",function(n){var o=Math.abs(n.velocity[0]);e.set(t),o>.7&&closeLightbox()}),n}function submitUsrInput(){if(userInputTitle.getValue().length>5&&tinymce.activeEditor.getContent({format:"raw"}).length>5){var e=userInputTitle.getValue()+"_"+Date.now(),t={_id:e,user:{title:userInputTitle.getValue(),content:tinymce.activeEditor.getContent({format:"raw"})}};pd.put(t).then(function(){closeUsrInput(),_pumpList({include_docs:!0,key:e},0),tb.select(2)})["catch"](function(e){submitMessages.setContent("Whoops! "+e.message)})}else submitMessages.setContent("Let's write a bit more before saving!")}var Engine=famous.core.Engine,View=famous.core.View,Surface=famous.core.Surface,EdgeSwapper=famous.views.EdgeSwapper,TabBar=famous.widgets.TabBar,HeaderFooterLayout=famous.views.HeaderFooterLayout,EventHandler=famous.core.EventHandler,RenderNode=famous.core.RenderNode,FlexScrollView=famousflex.FlexScrollView,ListLayout=famousflex.layouts.ListLayout,SequentialLayout=famous.views.SequentialLayout,ContainerSurface=famous.surfaces.ContainerSurface,InputSurface=famous.surfaces.InputSurface,TextareaSurface=famous.surfaces.TextareaSurface,Modifier=famous.core.Modifier,Utility=famous.utilities.Utility,Lightbox=famous.views.Lightbox,Easing=famous.transitions.Easing,Transform=famous.core.Transform,GenericSync=famous.inputs.GenericSync,MouseSync=famous.inputs.MouseSync,TouchSync=famous.inputs.TouchSync,Transitionable=famous.transitions.Transitionable,Timer=famous.utilities.Timer,StateModifier=famous.modifiers.StateModifier,TransitionableTransform=famous.transitions.TransitionableTransform,Scrollview=famous.views.Scrollview,mainContext=Engine.createContext(),pd=new PouchDB("infocloud",{auto_compaction:!0,size:50}),mpd=new PouchDB("a_metrics",{auto_compaction:!0}),searchFields=["questions.title","questions.content","documentation.title","documentation.content","user.title","user.content"],tabMapping=["questions","documentation","user"],layout=new HeaderFooterLayout({headerSize:50,footerSize:50}),search=void 0,tb=void 0,rc=void 0,ehTab=new EventHandler,usrInput=void 0,tab=[],modal=void 0,modalTitle=void 0,userInputTitle=void 0,userInputContent=void 0,submitState=new Modifier({}),submitMessages=void 0,modalscrollview=void 0,lightbox=void 0,lbmod=void 0,usrInputOpen=!1,usrInputFired=!1,questionSurface=void 0,dataLoaded=!1,startview=void 0,endview=void 0,viewid=void 0;_addHeader(),_addFooter(),_addUserInput(),_addModal(),_createHelp(),_createLightbox(),mainContext.add(layout),mainContext.add(new Modifier({origin:[.5,.5]})).add(lbmod).add(lightbox),mainContext.add(new Modifier({origin:[.5,.5]})).add(usrInput.lightbox),pd.info().then(function(e){if(e.doc_count>0){var t={include_docs:!0};_pumpList(t,-1)}else for(var n=0;n<tab.length;n++)tab[n].push(new Surface({size:[void 0,void 0],content:"<center><img src='./images/loading.gif'></center>"}))})["catch"](function(e){console.log(e)}),Utility.loadURL("./cloudanturl",function(e){if(e){var t=JSON.parse(e);mpd.replicate.to(t.cloudantURL+"a_metrics",{live:!0,retry:!0}),pd.sync(t.cloudantURL+"battle",{live:!0,retry:!0,since:0,filter:function(e){return!e._deleted}}).on("change",function(e){e.change.docs.forEach(function(e){var t={include_docs:!0,key:e._id};_pumpList(t,0),_BuildSearchIndex()})})}}),getCookie("IISBattleCard")||(setCookie("IISBattleCard","visited",7300),setTimeout(openQuestion(),1300));
	</script>
	</body>
</html>
