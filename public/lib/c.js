!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.famous=t()}}(function(){return function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){var i=e[s][1][t];return o(i?i:t)},l,l.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e){function i(){var t=this.container;return[t.clientWidth,t.clientHeight]}function n(t){this.container=t,this._allocator=new s(t),this._node=new o,this._eventOutput=new r,this._size=i.call(this),this._perspectiveState=new c(0),this._perspective=void 0,this._nodeContext={allocator:this._allocator,transform:a.identity,opacity:1,origin:u,align:u,size:this._size},this._eventOutput.on("resize",function(){this.setSize(i.call(this))}.bind(this))}var o=t("./RenderNode"),r=t("./EventHandler"),s=t("./ElementAllocator"),a=t("./Transform"),c=t("../transitions/Transitionable"),u=[0,0],l=!("perspective"in document.documentElement.style),h=l?function(t,e){t.style.webkitPerspective=e?e.toFixed()+"px":""}:function(t,e){t.style.perspective=e?e.toFixed()+"px":""};n.prototype.getAllocator=function(){return this._allocator},n.prototype.add=function(t){return this._node.add(t)},n.prototype.migrate=function(t){t!==this.container&&(this.container=t,this._allocator.migrate(t))},n.prototype.getSize=function(){return this._size},n.prototype.setSize=function(t){t||(t=i.call(this)),this._size[0]=t[0],this._size[1]=t[1]},n.prototype.update=function(t){t&&(t.transform&&(this._nodeContext.transform=t.transform),t.opacity&&(this._nodeContext.opacity=t.opacity),t.origin&&(this._nodeContext.origin=t.origin),t.align&&(this._nodeContext.align=t.align),t.size&&(this._nodeContext.size=t.size));var e=this._perspectiveState.get();e!==this._perspective&&(h(this.container,e),this._perspective=e),this._node.commit(this._nodeContext)},n.prototype.getPerspective=function(){return this._perspectiveState.get()},n.prototype.setPerspective=function(t,e,i){return this._perspectiveState.set(t,e,i)},n.prototype.emit=function(t,e){return this._eventOutput.emit(t,e)},n.prototype.on=function(t,e){return this._eventOutput.on(t,e)},n.prototype.removeListener=function(t,e){return this._eventOutput.removeListener(t,e)},n.prototype.pipe=function(t){return this._eventOutput.pipe(t)},n.prototype.unpipe=function(t){return this._eventOutput.unpipe(t)},e.exports=n},{"../transitions/Transitionable":88,"./ElementAllocator":2,"./EventHandler":7,"./RenderNode":11,"./Transform":15}],2:[function(t,e){function i(t){t||(t=document.createDocumentFragment()),this.container=t,this.detachedNodes={},this.nodeCount=0}i.prototype.migrate=function(t){var e=this.container;if(t!==e){if(e instanceof DocumentFragment)t.appendChild(e);else for(;e.hasChildNodes();)t.appendChild(e.firstChild);this.container=t}},i.prototype.allocate=function(t){t=t.toLowerCase(),t in this.detachedNodes||(this.detachedNodes[t]=[]);var e,i=this.detachedNodes[t];return i.length>0?e=i.pop():(e=document.createElement(t),this.container.appendChild(e)),this.nodeCount++,e},i.prototype.deallocate=function(t){var e=t.nodeName.toLowerCase(),i=this.detachedNodes[e];i.push(t),this.nodeCount--},i.prototype.getNodeCount=function(){return this.nodeCount},e.exports=i},{}],3:[function(t,e){function i(t){this._matrix=null,this._opacity=1,this._origin=null,this._size=null,this._eventOutput=new u,this._eventOutput.bindThis(this),this.eventForwarder=function(t){this._eventOutput.emit(t.type,t)}.bind(this),this.id=c.register(this),this._element=null,this._sizeDirty=!1,this._originDirty=!1,this._transformDirty=!1,this._invisible=!1,t&&this.attach(t)}function n(t){for(var e in this._eventOutput.listeners)t.addEventListener(e,this.eventForwarder)}function o(t){for(var e in this._eventOutput.listeners)t.removeEventListener(e,this.eventForwarder)}function r(t){t[12]=Math.round(t[12]*p)/p,t[13]=Math.round(t[13]*p)/p;for(var e="matrix3d(",i=0;15>i;i++)e+=t[i]<1e-6&&t[i]>-1e-6?"0,":t[i]+",";return e+=t[15]+")"}function s(t){return 100*t[0]+"% "+100*t[1]+"%"}function a(t,e){return t&&e?t[0]!==e[0]||t[1]!==e[1]:t!==e}var c=t("./Entity"),u=t("./EventHandler"),l=t("./Transform"),h=!("transform"in document.documentElement.style),p=window.devicePixelRatio||1;i.prototype.on=function(t,e){this._element&&this._element.addEventListener(t,this.eventForwarder),this._eventOutput.on(t,e)},i.prototype.removeListener=function(t,e){this._eventOutput.removeListener(t,e)},i.prototype.emit=function(t,e){e&&!e.origin&&(e.origin=this);var i=this._eventOutput.emit(t,e);return i&&e&&e.stopPropagation&&e.stopPropagation(),i},i.prototype.pipe=function(t){return this._eventOutput.pipe(t)},i.prototype.unpipe=function(t){return this._eventOutput.unpipe(t)},i.prototype.render=function(){return this.id};var f;f=h?function(t,e){t.style.webkitTransform=r(e)}:function(t,e){t.style.transform=r(e)};var d=h?function(t,e){t.style.webkitTransformOrigin=s(e)}:function(t,e){t.style.transformOrigin=s(e)},v=h?function(t){t.style.webkitTransform="scale3d(0.0001,0.0001,0.0001)",t.style.opacity=0}:function(t){t.style.transform="scale3d(0.0001,0.0001,0.0001)",t.style.opacity=0};i.prototype.commit=function(t){var e=this._element;if(e){var i=t.transform,n=t.opacity,o=t.origin;if(t.size,!i&&this._matrix)return this._matrix=null,this._opacity=0,void v(e);if(a(this._origin,o)&&(this._originDirty=!0),l.notEquals(this._matrix,i)&&(this._transformDirty=!0),this._invisible&&(this._invisible=!1,this._element.style.display=""),this._opacity!==n&&(this._opacity=n,e.style.opacity=n>=1?"0.999999":n),this._transformDirty||this._originDirty||this._sizeDirty){this._sizeDirty&&(this._sizeDirty=!1),this._originDirty&&(o?(this._origin||(this._origin=[0,0]),this._origin[0]=o[0],this._origin[1]=o[1]):this._origin=null,d(e,this._origin),this._originDirty=!1),i||(i=l.identity),this._matrix=i;var r=this._size?l.thenMove(i,[-this._size[0]*o[0],-this._size[1]*o[1],0]):i;f(e,r),this._transformDirty=!1}}},i.prototype.cleanup=function(){this._element&&(this._invisible=!0,this._element.style.display="none")},i.prototype.attach=function(t){this._element=t,n.call(this,t)},i.prototype.detach=function(){var t=this._element;return t&&(o.call(this,t),this._invisible&&(this._invisible=!1,this._element.style.display="")),this._element=null,t},e.exports=i},{"./Entity":5,"./EventHandler":7,"./Transform":15}],4:[function(t,e){function i(){O.runLoop?(f.step(),window.requestAnimationFrame(i)):S=!1}function n(){for(var t=0;t<d.length;t++)d[t].emit("resize");b.emit("resize")}function o(){window.addEventListener("touchmove",function(t){t.preventDefault()},!0),r()}function r(){return document.body?(document.body.classList.add("famous-root"),void document.documentElement.classList.add("famous-root")):void f.nextTick(r)}function s(t,e){return document.body?void document.body.addEventListener(t,e):void f.nextTick(addEventListener.bind(this,t,e))}function a(t,e){return document.body?(document.body.appendChild(e),void t.emit("resize")):void f.nextTick(a.bind(this,t,e))}var c,u,l=t("./Context"),h=t("./EventHandler"),p=t("./OptionsManager"),f={},d=[],v=[],y=0,_=0,g=[],m=Date.now(),S=!0,w={},b=new h,O={containerType:"div",containerClass:"famous-container",fpsCap:void 0,runLoop:!0,appMode:!0},T=new p(O),E=10;f.step=function(){y++,_=y;var t=Date.now();if(!(u&&u>t-m)){var e=0;c=t-m,m=t,b.emit("prerender");for(var i=v.length;i--;)v.shift()(y);for(;g.length&&Date.now()-t<E;)g.shift().call(this);for(e=0;e<d.length;e++)d[e].update();b.emit("postrender")}},window.requestAnimationFrame(i),window.addEventListener("resize",n,!1),n();var x=!1;f.pipe=function(t){return t.subscribe instanceof Function?t.subscribe(f):b.pipe(t)},f.unpipe=function(t){return t.unsubscribe instanceof Function?t.unsubscribe(f):b.unpipe(t)},f.on=function(t,e){return t in w||(w[t]=b.emit.bind(b,t),s(t,w[t])),b.on(t,e)},f.emit=function(t,e){return b.emit(t,e)},f.removeListener=function(t,e){return b.removeListener(t,e)},f.getFPS=function(){return 1e3/c},f.setFPSCap=function(t){u=Math.floor(1e3/t)},f.getOptions=function(t){return T.getOptions(t)},f.setOptions=function(){return T.setOptions.apply(T,arguments)},f.createContext=function(t){!x&&O.appMode&&f.nextTick(o);var e=!1;t||(t=document.createElement(O.containerType),t.classList.add(O.containerClass),e=!0);var i=new l(t);return f.registerContext(i),e&&a(i,t),i},f.registerContext=function(t){return d.push(t),t},f.getContexts=function(){return d},f.deregisterContext=function(t){var e=d.indexOf(t);e>=0&&d.splice(e,1)},f.nextTick=function(t){v.push(t)},f.defer=function(t){g.push(t)},T.on("change",function(t){"fpsCap"===t.id?f.setFPSCap(t.value):"runLoop"===t.id&&!S&&t.value&&(S=!0,window.requestAnimationFrame(i))}),e.exports=f},{"./Context":1,"./EventHandler":7,"./OptionsManager":10}],5:[function(t,e){function i(t){return s[t]}function n(t,e){s[t]=e}function o(t){var e=s.length;return n(e,t),e}function r(t){n(t,null)}var s=[];e.exports={register:o,unregister:r,get:i,set:n}},{}],6:[function(t,e){function i(){this.listeners={},this._owner=this}i.prototype.emit=function(t,e){var i=this.listeners[t];if(i)for(var n=0;n<i.length;n++)i[n].call(this._owner,e);return this},i.prototype.on=function(t,e){t in this.listeners||(this.listeners[t]=[]);var i=this.listeners[t].indexOf(e);return 0>i&&this.listeners[t].push(e),this},i.prototype.addListener=i.prototype.on,i.prototype.removeListener=function(t,e){var i=this.listeners[t];if(void 0!==i){var n=i.indexOf(e);n>=0&&i.splice(n,1)}return this},i.prototype.bindThis=function(t){this._owner=t},e.exports=i},{}],7:[function(t,e){function i(){n.apply(this,arguments),this.downstream=[],this.downstreamFn=[],this.upstream=[],this.upstreamListeners={}}var n=t("./EventEmitter");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.setInputHandler=function(t,e){t.trigger=e.trigger.bind(e),e.subscribe&&e.unsubscribe&&(t.subscribe=e.subscribe.bind(e),t.unsubscribe=e.unsubscribe.bind(e))},i.setOutputHandler=function(t,e){e instanceof i&&e.bindThis(t),t.pipe=e.pipe.bind(e),t.unpipe=e.unpipe.bind(e),t.on=e.on.bind(e),t.addListener=t.on,t.removeListener=e.removeListener.bind(e)},i.prototype.emit=function(t,e){n.prototype.emit.apply(this,arguments);var i=0;for(i=0;i<this.downstream.length;i++)this.downstream[i].trigger&&this.downstream[i].trigger(t,e);for(i=0;i<this.downstreamFn.length;i++)this.downstreamFn[i](t,e);return this},i.prototype.trigger=i.prototype.emit,i.prototype.pipe=function(t){if(t.subscribe instanceof Function)return t.subscribe(this);var e=t instanceof Function?this.downstreamFn:this.downstream,i=e.indexOf(t);return 0>i&&e.push(t),t instanceof Function?t("pipe",null):t.trigger&&t.trigger("pipe",null),t},i.prototype.unpipe=function(t){if(t.unsubscribe instanceof Function)return t.unsubscribe(this);var e=t instanceof Function?this.downstreamFn:this.downstream,i=e.indexOf(t);return i>=0?(e.splice(i,1),t instanceof Function?t("unpipe",null):t.trigger&&t.trigger("unpipe",null),t):!1},i.prototype.on=function(t){if(n.prototype.on.apply(this,arguments),!(t in this.upstreamListeners)){var e=this.trigger.bind(this,t);this.upstreamListeners[t]=e;for(var i=0;i<this.upstream.length;i++)this.upstream[i].on(t,e)}return this},i.prototype.addListener=i.prototype.on,i.prototype.subscribe=function(t){var e=this.upstream.indexOf(t);if(0>e){this.upstream.push(t);for(var i in this.upstreamListeners)t.on(i,this.upstreamListeners[i])}return this},i.prototype.unsubscribe=function(t){var e=this.upstream.indexOf(t);if(e>=0){this.upstream.splice(e,1);for(var i in this.upstreamListeners)t.removeListener(i,this.upstreamListeners[i])}return this},e.exports=i},{"./EventEmitter":6}],8:[function(t,e){function i(t){r.call(this,t),this._shouldRecalculateSize=!1,this._container=document.createDocumentFragment(),this.context=new n(this._container),this.setContent(this._container),this._groupSize=[void 0,void 0]}var n=t("./Context"),o=t("./Transform"),r=t("./Surface");i.SIZE_ZERO=[0,0],i.prototype=Object.create(r.prototype),i.prototype.elementType="div",i.prototype.elementClass="famous-group",i.prototype.add=function(){return this.context.add.apply(this.context,arguments)},i.prototype.render=function(){return r.prototype.render.call(this)},i.prototype.deploy=function(t){this.context.migrate(t)},i.prototype.recall=function(){this._container=document.createDocumentFragment(),this.context.migrate(this._container)},i.prototype.commit=function(t){var e=t.transform,n=t.origin,s=t.opacity,a=t.size,c=r.prototype.commit.call(this,{allocator:t.allocator,transform:o.thenMove(e,[-n[0]*a[0],-n[1]*a[1],0]),opacity:s,origin:n,size:i.SIZE_ZERO});return(a[0]!==this._groupSize[0]||a[1]!==this._groupSize[1])&&(this._groupSize[0]=a[0],this._groupSize[1]=a[1],this.context.setSize(a)),this.context.update({transform:o.translate(-n[0]*a[0],-n[1]*a[1],0),origin:n,size:a}),c},e.exports=i},{"./Context":1,"./Surface":14,"./Transform":15}],9:[function(t,e){function i(t){this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._alignGetter=null,this._sizeGetter=null,this._proportionGetter=null,this._legacyStates={},this._output={transform:o.identity,opacity:1,origin:null,align:null,size:null,proportions:null,target:null},t&&(t.transform&&this.transformFrom(t.transform),void 0!==t.opacity&&this.opacityFrom(t.opacity),t.origin&&this.originFrom(t.origin),t.align&&this.alignFrom(t.align),t.size&&this.sizeFrom(t.size),t.proportions&&this.proportionsFrom(t.proportions))}function n(){this._transformGetter&&(this._output.transform=this._transformGetter()),this._opacityGetter&&(this._output.opacity=this._opacityGetter()),this._originGetter&&(this._output.origin=this._originGetter()),this._alignGetter&&(this._output.align=this._alignGetter()),this._sizeGetter&&(this._output.size=this._sizeGetter()),this._proportionGetter&&(this._output.proportions=this._proportionGetter())}var o=t("./Transform"),r=t("../transitions/Transitionable"),s=t("../transitions/TransitionableTransform");i.prototype.transformFrom=function(t){return t instanceof Function?this._transformGetter=t:t instanceof Object&&t.get?this._transformGetter=t.get.bind(t):(this._transformGetter=null,this._output.transform=t),this},i.prototype.opacityFrom=function(t){return t instanceof Function?this._opacityGetter=t:t instanceof Object&&t.get?this._opacityGetter=t.get.bind(t):(this._opacityGetter=null,this._output.opacity=t),this},i.prototype.originFrom=function(t){return t instanceof Function?this._originGetter=t:t instanceof Object&&t.get?this._originGetter=t.get.bind(t):(this._originGetter=null,this._output.origin=t),this},i.prototype.alignFrom=function(t){return t instanceof Function?this._alignGetter=t:t instanceof Object&&t.get?this._alignGetter=t.get.bind(t):(this._alignGetter=null,this._output.align=t),this},i.prototype.sizeFrom=function(t){return t instanceof Function?this._sizeGetter=t:t instanceof Object&&t.get?this._sizeGetter=t.get.bind(t):(this._sizeGetter=null,this._output.size=t),this},i.prototype.proportionsFrom=function(t){return t instanceof Function?this._proportionGetter=t:t instanceof Object&&t.get?this._proportionGetter=t.get.bind(t):(this._proportionGetter=null,this._output.proportions=t),this},i.prototype.setTransform=function(t,e,i){return e||this._legacyStates.transform?(this._legacyStates.transform||(this._legacyStates.transform=new s(this._output.transform)),this._transformGetter||this.transformFrom(this._legacyStates.transform),this._legacyStates.transform.set(t,e,i),this):this.transformFrom(t)},i.prototype.setOpacity=function(t,e,i){return e||this._legacyStates.opacity?(this._legacyStates.opacity||(this._legacyStates.opacity=new r(this._output.opacity)),this._opacityGetter||this.opacityFrom(this._legacyStates.opacity),this._legacyStates.opacity.set(t,e,i)):this.opacityFrom(t)},i.prototype.setOrigin=function(t,e,i){return e||this._legacyStates.origin?(this._legacyStates.origin||(this._legacyStates.origin=new r(this._output.origin||[0,0])),this._originGetter||this.originFrom(this._legacyStates.origin),this._legacyStates.origin.set(t,e,i),this):this.originFrom(t)},i.prototype.setAlign=function(t,e,i){return e||this._legacyStates.align?(this._legacyStates.align||(this._legacyStates.align=new r(this._output.align||[0,0])),this._alignGetter||this.alignFrom(this._legacyStates.align),this._legacyStates.align.set(t,e,i),this):this.alignFrom(t)},i.prototype.setSize=function(t,e,i){return t&&(e||this._legacyStates.size)?(this._legacyStates.size||(this._legacyStates.size=new r(this._output.size||[0,0])),this._sizeGetter||this.sizeFrom(this._legacyStates.size),this._legacyStates.size.set(t,e,i),this):this.sizeFrom(t)},i.prototype.setProportions=function(t,e,i){return t&&(e||this._legacyStates.proportions)?(this._legacyStates.proportions||(this._legacyStates.proportions=new r(this._output.proportions||[0,0])),this._proportionGetter||this.proportionsFrom(this._legacyStates.proportions),this._legacyStates.proportions.set(t,e,i),this):this.proportionsFrom(t)},i.prototype.halt=function(){this._legacyStates.transform&&this._legacyStates.transform.halt(),this._legacyStates.opacity&&this._legacyStates.opacity.halt(),this._legacyStates.origin&&this._legacyStates.origin.halt(),this._legacyStates.align&&this._legacyStates.align.halt(),this._legacyStates.size&&this._legacyStates.size.halt(),this._legacyStates.proportions&&this._legacyStates.proportions.halt(),this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._alignGetter=null,this._sizeGetter=null,this._proportionGetter=null},i.prototype.getTransform=function(){return this._transformGetter()},i.prototype.getFinalTransform=function(){return this._legacyStates.transform?this._legacyStates.transform.getFinal():this._output.transform},i.prototype.getOpacity=function(){return this._opacityGetter()},i.prototype.getOrigin=function(){return this._originGetter()},i.prototype.getAlign=function(){return this._alignGetter()},i.prototype.getSize=function(){return this._sizeGetter?this._sizeGetter():this._output.size},i.prototype.getProportions=function(){return this._proportionGetter?this._proportionGetter():this._output.proportions},i.prototype.modify=function(t){return n.call(this),this._output.target=t,this._output},e.exports=i},{"../transitions/Transitionable":88,"../transitions/TransitionableTransform":89,"./Transform":15}],10:[function(t,e){function i(t){this._value=t,this.eventOutput=null}function n(){this.eventOutput=new o,this.eventOutput.bindThis(this),o.setOutputHandler(this,this.eventOutput)}var o=t("./EventHandler");i.patch=function(t){for(var e=new i(t),n=1;n<arguments.length;n++)e.patch(arguments[n]);return t},i.prototype.patch=function(){for(var t=this._value,e=0;e<arguments.length;e++){var i=arguments[e];for(var n in i)n in t&&i[n]&&i[n].constructor===Object&&t[n]&&t[n].constructor===Object?(t.hasOwnProperty(n)||(t[n]=Object.create(t[n])),this.key(n).patch(i[n]),this.eventOutput&&this.eventOutput.emit("change",{id:n,value:this.key(n).value()})):this.set(n,i[n])}return this},i.prototype.setOptions=i.prototype.patch,i.prototype.key=function(t){var e=new i(this._value[t]);return(!(e._value instanceof Object)||e._value instanceof Array)&&(e._value={}),e},i.prototype.get=function(t){return t?this._value[t]:this._value},i.prototype.getOptions=i.prototype.get,i.prototype.set=function(t,e){var i=this.get(t);return this._value[t]=e,this.eventOutput&&e!==i&&this.eventOutput.emit("change",{id:t,value:e}),this},i.prototype.on=function(){return n.call(this),this.on.apply(this,arguments)},i.prototype.removeListener=function(){return n.call(this),this.removeListener.apply(this,arguments)},i.prototype.pipe=function(){return n.call(this),this.pipe.apply(this,arguments)},i.prototype.unpipe=function(){return n.call(this),this.unpipe.apply(this,arguments)},e.exports=i},{"./EventHandler":7}],11:[function(t,e){function i(t){this._object=null,this._child=null,this._hasMultipleChildren=!1,this._isRenderable=!1,this._isModifier=!1,this._resultCache={},this._prevResults={},this._childResult=null,t&&this.set(t)}function n(t,e,i){for(var s=r.parse(t,e),a=Object.keys(s),c=0;c<a.length;c++){var u=a[c],l=o.get(u),h=s[u];h.allocator=e.allocator;var p=l.commit(h);p?n(p,e,i):i[u]=h}}var o=t("./Entity"),r=t("./SpecParser");i.prototype.add=function(t){var e=t instanceof i?t:new i(t);return this._child instanceof Array?this._child.push(e):this._child?(this._child=[this._child,e],this._hasMultipleChildren=!0,this._childResult=[]):this._child=e,e},i.prototype.get=function(){return this._object||(this._hasMultipleChildren?null:this._child?this._child.get():null)},i.prototype.set=function(t){return this._childResult=null,this._hasMultipleChildren=!1,this._isRenderable=t.render?!0:!1,this._isModifier=t.modify?!0:!1,this._object=t,this._child=null,t instanceof i?t:this},i.prototype.getSize=function(){var t=null,e=this.get();return e&&e.getSize&&(t=e.getSize()),!t&&this._child&&this._child.getSize&&(t=this._child.getSize()),t},i.prototype.commit=function(t){for(var e=Object.keys(this._prevResults),i=0;i<e.length;i++){var r=e[i];if(void 0===this._resultCache[r]){var s=o.get(r);s.cleanup&&s.cleanup(t.allocator)}}this._prevResults=this._resultCache,this._resultCache={},n(this.render(),t,this._resultCache)},i.prototype.render=function(){if(this._isRenderable)return this._object.render();var t=null;if(this._hasMultipleChildren){t=this._childResult;for(var e=this._child,i=0;i<e.length;i++)t[i]=e[i].render()}else this._child&&(t=this._child.render());return this._isModifier?this._object.modify(t):t},e.exports=i},{"./Entity":5,"./SpecParser":13}],12:[function(t,e){function i(t){this.id=null,this._objects=null,this.node=new u,this._definition=null,t&&this.load(t)}function n(t){for(var e in l)if(e in t){var i=t[e];return i instanceof Array||(i=[i]),l[e].apply(this,i)}}function o(t){var e=t.transform,i=t.opacity,o=t.origin,r=t.align,s=t.size,u=a.identity;if(e instanceof Array)if(16===e.length&&"number"==typeof e[0])u=e;else for(var l=0;l<e.length;l++)u=a.multiply(u,n(e[l]));else e instanceof Function?u=e:e instanceof Object&&(u=n(e));var h=new c({transform:u,opacity:i,origin:o,align:r,size:s});return h}function r(t){for(var e=new u,i=0;i<t.length;i++){var n=s.call(this,t[i]);n&&e.add(n)}return e}function s(t){var e,i;if(t instanceof Array)e=r.call(this,t);else if(i=this._objects.length,t.render&&t.render instanceof Function)e=t;else if(t.target){var n=s.call(this,t.target),a=o.call(this,t);e=new u(a),e.add(n),t.id&&(this.id[t.id]=a)}else t.id&&(e=new u,this.id[t.id]=e);return this._objects[i]=e,e}var a=t("./Transform"),c=t("./Modifier"),u=t("./RenderNode"),l={translate:a.translate,rotate:a.rotate,rotateX:a.rotateX,rotateY:a.rotateY,rotateZ:a.rotateZ,rotateAxis:a.rotateAxis,scale:a.scale,skew:a.skew,matrix3d:function(){return arguments}};i.prototype.create=function(){return new i(this._definition)},i.prototype.load=function(t){this._definition=t,this.id={},this._objects=[],this.node.set(s.call(this,t))},i.prototype.add=function(){return this.node.add.apply(this.node,arguments)},i.prototype.render=function(){return this.node.render.apply(this.node,arguments)},e.exports=i},{"./Modifier":9,"./RenderNode":11,"./Transform":15}],13:[function(t,e){function i(){this.result={}}function n(t,e){return[t[0]*e[0]+t[1]*e[4]+t[2]*e[8],t[0]*e[1]+t[1]*e[5]+t[2]*e[9],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]]}var o=t("./Transform");i._instance=new i,i.parse=function(t,e){return i._instance.parse(t,e)},i.prototype.parse=function(t,e){return this.reset(),this._parseSpec(t,e,o.identity),this.result},i.prototype.reset=function(){this.result={}};var r=[0,0];i.prototype._parseSpec=function(t,e,i){var s,a,c,u,l,h,p;if("number"==typeof t){if(s=t,c=e.transform,h=e.align||r,e.size&&h&&(h[0]||h[1])){var f=[h[0]*e.size[0],h[1]*e.size[1],0];c=o.thenMove(c,n(f,i))}this.result[s]={transform:c,opacity:e.opacity,origin:e.origin||r,align:e.align||r,size:e.size}}else{if(!t)return;if(t instanceof Array)for(var d=0;d<t.length;d++)this._parseSpec(t[d],e,i);else{a=t.target,c=e.transform,u=e.opacity,l=e.origin,h=e.align,p=e.size;var v=i;if(void 0!==t.opacity&&(u=e.opacity*t.opacity),t.transform&&(c=o.multiply(e.transform,t.transform)),t.origin&&(l=t.origin,v=e.transform),t.align&&(h=t.align),t.size||t.proportions){var y=p;p=[p[0],p[1]],t.size&&(void 0!==t.size[0]&&(p[0]=t.size[0]),void 0!==t.size[1]&&(p[1]=t.size[1])),t.proportions&&(void 0!==t.proportions[0]&&(p[0]=p[0]*t.proportions[0]),void 0!==t.proportions[1]&&(p[1]=p[1]*t.proportions[1])),y&&(h&&(h[0]||h[1])&&(c=o.thenMove(c,n([h[0]*y[0],h[1]*y[1],0],i))),l&&(l[0]||l[1])&&(c=o.moveThen([-l[0]*p[0],-l[1]*p[1],0],c))),v=e.transform,l=null,h=null}this._parseSpec(a,{transform:c,opacity:u,origin:l,align:h,size:p},v)}}},e.exports=i},{"./Transform":15}],14:[function(t,e){function i(t){u.call(this),this.options={},this.properties={},this.attributes={},this.content="",this.classList=[],this.size=null,this._classesDirty=!0,this._stylesDirty=!0,this._attributesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._trueSizeCheck=!0,this._dirtyClasses=[],t&&this.setOptions(t),this._currentTarget=null}function n(t){for(var e=0;e<this._dirtyClasses.length;e++)t.classList.remove(this._dirtyClasses[e]);this._dirtyClasses=[]}function o(t){for(var e in this.properties)t.style[e]=this.properties[e]}function r(t){for(var e in this.properties)t.style[e]=""}function s(t){for(var e in this.attributes)t.setAttribute(e,this.attributes[e])}function a(t){for(var e in this.attributes)t.removeAttribute(e)}function c(t,e){return t&&e?t[0]!==e[0]||t[1]!==e[1]:t!==e}var u=t("./ElementOutput");i.prototype=Object.create(u.prototype),i.prototype.constructor=i,i.prototype.elementType="div",i.prototype.elementClass="famous-surface",i.prototype.setAttributes=function(t){for(var e in t){if("style"===e)throw new Error('Cannot set styles via "setAttributes" as it will break Famo.us.  Use "setProperties" instead.');this.attributes[e]=t[e]}this._attributesDirty=!0},i.prototype.getAttributes=function(){return this.attributes},i.prototype.setProperties=function(t){for(var e in t)this.properties[e]=t[e];return this._stylesDirty=!0,this},i.prototype.getProperties=function(){return this.properties},i.prototype.addClass=function(t){return this.classList.indexOf(t)<0&&(this.classList.push(t),this._classesDirty=!0),this},i.prototype.removeClass=function(t){var e=this.classList.indexOf(t);return e>=0&&(this._dirtyClasses.push(this.classList.splice(e,1)[0]),this._classesDirty=!0),this},i.prototype.toggleClass=function(t){var e=this.classList.indexOf(t);return e>=0?this.removeClass(t):this.addClass(t),this},i.prototype.setClasses=function(t){var e=0,i=[];for(e=0;e<this.classList.length;e++)t.indexOf(this.classList[e])<0&&i.push(this.classList[e]);for(e=0;e<i.length;e++)this.removeClass(i[e]);for(e=0;e<t.length;e++)this.addClass(t[e]);return this},i.prototype.getClassList=function(){return this.classList},i.prototype.setContent=function(t){return this.content!==t&&(this.content=t,this._contentDirty=!0),this},i.prototype.getContent=function(){return this.content},i.prototype.setOptions=function(t){return t.size&&this.setSize(t.size),t.classes&&this.setClasses(t.classes),t.properties&&this.setProperties(t.properties),t.attributes&&this.setAttributes(t.attributes),t.content&&this.setContent(t.content),this},i.prototype.setup=function(t){var e=t.allocate(this.elementType);if(this.elementClass)if(this.elementClass instanceof Array)for(var i=0;i<this.elementClass.length;i++)e.classList.add(this.elementClass[i]);else e.classList.add(this.elementClass);e.style.display="",this.attach(e),this._opacity=null,this._currentTarget=e,this._stylesDirty=!0,this._classesDirty=!0,this._attributesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._originDirty=!0,this._transformDirty=!0},i.prototype.commit=function(t){this._currentTarget||this.setup(t.allocator);var e=this._currentTarget,i=t.size;if(this._classesDirty){n.call(this,e);for(var r=this.getClassList(),a=0;a<r.length;a++)e.classList.add(r[a]);this._classesDirty=!1,this._trueSizeCheck=!0}if(this._stylesDirty&&(o.call(this,e),this._stylesDirty=!1,this._trueSizeCheck=!0),this._attributesDirty&&(s.call(this,e),this._attributesDirty=!1,this._trueSizeCheck=!0),this.size){var l=t.size;if(i=[this.size[0],this.size[1]],void 0===i[0]&&(i[0]=l[0]),void 0===i[1]&&(i[1]=l[1]),i[0]===!0||i[1]===!0){if(i[0]===!0)if(this._trueSizeCheck||0===this._size[0]){var h=e.offsetWidth;this._size&&this._size[0]!==h&&(this._size[0]=h,this._sizeDirty=!0),i[0]=h}else this._size&&(i[0]=this._size[0]);if(i[1]===!0)if(this._trueSizeCheck||0===this._size[1]){var p=e.offsetHeight;this._size&&this._size[1]!==p&&(this._size[1]=p,this._sizeDirty=!0),i[1]=p}else this._size&&(i[1]=this._size[1]);this._trueSizeCheck=!1}}c(this._size,i)&&(this._size||(this._size=[0,0]),this._size[0]=i[0],this._size[1]=i[1],this._sizeDirty=!0),this._sizeDirty&&(this._size&&(e.style.width=this.size&&this.size[0]===!0?"":this._size[0]+"px",e.style.height=this.size&&this.size[1]===!0?"":this._size[1]+"px"),this._eventOutput.emit("resize")),this._contentDirty&&(this.deploy(e),this._eventOutput.emit("deploy"),this._contentDirty=!1,this._trueSizeCheck=!0),u.prototype.commit.call(this,t)},i.prototype.cleanup=function(t){var e=0,i=this._currentTarget;this._eventOutput.emit("recall"),this.recall(i),i.style.display="none",i.style.opacity="",i.style.width="",i.style.height="",r.call(this,i),a.call(this,i);var o=this.getClassList();for(n.call(this,i),e=0;e<o.length;e++)i.classList.remove(o[e]);if(this.elementClass)if(this.elementClass instanceof Array)for(e=0;e<this.elementClass.length;e++)i.classList.remove(this.elementClass[e]);else i.classList.remove(this.elementClass);this.detach(i),this._currentTarget=null,t.deallocate(i)},i.prototype.deploy=function(t){var e=this.getContent();if(e instanceof Node){for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}else t.innerHTML=e},i.prototype.recall=function(t){for(var e=document.createDocumentFragment();t.hasChildNodes();)e.appendChild(t.firstChild);this.setContent(e)},i.prototype.getSize=function(){return this._size?this._size:this.size},i.prototype.setSize=function(t){return this.size=t?[t[0],t[1]]:null,this._sizeDirty=!0,this},e.exports=i},{"./ElementOutput":3}],15:[function(t,e){function i(t){return 2===t.length?t[0]*t[0]+t[1]*t[1]:t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function n(t){return Math.sqrt(i(t))}function o(t){return 0>t?-1:1}var r={};r.precision=1e-6,r.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.multiply4x4=function(t,e){return[t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15]]},r.multiply=function(t,e){return[t[0]*e[0]+t[4]*e[1]+t[8]*e[2],t[1]*e[0]+t[5]*e[1]+t[9]*e[2],t[2]*e[0]+t[6]*e[1]+t[10]*e[2],0,t[0]*e[4]+t[4]*e[5]+t[8]*e[6],t[1]*e[4]+t[5]*e[5]+t[9]*e[6],t[2]*e[4]+t[6]*e[5]+t[10]*e[6],0,t[0]*e[8]+t[4]*e[9]+t[8]*e[10],t[1]*e[8]+t[5]*e[9]+t[9]*e[10],t[2]*e[8]+t[6]*e[9]+t[10]*e[10],0,t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12],t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13],t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14],1];
},r.thenMove=function(t,e){return e[2]||(e[2]=0),[t[0],t[1],t[2],0,t[4],t[5],t[6],0,t[8],t[9],t[10],0,t[12]+e[0],t[13]+e[1],t[14]+e[2],1]},r.moveThen=function(t,e){t[2]||(t[2]=0);var i=t[0]*e[0]+t[1]*e[4]+t[2]*e[8],n=t[0]*e[1]+t[1]*e[5]+t[2]*e[9],o=t[0]*e[2]+t[1]*e[6]+t[2]*e[10];return r.thenMove(e,[i,n,o])},r.translate=function(t,e,i){return void 0===i&&(i=0),[1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1]},r.thenScale=function(t,e){return[e[0]*t[0],e[1]*t[1],e[2]*t[2],0,e[0]*t[4],e[1]*t[5],e[2]*t[6],0,e[0]*t[8],e[1]*t[9],e[2]*t[10],0,e[0]*t[12],e[1]*t[13],e[2]*t[14],1]},r.scale=function(t,e,i){return void 0===i&&(i=1),void 0===e&&(e=t),[t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1]},r.rotateX=function(t){var e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]},r.rotateY=function(t){var e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]},r.rotateZ=function(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]},r.rotate=function(t,e,i){var n=Math.cos(t),o=Math.sin(t),r=Math.cos(e),s=Math.sin(e),a=Math.cos(i),c=Math.sin(i),u=[r*a,n*c+o*s*a,o*c-n*s*a,0,-r*c,n*a-o*s*c,o*a+n*s*c,0,s,-o*r,n*r,0,0,0,0,1];return u},r.rotateAxis=function(t,e){var i=Math.sin(e),n=Math.cos(e),o=1-n,r=t[0]*t[0]*o,s=t[0]*t[1]*o,a=t[0]*t[2]*o,c=t[1]*t[1]*o,u=t[1]*t[2]*o,l=t[2]*t[2]*o,h=t[0]*i,p=t[1]*i,f=t[2]*i,d=[r+n,s+f,a-p,0,s-f,c+n,u+h,0,a+p,u-h,l+n,0,0,0,0,1];return d},r.aboutOrigin=function(t,e){var i=t[0]-(t[0]*e[0]+t[1]*e[4]+t[2]*e[8]),n=t[1]-(t[0]*e[1]+t[1]*e[5]+t[2]*e[9]),o=t[2]-(t[0]*e[2]+t[1]*e[6]+t[2]*e[10]);return r.thenMove(e,[i,n,o])},r.skew=function(t,e,i){return[1,Math.tan(e),0,0,Math.tan(i),1,0,0,0,Math.tan(t),1,0,0,0,0,1]},r.skewX=function(t){return[1,0,0,0,Math.tan(t),1,0,0,0,0,1,0,0,0,0,1]},r.skewY=function(t){return[1,Math.tan(t),0,0,0,1,0,0,0,0,1,0,0,0,0,1]},r.perspective=function(t){return[1,0,0,0,0,1,0,0,0,0,1,-1/t,0,0,0,1]},r.getTranslate=function(t){return[t[12],t[13],t[14]]},r.inverse=function(t){var e=t[5]*t[10]-t[6]*t[9],i=t[4]*t[10]-t[6]*t[8],n=t[4]*t[9]-t[5]*t[8],o=t[1]*t[10]-t[2]*t[9],r=t[0]*t[10]-t[2]*t[8],s=t[0]*t[9]-t[1]*t[8],a=t[1]*t[6]-t[2]*t[5],c=t[0]*t[6]-t[2]*t[4],u=t[0]*t[5]-t[1]*t[4],l=t[0]*e-t[1]*i+t[2]*n,h=1/l,p=[h*e,-h*o,h*a,0,-h*i,h*r,-h*c,0,h*n,-h*s,h*u,0,0,0,0,1];return p[12]=-t[12]*p[0]-t[13]*p[4]-t[14]*p[8],p[13]=-t[12]*p[1]-t[13]*p[5]-t[14]*p[9],p[14]=-t[12]*p[2]-t[13]*p[6]-t[14]*p[10],p},r.transpose=function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},r.interpret=function(t){var e=[t[0],t[1],t[2]],s=o(e[0]),a=n(e),c=[e[0]+s*a,e[1],e[2]],u=2/i(c);if(u>=1/0)return{translate:r.getTranslate(t),rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]};var l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];l[0]=1-u*c[0]*c[0],l[5]=1-u*c[1]*c[1],l[10]=1-u*c[2]*c[2],l[1]=-u*c[0]*c[1],l[2]=-u*c[0]*c[2],l[6]=-u*c[1]*c[2],l[4]=l[1],l[8]=l[2],l[9]=l[6];var h=r.multiply(l,t),p=[h[5],h[6]],f=o(p[0]),d=n(p),v=[p[0]+f*d,p[1]],y=2/i(v),_=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];_[5]=1-y*v[0]*v[0],_[10]=1-y*v[1]*v[1],_[6]=-y*v[0]*v[1],_[9]=_[6];var g=r.multiply(_,l),m=r.multiply(g,t),S=r.scale(m[0]<0?-1:1,m[5]<0?-1:1,m[10]<0?-1:1);m=r.multiply(m,S),g=r.multiply(S,g);var w={};return w.translate=r.getTranslate(t),w.rotate=[Math.atan2(-g[6],g[10]),Math.asin(g[2]),Math.atan2(-g[1],g[0])],w.rotate[0]||(w.rotate[0]=0,w.rotate[2]=Math.atan2(g[4],g[5])),w.scale=[m[0],m[5],m[10]],w.skew=[Math.atan2(m[9],w.scale[2]),Math.atan2(m[8],w.scale[2]),Math.atan2(m[4],w.scale[0])],Math.abs(w.rotate[0])+Math.abs(w.rotate[2])>1.5*Math.PI&&(w.rotate[1]=Math.PI-w.rotate[1],w.rotate[1]>Math.PI&&(w.rotate[1]-=2*Math.PI),w.rotate[1]<-Math.PI&&(w.rotate[1]+=2*Math.PI),w.rotate[0]<0?w.rotate[0]+=Math.PI:w.rotate[0]-=Math.PI,w.rotate[2]<0?w.rotate[2]+=Math.PI:w.rotate[2]-=Math.PI),w},r.average=function(t,e,i){i=void 0===i?.5:i;for(var n=r.interpret(t),o=r.interpret(e),s={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]},a=0;3>a;a++)s.translate[a]=(1-i)*n.translate[a]+i*o.translate[a],s.rotate[a]=(1-i)*n.rotate[a]+i*o.rotate[a],s.scale[a]=(1-i)*n.scale[a]+i*o.scale[a],s.skew[a]=(1-i)*n.skew[a]+i*o.skew[a];return r.build(s)},r.build=function(t){var e=r.scale(t.scale[0],t.scale[1],t.scale[2]),i=r.skew(t.skew[0],t.skew[1],t.skew[2]),n=r.rotate(t.rotate[0],t.rotate[1],t.rotate[2]);return r.thenMove(r.multiply(r.multiply(n,i),e),t.translate)},r.equals=function(t,e){return!r.notEquals(t,e)},r.notEquals=function(t,e){return t===e?!1:!(t&&e)||t[12]!==e[12]||t[13]!==e[13]||t[14]!==e[14]||t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[4]!==e[4]||t[5]!==e[5]||t[6]!==e[6]||t[8]!==e[8]||t[9]!==e[9]||t[10]!==e[10]},r.normalizeRotation=function(t){var e=t.slice(0);for((e[0]===.5*Math.PI||e[0]===.5*-Math.PI)&&(e[0]=-e[0],e[1]=Math.PI-e[1],e[2]-=Math.PI),e[0]>.5*Math.PI&&(e[0]=e[0]-Math.PI,e[1]=Math.PI-e[1],e[2]-=Math.PI),e[0]<.5*-Math.PI&&(e[0]=e[0]+Math.PI,e[1]=-Math.PI-e[1],e[2]-=Math.PI);e[1]<-Math.PI;)e[1]+=2*Math.PI;for(;e[1]>=Math.PI;)e[1]-=2*Math.PI;for(;e[2]<-Math.PI;)e[2]+=2*Math.PI;for(;e[2]>=Math.PI;)e[2]-=2*Math.PI;return e},r.inFront=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,.001,1],r.behind=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-.001,1],e.exports=r},{}],16:[function(t,e){function i(t){this._node=new r,this._eventInput=new n,this._eventOutput=new n,n.setInputHandler(this,this._eventInput),n.setOutputHandler(this,this._eventOutput),this.options=s.clone(this.constructor.DEFAULT_OPTIONS||i.DEFAULT_OPTIONS),this._optionsManager=new o(this.options),t&&this.setOptions(t)}var n=t("./EventHandler"),o=t("./OptionsManager"),r=t("./RenderNode"),s=t("../utilities/Utility");i.DEFAULT_OPTIONS={},i.prototype.getOptions=function(t){return this._optionsManager.getOptions(t)},i.prototype.setOptions=function(t){this._optionsManager.patch(t)},i.prototype.add=function(){return this._node.add.apply(this._node,arguments)},i.prototype._add=i.prototype.add,i.prototype.render=function(){return this._node.render()},i.prototype.getSize=function(){return this._node&&this._node.getSize?this._node.getSize.apply(this._node,arguments)||this.options.size:this.options.size},e.exports=i},{"../utilities/Utility":95,"./EventHandler":7,"./OptionsManager":10,"./RenderNode":11}],17:[function(t,e){function i(t){t||(t=[]),t instanceof Array&&(t={array:t}),this._=null,this.index=t.index||0,t.array?this._=new this.constructor.Backing(t.array):t._&&(this._=t._),this.index===this._.firstIndex&&(this._.firstNode=this),this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),void 0!==t.loop&&(this._.loop=t.loop),void 0!==t.trackSize&&(this._.trackSize=t.trackSize),this._previousNode=null,this._nextNode=null}i.Backing=function(t){this.array=t,this.firstIndex=0,this.loop=!1,this.firstNode=null,this.lastNode=null,this.cumulativeSizes=[[0,0]],this.sizeDirty=!0,this.trackSize=!1},i.Backing.prototype.getValue=function(t){var e=t-this.firstIndex;return 0>e||e>=this.array.length?null:this.array[e]},i.Backing.prototype.setValue=function(t,e){this.array[t-this.firstIndex]=e},i.Backing.prototype.getSize=function(t){return this.cumulativeSizes[t]},i.Backing.prototype.calculateSize=function(t){t=t||this.array.length;for(var e=[0,0],i=0;t>i;i++){var n=this.array[i].getSize();if(!n)return;void 0!==e[0]&&(void 0===n[0]?e[0]=void 0:e[0]+=n[0]),void 0!==e[1]&&(void 0===n[1]?e[1]=void 0:e[1]+=n[1]),this.cumulativeSizes[i+1]=e.slice()}return this.sizeDirty=!1,e},i.Backing.prototype.reindex=function(t,e,i){if(this.array[0]){for(var n=0,o=this.firstIndex,r=i-e,s=this.firstNode;t-1>o;)s=s.getNext(),o++;var a=s;for(n=0;e>n;n++)s=s.getNext(),s&&(s._previousNode=a);var c=s?s.getNext():null;for(a._nextNode=null,s=a,n=0;i>n;n++)s=s.getNext();if(o+=i,s!==c&&(s._nextNode=c,c&&(c._previousNode=s)),c)for(s=c,o++;s&&o<this.array.length+this.firstIndex;)s._nextNode?s.index+=r:s.index=o,s=s.getNext(),o++;this.trackSize&&(this.sizeDirty=!0)}},i.prototype.getPrevious=function(){var t=this._.array.length;return t?this.index===this._.firstIndex?this._.loop?(this._previousNode=this._.lastNode||new this.constructor({_:this._,index:this._.firstIndex+t-1}),this._previousNode._nextNode=this):this._previousNode=null:this._previousNode||(this._previousNode=new this.constructor({_:this._,index:this.index-1}),this._previousNode._nextNode=this):this._previousNode=null,this._previousNode},i.prototype.getNext=function(){var t=this._.array.length;return t?this.index===this._.firstIndex+t-1?this._.loop?(this._nextNode=this._.firstNode||new this.constructor({_:this._,index:this._.firstIndex}),this._nextNode._previousNode=this):this._nextNode=null:this._nextNode||(this._nextNode=new this.constructor({_:this._,index:this.index+1}),this._nextNode._previousNode=this):this._nextNode=null,this._nextNode},i.prototype.indexOf=function(t){return this._.array.indexOf(t)},i.prototype.getIndex=function(){return this.index},i.prototype.toString=function(){return""+this.index},i.prototype.unshift=function(){this._.array.unshift.apply(this._.array,arguments),this._.firstIndex-=arguments.length,this._.trackSize&&(this._.sizeDirty=!0)},i.prototype.push=function(){this._.array.push.apply(this._.array,arguments),this._.trackSize&&(this._.sizeDirty=!0)},i.prototype.splice=function(t,e){var i=Array.prototype.slice.call(arguments,2);this._.array.splice.apply(this._.array,[t-this._.firstIndex,e].concat(i)),this._.reindex(t,e,i.length)},i.prototype.swap=function(t){var e=t.get(),i=this.get();this._.setValue(this.index,e),this._.setValue(t.index,i);var n=this._previousNode,o=this._nextNode,r=this.index,s=t._previousNode,a=t._nextNode,c=t.index;this.index=c,this._previousNode=s===this?t:s,this._previousNode&&(this._previousNode._nextNode=this),this._nextNode=a===this?t:a,this._nextNode&&(this._nextNode._previousNode=this),t.index=r,t._previousNode=n===t?this:n,t._previousNode&&(t._previousNode._nextNode=t),t._nextNode=o===t?this:o,t._nextNode&&(t._nextNode._previousNode=t),this.index===this._.firstIndex?this._.firstNode=this:this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),t.index===this._.firstIndex?this._.firstNode=t:t.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=t),this._.trackSize&&(this._.sizeDirty=!0)},i.prototype.get=function(){return this._.getValue(this.index)},i.prototype.getSize=function(){var t=this.get();return t?t.getSize():null},i.prototype.render=function(){this._.trackSize&&this._.sizeDirty&&this._.calculateSize();var t=this.get();return t?t.render.apply(t,arguments):null},e.exports=i},{}],18:[function(t,e){e.exports={Context:t("./Context"),ElementAllocator:t("./ElementAllocator"),ElementOutput:t("./ElementOutput"),Engine:t("./Engine"),Entity:t("./Entity"),EventEmitter:t("./EventEmitter"),EventHandler:t("./EventHandler"),Group:t("./Group"),Modifier:t("./Modifier"),OptionsManager:t("./OptionsManager"),RenderNode:t("./RenderNode"),Scene:t("./Scene"),SpecParser:t("./SpecParser"),Surface:t("./Surface"),Transform:t("./Transform"),View:t("./View"),ViewSequence:t("./ViewSequence")}},{"./Context":1,"./ElementAllocator":2,"./ElementOutput":3,"./Engine":4,"./Entity":5,"./EventEmitter":6,"./EventHandler":7,"./Group":8,"./Modifier":9,"./OptionsManager":10,"./RenderNode":11,"./Scene":12,"./SpecParser":13,"./Surface":14,"./Transform":15,"./View":16,"./ViewSequence":17}],19:[function(t,e){function i(t){this.dispatchers={},this.currMode=void 0,this.setMode(t)}var n=t("../core/EventHandler");i.prototype.setMode=function(t){if(t!==this.currMode){var e=this.currMode;this.dispatchers[this.currMode]&&this.dispatchers[this.currMode].trigger("unpipe"),this.currMode=t,this.dispatchers[t]&&this.dispatchers[t].emit("pipe"),this.emit("change",{from:e,to:t})}},i.prototype.forMode=function(t){return this.dispatchers[t]||(this.dispatchers[t]=new n),this.dispatchers[t]},i.prototype.emit=function(t,e){if(void 0===this.currMode)return!1;e||(e={});var i=this.dispatchers[this.currMode];return i?i.trigger(t,e):void 0},e.exports=i},{"../core/EventHandler":7}],20:[function(t,e){function i(t){n.call(this),this._condition=t}var n=t("../core/EventHandler");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.emit=function(t,e){return this._condition(t,e)?n.prototype.emit.apply(this,arguments):void 0},i.prototype.trigger=i.prototype.emit,e.exports=i},{"../core/EventHandler":7}],21:[function(t,e){function i(t){n.call(this),this._mappingFunction=t}var n=t("../core/EventHandler");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.subscribe=null,i.prototype.unsubscribe=null,i.prototype.emit=function(t,e){var i=this._mappingFunction.apply(this,arguments);i&&i.emit instanceof Function&&i.emit(t,e)},i.prototype.trigger=i.prototype.emit,e.exports=i},{"../core/EventHandler":7}],22:[function(t,e){e.exports={EventArbiter:t("./EventArbiter"),EventFilter:t("./EventFilter"),EventMapper:t("./EventMapper")}},{"./EventArbiter":19,"./EventFilter":20,"./EventMapper":21}],23:[function(t,e){e.exports={core:t("./core"),events:t("./events"),inputs:t("./inputs"),math:t("./math"),modifiers:t("./modifiers"),physics:t("./physics"),surfaces:t("./surfaces"),transitions:t("./transitions"),utilities:t("./utilities"),views:t("./views"),widgets:t("./widgets")}},{"./core":18,"./events":22,"./inputs":36,"./math":42,"./modifiers":47,"./physics":71,"./surfaces":82,"./transitions":92,"./utilities":96,"./views":112,"./widgets":117}],24:[function(t,e){function i(t,e){void 0===e&&(e="update"),this._state=t&&t.get&&t.set?t:new r(t||0),this._eventInput=new o,o.setInputHandler(this,this._eventInput),this._eventInput.on(e,n.bind(this))}function n(t){var e=t.delta,i=this.get();if(e.constructor===i.constructor){var n=e instanceof Array?[i[0]+e[0],i[1]+e[1]]:i+e;this.set(n)}}var o=t("../core/EventHandler"),r=t("../transitions/Transitionable");i.prototype.get=function(){return this._state.get()},i.prototype.set=function(t){this._state.set(t)},e.exports=i},{"../core/EventHandler":7,"../transitions/Transitionable":88}],25:[function(){function t(t){window.addEventListener(t,function(t){return t.stopPropagation(),!1},!0)}var e="ontouchstart"in window;e&&(t("mousedown"),t("mousemove"),t("mouseup"),t("mouseleave"))},{}],26:[function(){!function(){if(window.CustomEvent){var t=300,e=500,i={},n={},o=Date.now;window.addEventListener("touchstart",function(t){for(var e=o(),n=0;n<t.changedTouches.length;n++){var r=t.changedTouches[n];i[r.identifier]=e}}),window.addEventListener("touchmove",function(t){for(var e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e];delete i[n.identifier]}}),window.addEventListener("touchend",function(e){for(var r=o(),s=0;s<e.changedTouches.length;s++){var a=e.changedTouches[s],c=i[a.identifier];if(c&&t>r-c){var u=new window.CustomEvent("click",{bubbles:!0,detail:a});n[r]=e,e.target.dispatchEvent(u)}delete i[a.identifier]}}),window.addEventListener("click",function(t){var i=o();for(var r in n){var s=n[r];e>i-r?t instanceof window.MouseEvent&&t.target===s.target&&t.stopPropagation():delete n[r]}},!0)}}()},{}],27:[function(t,e){function i(t,e){this._eventInput=new o,this._eventOutput=new o,o.setInputHandler(this,this._eventInput),o.setOutputHandler(this,this._eventOutput),this._syncs={},t&&this.addSync(t),e&&this.setOptions(e)}function n(t,e){r[t]&&(this._syncs[t]=new r[t](e),this.pipeSync(t))}var o=t("../core/EventHandler");i.DIRECTION_X=0,i.DIRECTION_Y=1,i.DIRECTION_Z=2;var r={};i.register=function(t){for(var e in t)if(r[e]){if(r[e]!==t[e])throw new Error("Conflicting sync classes for key: "+e)}else r[e]=t[e]},i.prototype.setOptions=function(t){for(var e in this._syncs)this._syncs[e].setOptions(t)},i.prototype.pipeSync=function(t){var e=this._syncs[t];this._eventInput.pipe(e),e.pipe(this._eventOutput)},i.prototype.unpipeSync=function(t){var e=this._syncs[t];this._eventInput.unpipe(e),e.unpipe(this._eventOutput)},i.prototype.addSync=function(t){if(t instanceof Array)for(var e=0;e<t.length;e++)n.call(this,t[e]);else if(t instanceof Object)for(var i in t)n.call(this,i,t[i])},e.exports=i},{"../core/EventHandler":7}],28:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new c(this.options),t&&this.setOptions(t),this._eventInput=new a,this._eventOutput=new a,a.setInputHandler(this,this._eventInput),a.setOutputHandler(this,this._eventOutput),this._eventInput.on("mousedown",n.bind(this)),this._eventInput.on("mousemove",o.bind(this)),this._eventInput.on("mouseup",r.bind(this)),this.options.propogate?this._eventInput.on("mouseleave",s.bind(this)):this._eventInput.on("mouseleave",r.bind(this)),this.options.clickThreshold&&window.addEventListener("click",function(t){Math.sqrt(Math.pow(this._displacement[0],2)+Math.pow(this._displacement[1],2))>this.options.clickThreshold&&t.stopPropagation()}.bind(this),!0),this._payload={delta:null,position:null,velocity:null,clientX:0,clientY:0,offsetX:0,offsetY:0},this._positionHistory=[],this._position=null,this._prevCoord=void 0,this._prevTime=void 0,this._down=!1,this._moved=!1,this._displacement=[0,0],this._documentActive=!1}function n(t){var e,i;this.options.preventDefault&&t.preventDefault();var n=t.clientX,o=t.clientY;this._prevCoord=[n,o],this._prevTime=Date.now(),this._down=!0,this._move=!1,void 0!==this.options.direction?(this._position=0,e=0,i=0):(this._position=[0,0],e=[0,0],i=[0,0]),this.options.clickThreshold&&(this._displacement=[0,0]);var r=this._payload;r.delta=e,r.position=this._position,r.velocity=i,r.clientX=n,r.clientY=o,r.offsetX=t.offsetX,r.offsetY=t.offsetY,this._positionHistory.push({position:r.position.slice?r.position.slice(0):r.position,time:this._prevTime}),this._eventOutput.emit("start",r),this._documentActive=!1}function o(t){if(this._prevCoord){var e=this._prevCoord;this._prevTime;var n=t.clientX,o=t.clientY,r=Date.now(),s=n-e[0],a=o-e[1];this.options.rails&&(Math.abs(s)>Math.abs(a)?a=0:s=0);var c,l,h=Math.max(r-this._positionHistory[0].time,u),p=this.options.scale;this.options.direction===i.DIRECTION_X?(l=p*s,this._position+=l,c=p*(this._position-this._positionHistory[0].position)/h):this.options.direction===i.DIRECTION_Y?(l=p*a,this._position+=l,c=p*(this._position-this._positionHistory[0].position)/h):(l=[p*s,p*a],c=[p*(this._position[0]-this._positionHistory[0].position[0])/h,p*(this._position[1]-this._positionHistory[0].position[1])/h],this._position[0]+=l[0],this._position[1]+=l[1]),this.options.clickThreshold!==!1&&(this._displacement[0]+=s,this._displacement[1]+=a);var f=this._payload;f.delta=l,f.position=this._position,f.velocity=c,f.clientX=n,f.clientY=o,f.offsetX=t.offsetX,f.offsetY=t.offsetY,this._positionHistory.length===this.options.velocitySampleLength&&this._positionHistory.shift(),this._positionHistory.push({position:f.position.slice?f.position.slice(0):f.position,time:r}),this._eventOutput.emit("update",f),this._prevCoord=[n,o],this._prevTime=r,this._move=!0}}function r(){this._down&&(this._eventOutput.emit("end",this._payload),this._prevCoord=void 0,this._prevTime=void 0,this._down=!1,this._move=!1,this._positionHistory=[])}function s(t){if(this._down&&this._move&&!this._documentActive){var e=o.bind(this),i=function(t){r.call(this,t),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",i)}.bind(this,t);document.addEventListener("mousemove",e),document.addEventListener("mouseup",i),this._documentActive=!0}}var a=t("../core/EventHandler"),c=t("../core/OptionsManager");i.DEFAULT_OPTIONS={clickThreshold:void 0,direction:void 0,rails:!1,scale:1,propogate:!0,velocitySampleLength:10,preventDefault:!0},i.DIRECTION_X=0,i.DIRECTION_Y=1;var u=8;i.prototype.getOptions=function(){return this.options},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.exports=i},{"../core/EventHandler":7,"../core/OptionsManager":10}],29:[function(t,e){function i(t){n.call(this),this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new o(this.options),t&&this.setOptions(t),this._displacement=0,this._previousDistance=0}var n=t("./TwoFingerSync"),o=t("../core/OptionsManager");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={scale:1},i.prototype._startUpdate=function(t){this._previousDistance=n.calculateDistance(this.posA,this.posB),this._displacement=0,this._eventOutput.emit("start",{count:t.touches.length,touches:[this.touchAId,this.touchBId],distance:this._dist,center:n.calculateCenter(this.posA,this.posB)})},i.prototype._moveUpdate=function(t){var e=n.calculateDistance(this.posA,this.posB),i=n.calculateCenter(this.posA,this.posB),o=this.options.scale,r=o*(e-this._previousDistance),s=r/t;this._previousDistance=e,this._displacement+=r,this._eventOutput.emit("update",{delta:r,velocity:s,distance:e,displacement:this._displacement,center:i,touches:[this.touchAId,this.touchBId]})},i.prototype.getOptions=function(){return this.options},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.exports=i},{"../core/OptionsManager":10,"./TwoFingerSync":35}],30:[function(t,e){function i(t){n.call(this),this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new o(this.options),t&&this.setOptions(t),this._angle=0,this._previousAngle=0}var n=t("./TwoFingerSync"),o=t("../core/OptionsManager");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={scale:1},i.prototype._startUpdate=function(t){this._angle=0,this._previousAngle=n.calculateAngle(this.posA,this.posB);var e=n.calculateCenter(this.posA,this.posB);this._eventOutput.emit("start",{count:t.touches.length,angle:this._angle,center:e,touches:[this.touchAId,this.touchBId]})},i.prototype._moveUpdate=function(t){var e=this.options.scale,i=n.calculateAngle(this.posA,this.posB),o=n.calculateCenter(this.posA,this.posB),r=e*(i-this._previousAngle),s=r/t;this._angle+=r,this._eventOutput.emit("update",{delta:r,velocity:s,angle:this._angle,center:o,touches:[this.touchAId,this.touchBId]}),this._previousAngle=i},i.prototype.getOptions=function(){return this.options},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.exports=i},{"../core/OptionsManager":10,"./TwoFingerSync":35}],31:[function(t,e){function i(t){o.call(this),this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new r(this.options),t&&this.setOptions(t),this._scaleFactor=1,this._startDist=0,this._eventInput.on("pipe",n.bind(this))}function n(){this.touchAId=void 0,this.touchBId=void 0}var o=t("./TwoFingerSync"),r=t("../core/OptionsManager");i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={scale:1},i.prototype._startUpdate=function(t){this._scaleFactor=1,this._startDist=o.calculateDistance(this.posA,this.posB),this._eventOutput.emit("start",{count:t.touches.length,touches:[this.touchAId,this.touchBId],distance:this._startDist,center:o.calculateCenter(this.posA,this.posB)})},i.prototype._moveUpdate=function(t){var e=this.options.scale,i=o.calculateDistance(this.posA,this.posB),n=o.calculateCenter(this.posA,this.posB),r=(i-this._startDist)/this._startDist,s=Math.max(1+e*r,0),a=(s-this._scaleFactor)/t;this._eventOutput.emit("update",{delta:r,scale:s,velocity:a,distance:i,center:n,touches:[this.touchAId,this.touchBId]}),this._scaleFactor=s},i.prototype.getOptions=function(){return this.options},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.exports=i},{"../core/OptionsManager":10,"./TwoFingerSync":35}],32:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new a(this.options),t&&this.setOptions(t),this._payload={delta:null,position:null,velocity:null,slip:!0},this._eventInput=new r,this._eventOutput=new r,r.setInputHandler(this,this._eventInput),r.setOutputHandler(this,this._eventOutput),this._position=void 0===this.options.direction?[0,0]:0,this._prevTime=void 0,this._prevVel=void 0,this._eventInput.on("mousewheel",o.bind(this)),this._eventInput.on("wheel",o.bind(this)),this._inProgress=!1,this._loopBound=!1}function n(){if(this._inProgress&&u()-this._prevTime>this.options.stallTime){this._inProgress=!1;var t=Math.abs(this._prevVel)>=this.options.minimumEndSpeed?this._prevVel:0,e=this._payload;e.position=this._position,e.velocity=t,e.slip=!0,this._eventOutput.emit("end",e)}}function o(t){this.options.preventDefault&&t.preventDefault(),this._inProgress||(this._inProgress=!0,this._position=void 0===this.options.direction?[0,0]:0,y=this._payload,y.slip=!0,y.position=this._position,y.clientX=t.clientX,y.clientY=t.clientY,y.offsetX=t.offsetX,y.offsetY=t.offsetY,this._eventOutput.emit("start",y),this._loopBound||(s.on("prerender",n.bind(this)),this._loopBound=!0));var e=u(),o=this._prevTime||e,r=void 0!==t.wheelDeltaX?t.wheelDeltaX:-t.deltaX,a=void 0!==t.wheelDeltaY?t.wheelDeltaY:-t.deltaY;1===t.deltaMode&&(r*=this.options.lineHeight,a*=this.options.lineHeight),this.options.rails&&(Math.abs(r)>Math.abs(a)?a=0:r=0);var l,h,p=Math.max(e-o,c),f=r/p,d=a/p,v=this.options.scale;this.options.direction===i.DIRECTION_X?(h=v*r,l=v*f,this._position+=h):this.options.direction===i.DIRECTION_Y?(h=v*a,l=v*d,this._position+=h):(h=[v*r,v*a],l=[v*f,v*d],this._position[0]+=h[0],this._position[1]+=h[1]);var y=this._payload;y.delta=h,y.velocity=l,y.position=this._position,y.slip=!0,this._eventOutput.emit("update",y),this._prevTime=e,this._prevVel=l}var r=t("../core/EventHandler"),s=t("../core/Engine"),a=t("../core/OptionsManager");i.DEFAULT_OPTIONS={direction:void 0,minimumEndSpeed:1/0,rails:!1,scale:1,stallTime:50,lineHeight:40,preventDefault:!0},i.DIRECTION_X=0,i.DIRECTION_Y=1;var c=8,u=Date.now;i.prototype.getOptions=function(){return this.options},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.exports=i},{"../core/Engine":4,"../core/EventHandler":7,"../core/OptionsManager":10}],33:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new c(this.options),t&&this.setOptions(t),this._eventOutput=new a,this._touchTracker=new s({touchLimit:this.options.touchLimit}),a.setOutputHandler(this,this._eventOutput),a.setInputHandler(this,this._touchTracker),this._touchTracker.on("trackstart",n.bind(this)),this._touchTracker.on("trackmove",o.bind(this)),this._touchTracker.on("trackend",r.bind(this)),this._payload={delta:null,position:null,velocity:null,clientX:void 0,clientY:void 0,count:0,touch:void 0},this._position=null}function n(t){var e,i;void 0!==this.options.direction?(this._position=0,e=0,i=0):(this._position=[0,0],e=[0,0],i=[0,0]);var n=this._payload;n.delta=i,n.position=this._position,n.velocity=e,n.clientX=t.x,n.clientY=t.y,n.count=t.count,n.touch=t.identifier,this._eventOutput.emit("start",n)}function o(t){var e=t.history,n=e[e.length-1],o=e[e.length-2],r=e[e.length-this.options.velocitySampleLength]?e[e.length-this.options.velocitySampleLength]:e[e.length-2],s=r.timestamp,a=n.timestamp,c=n.x-o.x,l=n.y-o.y,h=n.x-r.x,p=n.y-r.y;this.options.rails&&(Math.abs(c)>Math.abs(l)?l=0:c=0,Math.abs(h)>Math.abs(p)?p=0:h=0);var f,d,v=Math.max(a-s,u),y=h/v,_=p/v,g=this.options.scale;this.options.direction===i.DIRECTION_X?(d=g*c,f=g*y,this._position+=d):this.options.direction===i.DIRECTION_Y?(d=g*l,f=g*_,this._position+=d):(d=[g*c,g*l],f=[g*y,g*_],this._position[0]+=d[0],this._position[1]+=d[1]);var m=this._payload;m.delta=d,m.velocity=f,m.position=this._position,m.clientX=t.x,m.clientY=t.y,m.count=t.count,m.touch=t.identifier,this._eventOutput.emit("update",m)}function r(t){this._payload.count=t.count,this._eventOutput.emit("end",this._payload)}var s=t("./TouchTracker"),a=t("../core/EventHandler"),c=t("../core/OptionsManager");i.DEFAULT_OPTIONS={direction:void 0,rails:!1,touchLimit:1,velocitySampleLength:10,scale:1},i.DIRECTION_X=0,i.DIRECTION_Y=1;var u=8;i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},i.prototype.getOptions=function(){return this.options},e.exports=i},{"../core/EventHandler":7,"../core/OptionsManager":10,"./TouchTracker":34}],34:[function(t,e){function i(t,e,i){return{x:t.clientX,y:t.clientY,identifier:t.identifier,origin:e.origin,timestamp:u(),count:e.touches.length,history:i}}function n(t){if(!(t.touches.length>this.touchLimit)){this.isTouched=!0;for(var e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e],o=i(n,t,null);this.eventOutput.emit("trackstart",o),this.selective||this.touchHistory[n.identifier]||this.track(o)}}}function o(t){if(!(t.touches.length>this.touchLimit))for(var e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e],o=this.touchHistory[n.identifier];if(o){var r=i(n,t,o);this.touchHistory[n.identifier].push(r),this.eventOutput.emit("trackmove",r)}}}function r(t){if(this.isTouched){for(var e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e],o=this.touchHistory[n.identifier];if(o){var r=i(n,t,o);this.eventOutput.emit("trackend",r),delete this.touchHistory[n.identifier]}}this.isTouched=!1}}function s(){for(var t in this.touchHistory){var e=this.touchHistory[t];this.eventOutput.emit("trackend",{touch:e[e.length-1].touch,timestamp:Date.now(),count:0,history:e}),delete this.touchHistory[t]}}function a(t){this.selective=t.selective,this.touchLimit=t.touchLimit||1,this.touchHistory={},this.eventInput=new c,this.eventOutput=new c,c.setInputHandler(this,this.eventInput),c.setOutputHandler(this,this.eventOutput),this.eventInput.on("touchstart",n.bind(this)),this.eventInput.on("touchmove",o.bind(this)),this.eventInput.on("touchend",r.bind(this)),this.eventInput.on("touchcancel",r.bind(this)),this.eventInput.on("unpipe",s.bind(this)),this.isTouched=!1}var c=t("../core/EventHandler"),u=Date.now;a.prototype.track=function(t){this.touchHistory[t.identifier]=[t]},e.exports=a},{"../core/EventHandler":7}],35:[function(t,e){function i(){this._eventInput=new n,this._eventOutput=new n,n.setInputHandler(this,this._eventInput),n.setOutputHandler(this,this._eventOutput),this.touchAEnabled=!1,this.touchAId=0,this.posA=null,this.timestampA=0,this.touchBEnabled=!1,this.touchBId=0,this.posB=null,this.timestampB=0,this._eventInput.on("touchstart",this.handleStart.bind(this)),this._eventInput.on("touchmove",this.handleMove.bind(this)),this._eventInput.on("touchend",this.handleEnd.bind(this)),this._eventInput.on("touchcancel",this.handleEnd.bind(this))}var n=t("../core/EventHandler");i.calculateAngle=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.atan2(n,i)},i.calculateDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},i.calculateCenter=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]};var o=Date.now;i.prototype.handleStart=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];this.touchAEnabled?this.touchBEnabled||(this.touchBId=i.identifier,this.touchBEnabled=!0,this.posB=[i.pageX,i.pageY],this.timestampB=o(),this._startUpdate(t)):(this.touchAId=i.identifier,this.touchAEnabled=!0,this.posA=[i.pageX,i.pageY],this.timestampA=o())}},i.prototype.handleMove=function(t){if(this.touchAEnabled&&this.touchBEnabled){for(var e,i=this.timestampA,n=this.timestampB,r=0;r<t.changedTouches.length;r++){var s=t.changedTouches[r];s.identifier===this.touchAId?(this.posA=[s.pageX,s.pageY],this.timestampA=o(),e=this.timestampA-i):s.identifier===this.touchBId&&(this.posB=[s.pageX,s.pageY],this.timestampB=o(),e=this.timestampB-n)}e&&this._moveUpdate(e)}},i.prototype.handleEnd=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];(i.identifier===this.touchAId||i.identifier===this.touchBId)&&(this.touchAEnabled&&this.touchBEnabled&&this._eventOutput.emit("end",{touches:[this.touchAId,this.touchBId],angle:this._angle}),this.touchAEnabled=!1,this.touchAId=0,this.touchBEnabled=!1,this.touchBId=0)}},e.exports=i},{"../core/EventHandler":7}],36:[function(t,e){e.exports={Accumulator:t("./Accumulator"),DesktopEmulationMode:t("./DesktopEmulationMode"),FastClick:t("./FastClick"),GenericSync:t("./GenericSync"),MouseSync:t("./MouseSync"),PinchSync:t("./PinchSync"),RotateSync:t("./RotateSync"),ScaleSync:t("./ScaleSync"),ScrollSync:t("./ScrollSync"),TouchSync:t("./TouchSync"),TouchTracker:t("./TouchTracker"),
TwoFingerSync:t("./TwoFingerSync")}},{"./Accumulator":24,"./DesktopEmulationMode":25,"./FastClick":26,"./GenericSync":27,"./MouseSync":28,"./PinchSync":29,"./RotateSync":30,"./ScaleSync":31,"./ScrollSync":32,"./TouchSync":33,"./TouchTracker":34,"./TwoFingerSync":35}],37:[function(t,e){function i(t){return this.values=t||[[1,0,0],[0,1,0],[0,0,1]],this}var n=t("./Vector"),o=new i,r=new n;i.prototype.get=function(){return this.values},i.prototype.set=function(t){this.values=t},i.prototype.vectorMultiply=function(t){var e=this.get(),i=t.x,n=t.y,o=t.z,s=e[0],a=e[1],c=e[2],u=s[0],l=s[1],h=s[2],p=a[0],f=a[1],d=a[2],v=c[0],y=c[1],_=c[2];return r.setXYZ(u*i+l*n+h*o,p*i+f*n+d*o,v*i+y*n+_*o)},i.prototype.multiply=function(t){for(var e=this.get(),i=[[]],n=0;3>n;n++){i[n]=[];for(var r=0;3>r;r++){for(var s=0,a=0;3>a;a++)s+=e[n][a]*t[a][r];i[n][r]=s}}return o.set(i)},i.prototype.transpose=function(){for(var t=[[],[],[]],e=this.get(),i=0;3>i;i++)for(var n=0;3>n;n++)t[i][n]=e[n][i];return o.set(t)},i.prototype.clone=function(){for(var t=this.get(),e=[],n=0;3>n;n++)e[n]=t[n].slice();return new i(e)},e.exports=i},{"./Vector":41}],38:[function(t,e){function i(t,e,i,n){return 1===arguments.length?this.set(t):(this.w=void 0!==t?t:1,this.x=void 0!==e?e:0,this.y=void 0!==i?i:0,this.z=void 0!==n?n:0),this}var n=t("./Matrix"),o=new i(1,0,0,0);i.prototype.add=function(t){return o.setWXYZ(this.w+t.w,this.x+t.x,this.y+t.y,this.z+t.z)},i.prototype.sub=function(t){return o.setWXYZ(this.w-t.w,this.x-t.x,this.y-t.y,this.z-t.z)},i.prototype.scalarDivide=function(t){return this.scalarMultiply(1/t)},i.prototype.scalarMultiply=function(t){return o.setWXYZ(this.w*t,this.x*t,this.y*t,this.z*t)},i.prototype.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=t.x,a=t.y,c=t.z,u=t.w||0;return o.setWXYZ(r*u-e*s-i*a-n*c,e*u+s*r+a*n-i*c,i*u+a*r+e*c-s*n,n*u+c*r+s*i-e*a)};var r=new i(1,0,0,0);i.prototype.rotateVector=function(t){return r.set(this.conj()),o.set(this.multiply(t).multiply(r))},i.prototype.inverse=function(){return o.set(this.conj().scalarDivide(this.normSquared()))},i.prototype.negate=function(){return this.scalarMultiply(-1)},i.prototype.conj=function(){return o.setWXYZ(this.w,-this.x,-this.y,-this.z)},i.prototype.normalize=function(t){return t=void 0===t?1:t,this.scalarDivide(t*this.norm())},i.prototype.makeFromAngleAndAxis=function(t,e){var i=e.normalize(),n=.5*t,o=-Math.sin(n);return this.x=o*i.x,this.y=o*i.y,this.z=o*i.z,this.w=Math.cos(n),this},i.prototype.setWXYZ=function(t,e,i,n){return o.clear(),this.w=t,this.x=e,this.y=i,this.z=n,this},i.prototype.set=function(t){return t instanceof Array?(this.w=0,this.x=t[0],this.y=t[1],this.z=t[2]):(this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z),this!==o&&o.clear(),this},i.prototype.put=function(t){t.set(o)},i.prototype.clone=function(){return new i(this)},i.prototype.clear=function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},i.prototype.isEqual=function(t){return t.w===this.w&&t.x===this.x&&t.y===this.y&&t.z===this.z},i.prototype.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.normSquared=function(){return this.dot(this)},i.prototype.norm=function(){return Math.sqrt(this.normSquared())},i.prototype.isZero=function(){return!(this.x||this.y||this.z)},i.prototype.getTransform=function(){var t=this.normalize(1),e=t.x,i=t.y,n=t.z,o=t.w;return[1-2*i*i-2*n*n,2*e*i-2*n*o,2*e*n+2*i*o,0,2*e*i+2*n*o,1-2*e*e-2*n*n,2*i*n-2*e*o,0,2*e*n-2*i*o,2*i*n+2*e*o,1-2*e*e-2*i*i,0,0,0,0,1]};var s=new n;i.prototype.getMatrix=function(){var t=this.normalize(1),e=t.x,i=t.y,n=t.z,o=t.w;return s.set([[1-2*i*i-2*n*n,2*e*i+2*n*o,2*e*n-2*i*o],[2*e*i-2*n*o,1-2*e*e-2*n*n,2*i*n+2*e*o],[2*e*n+2*i*o,2*i*n-2*e*o,1-2*e*e-2*i*i]])};var a=1e-5;i.prototype.slerp=function(t,e){var i,n,r,s,c;return n=this.dot(t),1-n>a?(i=Math.acos(n),r=Math.sin(i),s=Math.sin((1-e)*i)/r,c=Math.sin(e*i)/r):(s=1-e,c=e),o.set(this.scalarMultiply(s/c).add(t).scalarMultiply(c))},e.exports=i},{"./Matrix":37}],39:[function(t,e){function i(t,e){return t+r()*(e-t)}function n(t,e){return t+(r()*(e-t+1)>>0)}function o(t,e,i,n){if(e=void 0!==e?e:0,i=void 0!==i?i:1,void 0!==n){for(var o=[],r=0;n>r;r++)o.push(t(e,i));return o}return t(e,i)}var r=Math.random,s={};s.integer=function(t,e,i){return o(n,t,e,i)},s.range=function(t,e,n){return o(i,t,e,n)},s.sign=function(t){return s.bool(t)?1:-1},s.bool=function(t){return t=void 0!==t?t:.5,r()<t},e.exports=s},{}],40:[function(t,e){var i={};i.clamp=function(t,e){return Math.max(Math.min(t,e[1]),e[0])},i.length=function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i]*t[i];return Math.sqrt(e)},e.exports=i},{}],41:[function(t,e){function i(t,e,i){return 1===arguments.length&&void 0!==t?this.set(t):(this.x=t||0,this.y=e||0,this.z=i||0),this}function n(t,e,i){return this.x=t,this.y=e,this.z=i,this}function o(t){return n.call(this,t[0],t[1],t[2]||0)}function r(t){return n.call(this,t.x,t.y,t.z)}function s(t){return n.call(this,t,0,0)}var a=new i(0,0,0);i.prototype.add=function(t){return n.call(a,this.x+t.x,this.y+t.y,this.z+t.z)},i.prototype.sub=function(t){return n.call(a,this.x-t.x,this.y-t.y,this.z-t.z)},i.prototype.mult=function(t){return n.call(a,t*this.x,t*this.y,t*this.z)},i.prototype.div=function(t){return this.mult(1/t)},i.prototype.cross=function(t){var e=this.x,i=this.y,o=this.z,r=t.x,s=t.y,c=t.z;return n.call(a,o*s-i*c,e*c-o*r,i*r-e*s)},i.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},i.prototype.rotateX=function(t){var e=this.x,i=this.y,o=this.z,r=Math.cos(t),s=Math.sin(t);return n.call(a,e,i*r-o*s,i*s+o*r)},i.prototype.rotateY=function(t){var e=this.x,i=this.y,o=this.z,r=Math.cos(t),s=Math.sin(t);return n.call(a,o*s+e*r,i,o*r-e*s)},i.prototype.rotateZ=function(t){var e=this.x,i=this.y,o=this.z,r=Math.cos(t),s=Math.sin(t);return n.call(a,e*r-i*s,e*s+i*r,o)},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.normSquared=function(){return this.dot(this)},i.prototype.norm=function(){return Math.sqrt(this.normSquared())},i.prototype.normalize=function(t){0===arguments.length&&(t=1);var e=this.norm();return e>1e-7?r.call(a,this.mult(t/e)):n.call(a,t,0,0)},i.prototype.clone=function(){return new i(this)},i.prototype.isZero=function(){return!(this.x||this.y||this.z)},i.prototype.set=function(t){return t instanceof Array?o.call(this,t):"number"==typeof t?s.call(this,t):r.call(this,t)},i.prototype.setXYZ=function(){return n.apply(this,arguments)},i.prototype.set1D=function(t){return s.call(this,t)},i.prototype.put=function(t){this===a?r.call(t,a):r.call(t,this)},i.prototype.clear=function(){return n.call(this,0,0,0)},i.prototype.cap=function c(c){if(1/0===c)return r.call(a,this);var t=this.norm();return t>c?r.call(a,this.mult(c/t)):r.call(a,this)},i.prototype.project=function(t){return t.mult(this.dot(t))},i.prototype.reflectAcross=function(t){return t.normalize().put(t),r(a,this.sub(this.project(t).mult(2)))},i.prototype.get=function(){return[this.x,this.y,this.z]},i.prototype.get1D=function(){return this.x},e.exports=i},{}],42:[function(t,e){e.exports={Matrix:t("./Matrix"),Quaternion:t("./Quaternion"),Random:t("./Random"),Utilities:t("./Utilities"),Vector:t("./Vector")}},{"./Matrix":37,"./Quaternion":38,"./Random":39,"./Utilities":40,"./Vector":41}],43:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),this._positionState=new u([0,0]),this._differential=[0,0],this._active=!0,this.sync=new p(["mouse","touch"],{scale:this.options.scale}),this.eventOutput=new l,l.setInputHandler(this,this.sync),l.setOutputHandler(this,this.eventOutput),a.call(this)}function n(t){var e=this.options,i=e.projection,n=e.snapX,o=e.snapY,r=i&v.x?t[0]:0,s=i&v.y?t[1]:0;return n>0&&(r-=r%n),o>0&&(s-=s%o),[r,s]}function o(){this._active&&(this._positionState.isActive()&&this._positionState.halt(),this.eventOutput.emit("start",{position:this.getPosition()}))}function r(t){if(this._active){var e=this.options;this._differential=t.position;var i=n.call(this,this._differential);this._differential[0]-=i[0],this._differential[1]-=i[1];var o=this.getPosition();if(o[0]+=i[0],o[1]+=i[1],e.xRange){var r=[e.xRange[0]+.5*e.snapX,e.xRange[1]-.5*e.snapX];o[0]=y(o[0],r)}if(e.yRange){var s=[e.yRange[0]+.5*e.snapY,e.yRange[1]-.5*e.snapY];o[1]=y(o[1],s)}this.eventOutput.emit("update",{position:o})}}function s(){this._active&&this.eventOutput.emit("end",{position:this.getPosition()})}function a(){this.sync.on("start",o.bind(this)),this.sync.on("update",r.bind(this)),this.sync.on("end",s.bind(this))}var c=t("../core/Transform"),u=t("../transitions/Transitionable"),l=t("../core/EventHandler"),h=t("../math/Utilities"),p=t("../inputs/GenericSync"),f=t("../inputs/MouseSync"),d=t("../inputs/TouchSync");p.register({mouse:f,touch:d});var v={x:1,y:2};i.DIRECTION_X=v.x,i.DIRECTION_Y=v.y;var y=h.clamp;i.DEFAULT_OPTIONS={projection:v.x|v.y,scale:1,xRange:null,yRange:null,snapX:0,snapY:0,transition:{duration:0}},i.prototype.setOptions=function(t){var e=this.options;if(void 0!==t.projection){var i=t.projection;this.options.projection=0,["x","y"].forEach(function(t){-1!==i.indexOf(t)&&(e.projection|=v[t])})}void 0!==t.scale&&(e.scale=t.scale,this.sync.setOptions({scale:t.scale})),void 0!==t.xRange&&(e.xRange=t.xRange),void 0!==t.yRange&&(e.yRange=t.yRange),void 0!==t.snapX&&(e.snapX=t.snapX),void 0!==t.snapY&&(e.snapY=t.snapY)},i.prototype.getPosition=function(){return this._positionState.get()},i.prototype.setRelativePosition=function(t,e,i){var n=this.getPosition(),o=[n[0]+t[0],n[1]+t[1]];this.setPosition(o,e,i)},i.prototype.setPosition=function(t,e,i){this._positionState.isActive()&&this._positionState.halt(),this._positionState.set(t,e,i)},i.prototype.activate=function(){this._active=!0},i.prototype.deactivate=function(){this._active=!1},i.prototype.toggle=function(){this._active=!this._active},i.prototype.modify=function(t){var e=this.getPosition();return{transform:c.translate(e[0],e[1]),target:t}},e.exports=i},{"../core/EventHandler":7,"../core/Transform":15,"../inputs/GenericSync":27,"../inputs/MouseSync":28,"../inputs/TouchSync":33,"../math/Utilities":40,"../transitions/Transitionable":88}],44:[function(t,e){function i(t,e){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new o(this.options),t&&this.setOptions(t),e||(e=0),this.transitionHelper=new n(e)}var n=t("../transitions/Transitionable"),o=t("../core/OptionsManager");i.DEFAULT_OPTIONS={cull:!1,transition:!0,pulseInTransition:!0,pulseOutTransition:!0},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},i.prototype.show=function(t,e){t=t||this.options.transition,this.set(1,t,e)},i.prototype.hide=function(t,e){t=t||this.options.transition,this.set(0,t,e)},i.prototype.set=function(t,e,i){this.halt(),this.transitionHelper.set(t,e,i)},i.prototype.halt=function(){this.transitionHelper.halt()},i.prototype.isVisible=function(){return this.transitionHelper.get()>0},i.prototype.modify=function(t){var e=this.transitionHelper.get();return this.options.cull&&!e?void 0:{opacity:e,target:t}},e.exports=i},{"../core/OptionsManager":10,"../transitions/Transitionable":88}],45:[function(t,e){function i(){this._chain=[],arguments.length&&this.addModifier.apply(this,arguments)}i.prototype.addModifier=function(){Array.prototype.push.apply(this._chain,arguments)},i.prototype.removeModifier=function(t){var e=this._chain.indexOf(t);0>e||this._chain.splice(e,1)},i.prototype.modify=function(t){for(var e=this._chain,i=t,n=0;n<e.length;n++)i=e[n].modify(i);return i},e.exports=i},{}],46:[function(t,e){function i(t){this._transformState=new s(o.identity),this._opacityState=new r(1),this._originState=new r([0,0]),this._alignState=new r([0,0]),this._sizeState=new r([0,0]),this._proportionsState=new r([0,0]),this._modifier=new n({transform:this._transformState,opacity:this._opacityState,origin:null,align:null,size:null,proportions:null}),this._hasOrigin=!1,this._hasAlign=!1,this._hasSize=!1,this._hasProportions=!1,t&&(t.transform&&this.setTransform(t.transform),void 0!==t.opacity&&this.setOpacity(t.opacity),t.origin&&this.setOrigin(t.origin),t.align&&this.setAlign(t.align),t.size&&this.setSize(t.size),t.proportions&&this.setProportions(t.proportions))}var n=t("../core/Modifier"),o=t("../core/Transform"),r=t("../transitions/Transitionable"),s=t("../transitions/TransitionableTransform");i.prototype.setTransform=function(t,e,i){return this._transformState.set(t,e,i),this},i.prototype.setOpacity=function(t,e,i){return this._opacityState.set(t,e,i),this},i.prototype.setOrigin=function(t,e,i){return null===t?(this._hasOrigin&&(this._modifier.originFrom(null),this._hasOrigin=!1),this):(this._hasOrigin||(this._hasOrigin=!0,this._modifier.originFrom(this._originState)),this._originState.set(t,e,i),this)},i.prototype.setAlign=function(t,e,i){return null===t?(this._hasAlign&&(this._modifier.alignFrom(null),this._hasAlign=!1),this):(this._hasAlign||(this._hasAlign=!0,this._modifier.alignFrom(this._alignState)),this._alignState.set(t,e,i),this)},i.prototype.setSize=function(t,e,i){return null===t?(this._hasSize&&(this._modifier.sizeFrom(null),this._hasSize=!1),this):(this._hasSize||(this._hasSize=!0,this._modifier.sizeFrom(this._sizeState)),this._sizeState.set(t,e,i),this)},i.prototype.setProportions=function(t,e,i){return null===t?(this._hasProportions&&(this._modifier.proportionsFrom(null),this._hasProportions=!1),this):(this._hasProportions||(this._hasProportions=!0,this._modifier.proportionsFrom(this._proportionsState)),this._proportionsState.set(t,e,i),this)},i.prototype.halt=function(){this._transformState.halt(),this._opacityState.halt(),this._originState.halt(),this._alignState.halt(),this._sizeState.halt(),this._proportionsState.halt()},i.prototype.getTransform=function(){return this._transformState.get()},i.prototype.getFinalTransform=function(){return this._transformState.getFinal()},i.prototype.getOpacity=function(){return this._opacityState.get()},i.prototype.getOrigin=function(){return this._hasOrigin?this._originState.get():null},i.prototype.getAlign=function(){return this._hasAlign?this._alignState.get():null},i.prototype.getSize=function(){return this._hasSize?this._sizeState.get():null},i.prototype.getProportions=function(){return this._hasProportions?this._proportionsState.get():null},i.prototype.modify=function(t){return this._modifier.modify(t)},e.exports=i},{"../core/Modifier":9,"../core/Transform":15,"../transitions/Transitionable":88,"../transitions/TransitionableTransform":89}],47:[function(t,e){e.exports={Draggable:t("./Draggable"),Fader:t("./Fader"),ModifierChain:t("./ModifierChain"),StateModifier:t("./StateModifier")}},{"./Draggable":43,"./Fader":44,"./ModifierChain":45,"./StateModifier":46}],48:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),this._particles=[],this._bodies=[],this._agentData={},this._forces=[],this._constraints=[],this._buffer=0,this._prevTime=w(),this._isSleeping=!1,this._eventHandler=null,this._currAgentId=0,this._hasBodies=!1,this._eventHandler=null}function n(t){return t.applyForce?this._forces:t.applyConstraint?this._constraints:void 0}function o(t,e,i){return void 0===e&&(e=this.getParticlesAndBodies()),e instanceof Array||(e=[e]),t.on("change",this.wake.bind(this)),this._agentData[this._currAgentId]={agent:t,id:this._currAgentId,targets:e,source:i},n.call(this,t).push(this._currAgentId),this._currAgentId++}function r(t){return this._agentData[t]}function s(t){var e=r.call(this,this._forces[t]);e.agent.applyForce(e.targets,e.source)}function a(){for(var t=this._forces.length-1;t>-1;t--)s.call(this,t)}function c(t,e){var i=this._agentData[this._constraints[t]];return i.agent.applyConstraint(i.targets,i.source,e)}function u(t){for(var e=0;e<this.options.constraintSteps;){for(var i=this._constraints.length-1;i>-1;i--)c.call(this,i,t);e++}}function l(t,e){t.integrateVelocity(e),this.options.velocityCap&&t.velocity.cap(this.options.velocityCap).put(t.velocity)}function h(t,e){t.integrateAngularMomentum(e),t.updateAngularVelocity(),this.options.angularVelocityCap&&t.angularVelocity.cap(this.options.angularVelocityCap).put(t.angularVelocity)}function p(t,e){t.integrateOrientation(e)}function f(t,e){t.integratePosition(e),t.emit(b.update,t)}function d(t){a.call(this,t),this.forEach(l,t),this.forEachBody(h,t),u.call(this,t),this.forEachBody(p,t),this.forEach(f,t)}function v(){var t=0,e=0;return this.forEach(function(i){e=i.getEnergy(),t+=e}),t}function y(){var t=0;for(var e in this._agentData)t+=this.getAgentEnergy(e);return t}var _=t("../core/EventHandler"),g=17,m=1e3/120,S=17,w=Date.now,b={start:"start",update:"update",end:"end"};i.DEFAULT_OPTIONS={constraintSteps:1,sleepTolerance:1e-7,velocityCap:void 0,angularVelocityCap:void 0},i.prototype.setOptions=function(t){for(var e in t)this.options[e]&&(this.options[e]=t[e])},i.prototype.addBody=function(t){return t._engine=this,t.isBody?(this._bodies.push(t),this._hasBodies=!0):this._particles.push(t),t.on("start",this.wake.bind(this)),t},i.prototype.removeBody=function(t){var e=t.isBody?this._bodies:this._particles,i=e.indexOf(t);if(i>-1){for(var n in this._agentData)this._agentData.hasOwnProperty(n)&&this.detachFrom(this._agentData[n].id,t);e.splice(i,1)}0===this.getBodies().length&&(this._hasBodies=!1)},i.prototype.attach=function(t,e,i){if(this.wake(),t instanceof Array){for(var n=[],r=0;r<t.length;r++)n[r]=o.call(this,t[r],e,i);return n}return o.call(this,t,e,i)},i.prototype.attachTo=function(t,e){r.call(this,t).targets.push(e)},i.prototype.detach=function(t){var e=this.getAgent(t),i=n.call(this,e),o=i.indexOf(t);i.splice(o,1),delete this._agentData[t]},i.prototype.detachFrom=function(t,e){var i=r.call(this,t);if(i.source===e)this.detach(t);else{var n=i.targets,o=n.indexOf(e);o>-1&&n.splice(o,1)}},i.prototype.detachAll=function(){this._agentData={},this._forces=[],this._constraints=[],this._currAgentId=0},i.prototype.getAgent=function(t){return r.call(this,t).agent},i.prototype.getParticles=function(){return this._particles},i.prototype.getBodies=function(){return this._bodies},i.prototype.getParticlesAndBodies=function(){return this.getParticles().concat(this.getBodies())},i.prototype.forEachParticle=function(t,e){for(var i=this.getParticles(),n=0,o=i.length;o>n;n++)t.call(this,i[n],e)},i.prototype.forEachBody=function(t,e){if(this._hasBodies)for(var i=this.getBodies(),n=0,o=i.length;o>n;n++)t.call(this,i[n],e)},i.prototype.forEach=function(t,e){this.forEachParticle(t,e),this.forEachBody(t,e)},i.prototype.getAgentEnergy=function(t){var e=r.call(this,t);return e.agent.getEnergy(e.targets,e.source)},i.prototype.getEnergy=function(){return v.call(this)+y.call(this)},i.prototype.step=function(){if(!this.isSleeping()){var t=w(),e=t-this._prevTime;this._prevTime=t,m>e||(e>S&&(e=S),d.call(this,g),this.emit(b.update,this),this.getEnergy()<this.options.sleepTolerance&&this.sleep())}},i.prototype.isSleeping=function(){return this._isSleeping},i.prototype.isActive=function(){return!this._isSleeping},i.prototype.sleep=function(){this._isSleeping||(this.forEach(function(t){t.sleep()}),this.emit(b.end,this),this._isSleeping=!0)},i.prototype.wake=function(){this._isSleeping&&(this._prevTime=w(),this.emit(b.start,this),this._isSleeping=!1)},i.prototype.emit=function(t,e){null!==this._eventHandler&&this._eventHandler.emit(t,e)},i.prototype.on=function(t,e){null===this._eventHandler&&(this._eventHandler=new _),this._eventHandler.on(t,e)},e.exports=i},{"../core/EventHandler":7}],49:[function(t,e){function i(t){n.call(this,t),t=t||{},this.orientation=new s,this.angularVelocity=new r,this.angularMomentum=new r,this.torque=new r,t.orientation&&this.orientation.set(t.orientation),t.angularVelocity&&this.angularVelocity.set(t.angularVelocity),t.angularMomentum&&this.angularMomentum.set(t.angularMomentum),t.torque&&this.torque.set(t.torque),this.angularVelocity.w=0,this.setMomentsOfInertia(),this.pWorld=new r}var n=t("./Particle"),o=t("../../core/Transform"),r=t("../../math/Vector"),s=t("../../math/Quaternion"),a=t("../../math/Matrix"),c=t("../integrators/SymplecticEuler");i.DEFAULT_OPTIONS=n.DEFAULT_OPTIONS,i.DEFAULT_OPTIONS.orientation=[0,0,0,1],i.DEFAULT_OPTIONS.angularVelocity=[0,0,0],i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.isBody=!0,i.prototype.setMass=function(){n.prototype.setMass.apply(this,arguments),this.setMomentsOfInertia()},i.prototype.setMomentsOfInertia=function(){this.inertia=new a,this.inverseInertia=new a},i.prototype.updateAngularVelocity=function(){this.angularVelocity.set(this.inverseInertia.vectorMultiply(this.angularMomentum))},i.prototype.toWorldCoordinates=function(t){return this.pWorld.set(this.orientation.rotateVector(t))},i.prototype.getEnergy=function(){return n.prototype.getEnergy.call(this)+.5*this.inertia.vectorMultiply(this.angularVelocity).dot(this.angularVelocity)},i.prototype.reset=function(t,e,i,o){n.prototype.reset.call(this,t,e),this.angularVelocity.clear(),this.setOrientation(i||[1,0,0,0]),this.setAngularMomentum(o||[0,0,0])},i.prototype.setOrientation=function(t){this.orientation.set(t)},i.prototype.setAngularVelocity=function(t){this.wake(),this.angularVelocity.set(t)},i.prototype.setAngularMomentum=function(t){this.wake(),this.angularMomentum.set(t)},i.prototype.applyForce=function(t,e){n.prototype.applyForce.call(this,t),void 0!==e&&this.applyTorque(e.cross(t))},i.prototype.applyTorque=function(t){this.wake(),this.torque.set(this.torque.add(t))},i.prototype.getTransform=function(){return o.thenMove(this.orientation.getTransform(),o.getTranslate(n.prototype.getTransform.call(this)))},i.prototype._integrate=function(t){n.prototype._integrate.call(this,t),this.integrateAngularMomentum(t),this.updateAngularVelocity(t),this.integrateOrientation(t)},i.prototype.integrateAngularMomentum=function(t){c.integrateAngularMomentum(this,t)},i.prototype.integrateOrientation=function(t){c.integrateOrientation(this,t)},e.exports=i},{"../../core/Transform":15,"../../math/Matrix":37,"../../math/Quaternion":38,"../../math/Vector":41,"../integrators/SymplecticEuler":72,"./Particle":51}],50:[function(t,e){function i(t){t=t||{},this.setRadius(t.radius||0),n.call(this,t)}var n=t("./Body"),o=t("../../math/Matrix");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.setRadius=function(t){this.radius=t,this.size=[2*this.radius,2*this.radius],this.setMomentsOfInertia()},i.prototype.setMomentsOfInertia=function(){var t=this.mass,e=this.radius;this.inertia=new o([[.25*t*e*e,0,0],[0,.25*t*e*e,0],[0,0,.5*t*e*e]]),this.inverseInertia=new o([[4/(t*e*e),0,0],[0,4/(t*e*e),0],[0,0,2/(t*e*e)]])},e.exports=i},{"../../math/Matrix":37,"./Body":49}],51:[function(t,e){function i(t){t=t||{};var e=i.DEFAULT_OPTIONS;this.position=new o,this.velocity=new o,this.force=new o,this._engine=null,this._isSleeping=!0,this._eventOutput=null,this.mass=void 0!==t.mass?t.mass:e.mass,this.inverseMass=1/this.mass,this.setPosition(t.position||e.position),this.setVelocity(t.velocity||e.velocity),this.force.set(t.force||[0,0,0]),this.transform=r.identity.slice(),this._spec={size:[!0,!0],target:{transform:this.transform,origin:[.5,.5],target:null}}}function n(){this._eventOutput=new s,this._eventOutput.bindThis(this),s.setOutputHandler(this,this._eventOutput)}var o=t("../../math/Vector"),r=t("../../core/Transform"),s=t("../../core/EventHandler"),a=t("../integrators/SymplecticEuler");i.DEFAULT_OPTIONS={position:[0,0,0],velocity:[0,0,0],mass:1};var c={start:"start",update:"update",end:"end"},u=Date.now;i.prototype.isBody=!1,i.prototype.isActive=function(){return!this._isSleeping},i.prototype.sleep=function(){this._isSleeping||(this.emit(c.end,this),this._isSleeping=!0)},i.prototype.wake=function(){this._isSleeping&&(this.emit(c.start,this),this._isSleeping=!1,this._prevTime=u(),this._engine&&this._engine.wake())},i.prototype.setPosition=function(t){this.position.set(t)},i.prototype.setPosition1D=function(t){this.position.x=t},i.prototype.getPosition=function(){return this._engine.step(),this.position.get()},i.prototype.getPosition1D=function(){return this._engine.step(),this.position.x},i.prototype.setVelocity=function(t){this.velocity.set(t),(0!==t[0]||0!==t[1]||0!==t[2])&&this.wake()},i.prototype.setVelocity1D=function(t){this.velocity.x=t,0!==t&&this.wake()},i.prototype.getVelocity=function(){return this.velocity.get()},i.prototype.setForce=function(t){this.force.set(t),this.wake()},i.prototype.getVelocity1D=function(){return this.velocity.x},i.prototype.setMass=function(t){this.mass=t,this.inverseMass=1/t},i.prototype.getMass=function(){return this.mass},i.prototype.reset=function(t,e){this.setPosition(t||[0,0,0]),this.setVelocity(e||[0,0,0])},i.prototype.applyForce=function(t){t.isZero()||(this.force.add(t).put(this.force),this.wake())},i.prototype.applyImpulse=function(t){if(!t.isZero()){var e=this.velocity;e.add(t.mult(this.inverseMass)).put(e)}},i.prototype.integrateVelocity=function(t){a.integrateVelocity(this,t)},i.prototype.integratePosition=function(t){a.integratePosition(this,t)},i.prototype._integrate=function(t){this.integrateVelocity(t),this.integratePosition(t)},i.prototype.getEnergy=function(){return.5*this.mass*this.velocity.normSquared()},i.prototype.getTransform=function(){this._engine.step();var t=this.position,e=this.transform;return e[12]=t.x,e[13]=t.y,e[14]=t.z,e},i.prototype.modify=function(t){var e=this._spec.target;return e.transform=this.getTransform(),e.target=t,this._spec},i.prototype.emit=function(t,e){this._eventOutput&&this._eventOutput.emit(t,e)},i.prototype.on=function(){return n.call(this),this.on.apply(this,arguments)},i.prototype.removeListener=function(){return n.call(this),this.removeListener.apply(this,arguments)},i.prototype.pipe=function(){return n.call(this),this.pipe.apply(this,arguments)},i.prototype.unpipe=function(){return n.call(this),this.unpipe.apply(this,arguments)},e.exports=i},{"../../core/EventHandler":7,"../../core/Transform":15,"../../math/Vector":41,"../integrators/SymplecticEuler":72}],52:[function(t,e){function i(t){t=t||{},this.size=t.size||[0,0],n.call(this,t)}var n=t("./Body"),o=t("../../math/Matrix");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.setSize=function(t){this.size=t,this.setMomentsOfInertia()},i.prototype.setMomentsOfInertia=function(){var t=this.mass,e=this.size[0],i=this.size[1];this.inertia=new o([[t*i*i/12,0,0],[0,t*e*e/12,0],[0,0,t*(e*e+i*i)/12]]),this.inverseInertia=new o([[12/(t*i*i),0,0],[0,12/(t*e*e),0],[0,0,12/(t*(e*e+i*i))]])},e.exports=i},{"../../math/Matrix":37,"./Body":49}],53:[function(t,e){e.exports={Body:t("./Body"),Circle:t("./Circle"),Particle:t("./Particle"),Rectangle:t("./Rectangle")}},{"./Body":49,"./Circle":50,"./Particle":51,"./Rectangle":52}],54:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),this.normal=new o,this.pDiff=new o,this.vDiff=new o,this.impulse1=new o,this.impulse2=new o,n.call(this)}var n=t("./Constraint"),o=t("../../math/Vector");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={restitution:.5,drift:.5,slop:0},i.prototype.setOptions=function(t){for(var e in t)this.options[e]=t[e]},i.prototype.applyConstraint=function(t,e,i){if(void 0!==e)for(var n=e.velocity,o=e.position,r=e.inverseMass,s=e.radius,a=this.options,c=a.drift,u=-a.slop,l=a.restitution,h=this.normal,p=this.pDiff,f=this.vDiff,d=this.impulse1,v=this.impulse2,y=0;y<t.length;y++){var _=t[y];if(_!==e){var g=_.velocity,m=_.position,S=_.inverseMass,w=_.radius;p.set(m.sub(o)),f.set(g.sub(n));var b=p.norm(),O=b-(s+w),T=1/(r+S),E=0;if(0>O){if(h.set(p.normalize()),this._eventOutput){var x={target:_,source:e,overlap:O,normal:h};this._eventOutput.emit("preCollision",x),this._eventOutput.emit("collision",x)}var I=u>=O?((1+l)*h.dot(f)+c/i*(O-u))/(E+i/T):(1+l)*h.dot(f)/(E+i/T);h.mult(i*I).put(d),d.mult(-1).put(v),e.applyImpulse(d),_.applyImpulse(v),this._eventOutput&&this._eventOutput.emit("postCollision",x)}}}},e.exports=i},{"../../math/Vector":41,"./Constraint":55}],55:[function(t,e){function i(){this.options=this.options||{},this._eventOutput=new n,n.setOutputHandler(this,this._eventOutput)}var n=t("../../core/EventHandler");i.prototype.setOptions=function(t){this._eventOutput.emit("change",t)},i.prototype.applyConstraint=function(){},i.prototype.getEnergy=function(){return 0},e.exports=i},{"../../core/EventHandler":7}],56:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),this.J=new o,this.impulse=new o,n.call(this)}var n=t("./Constraint"),o=t("../../math/Vector");i.prototype=Object.create(n.prototype),i.prototype.constructor=i;var r=1e-7,s=Math.PI;i.DEFAULT_OPTIONS={equation:function(){return 0},plane:function(t,e,i){return i},period:0,dampingRatio:0},i.prototype.setOptions=function(t){for(var e in t)this.options[e]=t[e]},i.prototype.applyConstraint=function(t,e,i){for(var n=this.options,o=this.impulse,a=this.J,c=n.equation,u=n.plane,l=n.dampingRatio,h=n.period,p=0;p<t.length;p++){var f,d,v=t[p],y=v.velocity,_=v.position,g=v.mass;if(0===h)f=0,d=1;else{var m=4*g*s*l/h,S=4*g*s*s/(h*h);f=1/(m+i*S),d=i*S/(m+i*S)}var w=_.x,b=_.y,O=_.z,T=c(w,b,O),E=(c(w+r,b,O)-T)/r,x=(c(w,b+r,O)-T)/r,I=(c(w,b,O+r)-T)/r,C=u(w,b,O),k=(u(w+r,b,O)-C)/r,N=(u(w,b+r,O)-C)/r,D=(u(w,b,O+r)-C)/r;a.setXYZ(E+k,x+N,I+D);var z=d/i*(T+C),A=-(a.dot(y)+z)/(f+i*a.normSquared()/g);o.set(a.mult(i*A)),v.applyImpulse(o)}},e.exports=i},{"../../math/Vector":41,"./Constraint":55}],57:[function(t,e){function i(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),t&&this.setOptions(t),this.impulse=new o,this.normal=new o,this.diffP=new o,this.diffV=new o,n.call(this)}var n=t("./Constraint"),o=t("../../math/Vector");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={anchor:null,length:0,minLength:0,period:0,dampingRatio:0};var r=Math.PI;i.prototype.setOptions=function(t){t.anchor&&(t.anchor.position instanceof o&&(this.options.anchor=t.anchor.position),t.anchor instanceof o&&(this.options.anchor=t.anchor),t.anchor instanceof Array&&(this.options.anchor=new o(t.anchor))),void 0!==t.length&&(this.options.length=t.length),void 0!==t.dampingRatio&&(this.options.dampingRatio=t.dampingRatio),void 0!==t.period&&(this.options.period=t.period),void 0!==t.minLength&&(this.options.minLength=t.minLength)},i.prototype.setAnchor=function(t){this.options.anchor||(this.options.anchor=new o),this.options.anchor.set(t)},i.prototype.applyConstraint=function(t,e,i){var n,o,s=this.normal,a=this.diffP,c=this.diffV,u=this.impulse,l=this.options,h=l.dampingRatio,p=l.period,f=l.minLength;if(e){var d=e.velocity;n=e.position,o=e.inverseMass}else n=this.options.anchor,o=0;for(var v=this.options.length,y=0;y<t.length;y++){var _=t[y],g=_.velocity,m=_.position,S=_.inverseMass;a.set(m.sub(n)),s.set(a.normalize());var w=a.norm()-v;if(Math.abs(w)<f)return;e?c.set(g.sub(d)):c.set(g);var b,O,T=1/(S+o);if(0===p)b=0,O=1;else{var E=4*T*r*h/p,x=4*T*r*r/(p*p);b=1/(E+i*x),O=i*x/(E+i*x)}var I=O/i*w,C=-(s.dot(c)+I)/(b+i/T);u.set(s.mult(i*C)),_.applyImpulse(u),e&&e.applyImpulse(u.mult(-1))}},e.exports=i},{"../../math/Vector":41,"./Constraint":55}],58:[function(t,e){function i(t){n.call(this),this.options=Object.create(this.constructor.DEFAULT_OPTIONS),t&&this.setOptions(t),this.pDiff=new o,this.vDiff=new o,this.impulse1=new o,this.impulse2=new o}var n=t("./Constraint"),o=t("../../math/Vector");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={period:300,dampingRatio:.1,length:0,anchor:void 0};var r=Math.PI;i.prototype.setOptions=function(t){void 0!==t.anchor&&(t.anchor instanceof o&&(this.options.anchor=t.anchor),t.anchor.position instanceof o&&(this.options.anchor=t.anchor.position),t.anchor instanceof Array&&(this.options.anchor=new o(t.anchor))),void 0!==t.length&&(this.options.length=t.length),void 0!==t.dampingRatio&&(this.options.dampingRatio=t.dampingRatio),void 0!==t.period&&(this.options.period=t.period),
n.prototype.setOptions.call(this,t)},i.prototype.getEnergy=function(t,e){for(var i=this.options,n=i.length,o=i.anchor||e.position,s=Math.pow(2*r/i.period,2),a=0,c=0;c<t.length;c++){var u=t[c],l=o.sub(u.position).norm()-n;a+=.5*s*l*l}return a},i.prototype.applyConstraint=function(t,e,i){for(var n=this.options,o=this.pDiff,s=this.vDiff,a=this.impulse1,c=this.impulse2,u=n.length,l=n.anchor||e.position,h=n.period,p=n.dampingRatio,f=0;f<t.length;f++){var d=t[f],v=d.position,y=d.velocity,_=d.mass,g=d.inverseMass;o.set(v.sub(l));var m,S=o.norm()-u;if(e){var w=e.inverseMass,b=e.velocity;s.set(y.sub(b)),m=1/(g+w)}else s.set(y),m=_;var O,T;if(0===this.options.period)O=0,T=1;else{var E=4*m*r*r/(h*h),x=4*m*r*p/h;T=i*E/(x+i*E),O=1/(x+i*E)}var I=T/i*S;o.normalize(-I).sub(s).mult(i/(O+i/m)).put(a),d.applyImpulse(a),e&&(a.mult(-1).put(c),e.applyImpulse(c))}},e.exports=i},{"../../math/Vector":41,"./Constraint":55}],59:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),this.J=new o,this.impulse=new o,n.call(this)}var n=t("./Constraint"),o=t("../../math/Vector");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={equation:void 0,period:0,dampingRatio:0};var r=1e-7,s=Math.PI;i.prototype.setOptions=function(t){for(var e in t)this.options[e]=t[e]},i.prototype.applyConstraint=function(t,e,i){for(var n=this.impulse,o=this.J,a=this.options,c=a.equation,u=a.dampingRatio,l=a.period,h=0;h<t.length;h++){var p,f,d=t[h],v=d.velocity,y=d.position,_=d.mass;if(0===l)p=0,f=1;else{var g=4*_*s*u/l,m=4*_*s*s/(l*l);p=1/(g+i*m),f=i*m/(g+i*m)}var S=y.x,w=y.y,b=y.z,O=c(S,w,b),T=(c(S+r,y,y)-O)/r,E=(c(S,w+r,y)-O)/r,x=(c(S,w,y+r)-O)/r;o.setXYZ(T,E,x);var I=f/i*O,C=-(o.dot(v)+I)/(p+i*o.normSquared()/_);n.set(o.mult(i*C)),d.applyImpulse(n)}},e.exports=i},{"../../math/Vector":41,"./Constraint":55}],60:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),this.diff=new c,this.impulse=new c,a.call(this)}function n(t,e){return e.dot(t)}function o(t){var e=this.options.normal,i=this.options.distance;return t.dot(e)+i}function r(t,e,n){var o=t.position,r=t.velocity,s=t.mass,a=this.options.normal,c=this.options.onContact,u=this.options.restitution,l=this.impulse,h=this.options.drift,p=-this.options.slop,f=0;if(this._eventOutput){var d={particle:t,wall:this,overlap:e,normal:a};this._eventOutput.emit("preCollision",d),this._eventOutput.emit("collision",d)}switch(c){case i.ON_CONTACT.REFLECT:var v=p>e?-((1+u)*a.dot(r)+h/n*(e-p))/(s*n+f):-((1+u)*a.dot(r))/(s*n+f);l.set(a.mult(n*v)),t.applyImpulse(l),t.setPosition(o.add(a.mult(-e)))}this._eventOutput&&this._eventOutput.emit("postCollision",d)}function s(t,e){var n=this.options.onContact,o=t.position,r=this.options.normal;n===i.ON_CONTACT.REFLECT&&t.setPosition(o.add(r.mult(-e)))}var a=t("./Constraint"),c=t("../../math/Vector");i.prototype=Object.create(a.prototype),i.prototype.constructor=i,i.ON_CONTACT={REFLECT:0,SILENT:1},i.DEFAULT_OPTIONS={restitution:.5,drift:.5,slop:0,normal:[1,0,0],distance:0,onContact:i.ON_CONTACT.REFLECT},i.prototype.setOptions=function(t){void 0!==t.normal&&(t.normal instanceof c&&(this.options.normal=t.normal.clone()),t.normal instanceof Array&&(this.options.normal=new c(t.normal))),void 0!==t.restitution&&(this.options.restitution=t.restitution),void 0!==t.drift&&(this.options.drift=t.drift),void 0!==t.slop&&(this.options.slop=t.slop),void 0!==t.distance&&(this.options.distance=t.distance),void 0!==t.onContact&&(this.options.onContact=t.onContact)},i.prototype.applyConstraint=function(t,e,i){for(var a=this.options.normal,c=0;c<t.length;c++){var u=t[c],l=u.position,h=u.velocity,p=u.radius||0,f=o.call(this,l.add(a.mult(-p))),d=n.call(this,a,h);0>=f&&(0>d?r.call(this,u,f,i):s.call(this,u,f,i))}},e.exports=i},{"../../math/Vector":41,"./Constraint":55}],61:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),o.call(this,t.sides||this.options.sides),s.call(this)}function n(t,e,n){var o,r=i.SIDES;switch(parseInt(t)){case r.LEFT:o=e[0]*n[0];break;case r.TOP:o=e[1]*n[1];break;case r.FRONT:o=e[2]*n[2];break;case r.RIGHT:o=e[0]*(1-n[0]);break;case r.BOTTOM:o=e[1]*(1-n[1]);break;case r.BACK:o=e[2]*(1-n[2])}return o}function o(t){this.components={};for(var e=this.components,i=0;i<t.length;i++){var o=t[i];e[i]=new a({normal:u[o].clone(),distance:n(o,this.options.size,this.options.origin)})}}function r(t){this.forEach(function(e){e.setOptions(t)});for(var e in t)this.options[e]=t[e]}var s=t("./Constraint"),a=t("./Wall"),c=t("../../math/Vector");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,i.ON_CONTACT=a.ON_CONTACT,i.SIDES={LEFT:0,RIGHT:1,TOP:2,BOTTOM:3,FRONT:4,BACK:5,TWO_DIMENSIONAL:[0,1,2,3],THREE_DIMENSIONAL:[0,1,2,3,4,5]},i.DEFAULT_OPTIONS={sides:i.SIDES.TWO_DIMENSIONAL,size:[window.innerWidth,window.innerHeight,0],origin:[.5,.5,.5],drift:.5,slop:0,restitution:.5,onContact:i.ON_CONTACT.REFLECT};var u={0:new c(1,0,0),1:new c(-1,0,0),2:new c(0,1,0),3:new c(0,-1,0),4:new c(0,0,1),5:new c(0,0,-1)};i.prototype.setOptions=function(t){var e=!1;void 0!==t.restitution&&r.call(this,{restitution:t.restitution}),void 0!==t.drift&&r.call(this,{drift:t.drift}),void 0!==t.slop&&r.call(this,{slop:t.slop}),void 0!==t.onContact&&r.call(this,{onContact:t.onContact}),void 0!==t.size&&(e=!0),void 0!==t.sides&&(this.options.sides=t.sides),void 0!==t.origin&&(e=!0),e&&this.setSize(t.size,t.origin)},i.prototype.setSize=function(t,e){e=e||this.options.origin,e.length<3&&(e[2]=.5),this.forEach(function(i,o){var r=n(o,t,e);i.setOptions({distance:r})}),this.options.size=t,this.options.origin=e},i.prototype.applyConstraint=function(t,e,i){this.forEach(function(n){n.applyConstraint(t,e,i)})},i.prototype.forEach=function(t){var e=this.options.sides;for(var i in this.sides)t(e[i],i)},i.prototype.rotateZ=function(t){this.forEach(function(e){var i=e.options.normal;i.rotateZ(t).put(i)})},i.prototype.rotateX=function(t){this.forEach(function(e){var i=e.options.normal;i.rotateX(t).put(i)})},i.prototype.rotateY=function(t){this.forEach(function(e){var i=e.options.normal;i.rotateY(t).put(i)})},i.prototype.reset=function(){var t=this.options.sides;for(var e in t){var i=this.components[e];i.options.normal.set(u[e])}},e.exports=i},{"../../math/Vector":41,"./Constraint":55,"./Wall":60}],62:[function(t,e){e.exports={Collision:t("./Collision"),Constraint:t("./Constraint"),Curve:t("./Curve"),Distance:t("./Distance"),Snap:t("./Snap"),Surface:t("./Surface"),Wall:t("./Wall"),Walls:t("./Walls")}},{"./Collision":54,"./Constraint":55,"./Curve":56,"./Distance":57,"./Snap":58,"./Surface":59,"./Wall":60,"./Walls":61}],63:[function(t,e){function i(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),t&&this.setOptions(t),n.call(this)}var n=t("./Force");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.FORCE_FUNCTIONS={LINEAR:function(t){return t},QUADRATIC:function(t){return t.mult(t.norm())}},i.DEFAULT_OPTIONS={strength:.01,forceFunction:i.FORCE_FUNCTIONS.LINEAR},i.prototype.applyForce=function(t){var e,i,n=this.options.strength,o=this.options.forceFunction,r=this.force;for(e=0;e<t.length;e++)i=t[e],o(i.velocity).mult(-n).put(r),i.applyForce(r)},i.prototype.setOptions=function(t){for(var e in t)this.options[e]=t[e]},e.exports=i},{"./Force":64}],64:[function(t,e){function i(t){this.force=new n(t),this._eventOutput=new o,o.setOutputHandler(this,this._eventOutput)}var n=t("../../math/Vector"),o=t("../../core/EventHandler");i.prototype.setOptions=function(t){this._eventOutput.emit("change",t)},i.prototype.applyForce=function(t){for(var e=t.length;e--;)t[e].applyForce(this.force)},i.prototype.getEnergy=function(){return 0},e.exports=i},{"../../core/EventHandler":7,"../../math/Vector":41}],65:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),this.disp=new o,n.call(this)}var n=t("./Force"),o=t("../../math/Vector");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DECAY_FUNCTIONS={LINEAR:function(t,e){return Math.max(1-1/e*t,0)},MORSE:function(t,e){var i=0===e?100:e,n=t+i*(1-Math.log(2));return Math.max(1-Math.pow(1-Math.exp(n/i-1),2),0)},INVERSE:function(t,e){return 1/(1-e+t)},GRAVITY:function(t,e){return 1/(1-e+t*t)}},i.DEFAULT_OPTIONS={strength:1,anchor:void 0,range:[0,1/0],cutoff:0,cap:1/0,decayFunction:i.DECAY_FUNCTIONS.GRAVITY},i.prototype.setOptions=function(t){void 0!==t.anchor&&(t.anchor.position instanceof o&&(this.options.anchor=t.anchor.position),t.anchor instanceof Array&&(this.options.anchor=new o(t.anchor)),delete t.anchor);for(var e in t)this.options[e]=t[e]},i.prototype.applyForce=function(t,e){var i=this.options,n=this.force,o=this.disp,r=i.strength,s=i.anchor||e.position,a=i.cap,c=i.cutoff,u=i.range[0],l=i.range[1],h=i.decayFunction;if(0!==r)for(var p,f,d,v,y=t.length;y--;)p=t[y],p!==e&&(f=p.mass,d=p.position,o.set(d.sub(s)),v=o.norm(),l>v&&v>u&&(n.set(o.normalize(r*f*h(v,c)).cap(a)),p.applyForce(n)))},e.exports=i},{"../../math/Vector":41,"./Force":64}],66:[function(t,e){function i(t){n.call(this,t)}var n=t("./Drag");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS=n.DEFAULT_OPTIONS,i.FORCE_FUNCTIONS=n.FORCE_FUNCTIONS,i.FORCE_FUNCTIONS={LINEAR:function(t){return t},QUADRATIC:function(t){return t.mult(t.norm())}},i.prototype.applyForce=function(t){var e,i,n=this.options.strength,o=this.options.forceFunction,r=this.force;for(e=0;e<t.length;e++)i=t[e],o(i.angularVelocity).mult(-100*n).put(r),i.applyTorque(r)},i.prototype.setOptions=function(t){for(var e in t)this.options[e]=t[e]},e.exports=i},{"./Drag":63}],67:[function(t,e){function i(t){a.call(this,t)}function n(){var t=this.options;t.stiffness=Math.pow(2*u/t.period,2)}function o(){var t=this.options;t.damping=4*u*t.dampingRatio/t.period}function r(){n.call(this),o.call(this)}var s=t("./Force"),a=t("./Spring"),c=t("../../math/Quaternion");i.prototype=Object.create(a.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS=a.DEFAULT_OPTIONS,i.FORCE_FUNCTIONS=a.FORCE_FUNCTIONS;var u=Math.PI;i.prototype.setOptions=function(t){void 0!==t.anchor&&(t.anchor instanceof c&&(this.options.anchor=t.anchor),t.anchor instanceof Array&&(this.options.anchor=new c(t.anchor))),void 0!==t.period&&(this.options.period=t.period),void 0!==t.dampingRatio&&(this.options.dampingRatio=t.dampingRatio),void 0!==t.length&&(this.options.length=t.length),void 0!==t.forceFunction&&(this.options.forceFunction=t.forceFunction),void 0!==t.maxLength&&(this.options.maxLength=t.maxLength),r.call(this),s.prototype.setOptions.call(this,t)},i.prototype.applyForce=function(t){var e,i,n,o,r=this.force,s=this.options,a=this.disp,c=s.stiffness,u=s.damping,l=s.length,h=s.anchor,p=s.forceFunction,f=s.maxLength;for(e=0;e<t.length;e++){if(i=t[e],a.set(h.sub(i.orientation)),n=a.norm()-l,0===n)return;o=i.mass,c*=o,u*=o,r.set(a.normalize(c*p(n,f))),u&&r.add(i.angularVelocity.mult(-u)).put(r),i.applyTorque(r)}},i.prototype.getEnergy=function(t){for(var e=this.options,i=e.length,n=e.anchor,o=e.stiffness,r=0,s=0;s<t.length;s++){var a=t[s],c=n.sub(a.orientation).norm()-i;r+=.5*o*c*c}return r},e.exports=i},{"../../math/Quaternion":38,"./Force":64,"./Spring":68}],68:[function(t,e){function i(t){s.call(this),this.options=Object.create(this.constructor.DEFAULT_OPTIONS),t&&this.setOptions(t),this.disp=new a(0,0,0),r.call(this)}function n(){var t=this.options;t.stiffness=Math.pow(2*c/t.period,2)}function o(){var t=this.options;t.damping=4*c*t.dampingRatio/t.period}function r(){n.call(this),o.call(this)}var s=t("./Force"),a=t("../../math/Vector");i.prototype=Object.create(s.prototype),i.prototype.constructor=i;var c=Math.PI,u=150;i.FORCE_FUNCTIONS={FENE:function(t,e){var i=.99*e,n=Math.max(Math.min(t,i),-i);return n/(1-n*n/(e*e))},HOOK:function(t){return t}},i.DEFAULT_OPTIONS={period:300,dampingRatio:.1,length:0,maxLength:1/0,anchor:void 0,forceFunction:i.FORCE_FUNCTIONS.HOOK},i.prototype.setOptions=function(t){void 0!==t.anchor&&(t.anchor.position instanceof a&&(this.options.anchor=t.anchor.position),t.anchor instanceof a&&(this.options.anchor=t.anchor),t.anchor instanceof Array&&(this.options.anchor=new a(t.anchor))),void 0!==t.period&&(t.period<u&&(t.period=u,console.warn("The period of a SpringTransition is capped at "+u+" ms. Use a SnapTransition for faster transitions")),this.options.period=t.period),void 0!==t.dampingRatio&&(this.options.dampingRatio=t.dampingRatio),void 0!==t.length&&(this.options.length=t.length),void 0!==t.forceFunction&&(this.options.forceFunction=t.forceFunction),void 0!==t.maxLength&&(this.options.maxLength=t.maxLength),r.call(this),s.prototype.setOptions.call(this,t)},i.prototype.applyForce=function(t,e){var i,n,o,r,s,a,c=this.force,u=this.disp,l=this.options,h=l.stiffness,p=l.damping,f=l.length,d=l.maxLength,v=l.anchor||e.position,y=l.forceFunction;for(i=0;i<t.length;i++){if(n=t[i],o=n.position,r=n.velocity,v.sub(o).put(u),s=u.norm()-f,0===s)return;a=n.mass,h*=a,p*=a,u.normalize(h*y(s,d)).put(c),p&&(e?c.add(r.sub(e.velocity).mult(-p)).put(c):c.add(r.mult(-p)).put(c)),n.applyForce(c),e&&e.applyForce(c.mult(-1))}},i.prototype.getEnergy=function(t,e){for(var i=this.options,n=i.length,o=e?e.position:i.anchor,r=i.stiffness,s=0,a=0;a<t.length;a++){var c=t[a],u=o.sub(c.position).norm()-n;s+=.5*r*u*u}return s},e.exports=i},{"../../math/Vector":41,"./Force":64}],69:[function(t,e){function i(t){o.call(this),this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),this.evaluation=new r}function n(t){var e=i.FIELDS;switch(t){case e.CONSTANT:this.options.direction?this.options.direction instanceof Array&&(this.options.direction=new r(this.options.direction)):this.options.direction=new r(0,1,0);break;case e.POINT_ATTRACTOR:this.options.position?this.options.position instanceof Array&&(this.options.position=new r(this.options.position)):this.options.position=new r(0,0,0)}}var o=t("./Force"),r=t("../../math/Vector");i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.FIELDS={CONSTANT:function(t,e){e.direction.put(this.evaluation)},LINEAR:function(t){t.put(this.evaluation)},RADIAL:function(t){t.mult(-1).put(this.evaluation)},POINT_ATTRACTOR:function(t,e){e.position.sub(t).put(this.evaluation)}},i.DEFAULT_OPTIONS={strength:.01,field:i.FIELDS.CONSTANT},i.prototype.setOptions=function(t){void 0!==t.strength&&(this.options.strength=t.strength),void 0!==t.direction&&(this.options.direction=t.direction),void 0!==t.field&&(this.options.field=t.field,n.call(this,this.options.field))},i.prototype.applyForce=function(t){var e,i,n=this.force,o=this.options.strength,r=this.options.field;for(e=0;e<t.length;e++)i=t[e],r.call(this,i.position,this.options),this.evaluation.mult(i.mass*o).put(n),i.applyForce(n)},i.prototype.getEnergy=function(t){var e,n,o=this.options.field,r=i.FIELDS,s=0;switch(o){case r.CONSTANT:s=t.length*this.options.direction.norm();break;case r.RADIAL:for(e=0;e<t.length;e++)n=t[e],s+=n.position.norm();break;case r.POINT_ATTRACTOR:for(e=0;e<t.length;e++)n=t[e],s+=n.position.sub(this.options.position).norm()}return s*=this.options.strength},e.exports=i},{"../../math/Vector":41,"./Force":64}],70:[function(t,e){e.exports={Drag:t("./Drag"),Force:t("./Force"),Repulsion:t("./Repulsion"),RotationalDrag:t("./RotationalDrag"),RotationalSpring:t("./RotationalSpring"),Spring:t("./Spring"),VectorField:t("./VectorField")}},{"./Drag":63,"./Force":64,"./Repulsion":65,"./RotationalDrag":66,"./RotationalSpring":67,"./Spring":68,"./VectorField":69}],71:[function(t,e){e.exports={PhysicsEngine:t("./PhysicsEngine"),bodies:t("./bodies"),constraints:t("./constraints"),forces:t("./forces"),integrators:t("./integrators")}},{"./PhysicsEngine":48,"./bodies":53,"./constraints":62,"./forces":70,"./integrators":73}],72:[function(t,e){var i={};i.integrateVelocity=function(t,e){var i=t.velocity,n=t.inverseMass,o=t.force;o.isZero()||(i.add(o.mult(e*n)).put(i),o.clear())},i.integratePosition=function(t,e){var i=t.position,n=t.velocity;i.add(n.mult(e)).put(i)},i.integrateAngularMomentum=function(t,e){var i=t.angularMomentum,n=t.torque;n.isZero()||(i.add(n.mult(e)).put(i),n.clear())},i.integrateOrientation=function(t,e){var i=t.orientation,n=t.angularVelocity;n.isZero()||i.add(i.multiply(n).scalarMultiply(.5*e)).put(i)},e.exports=i},{}],73:[function(t,e){e.exports={SymplecticEuler:t("./SymplecticEuler")}},{"./SymplecticEuler":72}],74:[function(t,e){function i(t){t&&t.canvasSize&&(this._canvasSize=t.canvasSize),n.apply(this,arguments),this._canvasSize||(this._canvasSize=this.getSize()),this._backBuffer=document.createElement("canvas"),this._canvasSize&&(this._backBuffer.width=this._canvasSize[0],this._backBuffer.height=this._canvasSize[1]),this._contextId=void 0}var n=t("../core/Surface");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.elementType="canvas",i.prototype.elementClass="famous-surface",i.prototype.setContent=function(){},i.prototype.deploy=function(t){this._canvasSize&&(t.width=this._canvasSize[0],t.height=this._canvasSize[1]),"2d"===this._contextId&&(t.getContext(this._contextId).drawImage(this._backBuffer,0,0),this._backBuffer.width=0,this._backBuffer.height=0)},i.prototype.recall=function(t){this.getSize(),this._backBuffer.width=t.width,this._backBuffer.height=t.height,"2d"===this._contextId&&(this._backBuffer.getContext(this._contextId).drawImage(t,0,0),t.width=0,t.height=0)},i.prototype.getContext=function(t){return this._contextId=t,this._currentTarget?this._currentTarget.getContext(t):this._backBuffer.getContext(t)},i.prototype.setSize=function(t,e){n.prototype.setSize.apply(this,arguments),e&&(this._canvasSize=[e[0],e[1]]),this._currentTarget&&(this._currentTarget.width=this._canvasSize[0],this._currentTarget.height=this._canvasSize[1])},e.exports=i},{"../core/Surface":14}],75:[function(t,e){function i(t){n.call(this,t),this._container=document.createElement("div"),this._container.classList.add("famous-group"),this._container.classList.add("famous-container-group"),this._shouldRecalculateSize=!1,this.context=new o(this._container),this.setContent(this._container)}var n=t("../core/Surface"),o=t("../core/Context");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.elementType="div",i.prototype.elementClass="famous-surface",i.prototype.add=function(){return this.context.add.apply(this.context,arguments)},i.prototype.render=function(){return this._sizeDirty&&(this._shouldRecalculateSize=!0),n.prototype.render.apply(this,arguments)},i.prototype.deploy=function(){return this._shouldRecalculateSize=!0,n.prototype.deploy.apply(this,arguments)},i.prototype.commit=function(){var t=this._size?[this._size[0],this._size[1]]:null,e=n.prototype.commit.apply(this,arguments);return(this._shouldRecalculateSize||t&&(this._size[0]!==t[0]||this._size[1]!==t[1]))&&(this.context.setSize(),this._shouldRecalculateSize=!1),this.context.update(),e},e.exports=i},{"../core/Context":1,"../core/Surface":14}],76:[function(t,e){function i(t){t&&(this._method=t.method||""),n.apply(this,arguments)}var n=t("./ContainerSurface");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.elementType="form",i.prototype.deploy=function(t){return this._method&&(t.method=this._method),n.prototype.deploy.apply(this,arguments)},e.exports=i},{"./ContainerSurface":75}],77:[function(t,e){function i(){this._imageUrl=void 0,n.apply(this,arguments)}var n=t("../core/Surface"),o=[],r=[],s=[],a=!0;i.enableCache=function(){a=!0},i.disableCache=function(){a=!1},i.clearCache=function(){o=[],r=[],s=[]},i.getCache=function(){return{urlCache:o,countCache:r,nodeCache:s}},i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.elementType="img",i.prototype.elementClass="famous-surface",i.prototype.setContent=function(t){var e=o.indexOf(this._imageUrl);-1!==e&&(1===r[e]?(o.splice(e,1),r.splice(e,1),s.splice(e,1)):r[e]--),e=o.indexOf(t),-1===e?(o.push(t),r.push(1)):r[e]++,this._imageUrl=t,this._contentDirty=!0},i.prototype.deploy=function(t){var e=o.indexOf(this._imageUrl);if(void 0===s[e]&&a){var i=new Image;i.src=this._imageUrl||"",s[e]=i}t.src=this._imageUrl||""},i.prototype.recall=function(t){t.src=""},e.exports=i},{"../core/Surface":14}],78:[function(t,e){function i(t){this._placeholder=t.placeholder||"",this._value=t.value||"",this._type=t.type||"text",this._name=t.name||"",n.apply(this,arguments),this.on("click",this.focus.bind(this)),window.addEventListener("click",function(t){t.target!==this._currentTarget&&this.blur()}.bind(this))}var n=t("../core/Surface");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.elementType="input",i.prototype.elementClass="famous-surface",i.prototype.setPlaceholder=function(t){return this._placeholder=t,this._contentDirty=!0,this},i.prototype.focus=function(){return this._currentTarget&&this._currentTarget.focus(),this},i.prototype.blur=function(){return this._currentTarget&&this._currentTarget.blur(),this},i.prototype.setValue=function(t){return this._value=t,this._contentDirty=!0,this},i.prototype.setType=function(t){return this._type=t,this._contentDirty=!0,this},i.prototype.getValue=function(){return this._currentTarget?this._currentTarget.value:this._value},i.prototype.setName=function(t){return this._name=t,this._contentDirty=!0,this},i.prototype.getName=function(){return this._name},i.prototype.deploy=function(t){""!==this._placeholder&&(t.placeholder=this._placeholder),t.value=this._value,t.type=this._type,t.name=this._name},e.exports=i},{"../core/Surface":14}],79:[function(t,e){function i(t){n.apply(this,arguments),this._type="submit",t&&t.onClick&&this.setOnClick(t.onClick)}var n=t("./InputSurface");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.setOnClick=function(t){this.onClick=t},i.prototype.deploy=function(t){this.onclick&&(t.onClick=this.onClick),n.prototype.deploy.apply(this,arguments)},e.exports=i},{"./InputSurface":78}],80:[function(t,e){function i(t){this._placeholder=t.placeholder||"",this._value=t.value||"",this._name=t.name||"",this._wrap=t.wrap||"",this._cols=t.cols||"",this._rows=t.rows||"",n.apply(this,arguments),this.on("click",this.focus.bind(this))}var n=t("../core/Surface");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.elementType="textarea",i.prototype.elementClass="famous-surface",i.prototype.setPlaceholder=function(t){return this._placeholder=t,this._contentDirty=!0,this},i.prototype.focus=function(){return this._currentTarget&&this._currentTarget.focus(),this},i.prototype.blur=function(){return this._currentTarget&&this._currentTarget.blur(),this},i.prototype.setValue=function(t){return this._value=t,this._contentDirty=!0,this},i.prototype.getValue=function(){return this._currentTarget?this._currentTarget.value:this._value},i.prototype.setName=function(t){return this._name=t,this._contentDirty=!0,this},i.prototype.getName=function(){return this._name},i.prototype.setWrap=function(t){return this._wrap=t,this._contentDirty=!0,this},i.prototype.setColumns=function(t){return this._cols=t,this._contentDirty=!0,this},i.prototype.setRows=function(t){return this._rows=t,this._contentDirty=!0,this},i.prototype.deploy=function(t){""!==this._placeholder&&(t.placeholder=this._placeholder),""!==this._value&&(t.value=this._value),""!==this._name&&(t.name=this._name),""!==this._wrap&&(t.wrap=this._wrap),""!==this._cols&&(t.cols=this._cols),""!==this._rows&&(t.rows=this._rows)},e.exports=i},{"../core/Surface":14}],81:[function(t,e){function i(t){n.apply(this,arguments),this._videoUrl=void 0,this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t)}var n=t("../core/Surface");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={autoplay:!1},i.prototype.elementType="video",i.prototype.elementClass="famous-surface",i.prototype.setOptions=function(t){t.size&&this.setSize(t.size),t.classes&&this.setClasses(t.classes),t.properties&&this.setProperties(t.properties),t.autoplay&&(this.options.autoplay=t.autoplay),t.src&&(this._videoUrl=t.src,this._contentDirty=!0)},i.prototype.setContent=function(t){this._videoUrl=t,this._contentDirty=!0},i.prototype.deploy=function(t){t.src=this._videoUrl,t.autoplay=this.options.autoplay},i.prototype.recall=function(t){t.src=""},e.exports=i},{"../core/Surface":14}],82:[function(t,e){e.exports={CanvasSurface:t("./CanvasSurface"),ContainerSurface:t("./ContainerSurface"),FormContainerSurface:t("./FormContainerSurface"),ImageSurface:t("./ImageSurface"),InputSurface:t("./InputSurface"),SubmitInputSurface:t("./SubmitInputSurface"),TextareaSurface:t("./TextareaSurface"),VideoSurface:t("./VideoSurface")}},{"./CanvasSurface":74,"./ContainerSurface":75,"./FormContainerSurface":76,"./ImageSurface":77,"./InputSurface":78,"./SubmitInputSurface":79,"./TextareaSurface":80,"./VideoSurface":81}],83:[function(t,e){function i(t){this._map=t||null,this._cachedOutput=null,this._cachedInput=Number.NaN}i.create=function(t){var e=new i(t);return e.get.bind(e)},i.prototype.get=function(t){return t!==this._cachedInput&&(this._cachedInput=t,this._cachedOutput=this._map(t)),this._cachedOutput},e.exports=i},{}],84:[function(t,e){var i={inQuad:function(t){return t*t},outQuad:function(t){return-(t-=1)*t+1},inOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},inQuart:function(t){return t*t*t*t},outQuart:function(t){return-(--t*t*t*t-1)},inOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return--t*t*t*t*t+1},inOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},inSine:function(t){return-1*Math.cos(t*(Math.PI/2))+1},outSine:function(t){return Math.sin(t*(Math.PI/2))},inOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},inExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},outExpo:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},inOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},inCirc:function(t){return-(Math.sqrt(1-t*t)-1)},outCirc:function(t){return Math.sqrt(1- --t*t)},inOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},inElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:1===t?1:(i||(i=.3),e=i/(2*Math.PI)*Math.asin(1/n),-(n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i)))},outElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:1===t?1:(i||(i=.3),e=i/(2*Math.PI)*Math.asin(1/n),n*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/i)+1)},inOutElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:2===(t/=.5)?1:(i||(i=.3*1.5),e=i/(2*Math.PI)*Math.asin(1/n),1>t?-.5*n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i):.5*n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i)+1)},inBack:function(t,e){return void 0===e&&(e=1.70158),t*t*((e+1)*t-e)},outBack:function(t,e){return void 0===e&&(e=1.70158),--t*t*((e+1)*t+e)+1},inOutBack:function(t,e){return void 0===e&&(e=1.70158),(t/=.5)<1?.5*t*t*(((e*=1.525)+1)*t-e):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},inBounce:function(t){return 1-i.outBounce(1-t)},outBounce:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},inOutBounce:function(t){return.5>t?.5*i.inBounce(2*t):.5*i.outBounce(2*t-1)+.5}};e.exports=i},{}],85:[function(t,e){function i(t){this.method=t,this._instances=[],this.state=[]}var n=t("../utilities/Utility");i.SUPPORTS_MULTIPLE=!0,i.prototype.get=function(){for(var t=0;t<this._instances.length;t++)this.state[t]=this._instances[t].get();return this.state},i.prototype.set=function(t,e,i){for(var o=n.after(t.length,i),r=0;r<t.length;r++)this._instances[r]||(this._instances[r]=new this.method),this._instances[r].set(t[r],e,o)},i.prototype.reset=function(t){for(var e=0;e<t.length;e++)this._instances[e]||(this._instances[e]=new this.method),this._instances[e].reset(t[e])},e.exports=i},{"../utilities/Utility":95}],86:[function(t,e){function i(t){t=t||0,this.endState=new g(t),this.initState=new g,this._dimensions=1,this._restTolerance=1e-10,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new v,this.particle=new y,this.spring=new _({anchor:this.endState}),this.PE.addBody(this.particle),this.PE.attach(this.spring,this.particle)}function n(){return this.particle.getEnergy()+this.spring.getEnergy([this.particle])}function o(){var t=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===t?this._restTolerance:this._restTolerance*t}function r(t){this.endState.set(t),o.call(this)}function s(){this.PE.wake()}function a(){this.PE.sleep()}function c(t){this.particle.position.set(t)}function u(t){this.particle.velocity.set(t)}function l(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function h(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function p(t){this._callback=t}function f(t){var e=i.DEFAULT_OPTIONS;void 0===t.period&&(t.period=e.period),void 0===t.dampingRatio&&(t.dampingRatio=e.dampingRatio),void 0===t.velocity&&(t.velocity=e.velocity),this.spring.setOptions({period:t.period,dampingRatio:t.dampingRatio}),u.call(this,t.velocity)}function d(){if(this.PE.isSleeping()){if(this._callback){var t=this._callback;this._callback=void 0,t()}}else n.call(this)<this._absRestTolerance&&(c.call(this,this.endState),u.call(this,[0,0,0]),a.call(this))}var v=t("../physics/PhysicsEngine"),y=t("../physics/bodies/Particle"),_=t("../physics/constraints/Snap"),g=t("../math/Vector");i.SUPPORTS_MULTIPLE=3,i.DEFAULT_OPTIONS={period:100,dampingRatio:.2,velocity:0},i.prototype.reset=function(t,e){this._dimensions=t instanceof Array?t.length:0,this.initState.set(t),c.call(this,t),r.call(this,t),e&&u.call(this,e),p.call(this,void 0)},i.prototype.getVelocity=function(){return h.call(this)},i.prototype.setVelocity=function(t){this.call(this,u(t))},i.prototype.isActive=function(){return!this.PE.isSleeping()},i.prototype.halt=function(){this.set(this.get())},i.prototype.get=function(){return d.call(this),l.call(this)},i.prototype.set=function(t,e,i){return e?(this._dimensions=t instanceof Array?t.length:0,s.call(this),f.call(this,e),r.call(this,t),void p.call(this,i)):(this.reset(t),void(i&&i()))},e.exports=i},{"../math/Vector":41,"../physics/PhysicsEngine":48,"../physics/bodies/Particle":51,"../physics/constraints/Snap":58}],87:[function(t,e){function i(t){t=t||0,this.endState=new g(t),this.initState=new g,this._dimensions=void 0,this._restTolerance=1e-10,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new v,this.spring=new _({anchor:this.endState}),this.particle=new y,this.PE.addBody(this.particle),this.PE.attach(this.spring,this.particle)}function n(){return this.particle.getEnergy()+this.spring.getEnergy([this.particle])}function o(t){this.particle.setPosition(t)}function r(t){this.particle.setVelocity(t)}function s(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function a(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function c(t){this._callback=t}function u(){this.PE.wake()}function l(){this.PE.sleep()}function h(){if(this.PE.isSleeping()){if(this._callback){var t=this._callback;this._callback=void 0,t()}}else n.call(this)<this._absRestTolerance&&(o.call(this,this.endState),r.call(this,[0,0,0]),l.call(this))}function p(t){var e=i.DEFAULT_OPTIONS;void 0===t.period&&(t.period=e.period),void 0===t.dampingRatio&&(t.dampingRatio=e.dampingRatio),void 0===t.velocity&&(t.velocity=e.velocity),t.period<150&&(t.period=150,console.warn("The period of a SpringTransition is capped at 150 ms. Use a SnapTransition for faster transitions")),this.spring.setOptions({period:t.period,dampingRatio:t.dampingRatio}),r.call(this,t.velocity);
}function f(){var t=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===t?this._restTolerance:this._restTolerance*t}function d(t){this.endState.set(t),f.call(this)}var v=t("../physics/PhysicsEngine"),y=t("../physics/bodies/Particle"),_=t("../physics/forces/Spring"),g=t("../math/Vector");i.SUPPORTS_MULTIPLE=3,i.DEFAULT_OPTIONS={period:300,dampingRatio:.5,velocity:0},i.prototype.reset=function(t,e){this._dimensions=t instanceof Array?t.length:0,this.initState.set(t),o.call(this,t),d.call(this,t),e&&r.call(this,e),c.call(this,void 0)},i.prototype.getVelocity=function(){return a.call(this)},i.prototype.setVelocity=function(t){this.call(this,r(t))},i.prototype.isActive=function(){return!this.PE.isSleeping()},i.prototype.halt=function(){this.set(this.get())},i.prototype.get=function(){return h.call(this),s.call(this)},i.prototype.set=function(t,e,i){return e?(this._dimensions=t instanceof Array?t.length:0,u.call(this),p.call(this,e),d.call(this,t),void c.call(this,i)):(this.reset(t),void(i&&i()))},e.exports=i},{"../math/Vector":41,"../physics/PhysicsEngine":48,"../physics/bodies/Particle":51,"../physics/forces/Spring":68}],88:[function(t,e){function i(t){this.currentAction=null,this.actionQueue=[],this.callbackQueue=[],this.state=0,this.velocity=void 0,this._callback=void 0,this._engineInstance=null,this._currentMethod=null,this.set(t)}function n(){if(this._callback){var t=this._callback;this._callback=void 0,t()}if(this.actionQueue.length<=0)return void this.set(this.get());this.currentAction=this.actionQueue.shift(),this._callback=this.callbackQueue.shift();var e=null,i=this.currentAction[0],a=this.currentAction[1];a instanceof Object&&a.method?(e=a.method,"string"==typeof e&&(e=s[e])):e=r,this._currentMethod!==e&&(this._engineInstance=!(i instanceof Object)||e.SUPPORTS_MULTIPLE===!0||i.length<=e.SUPPORTS_MULTIPLE?new e:new o(e),this._currentMethod=e),this._engineInstance.reset(this.state,this.velocity),void 0!==this.velocity&&(a.velocity=this.velocity),this._engineInstance.set(i,a,n.bind(this))}var o=t("./MultipleTransition"),r=t("./TweenTransition"),s={};i.register=function(t){var e=!0;for(var n in t)i.registerMethod(n,t[n])||(e=!1);return e},i.registerMethod=function(t,e){return t in s?!1:(s[t]=e,!0)},i.unregisterMethod=function(t){return t in s?(delete s[t],!0):!1},i.prototype.set=function(t,e,i){if(!e)return this.reset(t),i&&i(),this;var o=[t,e];return this.actionQueue.push(o),this.callbackQueue.push(i),this.currentAction||n.call(this),this},i.prototype.reset=function(t,e){this._currentMethod=null,this._engineInstance=null,this._callback=void 0,this.state=t,this.velocity=e,this.currentAction=null,this.actionQueue=[],this.callbackQueue=[]},i.prototype.delay=function(t,e){var i;return i=this.actionQueue.length?this.actionQueue[this.actionQueue.length-1][0]:this.currentAction?this.currentAction[0]:this.get(),this.set(i,{duration:t,curve:function(){return 0}},e)},i.prototype.get=function(t){return this._engineInstance&&(this._engineInstance.getVelocity&&(this.velocity=this._engineInstance.getVelocity()),this.state=this._engineInstance.get(t)),this.state},i.prototype.isActive=function(){return!!this.currentAction},i.prototype.halt=function(){return this.set(this.get())},e.exports=i},{"./MultipleTransition":85,"./TweenTransition":90}],89:[function(t,e){function i(t){this._final=s.identity.slice(),this._finalTranslate=[0,0,0],this._finalRotate=[0,0,0],this._finalSkew=[0,0,0],this._finalScale=[1,1,1],this.translate=new r(this._finalTranslate),this.rotate=new r(this._finalRotate),this.skew=new r(this._finalSkew),this.scale=new r(this._finalScale),t&&this.set(t)}function n(){return s.build({translate:this.translate.get(),rotate:this.rotate.get(),skew:this.skew.get(),scale:this.scale.get()})}function o(){return s.build({translate:this._finalTranslate,rotate:this._finalRotate,skew:this._finalSkew,scale:this._finalScale})}var r=t("./Transitionable"),s=t("../core/Transform"),a=t("../utilities/Utility");i.prototype.setTranslate=function(t,e,i){return this._finalTranslate=t,this._final=o.call(this),this.translate.set(t,e,i),this},i.prototype.setScale=function(t,e,i){return this._finalScale=t,this._final=o.call(this),this.scale.set(t,e,i),this},i.prototype.setRotate=function(t,e,i){return this._finalRotate=t,this._final=o.call(this),this.rotate.set(t,e,i),this},i.prototype.setSkew=function(t,e,i){return this._finalSkew=t,this._final=o.call(this),this.skew.set(t,e,i),this},i.prototype.set=function(t,e,i){var n=s.interpret(t);this._finalTranslate=n.translate,this._finalRotate=n.rotate,this._finalSkew=n.skew,this._finalScale=n.scale,this._final=t;var o=i?a.after(4,i):null;return this.translate.set(n.translate,e,o),this.rotate.set(n.rotate,e,o),this.skew.set(n.skew,e,o),this.scale.set(n.scale,e,o),this},i.prototype.setDefaultTransition=function(t){this.translate.setDefault(t),this.rotate.setDefault(t),this.skew.setDefault(t),this.scale.setDefault(t)},i.prototype.get=function(){return this.isActive()?n.call(this):this._final},i.prototype.getFinal=function(){return this._final},i.prototype.isActive=function(){return this.translate.isActive()||this.rotate.isActive()||this.scale.isActive()||this.skew.isActive()},i.prototype.halt=function(){return this.translate.halt(),this.rotate.halt(),this.skew.halt(),this.scale.halt(),this._final=this.get(),this._finalTranslate=this.translate.get(),this._finalRotate=this.rotate.get(),this._finalSkew=this.skew.get(),this._finalScale=this.scale.get(),this},e.exports=i},{"../core/Transform":15,"../utilities/Utility":95,"./Transitionable":88}],90:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),t&&this.setOptions(t),this._startTime=0,this._startValue=0,this._updateTime=0,this._endValue=0,this._curve=void 0,this._duration=0,this._active=!1,this._callback=void 0,this.state=0,this.velocity=void 0}function n(t,e,i){return(1-i)*t+i*e}function o(t){return t instanceof Object?t instanceof Array?t.slice(0):Object.create(t):t}function r(t,e){var n={curve:e.curve};return e.duration&&(n.duration=e.duration),e.speed&&(n.speed=e.speed),t instanceof Object&&(void 0!==t.duration&&(n.duration=t.duration),t.curve&&(n.curve=t.curve),t.speed&&(n.speed=t.speed)),"string"==typeof n.curve&&(n.curve=i.getCurve(n.curve)),n}function s(t,e,i,n,o){var r,s=1e-7,a=(i(o)-i(o-s))/s;if(t instanceof Array){r=[];for(var c=0;c<t.length;c++)r[c]="number"==typeof t[c]?a*(t[c]-e[c])/n:0}else r=a*(t-e)/n;return r}function a(t,e,i){var o;if(t instanceof Array){o=[];for(var r=0;r<t.length;r++)o[r]="number"==typeof t[r]?n(t[r],e[r],i):t[r]}else o=n(t,e,i);return o}i.Curves={linear:function(t){return t},easeIn:function(t){return t*t},easeOut:function(t){return t*(2-t)},easeInOut:function(t){return.5>=t?2*t*t:-2*t*t+4*t-1},easeOutBounce:function(t){return t*(3-2*t)},spring:function(t){return(1-t)*Math.sin(6*Math.PI*t)+t}},i.SUPPORTS_MULTIPLE=!0,i.DEFAULT_OPTIONS={curve:i.Curves.linear,duration:500,speed:0};var c={};i.registerCurve=function(t,e){return c[t]?!1:(c[t]=e,!0)},i.unregisterCurve=function(t){return c[t]?(delete c[t],!0):!1},i.getCurve=function(t){var e=c[t];if(void 0!==e)return e;throw new Error("curve not registered")},i.getCurves=function(){return c},i.prototype.setOptions=function(t){void 0!==t.curve&&(this.options.curve=t.curve),void 0!==t.duration&&(this.options.duration=t.duration),void 0!==t.speed&&(this.options.speed=t.speed)},i.prototype.set=function(t,e,i){if(!e)return this.reset(t),void(i&&i());if(this._startValue=o(this.get()),e=r(e,this.options),e.speed){var n=this._startValue;if(n instanceof Object){var s=0;for(var a in n)s+=(t[a]-n[a])*(t[a]-n[a]);e.duration=Math.sqrt(s)/e.speed}else e.duration=Math.abs(t-n)/e.speed}this._startTime=Date.now(),this._endValue=o(t),this._startVelocity=o(e.velocity),this._duration=e.duration,this._curve=e.curve,this._active=!0,this._callback=i},i.prototype.reset=function(t,e){if(this._callback){var i=this._callback;this._callback=void 0,i()}this.state=o(t),this.velocity=o(e),this._startTime=0,this._duration=0,this._updateTime=0,this._startValue=this.state,this._startVelocity=this.velocity,this._endValue=this.state,this._active=!1},i.prototype.getVelocity=function(){return this.velocity},i.prototype.get=function(t){return this.update(t),this.state},i.prototype.update=function(t){if(this._active){if(t||(t=Date.now()),!(this._updateTime>=t)){this._updateTime=t;var e=t-this._startTime;if(e>=this._duration)this.state=this._endValue,this.velocity=s(this.state,this._startValue,this._curve,this._duration,1),this._active=!1;else if(0>e)this.state=this._startValue,this.velocity=this._startVelocity;else{var i=e/this._duration;this.state=a(this._startValue,this._endValue,this._curve(i)),this.velocity=s(this.state,this._startValue,this._curve,this._duration,i)}}}else if(this._callback){var n=this._callback;this._callback=void 0,n()}},i.prototype.isActive=function(){return this._active},i.prototype.halt=function(){this.reset(this.get())},i.registerCurve("linear",i.Curves.linear),i.registerCurve("easeIn",i.Curves.easeIn),i.registerCurve("easeOut",i.Curves.easeOut),i.registerCurve("easeInOut",i.Curves.easeInOut),i.registerCurve("easeOutBounce",i.Curves.easeOutBounce),i.registerCurve("spring",i.Curves.spring),i.customCurve=function(t,e){return t=t||0,e=e||0,function(i){return t*i+(-2*t-e+3)*i*i+(t+e-2)*i*i*i}},e.exports=i},{}],91:[function(t,e){function i(t){t=t||0,this.endState=new m(t),this.initState=new m,this.spring=new _({anchor:this.endState}),this.wall=new g,this._restTolerance=1e-10,this._dimensions=1,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new v,this.particle=new y,this.PE.addBody(this.particle),this.PE.attach([this.wall,this.spring],this.particle)}function n(){return this.particle.getEnergy()+this.spring.getEnergy([this.particle])}function o(){var t=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===t?this._restTolerance:this._restTolerance*t}function r(){this.PE.wake()}function s(){this.PE.sleep()}function a(t){this.endState.set(t);var e=this.endState.sub(this.initState).norm();this.wall.setOptions({distance:this.endState.norm(),normal:0===e?this.particle.velocity.normalize(-1):this.endState.sub(this.initState).normalize(-1)}),o.call(this)}function c(t){this.particle.position.set(t)}function u(t){this.particle.velocity.set(t)}function l(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function h(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function p(t){this._callback=t}function f(){if(this.PE.isSleeping()){if(this._callback){var t=this._callback;this._callback=void 0,t()}}else{var e=n.call(this);e<this._absRestTolerance&&(s.call(this),c.call(this,this.endState),u.call(this,[0,0,0]))}}function d(t){var e=i.DEFAULT_OPTIONS;void 0===t.period&&(t.period=e.period),void 0===t.dampingRatio&&(t.dampingRatio=e.dampingRatio),void 0===t.velocity&&(t.velocity=e.velocity),void 0===t.restitution&&(t.restitution=e.restitution),void 0===t.drift&&(t.drift=g.DEFAULT_OPTIONS.drift),void 0===t.slop&&(t.slop=g.DEFAULT_OPTIONS.slop),this.spring.setOptions({period:t.period,dampingRatio:t.dampingRatio}),this.wall.setOptions({restitution:t.restitution,drift:t.drift,slop:t.slop}),u.call(this,t.velocity)}var v=t("../physics/PhysicsEngine"),y=t("../physics/bodies/Particle"),_=t("../physics/forces/Spring"),g=t("../physics/constraints/Wall"),m=t("../math/Vector");i.SUPPORTS_MULTIPLE=3,i.DEFAULT_OPTIONS={period:300,dampingRatio:.5,velocity:0,restitution:.5},i.prototype.reset=function(t,e){this._dimensions=t instanceof Array?t.length:0,this.initState.set(t),c.call(this,t),e&&u.call(this,e),a.call(this,t),p.call(this,void 0)},i.prototype.getVelocity=function(){return h.call(this)},i.prototype.setVelocity=function(t){this.call(this,u(t))},i.prototype.isActive=function(){return!this.PE.isSleeping()},i.prototype.halt=function(){this.set(this.get())},i.prototype.get=function(){return f.call(this),l.call(this)},i.prototype.set=function(t,e,i){return e?(this._dimensions=t instanceof Array?t.length:0,r.call(this),d.call(this,e),a.call(this,t),void p.call(this,i)):(this.reset(t),void(i&&i()))},e.exports=i},{"../math/Vector":41,"../physics/PhysicsEngine":48,"../physics/bodies/Particle":51,"../physics/constraints/Wall":60,"../physics/forces/Spring":68}],92:[function(t,e){e.exports={CachedMap:t("./CachedMap"),Easing:t("./Easing"),MultipleTransition:t("./MultipleTransition"),SnapTransition:t("./SnapTransition"),SpringTransition:t("./SpringTransition"),Transitionable:t("./Transitionable"),TransitionableTransform:t("./TransitionableTransform"),TweenTransition:t("./TweenTransition"),WallTransition:t("./WallTransition")}},{"./CachedMap":83,"./Easing":84,"./MultipleTransition":85,"./SnapTransition":86,"./SpringTransition":87,"./Transitionable":88,"./TransitionableTransform":89,"./TweenTransition":90,"./WallTransition":91}],93:[function(t,e){var i={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ENTER:13,LEFT_ARROW:37,RIGHT_ARROW:39,UP_ARROW:38,DOWN_ARROW:40,SPACE:32,SHIFT:16,TAB:9};e.exports=i},{}],94:[function(t,e){function i(t){return u.on(l,t),t}function n(t,e){var n=h(),o=function(){var i=h();i-n>=e&&(t.apply(this,arguments),u.removeListener(l,o))};return i(o)}function o(t,e){var n=h(),o=function(){var i=h();i-n>=e&&(t.apply(this,arguments),n=h())};return i(o)}function r(t,e){if(void 0!==e){var n=function(){e--,0>=e&&(t.apply(this,arguments),a(n))};return i(n)}}function s(t,e){e=e||1;var n=e,o=function(){e--,0>=e&&(t.apply(this,arguments),e=n)};return i(o)}function a(t){u.removeListener(l,t)}function c(t,e){var i,o,r,s,c;return function(){o=this,c=arguments,r=h();var u=function(){var a=h-r;e>a?i=n(u,e-a):(i=null,s=t.apply(o,c))};return a(i),i=n(u,e),s}}var u=t("../core/Engine"),l="prerender",h=window.performance&&window.performance.now?function(){return window.performance.now()}:function(){return Date.now()};e.exports={setTimeout:n,setInterval:o,debounce:c,after:r,every:s,clear:a}},{"../core/Engine":4}],95:[function(t,e){var i={};i.Direction={X:0,Y:1,Z:2},i.after=function(t,e){var i=t;return function(){i--,0===i&&e.apply(this,arguments)}},i.loadURL=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===this.readyState&&e&&e(this.responseText)},i.open("GET",t),i.send()},i.createDocumentFragmentFromHTML=function(t){var e=document.createElement("div");e.innerHTML=t;for(var i=document.createDocumentFragment();e.hasChildNodes();)i.appendChild(e.firstChild);return i},i.clone=function(t){var e;if("object"==typeof t){e=t instanceof Array?[]:{};for(var n in t)if("object"==typeof t[n]&&null!==t[n])if(t[n]instanceof Array){e[n]=new Array(t[n].length);for(var o=0;o<t[n].length;o++)e[n][o]=i.clone(t[n][o])}else e[n]=i.clone(t[n]);else e[n]=t[n]}else e=t;return e},e.exports=i},{}],96:[function(t,e){e.exports={KeyCodes:t("./KeyCodes"),Timer:t("./Timer"),Utility:t("./Utility")}},{"./KeyCodes":93,"./Timer":94,"./Utility":95}],97:[function(t,e){function i(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS||i.DEFAULT_OPTIONS),this._optionsManager=new r(this.options),t&&this.setOptions(t),this._eventInput=new o,this._eventOutput=new o,o.setInputHandler(this,this._eventInput),o.setOutputHandler(this,this._eventOutput),this._id=n.register(this)}var n=t("../core/Entity");t("../core/Transform");var o=t("../core/EventHandler"),r=t("../core/OptionsManager");i.DEFAULT_OPTIONS={},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},i.prototype.getOptions=function(t){return this._optionsManager.getOptions(t)},i.prototype.render=function(){return this._id},i.prototype.commit=function(){},e.exports=i},{"../core/Entity":5,"../core/EventHandler":7,"../core/OptionsManager":10,"../core/Transform":15}],98:[function(t,e){function i(){u.apply(this,arguments),this.state=new a(0),this._isOpen=!1,this.setOutputFunction(function(t,e,i){var o=n.call(this),s=this.options.direction===c.Direction.X?r.translate(o*e,0,.001*(o-1)*e):r.translate(0,o*e,.001*(o-1)*e),a=t.render();if(this.options.stackRotation){var u=this.options.stackRotation*i*(1-o);a={transform:r.rotateZ(u),origin:[.5,.5],target:a}}return{transform:s,size:t.getSize(),target:a}})}function n(t){return t?this._isOpen?1:0:this.state.get()}function o(t,e,i){this.state.halt(),this.state.set(t,e,i)}var r=t("../core/Transform"),s=t("../core/OptionsManager"),a=t("../transitions/Transitionable"),c=t("../utilities/Utility"),u=t("./SequentialLayout");i.prototype=Object.create(u.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS=s.patch(u.DEFAULT_OPTIONS,{transition:{curve:"easeOutBounce",duration:500},stackRotation:0}),i.prototype.getSize=function(){var t=u.prototype.getSize.apply(this,arguments),e=this._items?this._items.get().getSize():[0,0];e||(e=[0,0]);var i=n.call(this),o=1-i;return[e[0]*o+t[0]*i,e[1]*o+t[1]*i]},i.prototype.isOpen=function(){return this._isOpen},i.prototype.open=function(t){this._isOpen=!0,o.call(this,1,this.options.transition,t)},i.prototype.close=function(t){this._isOpen=!1,o.call(this,0,this.options.transition,t)},i.prototype.toggle=function(t){this._isOpen?this.close(t):this.open(t)},e.exports=i},{"../core/OptionsManager":10,"../core/Transform":15,"../transitions/Transitionable":88,"../utilities/Utility":95,"./SequentialLayout":110}],99:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new l(this.options),t&&this.setOptions(t),this._position=new h(0),this._direction=n(this.options.side),this._orientation=o(this.options.side),this._isOpen=!1,this._cachedLength=0,this.drawer=new c,this.content=new c,this._eventInput=new p,this._eventOutput=new p,p.setInputHandler(this,this._eventInput),p.setOutputHandler(this,this._eventOutput),this._eventInput.on("update",s.bind(this)),this._eventInput.on("end",a.bind(this))}function n(t){var e=i.SIDES;return t===e.LEFT||t===e.RIGHT?f:d}function o(t){var e=i.SIDES;return t===e.LEFT||t===e.TOP?1:-1}function r(t){var e,i=this.options;if(i.drawerLength)e=i.drawerLength;else{var n=t.getSize();e=n?n[this._direction]:i.drawerLength}return this._orientation*e}function s(t){var e,i,n=this.getPosition()+t.delta;this._cachedLength=r.call(this,this.drawer),1===this._orientation?(e=0,i=this._cachedLength):(e=this._cachedLength,i=0),n>i?n=i:e>n&&(n=e),this.setPosition(n)}function a(t){var e=t.velocity,i=this._orientation*this.getPosition(),n=this.options,o=this._orientation*this._cachedLength,r=n.positionThreshold||o/2,s=n.velocityThreshold;if(n.transition instanceof Object&&(n.transition.velocity=t.velocity),0===i)return void(this._isOpen=!1);if(i===o)return void(this._isOpen=!0);var a=Math.abs(e)>s||!this._isOpen&&i>r||this._isOpen&&r>i;a?this.toggle():this.reset()}var c=t("../core/RenderNode"),u=t("../core/Transform"),l=t("../core/OptionsManager"),h=t("../transitions/Transitionable"),p=t("../core/EventHandler"),f=0,d=1;i.SIDES={LEFT:0,TOP:1,RIGHT:2,BOTTOM:3},i.DEFAULT_OPTIONS={side:i.SIDES.LEFT,drawerLength:0,velocityThreshold:0,positionThreshold:0,transition:!0},i.prototype.setOptions=function(t){this._optionsManager.setOptions(t),void 0!==t.side&&(this._direction=n(t.side),this._orientation=o(t.side))},i.prototype.open=function(t,e){t instanceof Function&&(e=t),void 0===t&&(t=this.options.transition),this._cachedLength=r.call(this,this.drawer),this.setPosition(this._cachedLength,t,e),this._isOpen||(this._isOpen=!0,this._eventOutput.emit("open"))},i.prototype.close=function(t,e){t instanceof Function&&(e=t),void 0===t&&(t=this.options.transition),this.setPosition(0,t,e),this._isOpen&&(this._isOpen=!1,this._eventOutput.emit("close"))},i.prototype.setPosition=function(t,e,i){this._position.isActive()&&this._position.halt(),this._position.set(t,e,i)},i.prototype.getPosition=function(){return this._position.get()},i.prototype.setProgress=function(t,e,i){return this._position.set(t*this._cachedLength,e,i)},i.prototype.getProgress=function(){return this._position.get()/this._cachedLength},i.prototype.toggle=function(t){this._isOpen?this.close(t):this.open(t)},i.prototype.reset=function(t){this._isOpen?this.open(t):this.close(t)},i.prototype.isOpen=function(){return this._isOpen},i.prototype.render=function(){var t=this.getPosition();(!this._isOpen&&0>t&&1===this._orientation||t>0&&-1===this._orientation)&&(t=0,this.setPosition(t));var e=this._direction===f?u.translate(t,0,0):u.translate(0,t,0);return[{transform:u.behind,target:this.drawer.render()},{transform:e,target:this.content.render()}]},e.exports=i},{"../core/EventHandler":7,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../transitions/Transitionable":88}],100:[function(t,e){function i(t){this._currentTarget=null,this._size=[void 0,void 0],this._controller=new c(t),this._controller.inTransformFrom(o.create(n.bind(this,1e-4))),this._controller.outTransformFrom(o.create(n.bind(this,-1e-4))),this._eventInput=new s,s.setInputHandler(this,this._eventInput),this._entityId=r.register(this),t&&this.setOptions(t)}function n(t,e){return a.translate(this._size[0]*(1-e),0,t*(1-e))}var o=t("../transitions/CachedMap"),r=t("../core/Entity"),s=t("../core/EventHandler"),a=t("../core/Transform"),c=t("./RenderController");i.prototype.show=function(t){this._currentTarget&&this._eventInput.unpipe(this._currentTarget),this._currentTarget=t,this._currentTarget&&this._currentTarget.trigger&&this._eventInput.pipe(this._currentTarget),this._controller.show.apply(this._controller,arguments)},i.prototype.setOptions=function(t){this._controller.setOptions(t)},i.prototype.render=function(){return this._entityId},i.prototype.commit=function(t){return this._size[0]=t.size[0],this._size[1]=t.size[1],{transform:t.transform,opacity:t.opacity,origin:t.origin,size:t.size,target:this._controller.render()}},e.exports=i},{"../core/Entity":5,"../core/EventHandler":7,"../core/Transform":15,"../transitions/CachedMap":83,"./RenderController":106}],101:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this.optionsManager=new a(this.options),t&&this.setOptions(t),this.id=r.register(this),this._ratios=new u(this.options.ratios),this._nodes=[],this._size=[0,0],this._cachedDirection=null,this._cachedLengths=[],this._cachedTransforms=null,this._ratiosDirty=!1,this._eventOutput=new c,c.setOutputHandler(this,this._eventOutput)}function n(t,e,n){var o,r,a,c,u=0,l=e,h=0;for(this._cachedLengths=[],this._cachedTransforms=[],c=0;c<t.length;c++)r=t[c],a=this._nodes[c],"number"!=typeof r?l-=a.getSize()[n]||0:h+=r;for(c=0;c<t.length;c++)a=this._nodes[c],r=t[c],e="number"==typeof r?l*r/h:a.getSize()[n],o=n===i.DIRECTION_X?s.translate(u,0,0):s.translate(0,u,0),this._cachedTransforms.push(o),this._cachedLengths.push(e),u+=e}function o(t,e){for(var i=0;i<t.length;i++)if("number"!=typeof t[i]&&this._nodes[i].getSize()[e]!==this._cachedLengths[i])return!0;return!1}var r=t("../core/Entity"),s=t("../core/Transform"),a=t("../core/OptionsManager"),c=t("../core/EventHandler"),u=t("../transitions/Transitionable");i.DIRECTION_X=0,i.DIRECTION_Y=1,i.DEFAULT_OPTIONS={direction:i.DIRECTION_X,transition:!1,ratios:[]},i.prototype.render=function(){return this.id},i.prototype.setOptions=function(t){this.optionsManager.setOptions(t)},i.prototype.sequenceFrom=function(t){if(this._nodes=t,0===this._ratios.get().length){for(var e=[],i=0;i<this._nodes.length;i++)e.push(1);this.setRatios(e)}},i.prototype.setRatios=function(t,e,i){void 0===e&&(e=this.options.transition);var n=this._ratios;0===n.get().length&&(e=void 0),n.isActive()&&n.halt(),n.set(t,e,i),this._ratiosDirty=!0},i.prototype.getSize=function(){return this._size},i.prototype.commit=function(t){var e,i=t.size,r=t.transform,a=t.origin,c=t.opacity,u=this._ratios.get(),l=this.options.direction,h=i[l];(h!==this._size[l]||this._ratiosDirty||this._ratios.isActive()||l!==this._cachedDirection||o.call(this,u,l))&&(n.call(this,u,h,l),h!==this._size[l]&&(this._size[0]=i[0],this._size[1]=i[1]),l!==this._cachedDirection&&(this._cachedDirection=l),this._ratiosDirty&&(this._ratiosDirty=!1));for(var p=[],f=0;f<u.length;f++)e=[void 0,void 0],h=this._cachedLengths[f],e[l]=h,p.push({transform:this._cachedTransforms[f],size:e,target:this._nodes[f].render()});return i&&0!==a[0]&&0!==a[1]&&(r=s.moveThen([-i[0]*a[0],-i[1]*a[1],0],r)),{transform:r,size:i,opacity:c,target:p}},e.exports=i},{"../core/Entity":5,"../core/EventHandler":7,"../core/OptionsManager":10,"../core/Transform":15,"../transitions/Transitionable":88}],102:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new r(this.options),t&&this.setOptions(t),this.angle=new o(0),this.frontNode=void 0,this.backNode=void 0,this.flipped=!1}var n=t("../core/Transform"),o=t("../transitions/Transitionable");t("../core/RenderNode");var r=t("../core/OptionsManager");i.DIRECTION_X=0,i.DIRECTION_Y=1;var s=1;i.DEFAULT_OPTIONS={transition:!0,direction:i.DIRECTION_X},i.prototype.flip=function(t,e){var i=this.flipped?0:Math.PI;this.setAngle(i,t,e),this.flipped=!this.flipped},i.prototype.setAngle=function(t,e,i){void 0===e&&(e=this.options.transition),this.angle.isActive()&&this.angle.halt(),this.angle.set(t,e,i)},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},i.prototype.setFront=function(t){this.frontNode=t},i.prototype.setBack=function(t){this.backNode=t},i.prototype.render=function(){var t,e,o=this.angle.get();this.options.direction===i.DIRECTION_X?(t=n.rotateY(o),e=n.rotateY(o+Math.PI)):(t=n.rotateX(o),e=n.rotateX(o+Math.PI));var r=[];return this.frontNode&&r.push({transform:t,target:this.frontNode.render()}),this.backNode&&r.push({transform:n.moveThen([0,0,s],e),target:this.backNode.render()}),r},e.exports=i},{"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../transitions/Transitionable":88}],103:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this.optionsManager=new h(this.options),t&&this.setOptions(t),this.id=s.register(this),this._modifiers=[],this._states=[],this._contextSizeCache=[0,0],this._dimensionsCache=[0,0],this._activeCount=0,this._eventOutput=new u,u.setOutputHandler(this,this._eventOutput)}function n(t,e,i){var n=[t[0],t[1]];n[0]-=this.options.gutterSize[0]*(e-1),n[1]-=this.options.gutterSize[1]*(i-1);for(var s,a=Math.round(n[1]/i),c=Math.round(n[0]/e),u=0,l=0,h=0;i>h;h++){s=0;for(var p=0;e>p;p++)void 0===this._modifiers[l]?o.call(this,l,[c,a],[s,u,0],1):r.call(this,l,[c,a],[s,u,0],1),l++,s+=c+this.options.gutterSize[0];u+=a+this.options.gutterSize[1]}for(this._dimensionsCache=[this.options.dimensions[0],this.options.dimensions[1]],this._contextSizeCache=[t[0],t[1]],this._activeCount=i*e,h=this._activeCount;h<this._modifiers.length;h++)r.call(this,h,[Math.round(c),Math.round(a)],[0,0],0);this._eventOutput.emit("reflow")}function o(t,e,i,n){var o={transform:new f(a.translate.apply(null,i)),opacity:new p(n),size:new p(e)},r=new l({transform:o.transform,opacity:o.opacity,size:o.size});this._states[t]=o,this._modifiers[t]=r}function r(t,e,i,n){var o=this._states[t],r=o.size,s=o.opacity,a=o.transform,c=this.options.transition;a.halt(),s.halt(),r.halt(),a.setTranslate(i,c),r.set(e,c),s.set(n,c)}var s=t("../core/Entity");t("../core/RenderNode");var a=t("../core/Transform"),c=t("../core/ViewSequence"),u=t("../core/EventHandler"),l=t("../core/Modifier"),h=t("../core/OptionsManager"),p=t("../transitions/Transitionable"),f=t("../transitions/TransitionableTransform");i.DEFAULT_OPTIONS={dimensions:[1,1],transition:!1,gutterSize:[0,0]},i.prototype.render=function(){return this.id},i.prototype.setOptions=function(t){return this.optionsManager.setOptions(t)},i.prototype.sequenceFrom=function(t){t instanceof Array&&(t=new c(t)),this.sequence=t},i.prototype.getSize=function(){return this._contextSizeCache},i.prototype.commit=function(t){var e=t.transform,i=t.opacity,o=t.origin,r=t.size,s=this.options.dimensions[0],c=this.options.dimensions[1];(r[0]!==this._contextSizeCache[0]||r[1]!==this._contextSizeCache[1]||s!==this._dimensionsCache[0]||c!==this._dimensionsCache[1])&&n.call(this,r,s,c);for(var u=this.sequence,l=[],h=0;u&&h<this._modifiers.length;){var p=u.get(),f=this._modifiers[h];h>=this._activeCount&&this._states[h].opacity.isActive()&&(this._modifiers.splice(h,1),this._states.splice(h,1)),p&&l.push(f.modify({origin:o,target:p.render()})),u=u.getNext(),h++}return r&&(e=a.moveThen([-r[0]*o[0],-r[1]*o[1],0],e)),{transform:e,opacity:i,size:r,target:l}},e.exports=i},{"../core/Entity":5,"../core/EventHandler":7,"../core/Modifier":9,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../core/ViewSequence":17,"../transitions/Transitionable":88,"../transitions/TransitionableTransform":89}],104:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new u(this.options),t&&this.setOptions(t),this._entityId=s.register(this),this.header=new a,this.footer=new a,this.content=new a}function n(t,e){var i=t.getSize();return i?i[this.options.direction]:e}function o(t){return this.options.direction===i.DIRECTION_X?c.translate(t,0,0):c.translate(0,t,0)}function r(t,e){return this.options.direction===i.DIRECTION_X?[t,e[1]]:[e[0],t]}var s=t("../core/Entity"),a=t("../core/RenderNode"),c=t("../core/Transform"),u=t("../core/OptionsManager");i.DIRECTION_X=0,i.DIRECTION_Y=1,i.DEFAULT_OPTIONS={direction:i.DIRECTION_Y,headerSize:void 0,footerSize:void 0,defaultHeaderSize:0,defaultFooterSize:0},i.prototype.render=function(){return this._entityId},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},i.prototype.commit=function(t){var e=t.transform,i=t.origin,s=t.size,a=t.opacity,u=void 0!==this.options.headerSize?this.options.headerSize:n.call(this,this.header,this.options.defaultHeaderSize),l=void 0!==this.options.footerSize?this.options.footerSize:n.call(this,this.footer,this.options.defaultFooterSize),h=s[this.options.direction]-u-l;s&&(e=c.moveThen([-s[0]*i[0],-s[1]*i[1],0],e));var p=[{size:r.call(this,u,s),target:this.header.render()},{transform:o.call(this,u),size:r.call(this,h,s),target:this.content.render()},{transform:o.call(this,u+h),size:r.call(this,l,s),target:this.footer.render()}];return{transform:e,opacity:a,size:s,target:p}},e.exports=i},{"../core/Entity":5,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15}],105:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new a(this.options),t&&this.setOptions(t),this._showing=!1,this.nodes=[],this.transforms=[],this.states=[]}var n=t("../core/Transform"),o=t("../core/Modifier"),r=t("../core/RenderNode"),s=t("../utilities/Utility"),a=t("../core/OptionsManager"),c=t("../transitions/Transitionable"),u=t("../transitions/TransitionableTransform");i.DEFAULT_OPTIONS={inTransform:n.scale(.001,.001,.001),inOpacity:0,inOrigin:[.5,.5],inAlign:[.5,.5],outTransform:n.scale(.001,.001,.001),outOpacity:0,outOrigin:[.5,.5],outAlign:[.5,.5],showTransform:n.identity,showOpacity:1,showOrigin:[.5,.5],showAlign:[.5,.5],inTransition:!0,outTransition:!0,overlap:!1},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},i.prototype.show=function(t,e,i){if(!t)return this.hide(i);if(e instanceof Function&&(i=e,e=void 0),this._showing){if(!this.options.overlap)return this.hide(this.show.bind(this,t,e,i));this.hide()}this._showing=!0;var n={transform:new u(this.options.inTransform),origin:new c(this.options.inOrigin),align:new c(this.options.inAlign),opacity:new c(this.options.inOpacity)},a=new o({transform:n.transform,opacity:n.opacity,origin:n.origin,align:n.align}),l=new r;l.add(a).add(t),this.nodes.push(l),this.states.push(n),this.transforms.push(a);var h=i?s.after(3,i):void 0;
e||(e=this.options.inTransition),n.transform.set(this.options.showTransform,e,h),n.opacity.set(this.options.showOpacity,e,h),n.origin.set(this.options.showOrigin,e,h),n.align.set(this.options.showAlign,e,h)},i.prototype.hide=function(t,e){if(this._showing){this._showing=!1,t instanceof Function&&(e=t,t=void 0);var i=this.nodes[this.nodes.length-1],n=this.transforms[this.transforms.length-1],o=this.states[this.states.length-1],r=s.after(3,function(){this.nodes.splice(this.nodes.indexOf(i),1),this.states.splice(this.states.indexOf(o),1),this.transforms.splice(this.transforms.indexOf(n),1),e&&e.call(this)}.bind(this));t||(t=this.options.outTransition),o.transform.set(this.options.outTransform,t,r),o.opacity.set(this.options.outOpacity,t,r),o.origin.set(this.options.outOrigin,t,r),o.align.set(this.options.outAlign,t,r)}},i.prototype.render=function(){for(var t=[],e=0;e<this.nodes.length;e++)t.push(this.nodes[e].render());return t},e.exports=i},{"../core/Modifier":9,"../core/OptionsManager":10,"../core/RenderNode":11,"../core/Transform":15,"../transitions/Transitionable":88,"../transitions/TransitionableTransform":89,"../utilities/Utility":95}],106:[function(t,e){function i(){c.apply(this,arguments),this._showing=-1,this._outgoingRenderables=[],this._nextRenderable=null,this._renderables=[],this._nodes=[],this._modifiers=[],this._states=[],this.inTransformMap=i.DefaultMap.transform,this.inOpacityMap=i.DefaultMap.opacity,this.inOriginMap=i.DefaultMap.origin,this.inAlignMap=i.DefaultMap.align,this.outTransformMap=i.DefaultMap.transform,this.outOpacityMap=i.DefaultMap.opacity,this.outOriginMap=i.DefaultMap.origin,this.outAlignMap=i.DefaultMap.align,this._output=[]}function n(t,e){return t(e.get())}var o=t("../core/Modifier"),r=t("../core/RenderNode"),s=t("../core/Transform"),a=t("../transitions/Transitionable"),c=t("../core/View");i.prototype=Object.create(c.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={inTransition:!0,outTransition:!0,overlap:!0},i.DefaultMap={transform:function(){return s.identity},opacity:function(t){return t},origin:null,align:null},i.prototype.inTransformFrom=function(t){if(t instanceof Function)this.inTransformMap=t;else{if(!t||!t.get)throw new Error("inTransformFrom takes only function or getter object");this.inTransformMap=t.get.bind(t)}return this},i.prototype.inOpacityFrom=function(t){if(t instanceof Function)this.inOpacityMap=t;else{if(!t||!t.get)throw new Error("inOpacityFrom takes only function or getter object");this.inOpacityMap=t.get.bind(t)}return this},i.prototype.inOriginFrom=function(t){if(t instanceof Function)this.inOriginMap=t;else{if(!t||!t.get)throw new Error("inOriginFrom takes only function or getter object");this.inOriginMap=t.get.bind(t)}return this},i.prototype.inAlignFrom=function(t){if(t instanceof Function)this.inAlignMap=t;else{if(!t||!t.get)throw new Error("inAlignFrom takes only function or getter object");this.inAlignMap=t.get.bind(t)}return this},i.prototype.outTransformFrom=function(t){if(t instanceof Function)this.outTransformMap=t;else{if(!t||!t.get)throw new Error("outTransformFrom takes only function or getter object");this.outTransformMap=t.get.bind(t)}return this},i.prototype.outOpacityFrom=function(t){if(t instanceof Function)this.outOpacityMap=t;else{if(!t||!t.get)throw new Error("outOpacityFrom takes only function or getter object");this.outOpacityMap=t.get.bind(t)}return this},i.prototype.outOriginFrom=function(t){if(t instanceof Function)this.outOriginMap=t;else{if(!t||!t.get)throw new Error("outOriginFrom takes only function or getter object");this.outOriginMap=t.get.bind(t)}return this},i.prototype.outAlignFrom=function(t){if(t instanceof Function)this.outAlignMap=t;else{if(!t||!t.get)throw new Error("outAlignFrom takes only function or getter object");this.outAlignMap=t.get.bind(t)}return this},i.prototype.show=function(t,e,i){if(!t)return this.hide(i);if(e instanceof Function&&(i=e,e=null),this._showing>=0){if(!this.options.overlap)return void(this._nextRenderable?this._nextRenderable=t:(this._nextRenderable=t,this.hide(function(){this._nextRenderable===t&&this.show(this._nextRenderable,i),this._nextRenderable=null})));this.hide()}var s=null,c=this._renderables.indexOf(t);if(c>=0){this._showing=c,s=this._states[c],s.halt();var u=this._outgoingRenderables.indexOf(t);u>=0&&this._outgoingRenderables.splice(u,1)}else{s=new a(0);var l=new o({transform:this.inTransformMap?n.bind(this,this.inTransformMap,s):null,opacity:this.inOpacityMap?n.bind(this,this.inOpacityMap,s):null,origin:this.inOriginMap?n.bind(this,this.inOriginMap,s):null,align:this.inAlignMap?n.bind(this,this.inAlignMap,s):null}),h=new r;h.add(l).add(t),this._showing=this._nodes.length,this._nodes.push(h),this._modifiers.push(l),this._states.push(s),this._renderables.push(t)}e||(e=this.options.inTransition),s.set(1,e,i)},i.prototype.hide=function(t,e){if(!(this._showing<0)){var i=this._showing;this._showing=-1,t instanceof Function&&(e=t,t=void 0);var o=this._nodes[i],r=this._modifiers[i],s=this._states[i],a=this._renderables[i];r.transformFrom(this.outTransformMap?n.bind(this,this.outTransformMap,s):null),r.opacityFrom(this.outOpacityMap?n.bind(this,this.outOpacityMap,s):null),r.originFrom(this.outOriginMap?n.bind(this,this.outOriginMap,s):null),r.alignFrom(this.outAlignMap?n.bind(this,this.outAlignMap,s):null),this._outgoingRenderables.indexOf(a)<0&&this._outgoingRenderables.push(a),t||(t=this.options.outTransition),s.halt(),s.set(0,t,function(t,i,n,o){if(this._outgoingRenderables.indexOf(o)>=0){var r=this._nodes.indexOf(t);this._nodes.splice(r,1),this._modifiers.splice(r,1),this._states.splice(r,1),this._renderables.splice(r,1),this._outgoingRenderables.splice(this._outgoingRenderables.indexOf(o),1),this._showing>=r&&this._showing--}e&&e.call(this)}.bind(this,o,r,s,a))}},i.prototype.render=function(){var t=this._output;t.length>this._nodes.length&&t.splice(this._nodes.length);for(var e=0;e<this._nodes.length;e++)t[e]=this._nodes[e].render();return t},e.exports=i},{"../core/Modifier":9,"../core/RenderNode":11,"../core/Transform":15,"../core/View":16,"../transitions/Transitionable":88}],107:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new s(this.options),t&&this.setOptions(t),this.container=new n(this.options.container),this.scrollview=new r(this.options.scrollview),this.container.add(this.scrollview),this._eventInput=new o,o.setInputHandler(this,this._eventInput),this._eventInput.pipe(this.scrollview),this._eventOutput=new o,o.setOutputHandler(this,this._eventOutput),this.container.pipe(this._eventOutput),this.scrollview.pipe(this._eventOutput)}var n=t("../surfaces/ContainerSurface"),o=t("../core/EventHandler"),r=t("./Scrollview");t("../utilities/Utility");var s=t("../core/OptionsManager");i.DEFAULT_OPTIONS={container:{properties:{overflow:"hidden"}},scrollview:{}},i.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},i.prototype.sequenceFrom=function(){return this.scrollview.sequenceFrom.apply(this.scrollview,arguments)},i.prototype.getSize=function(){return this.container.getSize.apply(this.container,arguments)},i.prototype.render=function(){return this.container.render()},e.exports=i},{"../core/EventHandler":7,"../core/OptionsManager":10,"../surfaces/ContainerSurface":75,"../utilities/Utility":95,"./Scrollview":109}],108:[function(t,e){function i(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),this._optionsManager=new u(this.options),t&&this._optionsManager.setOptions(t),this._node=null,this._position=0,this._positionOffset=0,this._positionGetter=null,this._outputFunction=null,this._masterOutputFunction=null,this.outputFrom(),this._onEdge=0,this.group=new c,this.group.add({render:s.bind(this)}),this._entityId=a.register(this),this._size=[void 0,void 0],this._contextSize=[void 0,void 0],this._eventInput=new f,this._eventOutput=new f,f.setInputHandler(this,this._eventInput),f.setOutputHandler(this,this._eventOutput)}function n(t){t||(t=this._contextSize);var e=this.options.direction;return void 0===t[e]?this._contextSize[e]:t[e]}function o(t,e,i){var o=t.getSize?t.getSize():this._contextSize,r=this._outputFunction(e);return i.push({transform:r,target:t.render()}),n.call(this,o)}function r(){return void 0!==this.options.clipSize?this.options.clipSize:this._contextSize[this.options.direction]>this.getCumulativeSize()[this.options.direction]?n.call(this,this.getCumulativeSize()):n.call(this,this._contextSize)}function s(){for(var t=null,e=this._position,i=[],s=-this._positionOffset,a=r.call(this),c=this._node;c&&s-e<a+this.options.margin;)s+=o.call(this,c,s,i),c=c.getNext?c.getNext():null;var u=this._node,l=n.call(this,u.getSize());if(a>s){for(;u&&a>l;)u=u.getPrevious(),u&&(l+=n.call(this,u.getSize()));for(u=this._node;u&&a>l;)u=u.getNext(),u&&(l+=n.call(this,u.getSize()))}for(!c&&a-d>s-e?1!==this._onEdge&&(this._onEdge=1,this._eventOutput.emit("onEdge",{position:s-a})):!this._node.getPrevious()&&-d>e?-1!==this._onEdge&&(this._onEdge=-1,this._eventOutput.emit("onEdge",{position:0})):0!==this._onEdge&&(this._onEdge=0,this._eventOutput.emit("offEdge")),c=this._node&&this._node.getPrevious?this._node.getPrevious():null,s=-this._positionOffset,c&&(t=c.getSize?c.getSize():this._contextSize,s-=n.call(this,t));c&&s-e>-(a+this.options.margin);)o.call(this,c,s,i),c=c.getPrevious?c.getPrevious():null,c&&(t=c.getSize?c.getSize():this._contextSize,s-=n.call(this,t));return i}var a=t("../core/Entity"),c=t("../core/Group"),u=t("../core/OptionsManager"),l=t("../core/Transform"),h=t("../utilities/Utility"),p=t("../core/ViewSequence"),f=t("../core/EventHandler");i.DEFAULT_OPTIONS={direction:h.Direction.Y,margin:0,clipSize:void 0,groupScroll:!1};var d=0;i.prototype.getCumulativeSize=function(t){return void 0===t&&(t=this._node._.cumulativeSizes.length-1),this._node._.getSize(t)},i.prototype.setOptions=function(t){t.groupScroll!==this.options.groupScroll&&(t.groupScroll?this.group.pipe(this._eventOutput):this.group.unpipe(this._eventOutput)),this._optionsManager.setOptions(t)},i.prototype.onEdge=function(){return this._onEdge},i.prototype.outputFrom=function(t,e){t||(t=function(t){return this.options.direction===h.Direction.X?l.translate(t,0):l.translate(0,t)}.bind(this),e||(e=t)),this._outputFunction=t,this._masterOutputFunction=e?e:function(e){return l.inverse(t(-e))}},i.prototype.positionFrom=function(t){t instanceof Function?this._positionGetter=t:t&&t.get?this._positionGetter=t.get.bind(t):(this._positionGetter=null,this._position=t),this._positionGetter&&(this._position=this._positionGetter.call(this))},i.prototype.sequenceFrom=function(t){t instanceof Array&&(t=new p({array:t})),this._node=t,this._positionOffset=0},i.prototype.getSize=function(t){return t?this._contextSize:this._size},i.prototype.render=function(){return this._node?(this._positionGetter&&(this._position=this._positionGetter.call(this)),this._entityId):null},i.prototype.commit=function(t){var e=t.transform,i=t.opacity,n=t.origin,o=t.size;this.options.clipSize||o[0]===this._contextSize[0]&&o[1]===this._contextSize[1]||(this._onEdge=0,this._contextSize[0]=o[0],this._contextSize[1]=o[1],this.options.direction===h.Direction.X?(this._size[0]=r.call(this),this._size[1]=void 0):(this._size[0]=void 0,this._size[1]=r.call(this)));var s=this._masterOutputFunction(-this._position);return{transform:l.multiply(e,s),size:o,opacity:i,origin:n,target:this.group.render()}},e.exports=i},{"../core/Entity":5,"../core/EventHandler":7,"../core/Group":8,"../core/OptionsManager":10,"../core/Transform":15,"../core/ViewSequence":17,"../utilities/Utility":95}],109:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this._optionsManager=new S(this.options),this._scroller=new b(this.options),this.sync=new T(["scroll","touch"],{direction:this.options.direction,scale:this.options.syncScale,rails:this.options.rails,preventDefault:void 0!==this.options.preventDefault?this.options.preventDefault:this.options.direction!==O.Direction.Y}),this._physicsEngine=new v,this._particle=new y,this._physicsEngine.addBody(this._particle),this.spring=new g({anchor:[0,0,0],period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}),this.drag=new _({forceFunction:_.FORCE_FUNCTIONS.QUADRATIC,strength:this.options.drag}),this.friction=new _({forceFunction:_.FORCE_FUNCTIONS.LINEAR,strength:this.options.friction}),this._node=null,this._touchCount=0,this._springState=I.NONE,this._onEdge=C.NONE,this._pageSpringPosition=0,this._edgeSpringPosition=0,this._touchVelocity=0,this._earlyEnd=!1,this._needsPaginationCheck=!1,this._displacement=0,this._totalShift=0,this._cachedIndex=0,this._scroller.positionFrom(this.getPosition.bind(this)),this._eventInput=new m,this._eventOutput=new m,this._eventInput.pipe(this.sync),this.sync.pipe(this._eventInput),m.setInputHandler(this,this._eventInput),m.setOutputHandler(this,this._eventOutput),s.call(this),t&&this.setOptions(t)}function n(t){this._touchCount=t.count,void 0===t.count&&(this._touchCount=1),c.call(this),this.setVelocity(0),this._touchVelocity=0,this._earlyEnd=!1}function o(t){var e=-t.velocity,i=-t.delta;if(this._onEdge!==C.NONE&&t.slip&&(0>e&&this._onEdge===C.TOP||e>0&&this._onEdge===C.BOTTOM?this._earlyEnd||(r.call(this,t),this._earlyEnd=!0):this._earlyEnd&&Math.abs(e)>Math.abs(this.getVelocity())&&n.call(this,t)),!this._earlyEnd){if(this._touchVelocity=e,t.slip){var o=this.options.speedLimit;-o>e?e=-o:e>o&&(e=o),this.setVelocity(e);var s=16*o;i>s?i=s:-s>i&&(i=-s)}this.setPosition(this.getPosition()+i),this._displacement+=i,this._springState===I.NONE&&f.call(this)}}function r(t){if(this._touchCount=t.count||0,!this._touchCount){c.call(this),this._onEdge!==C.NONE&&p.call(this,this._edgeSpringPosition,I.EDGE),a.call(this);var e=-t.velocity,i=this.options.speedLimit;t.slip&&(i*=this.options.edgeGrip),-i>e?e=-i:e>i&&(e=i),this.setVelocity(e),this._touchVelocity=0,this._needsPaginationCheck=!0}}function s(){this._eventInput.bindThis(this),this._eventInput.on("start",n),this._eventInput.on("update",o),this._eventInput.on("end",r),this._eventInput.on("resize",function(){this._node._.calculateSize()}.bind(this)),this._scroller.on("onEdge",function(t){this._edgeSpringPosition=t.position,l.call(this,this._scroller.onEdge()),this._eventOutput.emit("onEdge")}.bind(this)),this._scroller.on("offEdge",function(){this.sync.setOptions({scale:this.options.syncScale}),this._onEdge=this._scroller.onEdge(),this._eventOutput.emit("offEdge")}.bind(this)),this._particle.on("update",function(t){this._springState===I.NONE&&f.call(this),this._displacement=t.position.x-this._totalShift}.bind(this)),this._particle.on("end",function(){(!this.options.paginated||this.options.paginated&&this._springState!==I.NONE)&&this._eventOutput.emit("settle")}.bind(this))}function a(){this._springState?this._physicsEngine.attach([this.spring],this._particle):this._physicsEngine.attach([this.drag,this.friction],this._particle)}function c(){this._springState=I.NONE,this._physicsEngine.detachAll()}function u(t){var e=this.options.direction,i=t.getSize();return i?i[e]:this._scroller.getSize()[e]}function l(t){this.sync.setOptions({scale:this.options.edgeGrip}),this._onEdge=t,this._touchCount||this._springState===I.EDGE||p.call(this,this._edgeSpringPosition,I.EDGE),this._springState&&Math.abs(this.getVelocity())<.001&&(c.call(this),a.call(this))}function h(){if(!this._touchCount&&this._springState!==I.EDGE){var t=this.getVelocity();if(!(Math.abs(t)>=this.options.pageStopSpeed)){var e=this.getPosition(),i=Math.abs(t)>this.options.pageSwitchSpeed,n=u.call(this,this._node),o=e>.5*n,r=t>0,s=0>t;this._needsPaginationCheck=!1,o&&!i||i&&r?this.goToNextPage():i&&s?this.goToPreviousPage():p.call(this,0,I.PAGE)}}}function p(t,e){var i;e===I.EDGE?(this._edgeSpringPosition=t,i={anchor:[this._edgeSpringPosition,0,0],period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}):e===I.PAGE&&(this._pageSpringPosition=t,i={anchor:[this._pageSpringPosition,0,0],period:this.options.pagePeriod,dampingRatio:this.options.pageDamp}),this.spring.setOptions(i),e&&!this._springState&&(c.call(this),this._springState=e,a.call(this)),this._springState=e}function f(){var t=0,e=this.getPosition();e+=(0>e?-.5:.5)>>0;for(var i=u.call(this,this._node),n=this._node.getNext();t+e>=i&&n;)t-=i,this._scroller.sequenceFrom(n),this._node=n,n=this._node.getNext(),i=u.call(this,this._node);for(var o,r=this._node.getPrevious();0>=t+e&&r;)o=u.call(this,r),this._scroller.sequenceFrom(r),this._node=r,t+=o,r=this._node.getPrevious();t&&d.call(this,t),this._node&&(this._node.index!==this._cachedIndex?this.getPosition()<.5*i&&(this._cachedIndex=this._node.index,this._eventOutput.emit("pageChange",{direction:-1,index:this._cachedIndex})):this.getPosition()>.5*i&&(this._cachedIndex=this._node.index+1,this._eventOutput.emit("pageChange",{direction:1,index:this._cachedIndex})))}function d(t){this._edgeSpringPosition+=t,this._pageSpringPosition+=t,this.setPosition(this.getPosition()+t),this._totalShift+=t,this._springState===I.EDGE?this.spring.setOptions({anchor:[this._edgeSpringPosition,0,0]}):this._springState===I.PAGE&&this.spring.setOptions({anchor:[this._pageSpringPosition,0,0]})}var v=t("../physics/PhysicsEngine"),y=t("../physics/bodies/Particle"),_=t("../physics/forces/Drag"),g=t("../physics/forces/Spring"),m=t("../core/EventHandler"),S=t("../core/OptionsManager"),w=t("../core/ViewSequence"),b=t("../views/Scroller"),O=t("../utilities/Utility"),T=t("../inputs/GenericSync"),E=t("../inputs/ScrollSync"),x=t("../inputs/TouchSync");T.register({scroll:E,touch:x});var I={NONE:0,EDGE:1,PAGE:2},C={TOP:-1,NONE:0,BOTTOM:1};i.DEFAULT_OPTIONS={direction:O.Direction.Y,rails:!0,friction:.005,drag:1e-4,edgeGrip:.2,edgePeriod:300,edgeDamp:1,margin:1e3,paginated:!1,pagePeriod:500,pageDamp:.8,pageStopSpeed:10,pageSwitchSpeed:.5,speedLimit:5,groupScroll:!1,syncScale:1},i.prototype.getCurrentIndex=function(){return this._node.index},i.prototype.goToPreviousPage=function(){if(!this._node||this._onEdge===C.TOP)return null;if(this.getPosition()>1&&this._springState===I.NONE)return p.call(this,0,I.PAGE),this._node;var t=this._node.getPrevious();if(t){var e=u.call(this,t);this._scroller.sequenceFrom(t),this._node=t,d.call(this,e),p.call(this,0,I.PAGE)}return t},i.prototype.goToNextPage=function(){if(!this._node||this._onEdge===C.BOTTOM)return null;var t=this._node.getNext();if(t){var e=u.call(this,this._node);this._scroller.sequenceFrom(t),this._node=t,d.call(this,-e),p.call(this,0,I.PAGE)}return t},i.prototype.goToPage=function(t){var e,i=this.getCurrentIndex();if(i>t)for(e=0;i-t>e;e++)this.goToPreviousPage();if(t>i)for(e=0;t-i>e;e++)this.goToNextPage()},i.prototype.outputFrom=function(){return this._scroller.outputFrom.apply(this._scroller,arguments)},i.prototype.getPosition=function(){return this._particle.getPosition1D()},i.prototype.getAbsolutePosition=function(){return this._scroller.getCumulativeSize(this.getCurrentIndex())[this.options.direction]+this.getPosition()},i.prototype.getOffset=i.prototype.getPosition,i.prototype.setPosition=function(t){this._particle.setPosition1D(t)},i.prototype.setOffset=i.prototype.setPosition,i.prototype.getVelocity=function(){return this._touchCount?this._touchVelocity:this._particle.getVelocity1D()},i.prototype.setVelocity=function(t){this._particle.setVelocity1D(t)},i.prototype.setOptions=function(t){void 0!==t.direction&&("x"===t.direction?t.direction=O.Direction.X:"y"===t.direction&&(t.direction=O.Direction.Y)),t.groupScroll!==this.options.groupScroll&&(t.groupScroll?this.subscribe(this._scroller):this.unsubscribe(this._scroller)),this._optionsManager.setOptions(t),this._scroller.setOptions(t),void 0!==t.drag&&this.drag.setOptions({strength:this.options.drag}),void 0!==t.friction&&this.friction.setOptions({strength:this.options.friction}),(void 0!==t.edgePeriod||void 0!==t.edgeDamp)&&this.spring.setOptions({period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}),(t.rails||void 0!==t.direction||void 0!==t.syncScale||t.preventDefault)&&this.sync.setOptions({rails:this.options.rails,direction:this.options.direction===O.Direction.X?T.DIRECTION_X:T.DIRECTION_Y,scale:this.options.syncScale,preventDefault:this.options.preventDefault})},i.prototype.sequenceFrom=function(t){return t instanceof Array&&(t=new w({array:t,trackSize:!0})),this._node=t,this._scroller.sequenceFrom(t)},i.prototype.getSize=function(){return this._scroller.getSize.apply(this._scroller,arguments)},i.prototype.render=function(){return this.options.paginated&&this._needsPaginationCheck&&h.call(this),this._scroller.render()},e.exports=i},{"../core/EventHandler":7,"../core/OptionsManager":10,"../core/ViewSequence":17,"../inputs/GenericSync":27,"../inputs/ScrollSync":32,"../inputs/TouchSync":33,"../physics/PhysicsEngine":48,"../physics/bodies/Particle":51,"../physics/forces/Drag":63,"../physics/forces/Spring":68,"../utilities/Utility":95,"../views/Scroller":108}],110:[function(t,e){function i(t){this._items=null,this._size=null,this._outputFunction=i.DEFAULT_OUTPUT_FUNCTION,this.options=a.clone(this.constructor.DEFAULT_OPTIONS||i.DEFAULT_OPTIONS),this.optionsManager=new n(this.options),this.id=o.register(this),this.cachedSize=[void 0,void 0],t&&this.setOptions(t)}var n=t("../core/OptionsManager"),o=t("../core/Entity"),r=t("../core/Transform"),s=t("../core/ViewSequence"),a=t("../utilities/Utility");i.DEFAULT_OPTIONS={direction:a.Direction.Y,itemSpacing:0},i.DEFAULT_OUTPUT_FUNCTION=function(t,e){var i=this.options.direction===a.Direction.X?r.translate(e,0):r.translate(0,e);return{size:this.cachedSize,transform:i,target:t.render()}},i.prototype.getSize=function(){return this._size||this.render(),this._size},i.prototype.sequenceFrom=function(t){return t instanceof Array&&(t=new s(t)),this._items=t,this},i.prototype.setOptions=function(){return this.optionsManager.setOptions.apply(this.optionsManager,arguments),this},i.prototype.setOutputFunction=function(t){return this._outputFunction=t,this},i.prototype.render=function(){return this.id},i.prototype.commit=function(t){var e=0,i=1^this.options.direction,n=this._items,o=null,r=[],s={},a=[],c=0;for(this._size=[0,0],this.cachedSize=t.size;n&&(o=n.get());)o.getSize&&(r=o.getSize()),s=this._outputFunction.call(this,o,e,c++),a.push(s),r&&(r[this.options.direction]&&(e+=r[this.options.direction]),r[i]>this._size[i]&&(this._size[i]=r[i]),0===r[i]&&(this._size[i]=void 0)),n=n.getNext(),this.options.itemSpacing&&n&&(e+=this.options.itemSpacing);return this._size[this.options.direction]=e,{transform:t.transform,origin:t.origin,opacity:t.opacity,size:this.getSize(),target:a}},e.exports=i},{"../core/Entity":5,"../core/OptionsManager":10,"../core/Transform":15,"../core/ViewSequence":17,"../utilities/Utility":95}],111:[function(t,e){function i(){n.apply(this,arguments),this._id=o.register(this),this._parentSize=[]}var n=t("../core/View"),o=t("../core/Entity"),r=t("../core/Transform");i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.commit=function(t){var e=t.transform,i=t.opacity,n=t.origin;return this._parentSize&&this._parentSize[0]===t.size[0]&&this._parentSize[1]===t.size[1]||(this._parentSize[0]=t.size[0],this._parentSize[1]=t.size[1],this._eventInput.emit("parentResize",this._parentSize),this.onResize&&this.onResize(this._parentSize)),this._parentSize&&(e=r.moveThen([-this._parentSize[0]*n[0],-this._parentSize[1]*n[1],0],e)),{transform:e,opacity:i,size:this._parentSize,target:this._node.render()}},i.prototype.getParentSize=function(){return this._parentSize},i.prototype.render=function(){return this._id},e.exports=i},{"../core/Entity":5,"../core/Transform":15,"../core/View":16}],112:[function(t,e){e.exports={ContextualView:t("./ContextualView"),Deck:t("./Deck"),DrawerLayout:t("./DrawerLayout"),EdgeSwapper:t("./EdgeSwapper"),FlexibleLayout:t("./FlexibleLayout"),Flipper:t("./Flipper"),GridLayout:t("./GridLayout"),HeaderFooterLayout:t("./HeaderFooterLayout"),Lightbox:t("./Lightbox"),RenderController:t("./RenderController"),ScrollContainer:t("./ScrollContainer"),Scroller:t("./Scroller"),Scrollview:t("./Scrollview"),SequentialLayout:t("./SequentialLayout"),SizeAwareView:t("./SizeAwareView")}},{"./ContextualView":97,"./Deck":98,"./DrawerLayout":99,"./EdgeSwapper":100,"./FlexibleLayout":101,"./Flipper":102,"./GridLayout":103,"./HeaderFooterLayout":104,"./Lightbox":105,"./RenderController":106,"./ScrollContainer":107,"./Scroller":108,"./Scrollview":109,"./SequentialLayout":110,"./SizeAwareView":111}],113:[function(t,e){function i(){s.apply(this,arguments),this.title=new o({classes:this.options.classes,content:this.options.content}),this.back=new o({size:[this.options.size[1],this.options.size[1]],classes:this.options.classes,content:this.options.backContent}),this.back.on("click",function(){this._eventOutput.emit("back",{})}.bind(this)),this.more=new o({size:[this.options.size[1],this.options.size[1]],classes:this.options.classes,content:this.options.moreContent}),this.more.on("click",function(){this._eventOutput.emit("more",{})}.bind(this)),this.layout=new n({id:"master",size:this.options.size,target:[{transform:r.inFront,origin:[0,.5],align:[0,.5],target:this.back},{origin:[.5,.5],align:[.5,.5],target:this.title},{transform:r.inFront,origin:[1,.5],align:[1,.5],target:this.more}]}),this._add(this.layout),this._optionsManager.on("change",function(t){var e=t.id,i=t.value;"size"===e?(this.layout.id.master.setSize(i),this.title.setSize(i),this.back.setSize([i[1],i[1]]),this.more.setSize([i[1],i[1]])):"backClasses"===e?this.back.setOptions({classes:this.options.classes.concat(this.options.backClasses)}):"backContent"===e?this.back.setContent(this.options.backContent):"classes"===e?(this.title.setOptions({classes:this.options.classes}),this.back.setOptions({classes:this.options.classes.concat(this.options.backClasses)}),this.more.setOptions({classes:this.options.classes.concat(this.options.moreClasses)})):"content"===e?this.setContent(this.options.content):"moreClasses"===e?this.more.setOptions({classes:this.options.classes.concat(this.options.moreClasses)}):"moreContent"===e&&this.more.setContent(this.options.content)}.bind(this))}var n=t("../core/Scene"),o=t("../core/Surface"),r=t("../core/Transform"),s=t("../core/View");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={size:[void 0,50],backClasses:["back"],backContent:"",classes:["navigation"],content:"",moreClasses:["more"],moreContent:""},i.prototype.setContent=function(t){return this.title.setContent(t)},e.exports=i},{"../core/Scene":12,"../core/Surface":14,"../core/Transform":15,"../core/View":16}],114:[function(t,e){function i(t){this.options=Object.create(i.DEFAULT_OPTIONS),this.optionsManager=new u(this.options),t&&this.setOptions(t),this.indicator=new r({size:this.options.indicatorSize,classes:["slider-back"]}),this.label=new o({size:this.options.labelSize,content:this.options.label,properties:{pointerEvents:"none"},classes:["slider-label"]}),this.eventOutput=new a,this.eventInput=new a,a.setInputHandler(this,this.eventInput),a.setOutputHandler(this,this.eventOutput);var e=(this.options.range[1]-this.options.range[0])/this.options.indicatorSize[0];this.sync=new p(["mouse","touch"],{scale:e,direction:p.DIRECTION_X}),this.indicator.pipe(this.sync),this.sync.pipe(this),this.eventInput.on("update",function(t){this.set(t.position)}.bind(this)),this._drawPos=0,n.call(this)}function n(){this.label.setContent(this.options.label+'<span style="float: right">'+this.get().toFixed(this.options.precision)+"</span>")}var o=t("../core/Surface"),r=t("../surfaces/CanvasSurface"),s=t("../core/Transform"),a=t("../core/EventHandler"),c=t("../math/Utilities"),u=t("../core/OptionsManager"),l=t("../inputs/MouseSync"),h=t("../inputs/TouchSync"),p=t("../inputs/GenericSync");p.register({mouse:l,touch:h}),i.DEFAULT_OPTIONS={size:[200,60],indicatorSize:[200,30],labelSize:[200,30],range:[0,1],precision:2,value:0,label:"",fillColor:"rgba(170, 170, 170, 1)"},i.prototype.setOptions=function(t){return this.optionsManager.setOptions(t)},i.prototype.get=function(){return this.options.value},i.prototype.set=function(t){t!==this.options.value&&(this.options.value=c.clamp(t,this.options.range),n.call(this),this.eventOutput.emit("change",{value:t}))},i.prototype.getSize=function(){return this.options.size},i.prototype.render=function(){var t=this.options.range,e=Math.floor((this.get()-t[0])/(t[1]-t[0])*this.options.indicatorSize[0]);if(e<this._drawPos)this.indicator.getContext("2d").clearRect(e,0,this._drawPos-e+1,this.options.indicatorSize[1]);else if(e>this._drawPos){var i=this.indicator.getContext("2d");i.fillStyle=this.options.fillColor,i.fillRect(this._drawPos-1,0,e-this._drawPos+1,this.options.indicatorSize[1])}return this._drawPos=e,{size:this.options.size,target:[{origin:[0,0],target:this.indicator.render()},{transform:s.translate(0,0,1),origin:[0,0],target:this.label.render()}]}},e.exports=i},{"../core/EventHandler":7,"../core/OptionsManager":10,"../core/Surface":14,"../core/Transform":15,"../inputs/GenericSync":27,"../inputs/MouseSync":28,"../inputs/TouchSync":33,"../math/Utilities":40,"../surfaces/CanvasSurface":74}],115:[function(t,e){function i(){s.apply(this,arguments),this.layout=new a,this.buttons=[],this._buttonIds={},this._buttonCallbacks={},this.layout.sequenceFrom(this.buttons),this._add(this.layout),this._optionsManager.on("change",n.bind(this))}function n(t){var e=t.id,i=t.value;if("direction"===e)this.layout.setOptions({dimensions:o.call(this.buttons.length,this.options.direction)});else if("buttons"===e)for(var n in this.buttons)this.buttons[n].setOptions(i);else if("sections"===e)for(var r in this.options.sections)this.defineSection(r,this.options.sections[r])}function o(t,e){return e===r.Direction.X?[t,1]:[1,t]}var r=t("../utilities/Utility"),s=t("../core/View"),a=t("../views/GridLayout"),c=t("./ToggleButton");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,i.DEFAULT_OPTIONS={sections:[],widget:c,size:[void 0,50],direction:r.Direction.X,buttons:{toggleMode:c.ON}},i.prototype.defineSection=function(t,e){var i,n=this._buttonIds[t];if(void 0===n){n=this.buttons.length,this._buttonIds[t]=n;var r=this.options.widget;i=new r,this.buttons[n]=i,this.layout.setOptions({dimensions:o(this.buttons.length,this.options.direction)})}else i=this.buttons[n],i.unbind("select",this._buttonCallbacks[t]);this.options.buttons&&i.setOptions(this.options.buttons),i.setOptions(e),this._buttonCallbacks[t]=this.select.bind(this,t),i.on("select",this._buttonCallbacks[t])},i.prototype.select=function(t){var e=this._buttonIds[t];this.buttons[e]&&this.buttons[e].isSelected()?this._eventOutput.emit("select",{id:t}):this.buttons[e]&&this.buttons[e].select();for(var i=0;i<this.buttons.length;i++)i!==e&&this.buttons[i].deselect()},e.exports=i},{"../core/View":16,"../utilities/Utility":95,"../views/GridLayout":103,"./ToggleButton":116}],116:[function(t,e){function i(t){this.options={content:["",""],offClasses:["off"],onClasses:["on"],size:void 0,outTransition:{curve:"easeInOut",duration:300},inTransition:{curve:"easeInOut",duration:300},toggleMode:i.TOGGLE,crossfade:!0},this._eventOutput=new o,o.setOutputHandler(this,this._eventOutput),this.offSurface=new n,this.offSurface.on("click",function(){this.options.toggleMode!==i.OFF&&this.select()}.bind(this)),this.offSurface.pipe(this._eventOutput),this.onSurface=new n,this.onSurface.on("click",function(){this.options.toggleMode!==i.ON&&this.deselect()}.bind(this)),this.onSurface.pipe(this._eventOutput),this.arbiter=new r({overlap:this.options.crossfade}),this.deselect(),t&&this.setOptions(t)}var n=t("../core/Surface"),o=t("../core/EventHandler"),r=t("../views/RenderController");i.OFF=0,i.ON=1,i.TOGGLE=2,i.prototype.select=function(t){this.selected=!0,this.arbiter.show(this.onSurface,this.options.inTransition),t||this._eventOutput.emit("select")},i.prototype.deselect=function(t){this.selected=!1,this.arbiter.show(this.offSurface,this.options.outTransition),
t||this._eventOutput.emit("deselect")},i.prototype.isSelected=function(){return this.selected},i.prototype.setOptions=function(t){void 0!==t.content&&(t.content instanceof Array||(t.content=[t.content,t.content]),this.options.content=t.content,this.offSurface.setContent(this.options.content[0]),this.onSurface.setContent(this.options.content[1])),t.offClasses&&(this.options.offClasses=t.offClasses,this.offSurface.setClasses(this.options.offClasses)),t.onClasses&&(this.options.onClasses=t.onClasses,this.onSurface.setClasses(this.options.onClasses)),void 0!==t.size&&(this.options.size=t.size,this.onSurface.setSize(this.options.size),this.offSurface.setSize(this.options.size)),void 0!==t.toggleMode&&(this.options.toggleMode=t.toggleMode),void 0!==t.outTransition&&(this.options.outTransition=t.outTransition),void 0!==t.inTransition&&(this.options.inTransition=t.inTransition),void 0!==t.crossfade&&(this.options.crossfade=t.crossfade,this.arbiter.setOptions({overlap:this.options.crossfade}))},i.prototype.getSize=function(){return this.options.size},i.prototype.render=function(){return this.arbiter.render()},e.exports=i},{"../core/EventHandler":7,"../core/Surface":14,"../views/RenderController":106}],117:[function(t,e){e.exports={NavigationBar:t("./NavigationBar"),Slider:t("./Slider"),TabBar:t("./TabBar"),ToggleButton:t("./ToggleButton")}},{"./NavigationBar":113,"./Slider":114,"./TabBar":115,"./ToggleButton":116}]},{},[23])(23)}),function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){var i=e[s][1][t];return o(i?i:t)},l,l.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){"undefined"==typeof famousflex&&(famousflex={}),famousflex.FlexScrollView=t("../src/FlexScrollView"),famousflex.FlowLayoutNode=t("../src/FlowLayoutNode"),famousflex.LayoutContext=t("../src/LayoutContext"),famousflex.LayoutController=t("../src/LayoutController"),famousflex.LayoutNode=t("../src/LayoutNode"),famousflex.LayoutNodeManager=t("../src/LayoutNodeManager"),famousflex.LayoutUtility=t("../src/LayoutUtility"),famousflex.ScrollController=t("../src/ScrollController"),famousflex.VirtualViewSequence=t("../src/VirtualViewSequence"),famousflex.widgets=famousflex.widgets||{},famousflex.widgets.DatePicker=t("../src/widgets/DatePicker"),famousflex.widgets.TabBar=t("../src/widgets/TabBar"),famousflex.layouts=famousflex.layouts||{},famousflex.layouts.CollectionLayout=t("../src/layouts/CollectionLayout"),famousflex.layouts.CoverLayout=t("../src/layouts/CoverLayout"),famousflex.layouts.CubeLayout=t("../src/layouts/CubeLayout"),famousflex.layouts.GridLayout=t("../src/layouts/GridLayout"),famousflex.layouts.HeaderFooterLayout=t("../src/layouts/HeaderFooterLayout"),famousflex.layouts.ListLayout=t("../src/layouts/ListLayout"),famousflex.layouts.NavBarLayout=t("../src/layouts/NavBarLayout"),famousflex.layouts.ProportionalLayout=t("../src/layouts/ProportionalLayout"),famousflex.layouts.WheelLayout=t("../src/layouts/WheelLayout"),famousflex.helpers=famousflex.helpers||{},famousflex.helpers.LayoutDockHelper=t("../src/helpers/LayoutDockHelper")},{"../src/FlexScrollView":2,"../src/FlowLayoutNode":3,"../src/LayoutContext":4,"../src/LayoutController":5,"../src/LayoutNode":6,"../src/LayoutNodeManager":7,"../src/LayoutUtility":8,"../src/ScrollController":9,"../src/VirtualViewSequence":10,"../src/helpers/LayoutDockHelper":11,"../src/layouts/CollectionLayout":12,"../src/layouts/CoverLayout":13,"../src/layouts/CubeLayout":14,"../src/layouts/GridLayout":15,"../src/layouts/HeaderFooterLayout":16,"../src/layouts/ListLayout":17,"../src/layouts/NavBarLayout":18,"../src/layouts/ProportionalLayout":19,"../src/layouts/WheelLayout":21,"../src/widgets/DatePicker":22,"../src/widgets/TabBar":24}],2:[function(t,e,i){function n(t){a.call(this,s.combineOptions(n.DEFAULT_OPTIONS,t)),this._thisScrollViewDelta=0,this._leadingScrollViewDelta=0,this._trailingScrollViewDelta=0}function o(t,e){t.state!==e&&(t.state=e,t.node&&t.node.setPullToRefreshStatus&&t.node.setPullToRefreshStatus(e))}function r(t){return this._pullToRefresh?this._pullToRefresh[t?1:0]:void 0}var s=t("./LayoutUtility"),a=t("./ScrollController"),c=t("./layouts/ListLayout"),u={HIDDEN:0,PULLING:1,ACTIVE:2,COMPLETED:3,HIDDING:4};n.prototype=Object.create(a.prototype),n.prototype.constructor=n,n.PullToRefreshState=u,n.DEFAULT_OPTIONS={layout:c,direction:void 0,paginated:!1,alignment:0,flow:!1,mouseMove:!1,useContainer:!1,visibleItemThresshold:.5,pullToRefreshHeader:void 0,pullToRefreshFooter:void 0,leadingScrollView:void 0,trailingScrollView:void 0},n.prototype.setOptions=function(t){return a.prototype.setOptions.call(this,t),(t.pullToRefreshHeader||t.pullToRefreshFooter||this._pullToRefresh)&&(t.pullToRefreshHeader?(this._pullToRefresh=this._pullToRefresh||[void 0,void 0],this._pullToRefresh[0]||(this._pullToRefresh[0]={state:u.HIDDEN,prevState:u.HIDDEN,footer:!1}),this._pullToRefresh[0].node=t.pullToRefreshHeader):!this.options.pullToRefreshHeader&&this._pullToRefresh&&(this._pullToRefresh[0]=void 0),t.pullToRefreshFooter?(this._pullToRefresh=this._pullToRefresh||[void 0,void 0],this._pullToRefresh[1]||(this._pullToRefresh[1]={state:u.HIDDEN,prevState:u.HIDDEN,footer:!0}),this._pullToRefresh[1].node=t.pullToRefreshFooter):!this.options.pullToRefreshFooter&&this._pullToRefresh&&(this._pullToRefresh[1]=void 0),!this._pullToRefresh||this._pullToRefresh[0]||this._pullToRefresh[1]||(this._pullToRefresh=void 0)),this},n.prototype.sequenceFrom=function(t){return this.setDataSource(t)},n.prototype.getCurrentIndex=function(){var t=this.getFirstVisibleItem();return t?t.viewSequence.getIndex():-1},n.prototype.goToPage=function(t){var e=this._viewSequence;if(!e)return this;for(;e.getIndex()<t;)if(e=e.getNext(),!e)return this;for(;e.getIndex()>t;)if(e=e.getPrevious(),!e)return this;return this.goToRenderNode(e.get()),this},n.prototype.getOffset=function(){return this._scrollOffsetCache},n.prototype.getPosition=n.prototype.getOffset,n.prototype._postLayout=function(t,e){if(this._pullToRefresh){this.options.alignment&&(e+=t[this._direction]);for(var i,n,r,s=0;2>s;s++){var a=this._pullToRefresh[s];if(a){var c,l=a.node.getSize()[this._direction],h=a.node.getPullToRefreshSize?a.node.getPullToRefreshSize()[this._direction]:l;a.footer?(n=void 0===n?n=this._calcScrollHeight(!0):n,n=void 0===n?-1:n,c=n>=0?e+n:t[this._direction]+1,this.options.alignment||(i=void 0===i?this._calcScrollHeight(!1):i,i=void 0===i?-1:i,r=i>=0&&n>=0?i+n:-1,r>=0&&r<t[this._direction]&&(c=Math.round(e-i+t[this._direction]))),c=-(c-t[this._direction])):(i=this._calcScrollHeight(!1),i=void 0===i?-1:i,c=i>=0?e-i:i,this.options.alignment&&(n=this._calcScrollHeight(!0),n=void 0===n?-1:n,r=i>=0&&n>=0?i+n:-1,r>=0&&r<t[this._direction]&&(c=Math.round(e-t[this._direction]+n))));var p=Math.max(Math.min(c/h,1),0);switch(a.state){case u.HIDDEN:this._scroll.scrollForceCount&&(p>=1?o(a,u.ACTIVE):c>=.2&&o(a,u.PULLING));break;case u.PULLING:this._scroll.scrollForceCount&&p>=1?o(a,u.ACTIVE):.2>c&&o(a,u.HIDDEN);break;case u.ACTIVE:break;case u.COMPLETED:this._scroll.scrollForceCount||(c>=.2?o(a,u.HIDDING):o(a,u.HIDDEN));break;case u.HIDDING:.2>c&&o(a,u.HIDDEN)}if(a.state!==u.HIDDEN){var f,d={renderNode:a.node,prev:!a.footer,next:a.footer,index:a.footer?++this._nodes._contextState.nextGetIndex:--this._nodes._contextState.prevGetIndex};a.state===u.ACTIVE?f=l:this._scroll.scrollForceCount&&(f=Math.min(c,l));var v={size:[t[0],t[1]],translate:[0,0,-.001],scrollLength:f};v.size[this._direction]=Math.max(Math.min(c,h),0),v.translate[this._direction]=a.footer?t[this._direction]-l:0,this._nodes._context.set(d,v)}}}}},n.prototype.showPullToRefresh=function(t){var e=r.call(this,t);e&&(o(e,u.ACTIVE),this._scroll.scrollDirty=!0)},n.prototype.hidePullToRefresh=function(t){var e=r.call(this,t);return e&&e.state===u.ACTIVE&&(o(e,u.COMPLETED),this._scroll.scrollDirty=!0),this},n.prototype.isPullToRefreshVisible=function(t){var e=r.call(this,t);return e?e.state===u.ACTIVE:!1},n.prototype.applyScrollForce=function(t){var e=this.options.leadingScrollView,i=this.options.trailingScrollView;if(!e&&!i)return a.prototype.applyScrollForce.call(this,t);var n;return 0>t?(e&&(n=e.canScroll(t),this._leadingScrollViewDelta+=n,e.applyScrollForce(n),t-=n),i?(n=this.canScroll(t),a.prototype.applyScrollForce.call(this,n),this._thisScrollViewDelta+=n,t-=n,i.applyScrollForce(t),this._trailingScrollViewDelta+=t):(a.prototype.applyScrollForce.call(this,t),this._thisScrollViewDelta+=t)):(i&&(n=i.canScroll(t),i.applyScrollForce(n),this._trailingScrollViewDelta+=n,t-=n),e?(n=this.canScroll(t),a.prototype.applyScrollForce.call(this,n),this._thisScrollViewDelta+=n,t-=n,e.applyScrollForce(t),this._leadingScrollViewDelta+=t):(a.prototype.applyScrollForce.call(this,t),this._thisScrollViewDelta+=t)),this},n.prototype.updateScrollForce=function(t,e){var i=this.options.leadingScrollView,n=this.options.trailingScrollView;if(!i&&!n)return a.prototype.updateScrollForce.call(this,t,e);var o,r=e-t;return 0>r?(i&&(o=i.canScroll(r),i.updateScrollForce(this._leadingScrollViewDelta,this._leadingScrollViewDelta+o),this._leadingScrollViewDelta+=o,r-=o),n&&r?(o=this.canScroll(r),a.prototype.updateScrollForce.call(this,this._thisScrollViewDelta,this._thisScrollViewDelta+o),this._thisScrollViewDelta+=o,r-=o,this._trailingScrollViewDelta+=r,n.updateScrollForce(this._trailingScrollViewDelta,this._trailingScrollViewDelta+r)):r&&(a.prototype.updateScrollForce.call(this,this._thisScrollViewDelta,this._thisScrollViewDelta+r),this._thisScrollViewDelta+=r)):(n&&(o=n.canScroll(r),n.updateScrollForce(this._trailingScrollViewDelta,this._trailingScrollViewDelta+o),this._trailingScrollViewDelta+=o,r-=o),i?(o=this.canScroll(r),a.prototype.updateScrollForce.call(this,this._thisScrollViewDelta,this._thisScrollViewDelta+o),this._thisScrollViewDelta+=o,r-=o,i.updateScrollForce(this._leadingScrollViewDelta,this._leadingScrollViewDelta+r),this._leadingScrollViewDelta+=r):(a.prototype.updateScrollForce.call(this,this._thisScrollViewDelta,this._thisScrollViewDelta+r),this._thisScrollViewDelta+=r)),this},n.prototype.releaseScrollForce=function(t,e){var i=this.options.leadingScrollView,n=this.options.trailingScrollView;if(!i&&!n)return a.prototype.releaseScrollForce.call(this,t,e);var o;return 0>t?(i&&(o=Math.max(this._leadingScrollViewDelta,t),this._leadingScrollViewDelta-=o,t-=o,i.releaseScrollForce(this._leadingScrollViewDelta,t?0:e)),n?(o=Math.max(this._thisScrollViewDelta,t),this._thisScrollViewDelta-=o,t-=o,a.prototype.releaseScrollForce.call(this,this._thisScrollViewDelta,t?0:e),this._trailingScrollViewDelta-=t,n.releaseScrollForce(this._trailingScrollViewDelta,t?e:0)):(this._thisScrollViewDelta-=t,a.prototype.releaseScrollForce.call(this,this._thisScrollViewDelta,t?e:0))):(n&&(o=Math.min(this._trailingScrollViewDelta,t),this._trailingScrollViewDelta-=o,t-=o,n.releaseScrollForce(this._trailingScrollViewDelta,t?0:e)),i?(o=Math.min(this._thisScrollViewDelta,t),this._thisScrollViewDelta-=o,t-=o,a.prototype.releaseScrollForce.call(this,this._thisScrollViewDelta,t?0:e),this._leadingScrollViewDelta-=t,i.releaseScrollForce(this._leadingScrollViewDelta,t?e:0)):(this._thisScrollViewDelta-=t,a.prototype.updateScrollForce.call(this,this._thisScrollViewDelta,t?e:0))),this},n.prototype.commit=function(t){var e=a.prototype.commit.call(this,t);if(this._pullToRefresh)for(var i=0;2>i;i++){var n=this._pullToRefresh[i];n&&(n.state===u.ACTIVE&&n.prevState!==u.ACTIVE&&this._eventOutput.emit("refresh",{target:this,footer:n.footer}),n.prevState=n.state)}return e},e.exports=n},{"./LayoutUtility":8,"./ScrollController":9,"./layouts/ListLayout":17}],3:[function(t,e,i){(function(i){function n(t,e){if(d.apply(this,arguments),this.options||(this.options=Object.create(this.constructor.DEFAULT_OPTIONS),this._optionsManager=new c(this.options)),this._pe||(this._pe=new f,this._pe.sleep()),this._properties)for(var i in this._properties)this._properties[i].init=!1;else this._properties={};this._lockTransitionable?(this._lockTransitionable.halt(),this._lockTransitionable.reset(1)):this._lockTransitionable=new v(1),this._specModified=!0,this._initial=!0,e&&this.setSpec(e)}function o(t,e,i,n){return t&&t.init?[Math.round((t.curState.x+(t.endState.x-t.curState.x)*n)/i)*i,Math.round((t.curState.y+(t.endState.y-t.curState.y)*n)/i)*i,Math.round((t.curState.z+(t.endState.z-t.curState.z)*n)/i)*i]:e}function r(t,e,i,n,o,r){if(t=t||this._properties[e],t&&t.init){t.invalidated=!0;var s=n;return void 0!==i?s=i:this._removing&&(s=t.particle.getPosition()),t.endState.x=s[0],t.endState.y=s.length>1?s[1]:0,t.endState.z=s.length>2?s[2]:0,void(o?(t.curState.x=t.endState.x,t.curState.y=t.endState.y,t.curState.z=t.endState.z,t.velocity.x=0,t.velocity.y=0,t.velocity.z=0):(t.endState.x!==t.curState.x||t.endState.y!==t.curState.y||t.endState.z!==t.curState.z)&&this._pe.wake())}var a=this._pe.isSleeping();t?(t.particle.setPosition(this._initial||o?i:n),t.endState.set(i)):(t={particle:new h({position:this._initial||o?i:n}),endState:new l(i)},t.curState=t.particle.position,t.velocity=t.particle.velocity,t.force=new p(this.options.spring),t.force.setOptions({anchor:t.endState}),this._pe.addBody(t.particle),t.forceId=this._pe.attach(t.force,t.particle),this._properties[e]=t),this._initial||o?a&&this._pe.sleep():this._pe.wake(),t.init=!0,t.invalidated=!0}function s(t,e){return t[0]===e[0]&&t[1]===e[1]?void 0:t}function a(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]?void 0:t}var c="undefined"!=typeof window?window.famous.core.OptionsManager:"undefined"!=typeof i?i.famous.core.OptionsManager:null,u="undefined"!=typeof window?window.famous.core.Transform:"undefined"!=typeof i?i.famous.core.Transform:null,l="undefined"!=typeof window?window.famous.math.Vector:"undefined"!=typeof i?i.famous.math.Vector:null,h="undefined"!=typeof window?window.famous.physics.bodies.Particle:"undefined"!=typeof i?i.famous.physics.bodies.Particle:null,p="undefined"!=typeof window?window.famous.physics.forces.Spring:"undefined"!=typeof i?i.famous.physics.forces.Spring:null,f="undefined"!=typeof window?window.famous.physics.PhysicsEngine:"undefined"!=typeof i?i.famous.physics.PhysicsEngine:null,d=t("./LayoutNode"),v="undefined"!=typeof window?window.famous.transitions.Transitionable:"undefined"!=typeof i?i.famous.transitions.Transitionable:null;n.prototype=Object.create(d.prototype),n.prototype.constructor=n,n.DEFAULT_OPTIONS={spring:{dampingRatio:.8,period:300},particleRounding:.001};var y={opacity:1,opacity2D:[1,0],size:[0,0],origin:[0,0],align:[0,0],scale:[1,1,1],translate:[0,0,0],rotate:[0,0,0],skew:[0,0,0]};n.prototype.setOptions=function(t){this._optionsManager.setOptions(t);var e=this._pe.isSleeping();for(var i in this._properties){var n=this._properties[i];n.force&&n.force.setOptions(n.force)}return e&&this._pe.sleep(),this},n.prototype.setSpec=function(t){var e;t.transform&&(e=u.interpret(t.transform)),e||(e={}),e.opacity=t.opacity,e.size=t.size,e.align=t.align,e.origin=t.origin;var i=this._removing,n=this._invalidated;this.set(e),this._removing=i,this._invalidated=n},n.prototype.reset=function(){if(this._invalidated){for(var t in this._properties)this._properties[t].invalidated=!1;this._invalidated=!1}this.trueSizeRequested=!1,this.usesTrueSize=!1},n.prototype.remove=function(t){this._removing=!0,t?this.setSpec(t):(this._pe.sleep(),this._specModified=!1),this._invalidated=!1},n.prototype.releaseLock=function(t){this._lockTransitionable.halt(),this._lockTransitionable.reset(0),this._lockTransitionable.set(1,{duration:t||this.options.spring.period||1e3})},n.prototype.getSpec=function(){var t=this._pe.isSleeping();if(!this._specModified&&t)return this._spec.removed=!this._invalidated,this._spec;this._initial=!1,this._specModified=!t,this._spec.removed=!1,t||this._pe.step();var e=this._spec,i=this.options.particleRounding,n=this._lockTransitionable.get(),r=this._properties.opacity;r&&r.init?e.opacity=Math.round(Math.max(0,Math.min(1,r.curState.x))/i)*i:e.opacity=void 0,r=this._properties.size,r&&r.init?(e.size=e.size||[0,0],e.size[0]=.1*Math.round((r.curState.x+(r.endState.x-r.curState.x)*n)/.1),e.size[1]=.1*Math.round((r.curState.y+(r.endState.y-r.curState.y)*n)/.1)):e.size=void 0,r=this._properties.align,r&&r.init?(e.align=e.align||[0,0],e.align[0]=.1*Math.round((r.curState.x+(r.endState.x-r.curState.x)*n)/.1),e.align[1]=.1*Math.round((r.curState.y+(r.endState.y-r.curState.y)*n)/.1)):e.align=void 0,r=this._properties.origin,r&&r.init?(e.origin=e.origin||[0,0],e.origin[0]=.1*Math.round((r.curState.x+(r.endState.x-r.curState.x)*n)/.1),e.origin[1]=.1*Math.round((r.curState.y+(r.endState.y-r.curState.y)*n)/.1)):e.origin=void 0;var s,a,c,l=this._properties.translate;l&&l.init?(s=Math.round((l.curState.x+(l.endState.x-l.curState.x)*n)/i)*i,a=Math.round((l.curState.y+(l.endState.y-l.curState.y)*n)/i)*i,c=Math.round((l.curState.z+(l.endState.z-l.curState.z)*n)/i)*i):(s=0,a=0,c=0);var h=this._properties.scale,p=this._properties.skew,f=this._properties.rotate;return h||p||f?e.transform=u.build({translate:[s,a,c],skew:o.call(this,p,y.skew,this.options.particleRounding,n),scale:o.call(this,h,y.scale,this.options.particleRounding,n),rotate:o.call(this,f,y.rotate,this.options.particleRounding,n)}):l?e.transform?(e.transform[12]=s,e.transform[13]=a,e.transform[14]=c):e.transform=u.translate(s,a,c):e.transform=void 0,this._spec},n.prototype.set=function(t,e){e&&(this._removing=!1),this._invalidated=!0,this.scrollLength=t.scrollLength,this._specModified=!0;var i=this._properties.opacity,n=t.opacity===y.opacity?void 0:t.opacity;(void 0!==n||i&&i.init)&&r.call(this,i,"opacity",void 0===n?void 0:[n,0],y.opacity2D),i=this._properties.align,n=t.align?s(t.align,y.align):void 0,(n||i&&i.init)&&r.call(this,i,"align",n,y.align),i=this._properties.origin,n=t.origin?s(t.origin,y.origin):void 0,(n||i&&i.init)&&r.call(this,i,"origin",n,y.origin),i=this._properties.size,n=t.size||e,(n||i&&i.init)&&r.call(this,i,"size",n,e,this.usesTrueSize),i=this._properties.translate,n=t.translate,(n||i&&i.init)&&r.call(this,i,"translate",n,y.translate,void 0,!0),i=this._properties.scale,n=t.scale?a(t.scale,y.scale):void 0,(n||i&&i.init)&&r.call(this,i,"scale",n,y.scale),i=this._properties.rotate,n=t.rotate?a(t.rotate,y.rotate):void 0,(n||i&&i.init)&&r.call(this,i,"rotate",n,y.rotate),i=this._properties.skew,n=t.skew?a(t.skew,y.skew):void 0,(n||i&&i.init)&&r.call(this,i,"skew",n,y.skew)},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./LayoutNode":6}],4:[function(t,e,i){function n(t){for(var e in t)this[e]=t[e]}n.prototype.size=void 0,n.prototype.direction=void 0,n.prototype.scrollOffset=void 0,n.prototype.scrollStart=void 0,n.prototype.scrollEnd=void 0,n.prototype.next=function(){},n.prototype.prev=function(){},n.prototype.get=function(t){},n.prototype.set=function(t,e){},n.prototype.resolveSize=function(t){},e.exports=n},{}],5:[function(t,e,i){(function(i){function n(t,e){this.id=u.register(this),this._isDirty=!0,this._contextSizeCache=[0,0],this._commitOutput={},this._eventInput=new p,p.setInputHandler(this,this._eventInput),this._eventOutput=new p,p.setOutputHandler(this,this._eventOutput),this._layout={options:Object.create({})},this._layout.optionsManager=new h(this._layout.options),this._layout.optionsManager.on("change",function(){this._isDirty=!0}.bind(this)),this.options=Object.create(n.DEFAULT_OPTIONS),this._optionsManager=new h(this.options),e?this._nodes=e:t&&t.flow?this._nodes=new d(y,o.bind(this)):this._nodes=new d(v),this.setDirection(void 0),t&&this.setOptions(t)}function o(t,e){!e&&this.options.insertSpec&&t.setSpec(this.options.insertSpec)}function r(t){var e=this._dataSource;if(e instanceof Array)for(var i=0,n=e.length;n>i;i++)t(e[i]);else if(e instanceof l)for(var o;e&&(o=e.get());)t(o),e=e.getNext();else for(var r in e)t(e[r])}function s(t){if(this._layout.capabilities&&this._layout.capabilities.direction){if(Array.isArray(this._layout.capabilities.direction)){for(var e=0;e<this._layout.capabilities.direction.length;e++)if(this._layout.capabilities.direction[e]===t)return t;return this._layout.capabilities.direction[0]}return this._layout.capabilities.direction}return void 0===t?c.Direction.Y:t}function a(t){var e=this._viewSequence,i=e?e.getIndex():t;if(t>i)for(;e;){if(e=e.getNext(),!e)return;if(i=e.getIndex(),i===t)return e;if(i>t)return}else if(i>t)for(;e;){if(e=e.getPrevious(),!e)return;if(i=e.getIndex(),i===t)return e;if(t>i)return}return e}var c="undefined"!=typeof window?window.famous.utilities.Utility:"undefined"!=typeof i?i.famous.utilities.Utility:null,u="undefined"!=typeof window?window.famous.core.Entity:"undefined"!=typeof i?i.famous.core.Entity:null,l="undefined"!=typeof window?window.famous.core.ViewSequence:"undefined"!=typeof i?i.famous.core.ViewSequence:null,h="undefined"!=typeof window?window.famous.core.OptionsManager:"undefined"!=typeof i?i.famous.core.OptionsManager:null,p="undefined"!=typeof window?window.famous.core.EventHandler:"undefined"!=typeof i?i.famous.core.EventHandler:null,f=t("./LayoutUtility"),d=t("./LayoutNodeManager"),v=t("./LayoutNode"),y=t("./FlowLayoutNode"),_="undefined"!=typeof window?window.famous.core.Transform:"undefined"!=typeof i?i.famous.core.Transform:null;t("./helpers/LayoutDockHelper"),n.DEFAULT_OPTIONS={nodeSpring:{dampingRatio:.8,period:300},reflowOnResize:!0},n.prototype.setOptions=function(t){return void 0!==t.alignment&&t.alignment!==this.options.alignment&&(this._isDirty=!0),this._optionsManager.setOptions(t),t.dataSource&&this.setDataSource(t.dataSource),t.layout?this.setLayout(t.layout,t.layoutOptions):t.layoutOptions&&this.setLayoutOptions(t.layoutOptions),void 0!==t.direction&&this.setDirection(t.direction),t.nodeSpring&&this.options.flow&&this._nodes.setNodeOptions({spring:t.nodeSpring}),t.preallocateNodes&&this._nodes.preallocateNodes(t.preallocateNodes.count||0,t.preallocateNodes.spec),this},n.prototype.setDataSource=function(t){return this._dataSource=t,this._nodesById=void 0,t instanceof Array?this._viewSequence=new l(t):t instanceof l||t.getNext?this._viewSequence=t:t instanceof Object&&(this._nodesById=t),this.options.autoPipeEvents&&(this._dataSource.pipe?(this._dataSource.pipe(this),this._dataSource.pipe(this._eventOutput)):r.call(this,function(t){t&&t.pipe&&(t.pipe(this),t.pipe(this._eventOutput))}.bind(this))),this._isDirty=!0,this},n.prototype.getDataSource=function(){return this._dataSource},n.prototype.setLayout=function(t,e){if(t instanceof Function)this._layout._function=t,this._layout.capabilities=t.Capabilities,this._layout.literal=void 0;else if(t instanceof Object){this._layout.literal=t,this._layout.capabilities=void 0;var i=Object.keys(t)[0],n=f.getRegisteredHelper(i);this._layout._function=n?function(e,o){var r=new n(e,o);r.parse(t[i])}:void 0}else this._layout._function=void 0,this._layout.capabilities=void 0,this._layout.literal=void 0;return e&&this.setLayoutOptions(e),this.setDirection(this._configuredDirection),this._isDirty=!0,this},n.prototype.getLayout=function(){return this._layout.literal||this._layout._function},n.prototype.setLayoutOptions=function(t){return this._layout.optionsManager.setOptions(t),this},n.prototype.getLayoutOptions=function(){return this._layout.options},n.prototype.setDirection=function(t){this._configuredDirection=t;var e=s.call(this,t);e!==this._direction&&(this._direction=e,this._isDirty=!0)},n.prototype.getDirection=function(t){return t?this._direction:this._configuredDirection},n.prototype.getSpec=function(t,e){if(t){if(t instanceof String||"string"==typeof t){if(!this._nodesById)return;if(t=this._nodesById[t],!t)return;if(t instanceof Array)return t}if(this._specs)for(var i=0;i<this._specs.length;i++){var n=this._specs[i];if(n.renderNode===t){if(e&&n.transform&&n.size&&(n.align||n.origin)){var o=n.transform;return n.align&&(n.align[0]||n.align[1])&&(o=_.thenMove(o,[n.align[0]*this._contextSizeCache[0],n.align[1]*this._contextSizeCache[1],0])),n.origin&&(n.origin[0]||n.origin[1])&&(o=_.moveThen([-n.origin[0]*n.size[0],-n.origin[1]*n.size[1],0],o)),{opacity:n.opacity,size:n.size,transform:o}}return n}}}},n.prototype.reflowLayout=function(){return this._isDirty=!0,this},n.prototype.insert=function(t,e,i){if(t instanceof String||"string"==typeof t){if(void 0===this._dataSource&&(this._dataSource={},this._nodesById=this._dataSource),this._nodesById[t]===e)return;this._nodesById[t]=e}else{void 0===this._dataSource&&(this._dataSource=[],this._viewSequence=new l(this._dataSource));var n=this._viewSequence||this._dataSource;if(-1===t)n.push(e);else if(0===t)if(n===this._viewSequence){if(n.splice(0,0,e),0===this._viewSequence.getIndex()){var o=this._viewSequence.getNext();o&&o.get()&&(this._viewSequence=o)}}else n.splice(0,0,e);else n.splice(t,0,e)}return i&&this._nodes.insertNode(this._nodes.createNode(e,i)),this.options.autoPipeEvents&&e&&e.pipe&&(e.pipe(this),e.pipe(this._eventOutput)),this._isDirty=!0,this},n.prototype.push=function(t,e){return this.insert(-1,t,e)},n.prototype.get=function(t){if(this._nodesById||t instanceof String||"string"==typeof t)return this._nodesById[t];var e=a.call(this,t);return e?e.get():void 0},n.prototype.swap=function(t,e){return this._viewSequence&&(a.call(this,t).swap(a.call(this,e)),this._isDirty=!0),this},n.prototype.remove=function(t,e){var i;if(this._nodesById||t instanceof String||"string"==typeof t?(i=this._nodesById[t],i&&delete this._nodesById[t]):i=this._dataSource.splice(t,1)[0],i&&e){var n=this._nodes.getNodeByRenderNode(i);n&&n.remove(e||this.options.removeSpec)}return i&&(this._isDirty=!0),this},n.prototype.removeAll=function(t){if(this._nodesById){var e=!1;for(var i in this._nodesById)delete this._nodesById[i],e=!0;e&&(this._isDirty=!0)}else this._dataSource&&this.setDataSource([]);if(t)for(var n=this._nodes.getStartEnumNode();n;)n.remove(t||this.options.removeSpec),n=n._next;return this},n.prototype.getSize=function(){return this._size||this.options.size},n.prototype.render=function(){return this.id},n.prototype.commit=function(t){var e=t.transform,i=t.origin,n=t.size,o=t.opacity;if(n[0]!==this._contextSizeCache[0]||n[1]!==this._contextSizeCache[1]||this._isDirty||this._nodes._trueSizeRequested||this.options.alwaysLayout){var r={target:this,oldSize:this._contextSizeCache,size:n,dirty:this._isDirty,trueSizeRequested:this._nodes._trueSizeRequested};if(this._eventOutput.emit("layoutstart",r),this.options.flow&&(this._isDirty||this.options.reflowOnResize&&(n[0]!==this._contextSizeCache[0]||n[1]!==this._contextSizeCache[1])))for(var s=this._nodes.getStartEnumNode();s;)s.releaseLock(),s=s._next;this._contextSizeCache[0]=n[0],this._contextSizeCache[1]=n[1],this._isDirty=!1;var a;this.options.size&&this.options.size[this._direction]===!0&&(a=1e6);var c=this._nodes.prepareForLayout(this._viewSequence,this._nodesById,{size:n,direction:this._direction,scrollEnd:a});if(this._layout._function&&this._layout._function(c,this._layout.options),this._nodes.removeNonInvalidatedNodes(this.options.removeSpec),this._nodes.removeVirtualViewSequenceNodes(),a){for(a=0,s=this._nodes.getStartEnumNode();s;)s._invalidated&&s.scrollLength&&(a+=s.scrollLength),s=s._next;this._size=this._size||[0,0],this._size[0]=this.options.size[0],this._size[1]=this.options.size[1],this._size[this._direction]=a}var u=this._nodes.buildSpecAndDestroyUnrenderedNodes();this._commitOutput.target=u.specs,this._eventOutput.emit("reflow",{target:this}),this._eventOutput.emit("layoutend",r)}else this.options.flow&&(u=this._nodes.buildSpecAndDestroyUnrenderedNodes(),this._commitOutput.target=u.specs,u.modified&&this._eventOutput.emit("reflow",{target:this}));this._specs=this._commitOutput.target;for(var l=this._commitOutput.target,h=0,p=l.length;p>h;h++)l[h].target=l[h].renderNode.render();return!i||0===i[0]&&0===i[1]||(e=_.moveThen([-n[0]*i[0],-n[1]*i[1],0],e)),this._commitOutput.size=n,this._commitOutput.opacity=o,this._commitOutput.transform=e,this._commitOutput},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./FlowLayoutNode":3,"./LayoutNode":6,"./LayoutNodeManager":7,"./LayoutUtility":8,"./helpers/LayoutDockHelper":11}],6:[function(t,e,i){(function(i){function n(t,e){this.renderNode=t,this._spec=e?r.cloneSpec(e):{},this._spec.renderNode=t,this._specModified=!0,this._invalidated=!1,this._removing=!1}var o="undefined"!=typeof window?window.famous.core.Transform:"undefined"!=typeof i?i.famous.core.Transform:null,r=t("./LayoutUtility");n.prototype.setOptions=function(t){},n.prototype.destroy=function(){this.renderNode=void 0,this._spec.renderNode=void 0,this._viewSequence=void 0},n.prototype.reset=function(){this._invalidated=!1,this.trueSizeRequested=!1},n.prototype.setSpec=function(t){if(this._specModified=!0,t.align?(t.align||(this._spec.align=[0,0]),this._spec.align[0]=t.align[0],this._spec.align[1]=t.align[1]):this._spec.align=void 0,t.origin?(t.origin||(this._spec.origin=[0,0]),this._spec.origin[0]=t.origin[0],this._spec.origin[1]=t.origin[1]):this._spec.origin=void 0,t.size?(t.size||(this._spec.size=[0,0]),this._spec.size[0]=t.size[0],this._spec.size[1]=t.size[1]):this._spec.size=void 0,t.transform)if(t.transform)for(var e=0;16>e;e++)this._spec.transform[0]=t.transform[0];else this._spec.transform=t.transform.slice(0);else this._spec.transform=void 0;this._spec.opacity=t.opacity},n.prototype.set=function(t,e){this._invalidated=!0,this._specModified=!0,this._removing=!1;var i=this._spec;i.opacity=t.opacity,t.size?(i.size||(i.size=[0,0]),i.size[0]=t.size[0],i.size[1]=t.size[1]):i.size=void 0,t.origin?(i.origin||(i.origin=[0,0]),i.origin[0]=t.origin[0],i.origin[1]=t.origin[1]):i.origin=void 0,t.align?(i.align||(i.align=[0,0]),i.align[0]=t.align[0],i.align[1]=t.align[1]):i.align=void 0,t.skew||t.rotate||t.scale?this._spec.transform=o.build({translate:t.translate||[0,0,0],skew:t.skew||[0,0,0],scale:t.scale||[1,1,1],rotate:t.rotate||[0,0,0]}):t.translate?this._spec.transform=o.translate(t.translate[0],t.translate[1],t.translate[2]):this._spec.transform=void 0,this.scrollLength=t.scrollLength},n.prototype.getSpec=function(){return this._specModified=!1,this._spec.removed=!this._invalidated,this._spec},n.prototype.remove=function(t){this._removing=!0},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./LayoutUtility":8}],7:[function(t,e,i){function n(t,e){this.LayoutNode=t,this._initLayoutNodeFn=e,this._layoutCount=0,this._context=new h({next:s.bind(this),prev:a.bind(this),get:c.bind(this),set:u.bind(this),resolveSize:l.bind(this),size:[0,0]}),this._contextState={},this._pool={layoutNodes:{size:0},resolveSize:[0,0]}}function o(t){t._next&&(t._next._prev=t._prev),t._prev?t._prev._next=t._next:this._first=t._next,t.destroy(),this._pool.layoutNodes.size<f&&(this._pool.layoutNodes.size++,t._prev=void 0,t._next=this._pool.layoutNodes.first,this._pool.layoutNodes.first=t)}function r(t,e){var i,n=this._contextState;if(!n.start){for(i=this._first;i&&i.renderNode!==t;)i=i._next;return i||(i=this.createNode(t),i._next=this._first,this._first&&(this._first._prev=i),this._first=i),n.start=i,n.startPrev=e,n.prev=i,n.next=i,i}if(e){if(n.prev._prev&&n.prev._prev.renderNode===t)return n.prev=n.prev._prev,n.prev}else if(n.next._next&&n.next._next.renderNode===t)return n.next=n.next._next,n.next;for(i=this._first;i&&i.renderNode!==t;)i=i._next;return i?(i._next&&(i._next._prev=i._prev),i._prev?i._prev._next=i._next:this._first=i._next,i._next=void 0,i._prev=void 0):i=this.createNode(t),e?(n.prev._prev?(i._prev=n.prev._prev,n.prev._prev._next=i):this._first=i,n.prev._prev=i,i._next=n.prev,n.prev=i):(n.next._next&&(i._next=n.next._next,
n.next._next._prev=i),n.next._next=i,i._prev=n.next,n.next=i),i}function s(){if(this._contextState.nextSequence&&(!this._context.reverse||(this._contextState.nextSequence=this._contextState.nextSequence.getNext(),this._contextState.nextSequence))){var t=this._contextState.nextSequence.get();if(!t)return void(this._contextState.nextSequence=void 0);var e=this._contextState.nextSequence;return this._context.reverse||(this._contextState.nextSequence=this._contextState.nextSequence.getNext()),{renderNode:t,viewSequence:e,next:!0,index:++this._contextState.nextGetIndex}}}function a(){if(this._contextState.prevSequence&&(this._context.reverse||(this._contextState.prevSequence=this._contextState.prevSequence.getPrevious(),this._contextState.prevSequence))){var t=this._contextState.prevSequence.get();if(!t)return void(this._contextState.prevSequence=void 0);var e=this._contextState.prevSequence;return this._context.reverse&&(this._contextState.prevSequence=this._contextState.prevSequence.getPrevious()),{renderNode:t,viewSequence:e,prev:!0,index:--this._contextState.prevGetIndex}}}function c(t){if(this._nodesById&&(t instanceof String||"string"==typeof t)){var e=this._nodesById[t];if(!e)return;if(e instanceof Array){for(var i=[],n=0,o=e.length;o>n;n++)i.push({renderNode:e[n],arrayElement:!0});return i}return{renderNode:e,byId:!0}}return t}function u(t,e){var i=this._nodesById?c.call(this,t):t;if(i){var n=i.node;n||(i.next?(i.index<this._contextState.nextSetIndex&&p.error("Nodes must be layed out in the same order as they were requested!"),this._contextState.nextSetIndex=i.index):i.prev&&(i.index>this._contextState.prevSetIndex&&p.error("Nodes must be layed out in the same order as they were requested!"),this._contextState.prevSetIndex=i.index),n=r.call(this,i.renderNode,i.prev),n._viewSequence=i.viewSequence,n._layoutCount++,1===n._layoutCount&&this._contextState.addCount++,i.node=n),n.usesTrueSize=i.usesTrueSize,n.trueSizeRequested=i.trueSizeRequested,n.set(e,this._context.size),i.set=e}return e}function l(t,e){var i=this._nodesById?c.call(this,t):t,n=this._pool.resolveSize;if(!i)return n[0]=0,n[1]=0,n;var o=i.renderNode,r=o.getSize();if(!r)return e;var s=o.size&&void 0!==o._trueSizeCheck?o.size:void 0;if(s&&(s[0]===!0||s[1]===!0)){i.usesTrueSize=!0;var a=o._backupSize;if(o._trueSizeCheck)if(a&&s!==r){var u=s[0]===!0?Math.max(a[0],r[0]):r[0],l=s[1]===!0?Math.max(a[1],r[1]):r[1];(u!==a[0]||l!==a[1])&&(this._trueSizeRequested=!0,i.trueSizeRequested=!0),a[0]=u,a[1]=l,r=a,o._backupSize=void 0,a=void 0}else this._trueSizeRequested=!0,i.trueSizeRequested=!0;(this._reevalTrueSize||a&&(a[0]!==r[0]||a[1]!==r[1]))&&(o._trueSizeCheck=!0,o._sizeDirty=!0,this._trueSizeRequested=!0),a||(o._backupSize=[0,0],a=o._backupSize),a[0]=r[0],a[1]=r[1]}return s=o._nodes?o.options.size:void 0,!s||s[0]!==!0&&s[1]!==!0||(this._reevalTrueSize||o._nodes._trueSizeRequested)&&(i.usesTrueSize=!0,i.trueSizeRequested=!0,this._trueSizeRequested=!0),(void 0===r[0]||r[0]===!0||void 0===r[1]||r[1]===!0)&&(n[0]=r[0],n[1]=r[1],r=n,void 0===r[0]?r[0]=e[0]:r[0]===!0&&(r[0]=0,this._trueSizeRequested=!0,i.trueSizeRequested=!0),void 0===r[1]?r[1]=e[1]:r[1]===!0&&(r[1]=0,this._trueSizeRequested=!0,i.trueSizeRequested=!0)),r}var h=t("./LayoutContext"),p=t("./LayoutUtility"),f=100;n.prototype.prepareForLayout=function(t,e,i){for(var n=this._first;n;)n.reset(),n=n._next;var o=this._context;this._layoutCount++,this._nodesById=e,this._trueSizeRequested=!1,this._reevalTrueSize=i.reevalTrueSize||!o.size||o.size[0]!==i.size[0]||o.size[1]!==i.size[1];var r=this._contextState;return r.startSequence=t,r.nextSequence=t,r.prevSequence=t,r.start=void 0,r.nextGetIndex=0,r.prevGetIndex=0,r.nextSetIndex=0,r.prevSetIndex=0,r.addCount=0,r.removeCount=0,o.size[0]=i.size[0],o.size[1]=i.size[1],o.direction=i.direction,o.reverse=i.reverse,o.alignment=i.reverse?1:0,o.scrollOffset=i.scrollOffset||0,o.scrollStart=i.scrollStart||0,o.scrollEnd=i.scrollEnd||o.size[o.direction],o},n.prototype.removeNonInvalidatedNodes=function(t){for(var e=this._first;e;)e._invalidated||e._removing||e.remove(t),e=e._next},n.prototype.removeVirtualViewSequenceNodes=function(){this._contextState.startSequence&&this._contextState.startSequence.cleanup&&this._contextState.startSequence.cleanup()},n.prototype.buildSpecAndDestroyUnrenderedNodes=function(t){for(var e=[],i={specs:e,modified:!1},n=this._first;n;){var r=n._specModified,s=n.getSpec();if(s.removed){var a=n;n=n._next,o.call(this,a),i.modified=!0}else r&&(s.transform&&t&&(s.transform[12]+=t[0],s.transform[13]+=t[1],s.transform[14]+=t[2],s.transform[12]=Math.round(1e5*s.transform[12])/1e5,s.transform[13]=Math.round(1e5*s.transform[13])/1e5),i.modified=!0),e.push(s),n=n._next}return this._contextState.addCount=0,this._contextState.removeCount=0,i},n.prototype.getNodeByRenderNode=function(t){for(var e=this._first;e;){if(e.renderNode===t)return e;e=e._next}},n.prototype.insertNode=function(t){t._next=this._first,this._first&&(this._first._prev=t),this._first=t},n.prototype.setNodeOptions=function(t){this._nodeOptions=t;for(var e=this._first;e;)e.setOptions(t),e=e._next;for(e=this._pool.layoutNodes.first;e;)e.setOptions(t),e=e._next},n.prototype.preallocateNodes=function(t,e){for(var i=[],n=0;t>n;n++)i.push(this.createNode(void 0,e));for(n=0;t>n;n++)o.call(this,i[n])},n.prototype.createNode=function(t,e){var i;return this._pool.layoutNodes.first?(i=this._pool.layoutNodes.first,this._pool.layoutNodes.first=i._next,this._pool.layoutNodes.size--,i.constructor.apply(i,arguments)):(i=new this.LayoutNode(t,e),this._nodeOptions&&i.setOptions(this._nodeOptions)),i._prev=void 0,i._next=void 0,i._viewSequence=void 0,i._layoutCount=0,this._initLayoutNodeFn&&this._initLayoutNodeFn.call(this,i,e),i},n.prototype.getStartEnumNode=function(t){return void 0===t?this._first:t===!0?this._contextState.start&&this._contextState.startPrev?this._contextState.start._next:this._contextState.start:t===!1?this._contextState.start&&!this._contextState.startPrev?this._contextState.start._prev:this._contextState.start:void 0},e.exports=n},{"./LayoutContext":4,"./LayoutUtility":8}],8:[function(t,e,i){(function(t){function i(){}function n(t,e){if(t===e)return!0;if(void 0===t||void 0===e)return!1;var i=t.length;if(i!==e.length)return!1;for(;i--;)if(t[i]!==e[i])return!1;return!0}var o="undefined"!=typeof window?window.famous.utilities.Utility:"undefined"!=typeof t?t.famous.utilities.Utility:null;i.registeredHelpers={};var r={SEQUENCE:1,DIRECTION_X:2,DIRECTION_Y:4,SCROLLING:8};i.Capabilities=r,i.normalizeMargins=function(t){return t?Array.isArray(t)?0===t.length?[0,0,0,0]:1===t.length?[t[0],t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[0],t[1]]:t:[t,t,t,t]:[0,0,0,0]},i.cloneSpec=function(t){var e={};return void 0!==t.opacity&&(e.opacity=t.opacity),void 0!==t.size&&(e.size=t.size.slice(0)),void 0!==t.transform&&(e.transform=t.transform.slice(0)),void 0!==t.origin&&(e.origin=t.origin.slice(0)),void 0!==t.align&&(e.align=t.align.slice(0)),e},i.isEqualSpec=function(t,e){return t.opacity!==e.opacity?!1:n(t.size,e.size)&&n(t.transform,e.transform)&&n(t.origin,e.origin)&&n(t.align,e.align)?!0:!1},i.getSpecDiffText=function(t,e){var i="spec diff:";return t.opacity!==e.opacity&&(i+="\nopacity: "+t.opacity+" != "+e.opacity),n(t.size,e.size)||(i+="\nsize: "+JSON.stringify(t.size)+" != "+JSON.stringify(e.size)),n(t.transform,e.transform)||(i+="\ntransform: "+JSON.stringify(t.transform)+" != "+JSON.stringify(e.transform)),n(t.origin,e.origin)||(i+="\norigin: "+JSON.stringify(t.origin)+" != "+JSON.stringify(e.origin)),n(t.align,e.align)||(i+="\nalign: "+JSON.stringify(t.align)+" != "+JSON.stringify(e.align)),i},i.error=function(t){throw console.log("ERROR: "+t),t},i.warning=function(t){console.log("WARNING: "+t)},i.log=function(t){for(var e="",i=0;i<arguments.length;i++){var n=arguments[i];e+=n instanceof Object||n instanceof Array?JSON.stringify(n):n}console.log(e)},i.combineOptions=function(t,e,i){if(t&&!e&&!i)return t;if(!t&&e&&!i)return e;var n=o.clone(t||{});if(e)for(var r in e)n[r]=e[r];return n},i.registerHelper=function(t,e){e.prototype.parse||i.error('The layout-helper for name "'+t+'" is required to support the "parse" method'),void 0!==this.registeredHelpers[t]&&i.warning('A layout-helper with the name "'+t+'" is already registered and will be overwritten'),this.registeredHelpers[t]=e},i.unregisterHelper=function(t){delete this.registeredHelpers[t]},i.getRegisteredHelper=function(t){return this.registeredHelpers[t]},e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(t,e,i){(function(i){function n(t){t=x.combineOptions(n.DEFAULT_OPTIONS,t);var e=new N(t.flow?k:C,o.bind(this));I.call(this,t,e),this._scroll={activeTouches:[],pe:new F,particle:new R(this.options.scrollParticle),dragForce:new P(this.options.scrollDrag),frictionForce:new P(this.options.scrollFriction),springValue:void 0,springForce:new q(this.options.scrollSpring),springEndState:new M([0,0,0]),groupStart:0,groupTranslate:[0,0,0],scrollDelta:0,normalizedScrollDelta:0,scrollForce:0,scrollForceCount:0,unnormalizedScrollOffset:0,isScrolling:!1},this._debug={layoutCount:0,commitCount:0},this.group=new L,this.group.add({render:E.bind(this)}),this._scroll.pe.addBody(this._scroll.particle),this.options.scrollDrag.disabled||(this._scroll.dragForceId=this._scroll.pe.attach(this._scroll.dragForce,this._scroll.particle)),this.options.scrollFriction.disabled||(this._scroll.frictionForceId=this._scroll.pe.attach(this._scroll.frictionForce,this._scroll.particle)),this._scroll.springForce.setOptions({anchor:this._scroll.springEndState}),this._eventInput.on("touchstart",u.bind(this)),this._eventInput.on("touchmove",l.bind(this)),this._eventInput.on("touchend",h.bind(this)),this._eventInput.on("touchcancel",h.bind(this)),this._eventInput.on("mousedown",s.bind(this)),this._eventInput.on("mouseup",c.bind(this)),this._eventInput.on("mousemove",a.bind(this)),this._scrollSync=new j(this.options.scrollSync),this._eventInput.pipe(this._scrollSync),this._scrollSync.on("update",p.bind(this)),this.options.useContainer&&(this.container=new D(this.options.container),this.container.add({render:function(){return this.id}.bind(this)}),this.options.autoPipeEvents||(this.subscribe(this.container),A.setInputHandler(this.container,this),A.setOutputHandler(this.container,this)))}function o(t,e){!e&&this.options.insertSpec&&t.setSpec(this.options.insertSpec)}function r(){var t=this._scroll.scrollForceCount?void 0:this._scroll.springPosition;this._scroll.springValue!==t&&(this._scroll.springValue=t,void 0===t?void 0!==this._scroll.springForceId&&(this._scroll.pe.detach(this._scroll.springForceId),this._scroll.springForceId=void 0):(void 0===this._scroll.springForceId&&(this._scroll.springForceId=this._scroll.pe.attach(this._scroll.springForce,this._scroll.particle)),this._scroll.springEndState.set1D(t),this._scroll.pe.wake()))}function s(t){if(this.options.mouseMove){this._scroll.mouseMove&&this.releaseScrollForce(this._scroll.mouseMove.delta);var e=[t.clientX,t.clientY],i=Date.now();this._scroll.mouseMove={delta:0,start:e,current:e,prev:e,time:i,prevTime:i},this.applyScrollForce(this._scroll.mouseMove.delta)}}function a(t){if(this._scroll.mouseMove&&this.options.enabled){var e=Math.atan2(Math.abs(t.clientY-this._scroll.mouseMove.prev[1]),Math.abs(t.clientX-this._scroll.mouseMove.prev[0]))/(Math.PI/2),i=Math.abs(this._direction-e);(void 0===this.options.touchMoveDirectionThresshold||i<=this.options.touchMoveDirectionThresshold)&&(this._scroll.mouseMove.prev=this._scroll.mouseMove.current,this._scroll.mouseMove.current=[t.clientX,t.clientY],this._scroll.mouseMove.prevTime=this._scroll.mouseMove.time,this._scroll.mouseMove.direction=e,this._scroll.mouseMove.time=Date.now());var n=this._scroll.mouseMove.current[this._direction]-this._scroll.mouseMove.start[this._direction];this.updateScrollForce(this._scroll.mouseMove.delta,n),this._scroll.mouseMove.delta=n}}function c(t){if(this._scroll.mouseMove){var e=0,i=this._scroll.mouseMove.time-this._scroll.mouseMove.prevTime;if(i>0&&Date.now()-this._scroll.mouseMove.time<=this.options.touchMoveNoVelocityDuration){var n=this._scroll.mouseMove.current[this._direction]-this._scroll.mouseMove.prev[this._direction];e=n/i}this.releaseScrollForce(this._scroll.mouseMove.delta,e),this._scroll.mouseMove=void 0}}function u(t){this._touchEndEventListener||(this._touchEndEventListener=function(t){t.target.removeEventListener("touchend",this._touchEndEventListener),h.call(this,t)}.bind(this));for(var e,i,n=this._scroll.activeTouches.length,o=0;o<this._scroll.activeTouches.length;){var r=this._scroll.activeTouches[o];for(i=!1,e=0;e<t.touches.length;e++){var s=t.touches[e];if(s.identifier===r.id){i=!0;break}}i?o++:this._scroll.activeTouches.splice(o,1)}for(o=0;o<t.touches.length;o++){var a=t.touches[o];for(i=!1,e=0;e<this._scroll.activeTouches.length;e++)if(this._scroll.activeTouches[e].id===a.identifier){i=!0;break}if(!i){var c=[a.clientX,a.clientY],u=Date.now();this._scroll.activeTouches.push({id:a.identifier,start:c,current:c,prev:c,time:u,prevTime:u}),a.target.addEventListener("touchend",this._touchEndEventListener)}}!n&&this._scroll.activeTouches.length&&(this.applyScrollForce(0),this._scroll.touchDelta=0)}function l(t){if(this.options.enabled){for(var e,i=0;i<t.changedTouches.length;i++)for(var n=t.changedTouches[i],o=0;o<this._scroll.activeTouches.length;o++){var r=this._scroll.activeTouches[o];if(r.id===n.identifier){var s=Math.atan2(Math.abs(n.clientY-r.prev[1]),Math.abs(n.clientX-r.prev[0]))/(Math.PI/2),a=Math.abs(this._direction-s);(void 0===this.options.touchMoveDirectionThresshold||a<=this.options.touchMoveDirectionThresshold)&&(r.prev=r.current,r.current=[n.clientX,n.clientY],r.prevTime=r.time,r.direction=s,r.time=Date.now(),e=0===o?r:void 0)}}if(e){var c=e.current[this._direction]-e.start[this._direction];this.updateScrollForce(this._scroll.touchDelta,c),this._scroll.touchDelta=c}}}function h(t){for(var e=this._scroll.activeTouches.length?this._scroll.activeTouches[0]:void 0,i=0;i<t.changedTouches.length;i++)for(var n=t.changedTouches[i],o=0;o<this._scroll.activeTouches.length;o++){var r=this._scroll.activeTouches[o];if(r.id===n.identifier){if(this._scroll.activeTouches.splice(o,1),0===o&&this._scroll.activeTouches.length){var s=this._scroll.activeTouches[0];s.start[0]=s.current[0]-(r.current[0]-r.start[0]),s.start[1]=s.current[1]-(r.current[1]-r.start[1])}break}}if(e&&!this._scroll.activeTouches.length){var a=0,c=e.time-e.prevTime;if(c>0&&Date.now()-e.time<=this.options.touchMoveNoVelocityDuration){var u=e.current[this._direction]-e.prev[this._direction];a=u/c}var l=this._scroll.touchDelta;this.releaseScrollForce(l,a),this._scroll.touchDelta=0}}function p(t){if(this.options.enabled){var e=Array.isArray(t.delta)?t.delta[this._direction]:t.delta;this.scroll(e)}}function f(t,e,i){if(void 0!==t&&(this._scroll.particleValue=t,this._scroll.particle.setPosition1D(t)),void 0!==e){var n=this._scroll.particle.getVelocity1D();n!==e&&this._scroll.particle.setVelocity1D(e)}}function d(t,e){(e||void 0===this._scroll.particleValue)&&(this._scroll.particleValue=this._scroll.particle.getPosition1D(),this._scroll.particleValue=Math.round(1e3*this._scroll.particleValue)/1e3);var i=this._scroll.particleValue;return(this._scroll.scrollDelta||this._scroll.normalizedScrollDelta)&&(i+=this._scroll.scrollDelta+this._scroll.normalizedScrollDelta,(this._scroll.boundsReached&U.PREV&&i>this._scroll.springPosition||this._scroll.boundsReached&U.NEXT&&i<this._scroll.springPosition||this._scroll.boundsReached===U.BOTH)&&(i=this._scroll.springPosition),t&&(this._scroll.scrollDelta||(this._scroll.normalizedScrollDelta=0,f.call(this,i,void 0,"_calcScrollOffset")),this._scroll.normalizedScrollDelta+=this._scroll.scrollDelta,this._scroll.scrollDelta=0)),this._scroll.scrollForceCount&&this._scroll.scrollForce&&(void 0!==this._scroll.springPosition?i=(i+this._scroll.scrollForce+this._scroll.springPosition)/2:i+=this._scroll.scrollForce),this.options.overscroll||(this._scroll.boundsReached===U.BOTH||this._scroll.boundsReached===U.PREV&&i>this._scroll.springPosition||this._scroll.boundsReached===U.NEXT&&i<this._scroll.springPosition)&&(i=this._scroll.springPosition),i}function v(t,e){var i=this._calcScrollHeight(!1),n=this._calcScrollHeight(!0),o=this._layout.capabilities&&this._layout.capabilities.sequentialScrollingOptimized;if(void 0===i||void 0===n)return this._scroll.boundsReached=U.NONE,this._scroll.springPosition=void 0,void(this._scroll.springSource=B.NONE);var r;if(o&&(void 0!==n&&void 0!==i&&(r=i+n),void 0!==r&&r<=t[this._direction]))return this._scroll.boundsReached=U.BOTH,this._scroll.springPosition=this.options.alignment?-n:i,void(this._scroll.springSource=B.MINSIZE);if(this.options.alignment)if(o){if(void 0!==n&&0>=e+n)return this._scroll.boundsReached=U.NEXT,this._scroll.springPosition=-n,void(this._scroll.springSource=B.NEXTBOUNDS)}else{var s=this._calcScrollHeight(!1,!0);if(void 0!==n&&s&&e+n+t[this._direction]<=s)return this._scroll.boundsReached=U.NEXT,this._scroll.springPosition=n-(t[this._direction]-s),void(this._scroll.springSource=B.NEXTBOUNDS)}else if(void 0!==i&&e-i>=0)return this._scroll.boundsReached=U.PREV,this._scroll.springPosition=i,void(this._scroll.springSource=B.PREVBOUNDS);if(this.options.alignment){if(void 0!==i&&e-i>=-t[this._direction])return this._scroll.boundsReached=U.PREV,this._scroll.springPosition=-t[this._direction]+i,void(this._scroll.springSource=B.PREVBOUNDS)}else{var a=o?t[this._direction]:this._calcScrollHeight(!0,!0);if(void 0!==n&&a>=e+n)return this._scroll.boundsReached=U.NEXT,this._scroll.springPosition=a-n,void(this._scroll.springSource=B.NEXTBOUNDS)}this._scroll.boundsReached=U.NONE,this._scroll.springPosition=void 0,this._scroll.springSource=B.NONE}function y(t,e){var i=this._scroll.scrollToRenderNode||this._scroll.ensureVisibleRenderNode;if(i&&!(this._scroll.boundsReached===U.BOTH||!this._scroll.scrollToDirection&&this._scroll.boundsReached===U.PREV||this._scroll.scrollToDirection&&this._scroll.boundsReached===U.NEXT)){for(var n,o=0,r=this._nodes.getStartEnumNode(!0),s=0;r&&(s++,r._invalidated&&void 0!==r.scrollLength);){if(this.options.alignment&&(o-=r.scrollLength),r.renderNode===i){n=r;break}this.options.alignment||(o-=r.scrollLength),r=r._next}if(!n)for(o=0,r=this._nodes.getStartEnumNode(!1);r&&r._invalidated&&void 0!==r.scrollLength;){if(this.options.alignment||(o+=r.scrollLength),r.renderNode===i){n=r;break}this.options.alignment&&(o+=r.scrollLength),r=r._prev}if(n)return void(this._scroll.ensureVisibleSequence?this.options.alignment?o-n.scrollLength<0?(this._scroll.springPosition=o,this._scroll.springSource=B.ENSUREVISIBLE):o>t[this._direction]?(this._scroll.springPosition=t[this._direction]-o,this._scroll.springSource=B.ENSUREVISIBLE):this._scroll.ensureVisibleRenderNode=void 0:(o=-o,0>o?(this._scroll.springPosition=o,this._scroll.springSource=B.ENSUREVISIBLE):o+n.scrollLength>t[this._direction]?(this._scroll.springPosition=t[this._direction]-(o+n.scrollLength),this._scroll.springSource=B.ENSUREVISIBLE):this._scroll.ensureVisibleRenderNode=void 0):(this._scroll.springPosition=o,this._scroll.springSource=B.GOTOSEQUENCE));if(this._scroll.scrollToDirection?(this._scroll.springPosition=e-t[this._direction],this._scroll.springSource=B.GOTONEXTDIRECTION):(this._scroll.springPosition=e+t[this._direction],this._scroll.springSource=B.GOTOPREVDIRECTION),this._viewSequence.cleanup)for(var a=this._viewSequence;a.get()!==i&&(a=this._scroll.scrollToDirection?a.getNext(!0):a.getPrevious(!0)););}}function _(){if(this.options.paginated&&!this._scroll.scrollForceCount&&void 0===this._scroll.springPosition){var t;switch(this.options.paginationMode){case H.SCROLL:(!this.options.paginationEnergyThresshold||Math.abs(this._scroll.particle.getEnergy())<=this.options.paginationEnergyThresshold)&&(t=this.options.alignment?this.getLastVisibleItem():this.getFirstVisibleItem(),t&&t.renderNode&&this.goToRenderNode(t.renderNode));break;case H.PAGE:t=this.options.alignment?this.getLastVisibleItem():this.getFirstVisibleItem(),t&&t.renderNode&&this.goToRenderNode(t.renderNode)}}}function g(t){for(var e=0,i=t,n=!1,o=this._nodes.getStartEnumNode(!1);o&&o._invalidated&&o._viewSequence&&(n&&(this._viewSequence=o._viewSequence,i=t,n=!1),!(void 0===o.scrollLength||o.trueSizeRequested||0>t));)t-=o.scrollLength,e++,o.scrollLength&&(this.options.alignment?n=t>=0:(this._viewSequence=o._viewSequence,i=t)),o=o._prev;return i}function m(t){for(var e=0,i=t,n=this._nodes.getStartEnumNode(!0);n&&n._invalidated&&void 0!==n.scrollLength&&!n.trueSizeRequested&&n._viewSequence&&(!(t>0)||this.options.alignment&&0===n.scrollLength);)this.options.alignment&&(t+=n.scrollLength,e++),(n.scrollLength||this.options.alignment)&&(this._viewSequence=n._viewSequence,i=t),this.options.alignment||(t+=n.scrollLength,e++),n=n._next;return i}function S(t,e){var i=this._layout.capabilities;if(i&&i.debug&&void 0!==i.debug.normalize&&!i.debug.normalize)return e;if(this._scroll.scrollForceCount)return e;var n=e;if(this.options.alignment&&0>e?n=m.call(this,e):!this.options.alignment&&e>0&&(n=g.call(this,e)),n===e&&(this.options.alignment&&e>0?n=g.call(this,e):!this.options.alignment&&0>e&&(n=m.call(this,e))),n!==e){var o=n-e,r=this._scroll.particle.getPosition1D();f.call(this,r+o,void 0,"normalize"),void 0!==this._scroll.springPosition&&(this._scroll.springPosition+=o),i&&i.sequentialScrollingOptimized&&(this._scroll.groupStart-=o)}return n}function w(t,e){this._scroll.scrollToSequence=t,this._scroll.scrollToRenderNode=t.get(),this._scroll.ensureVisibleRenderNode=void 0,this._scroll.scrollToDirection=e,this._scroll.scrollDirty=!0}function b(t,e){this._scroll.scrollToSequence=void 0,this._scroll.scrollToRenderNode=void 0,this._scroll.ensureVisibleRenderNode=t.get(),this._scroll.scrollToDirection=e,this._scroll.scrollDirty=!0}function O(t){var e=this._scroll.scrollToSequence||this._viewSequence;if(!this._scroll.scrollToSequence){var i=this.getFirstVisibleItem();i&&(e=i.viewSequence,(0>t&&i.scrollOffset<0||t>0&&i.scrollOffset>0)&&(t=0))}if(e){for(var n=0;n<Math.abs(t);n++){var o=t>0?e.getNext():e.getPrevious();if(!o)break;e=o}w.call(this,e,t>=0)}}function T(t,e,i){this._debug.layoutCount++;var n=0-Math.max(this.options.extraBoundsSpace[0],1),o=t[this._direction]+Math.max(this.options.extraBoundsSpace[1],1);this.options.layoutAll&&(n=-1e6,o=1e6);var s=this._nodes.prepareForLayout(this._viewSequence,this._nodesById,{size:t,direction:this._direction,reverse:this.options.alignment?!0:!1,scrollOffset:this.options.alignment?e+t[this._direction]:e,scrollStart:n,scrollEnd:o});this._layout._function&&this._layout._function(s,this._layout.options),this._scroll.unnormalizedScrollOffset=e,this._postLayout&&this._postLayout(t,e),this._nodes.removeNonInvalidatedNodes(this.options.removeSpec),v.call(this,t,e),y.call(this,t,e),_.call(this);var a=d.call(this,!0);return i||a===e?(e=S.call(this,t,e),r.call(this),this._nodes.removeVirtualViewSequenceNodes(),e):T.call(this,t,a,!0)}function E(){for(var t=this._specs,e=0,i=t.length;i>e;e++)t[e].target=t[e].renderNode.render();return t}var x=t("./LayoutUtility"),I=t("./LayoutController"),C=t("./LayoutNode"),k=t("./FlowLayoutNode"),N=t("./LayoutNodeManager"),D="undefined"!=typeof window?window.famous.surfaces.ContainerSurface:"undefined"!=typeof i?i.famous.surfaces.ContainerSurface:null,z="undefined"!=typeof window?window.famous.core.Transform:"undefined"!=typeof i?i.famous.core.Transform:null,A="undefined"!=typeof window?window.famous.core.EventHandler:"undefined"!=typeof i?i.famous.core.EventHandler:null,L="undefined"!=typeof window?window.famous.core.Group:"undefined"!=typeof i?i.famous.core.Group:null,M="undefined"!=typeof window?window.famous.math.Vector:"undefined"!=typeof i?i.famous.math.Vector:null,F="undefined"!=typeof window?window.famous.physics.PhysicsEngine:"undefined"!=typeof i?i.famous.physics.PhysicsEngine:null,R="undefined"!=typeof window?window.famous.physics.bodies.Particle:"undefined"!=typeof i?i.famous.physics.bodies.Particle:null,P="undefined"!=typeof window?window.famous.physics.forces.Drag:"undefined"!=typeof i?i.famous.physics.forces.Drag:null,q="undefined"!=typeof window?window.famous.physics.forces.Spring:"undefined"!=typeof i?i.famous.physics.forces.Spring:null,j="undefined"!=typeof window?window.famous.inputs.ScrollSync:"undefined"!=typeof i?i.famous.inputs.ScrollSync:null,V="undefined"!=typeof window?window.famous.core.ViewSequence:"undefined"!=typeof i?i.famous.core.ViewSequence:null,U={NONE:0,PREV:1,NEXT:2,BOTH:3},B={NONE:"none",NEXTBOUNDS:"next-bounds",PREVBOUNDS:"prev-bounds",MINSIZE:"minimal-size",GOTOSEQUENCE:"goto-sequence",ENSUREVISIBLE:"ensure-visible",GOTOPREVDIRECTION:"goto-prev-direction",GOTONEXTDIRECTION:"goto-next-direction"},H={PAGE:0,SCROLL:1};n.prototype=Object.create(I.prototype),n.prototype.constructor=n,n.Bounds=U,n.PaginationMode=H,n.DEFAULT_OPTIONS={flow:!1,useContainer:!1,container:{properties:{overflow:"hidden"}},visibleItemThresshold:.5,scrollParticle:{},scrollDrag:{forceFunction:P.FORCE_FUNCTIONS.QUADRATIC,strength:.001,disabled:!0},scrollFriction:{forceFunction:P.FORCE_FUNCTIONS.LINEAR,strength:.0025,disabled:!1},scrollSpring:{dampingRatio:1,period:350},scrollSync:{scale:.2},overscroll:!0,paginated:!1,paginationMode:H.PAGE,paginationEnergyThresshold:.01,alignment:0,touchMoveDirectionThresshold:void 0,touchMoveNoVelocityDuration:100,mouseMove:!1,enabled:!0,layoutAll:!1,alwaysLayout:!1,extraBoundsSpace:[100,100],debug:!1},n.prototype.setOptions=function(t){return I.prototype.setOptions.call(this,t),this._scroll&&(t.scrollSpring&&this._scroll.springForce.setOptions(t.scrollSpring),t.scrollDrag&&this._scroll.dragForce.setOptions(t.scrollDrag)),t.scrollSync&&this._scrollSync&&this._scrollSync.setOptions(t.scrollSync),this},n.prototype._calcScrollHeight=function(t,e){for(var i=0,n=this._nodes.getStartEnumNode(t);n;){if(n._invalidated){if(n.trueSizeRequested){i=void 0;break}if(void 0!==n.scrollLength&&(i=e?n.scrollLength:i+n.scrollLength,!t&&e))break}n=t?n._next:n._prev}return i},n.prototype.getVisibleItems=function(){for(var t=this._contextSizeCache,e=this.options.alignment?this._scroll.unnormalizedScrollOffset+t[this._direction]:this._scroll.unnormalizedScrollOffset,i=[],n=this._nodes.getStartEnumNode(!0);n&&n._invalidated&&void 0!==n.scrollLength&&!(e>t[this._direction]);)e+=n.scrollLength,e>=0&&n._viewSequence&&i.push({index:n._viewSequence.getIndex(),viewSequence:n._viewSequence,renderNode:n.renderNode,visiblePerc:n.scrollLength?(Math.min(e,t[this._direction])-Math.max(e-n.scrollLength,0))/n.scrollLength:1,scrollOffset:e-n.scrollLength,scrollLength:n.scrollLength,_node:n}),n=n._next;for(e=this.options.alignment?this._scroll.unnormalizedScrollOffset+t[this._direction]:this._scroll.unnormalizedScrollOffset,n=this._nodes.getStartEnumNode(!1);n&&n._invalidated&&void 0!==n.scrollLength&&!(0>e);)e-=n.scrollLength,e<t[this._direction]&&n._viewSequence&&i.unshift({index:n._viewSequence.getIndex(),viewSequence:n._viewSequence,renderNode:n.renderNode,visiblePerc:n.scrollLength?(Math.min(e+n.scrollLength,t[this._direction])-Math.max(e,0))/n.scrollLength:1,scrollOffset:e,scrollLength:n.scrollLength,_node:n}),n=n._prev;return i},n.prototype.getFirstVisibleItem=function(t){for(var e,i,n,o=this._contextSizeCache,r=this.options.alignment?this._scroll.unnormalizedScrollOffset+o[this._direction]:this._scroll.unnormalizedScrollOffset,s=this._nodes.getStartEnumNode(!0);s&&s._invalidated&&void 0!==s.scrollLength&&!(r>o[this._direction]);){if(r+=s.scrollLength,r>=0&&s._viewSequence&&(e=s.scrollLength?(Math.min(r,o[this._direction])-Math.max(r-s.scrollLength,0))/s.scrollLength:1,i=r-s.scrollLength,e>=this.options.visibleItemThresshold||i>=0)){n=s;break}s=s._next}for(r=this.options.alignment?this._scroll.unnormalizedScrollOffset+o[this._direction]:this._scroll.unnormalizedScrollOffset,s=this._nodes.getStartEnumNode(!1);s&&s._invalidated&&void 0!==s.scrollLength&&!(0>r);){if(r-=s.scrollLength,r<o[this._direction]&&s._viewSequence){var a=s.scrollLength?(Math.min(r+s.scrollLength,o[this._direction])-Math.max(r,0))/s.scrollLength:1;if(a>=this.options.visibleItemThresshold||r>=0){e=a,i=r,n=s;break}}s=s._prev}return n?{index:n._viewSequence.getIndex(),viewSequence:n._viewSequence,renderNode:n.renderNode,visiblePerc:e,scrollOffset:i,scrollLength:n.scrollLength,_node:n}:void 0},n.prototype.getLastVisibleItem=function(){for(var t=this.getVisibleItems(),e=this._contextSizeCache,i=t.length-1;i>=0;i--){var n=t[i];if(n.visiblePerc>=this.options.visibleItemThresshold||n.scrollOffset+n.scrollLength<=e[this._direction])return n}return t.length?t[t.length-1]:void 0},n.prototype.goToFirstPage=function(){if(!this._viewSequence)return this;if(this._viewSequence._&&this._viewSequence._.loop)return x.error("Unable to go to first item of looped ViewSequence"),this;for(var t=this._viewSequence;t;){var e=t.getPrevious();if(!e||!e.get())break;t=e}return w.call(this,t,!1),this},n.prototype.goToPreviousPage=function(){return O.call(this,-1),this},n.prototype.goToNextPage=function(){return O.call(this,1),this},n.prototype.goToLastPage=function(){if(!this._viewSequence)return this;if(this._viewSequence._&&this._viewSequence._.loop)return x.error("Unable to go to last item of looped ViewSequence"),this;for(var t=this._viewSequence;t;){var e=t.getNext();if(!e||!e.get())break;t=e}return w.call(this,t,!0),this},n.prototype.goToRenderNode=function(t){if(!this._viewSequence||!t)return this;if(this._viewSequence.get()===t){var e=d.call(this)>=0;return w.call(this,this._viewSequence,e),this}for(var i=this._viewSequence.getNext(),n=this._viewSequence.getPrevious();(i||n)&&i!==this._viewSequence;){var o=i?i.get():void 0;if(o===t){w.call(this,i,!0);break}var r=n?n.get():void 0;if(r===t){w.call(this,n,!1);break}i=o?i.getNext():void 0,n=r?n.getPrevious():void 0}return this},n.prototype.ensureVisible=function(t){if(t instanceof V)t=t.get();else if(t instanceof Number||"number"==typeof t){for(var e=this._viewSequence;e.getIndex()<t;)if(e=e.getNext(),!e)return this;for(;e.getIndex()>t;)if(e=e.getPrevious(),!e)return this}if(this._viewSequence.get()===t){var i=d.call(this)>=0;return b.call(this,this._viewSequence,i),this}for(var n=this._viewSequence.getNext(),o=this._viewSequence.getPrevious();(n||o)&&n!==this._viewSequence;){var r=n?n.get():void 0;if(r===t){b.call(this,n,!0);break}var s=o?o.get():void 0;if(s===t){b.call(this,o,!1);break}n=r?n.getNext():void 0,o=s?o.getPrevious():void 0}return this},n.prototype.scroll=function(t){return this.halt(),this._scroll.scrollDelta+=t,this},n.prototype.canScroll=function(t){var e,i=d.call(this),n=this._calcScrollHeight(!1),o=this._calcScrollHeight(!0);if(void 0!==o&&void 0!==n&&(e=n+o),void 0!==e&&e<=this._contextSizeCache[this._direction])return 0;if(0>t&&void 0!==o){var r=this._contextSizeCache[this._direction]-(i+o);return Math.max(r,t)}if(t>0&&void 0!==n){var s=-(i-n);return Math.min(s,t)}return t},n.prototype.halt=function(){return this._scroll.scrollToSequence=void 0,this._scroll.scrollToRenderNode=void 0,this._scroll.ensureVisibleRenderNode=void 0,f.call(this,void 0,0,"halt"),this},n.prototype.isScrolling=function(){return this._scroll.isScrolling},n.prototype.getBoundsReached=function(){return this._scroll.boundsReached},n.prototype.getVelocity=function(){return this._scroll.particle.getVelocity1D()},n.prototype.setVelocity=function(t){return this._scroll.particle.setVelocity1D(t)},n.prototype.applyScrollForce=function(t){return this.halt(),0===this._scroll.scrollForceCount&&(this._scroll.scrollForceStartItem=this.alignment?this.getLastVisibleItem():this.getFirstVisibleItem()),this._scroll.scrollForceCount++,this._scroll.scrollForce+=t,this},n.prototype.updateScrollForce=function(t,e){return this.halt(),e-=t,this._scroll.scrollForce+=e,this},n.prototype.releaseScrollForce=function(t,e){if(this.halt(),1===this._scroll.scrollForceCount){
var i=d.call(this);if(f.call(this,i,e,"releaseScrollForce"),this._scroll.pe.wake(),this._scroll.scrollForce=0,this._scroll.scrollDirty=!0,this._scroll.scrollForceStartItem&&this.options.paginated&&this.options.paginationMode===H.PAGE){var n=this.alignment?this.getLastVisibleItem():this.getFirstVisibleItem();n.renderNode!==this._scroll.scrollForceStartItem.renderNode?this.goToRenderNode(n.renderNode):this.options.paginationEnergyThresshold&&Math.abs(this._scroll.particle.getEnergy())>=this.options.paginationEnergyThresshold?(e=e||0,0>e&&n._node._next&&n._node._next.renderNode?this.goToRenderNode(n._node._next.renderNode):e>=0&&n._node._prev&&n._node._prev.renderNode&&this.goToRenderNode(n._node._prev.renderNode)):this.goToRenderNode(n.renderNode)}this._scroll.scrollForceStartItem=void 0}else this._scroll.scrollForce-=t;return this._scroll.scrollForceCount--,this},n.prototype.getSpec=function(t,e){var i=I.prototype.getSpec.apply(this,arguments);if(i&&this._layout.capabilities&&this._layout.capabilities.sequentialScrollingOptimized){i={origin:i.origin,align:i.align,opacity:i.opacity,size:i.size,renderNode:i.renderNode,transform:i.transform};var n=[0,0,0];n[this._direction]=this._scrollOffsetCache+this._scroll.groupStart,i.transform=z.thenMove(i.transform,n)}return i},n.prototype.commit=function(t){var e=t.size;this._debug.commitCount++;var i=d.call(this,!0,!0);void 0===this._scrollOffsetCache&&(this._scrollOffsetCache=i);var n,o=!1,r=!1;if(e[0]!==this._contextSizeCache[0]||e[1]!==this._contextSizeCache[1]||this._isDirty||this._scroll.scrollDirty||this._nodes._trueSizeRequested||this.options.alwaysLayout||this._scrollOffsetCache!==i){if(n={target:this,oldSize:this._contextSizeCache,size:e,oldScrollOffset:this._scrollOffsetCache,scrollOffset:i},this._scrollOffsetCache!==i?(this._scroll.isScrolling||(this._scroll.isScrolling=!0,this._eventOutput.emit("scrollstart",n)),r=!0):this._scroll.isScrolling&&!this._scroll.scrollForceCount&&(o=!0),this._eventOutput.emit("layoutstart",n),this.options.flow&&(this._isDirty||this.options.reflowOnResize&&(e[0]!==this._contextSizeCache[0]||e[1]!==this._contextSizeCache[1])))for(var s=this._nodes.getStartEnumNode();s;)s.releaseLock(),s=s._next;this._contextSizeCache[0]=e[0],this._contextSizeCache[1]=e[1],this._isDirty=!1,this._scroll.scrollDirty=!1,i=T.call(this,e,i),this._scrollOffsetCache=i,n.scrollOffset=this._scrollOffsetCache,this._eventOutput.emit("layoutend",n)}else this._scroll.isScrolling&&!this._scroll.scrollForceCount&&(o=!0);var a=this._scroll.groupTranslate;a[0]=0,a[1]=0,a[2]=0,a[this._direction]=-this._scroll.groupStart-i;var c=this._layout.capabilities?this._layout.capabilities.sequentialScrollingOptimized:!1,u=this._nodes.buildSpecAndDestroyUnrenderedNodes(c?a:void 0);if(this._specs=u.specs,u.modified&&this._eventOutput.emit("reflow",{target:this}),r&&this._eventOutput.emit("scroll",n),n){var l=this.options.alignment?this.getLastVisibleItem():this.getFirstVisibleItem();(l&&!this._visibleItemCache||!l&&this._visibleItemCache||l&&this._visibleItemCache&&l.renderNode!==this._visibleItemCache.renderNode)&&(this._eventOutput.emit("pagechange",{target:this,oldViewSequence:this._visibleItemCache?this._visibleItemCache.viewSequence:void 0,viewSequence:l?l.viewSequence:void 0,oldIndex:this._visibleItemCache?this._visibleItemCache.index:void 0,index:l?l.index:void 0,renderNode:l?l.renderNode:void 0,oldRenderNode:this._visibleItemCache?this._visibleItemCache.renderNode:void 0}),this._visibleItemCache=l)}o&&(this._scroll.isScrolling=!1,n={target:this,oldSize:e,size:e,oldScrollOffset:i,scrollOffset:i},this._eventOutput.emit("scrollend",n));var h=t.transform;if(c){var p=i+this._scroll.groupStart,f=[0,0,0];f[this._direction]=p,h=z.thenMove(h,f)}return{transform:h,size:e,opacity:t.opacity,origin:t.origin,target:this.group.render()}},n.prototype.render=function(){return this.container?this.container.render.apply(this.container,arguments):this.id},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./FlowLayoutNode":3,"./LayoutController":5,"./LayoutNode":6,"./LayoutNodeManager":7,"./LayoutUtility":8}],10:[function(t,e,i){(function(t){function i(t){t=t||{},this._=t._||new this.constructor.Backing(t),this.touched=!0,this.value=t.value||this._.factory.create(),this.index=t.index||0,this.next=t.next,this.prev=t.prev,n.setOutputHandler(this,this._.eventOutput),this.value.pipe(this._.eventOutput)}var n="undefined"!=typeof window?window.famous.core.EventHandler:"undefined"!=typeof t?t.famous.core.EventHandler:null;i.Backing=function(t){this.factory=t.factory,this.eventOutput=new n},i.prototype.getPrevious=function(t){if(this.prev)return this.prev.touched=!0,this.prev;if(!t){var e=this._.factory.createPrevious(this.get());if(e)return this.prev=new i({_:this._,value:e,index:this.index-1,next:this}),this.prev}},i.prototype.getNext=function(t){if(this.next)return this.next.touched=!0,this.next;if(!t){var e=this._.factory.createNext(this.get());if(e)return this.next=new i({_:this._,value:e,index:this.index+1,prev:this}),this.next}},i.prototype.get=function(){return this.touched=!0,this.value},i.prototype.getIndex=function(){return this.touched=!0,this.index},i.prototype.toString=function(){return""+this.index},i.prototype.cleanup=function(){for(var t=this.prev;t;){if(!t.touched){if(t.next.prev=void 0,t.next=void 0,this._.factory.destroy)for(;t;)this._.factory.destroy(t.value),t=t.prev;break}t.touched=!1,t=t.prev}for(t=this.next;t;){if(!t.touched){if(t.prev.next=void 0,t.prev=void 0,this._.factory.destroy)for(;t;)this._.factory.destroy(t.value),t=t.next;break}t.touched=!1,t=t.next}return this},i.prototype.unshift=function(){console.error&&console.error("VirtualViewSequence.unshift is not supported and should not be called")},i.prototype.push=function(){console.error&&console.error("VirtualViewSequence.push is not supported and should not be called")},i.prototype.splice=function(){console.error&&console.error("VirtualViewSequence.splice is not supported and should not be called")},i.prototype.swap=function(){console.error&&console.error("VirtualViewSequence.swap is not supported and should not be called")},e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(t,e,i){function n(t,e){var i=t.size;if(this._size=i,this._context=t,this._options=e,this._z=e&&e.translateZ?e.translateZ:0,e&&e.margins){var n=o.normalizeMargins(e.margins);this._left=n[3],this._top=n[0],this._right=i[0]-n[1],this._bottom=i[1]-n[2]}else this._left=0,this._top=0,this._right=i[0],this._bottom=i[1]}var o=t("../LayoutUtility");n.prototype.parse=function(t){for(var e=0;e<t.length;e++){var i=t[e],n=i.length>=3?i[2]:void 0;"top"===i[0]?this.top(i[1],n,i.length>=4?i[3]:void 0):"left"===i[0]?this.left(i[1],n,i.length>=4?i[3]:void 0):"right"===i[0]?this.right(i[1],n,i.length>=4?i[3]:void 0):"bottom"===i[0]?this.bottom(i[1],n,i.length>=4?i[3]:void 0):"fill"===i[0]?this.fill(i[1],i.length>=3?i[2]:void 0):"margins"===i[0]&&this.margins(i[1])}},n.prototype.top=function(t,e,i){if(e instanceof Array&&(e=e[1]),void 0===e){var n=this._context.resolveSize(t,[this._right-this._left,this._bottom-this._top]);e=n[1]}return this._context.set(t,{size:[this._right-this._left,e],origin:[0,0],align:[0,0],translate:[this._left,this._top,void 0===i?this._z:i]}),this._top+=e,this},n.prototype.left=function(t,e,i){if(e instanceof Array&&(e=e[0]),void 0===e){var n=this._context.resolveSize(t,[this._right-this._left,this._bottom-this._top]);e=n[0]}return this._context.set(t,{size:[e,this._bottom-this._top],origin:[0,0],align:[0,0],translate:[this._left,this._top,void 0===i?this._z:i]}),this._left+=e,this},n.prototype.bottom=function(t,e,i){if(e instanceof Array&&(e=e[1]),void 0===e){var n=this._context.resolveSize(t,[this._right-this._left,this._bottom-this._top]);e=n[1]}return this._context.set(t,{size:[this._right-this._left,e],origin:[0,1],align:[0,1],translate:[this._left,-(this._size[1]-this._bottom),void 0===i?this._z:i]}),this._bottom-=e,this},n.prototype.right=function(t,e,i){if(e instanceof Array&&(e=e[0]),t){if(void 0===e){var n=this._context.resolveSize(t,[this._right-this._left,this._bottom-this._top]);e=n[0]}this._context.set(t,{size:[e,this._bottom-this._top],origin:[1,0],align:[1,0],translate:[-(this._size[0]-this._right),this._top,void 0===i?this._z:i]})}return e&&(this._right-=e),this},n.prototype.fill=function(t,e){return this._context.set(t,{size:[this._right-this._left,this._bottom-this._top],translate:[this._left,this._top,void 0===e?this._z:e]}),this},n.prototype.margins=function(t){return t=o.normalizeMargins(t),this._left+=t[3],this._top+=t[0],this._right-=t[1],this._bottom-=t[2],this},o.registerHelper("dock",n),e.exports=n},{"../LayoutUtility":8}],12:[function(t,e,i){(function(i){function n(t,e){if(!g.length)return 0;var i,n,o=[0,0];for(i=0;i<g.length;i++)o[c]=Math.max(o[c],g[i].size[c]),o[l]+=(i>0?d[l]:0)+g[i].size[l];var r,a=v[l]?(h-o[l])/(2*g.length):0,y=(c?f[3]:f[0])+a;for(i=0;i<g.length;i++){n=g[i];var _=[0,0,0];_[l]=y,_[c]=t?p:p-o[c],r=0,0===i&&(r=o[c],r+=e&&(t&&!u||!t&&u)?c?f[0]+f[2]:f[3]+f[1]:d[c]),n.set={size:n.size,translate:_,scrollLength:r},y+=n.size[l]+d[l]+2*a}for(i=0;i<g.length;i++)n=t?g[i]:g[g.length-1-i],s.set(n.node,n.set);return g=[],o[c]+d[c]}function o(t){var e=y;if(_&&(e=_(t.renderNode,a)),e[0]===!0||e[1]===!0){var i=s.resolveSize(t,a);return e[0]!==!0&&(i[0]=y[0]),e[1]!==!0&&(i[1]=y[1]),i}return e}function r(t,e){if(s=t,a=s.size,c=s.direction,u=s.alignment,l=(c+1)%2,void 0!==e.gutter&&console.warn&&console.warn("option `gutter` has been deprecated for CollectionLayout, use margins & spacing instead"),!e.gutter||e.margins||e.spacing)f=S.normalizeMargins(e.margins),d=e.spacing||0,d=Array.isArray(d)?d:[d,d];else{var i=Array.isArray(e.gutter)?e.gutter:[e.gutter,e.gutter];f=[i[1],i[0],i[1],i[0]],d=i}b[0]=f[c?0:3],b[1]=-f[c?2:1],v=Array.isArray(e.justify)?e.justify:e.justify?[!0,!0]:[!1,!1],h=a[l]-(c?f[3]+f[1]:f[0]+f[2]);var r,m,w,O;for(e.cells?(e.itemSize&&console.warn&&console.warn("options `cells` and `itemSize` cannot both be specified for CollectionLayout, only use one of the two"),y=[(a[0]-(f[1]+f[3]+d[0]*(e.cells[0]-1)))/e.cells[0],(a[1]-(f[0]+f[2]+d[1]*(e.cells[1]-1)))/e.cells[1]]):e.itemSize?e.itemSize instanceof Function?_=e.itemSize:y=void 0===e.itemSize[0]||void 0===e.itemSize[0]?[void 0===e.itemSize[0]?a[0]:e.itemSize[0],void 0===e.itemSize[1]?a[1]:e.itemSize[1]]:e.itemSize:y=[!0,!0],p=s.scrollOffset+(u?0:b[u]),O=s.scrollEnd+(u?0:b[u]),w=0,g=[];O>p;){if(r=s.next(),!r){n(!0,!0);break}m=o(r),w+=(g.length?d[l]:0)+m[l],w>h&&(p+=n(!0,!r),w=m[l]),g.push({node:r,size:m})}for(p=s.scrollOffset+(u?b[u]:0),O=s.scrollStart+(u?b[u]:0),w=0,g=[];p>O;){if(r=s.prev(),!r){n(!1,!0);break}m=o(r),w+=(g.length?d[l]:0)+m[l],w>h&&(p-=n(!1,!r),w=m[l]),g.unshift({node:r,size:m})}}var s,a,c,u,l,h,p,f,d,v,y,_,g,m="undefined"!=typeof window?window.famous.utilities.Utility:"undefined"!=typeof i?i.famous.utilities.Utility:null,S=t("../LayoutUtility"),w={sequence:!0,direction:[m.Direction.Y,m.Direction.X],scrolling:!0,trueSize:!0,sequentialScrollingOptimized:!0},b=[0,0];r.Capabilities=w,r.Name="CollectionLayout",r.Description="Multi-cell collection-layout with margins & spacing",e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../LayoutUtility":8}],13:[function(t,e,i){(function(t){function i(t,e){var i=t.next();if(i){var n=t.size,o=t.direction,r=e.itemSize,s=.2,a=.1,c=30,u=100;t.set(i,{size:r,origin:[.5,.5],align:[.5,.5],translate:[0,0,u],scrollLength:r[o]});var l=r[0]/2,h=1-s,p=u-1,f=1-a,d=!1,v=!1;for(i=t.next(),i||(i=t.prev(),d=!0);i;)if(t.set(i,{size:r,origin:[.5,.5],align:[.5,.5],translate:o?[0,d?-l:l,p]:[d?-l:l,0,p],scale:[f,f,1],opacity:h,scrollLength:r[o]}),h-=s,f-=a,l+=c,p--,l>=n[o]/2?v=!0:(i=d?t.prev():t.next(),v=!i),v){if(d)break;v=!1,d=!0,i=t.prev(),i&&(l=r[o]/2,h=1-s,p=u-1,f=1-a)}}}var n="undefined"!=typeof window?window.famous.utilities.Utility:"undefined"!=typeof t?t.famous.utilities.Utility:null,o={sequence:!0,direction:[n.Direction.X,n.Direction.Y],scrolling:!0};i.Capabilities=o,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(t,e,i){e.exports=function(t,e){var i=e.itemSize;t.set(t.next(),{size:i,origin:[.5,.5],rotate:[0,Math.PI/2,0],translate:[i[0]/2,0,0]}),t.set(t.next(),{size:i,origin:[.5,.5],rotate:[0,Math.PI/2,0],translate:[-(i[0]/2),0,0]}),t.set(t.next(),{size:i,origin:[.5,.5],rotate:[Math.PI/2,0,0],translate:[0,-(i[1]/2),0]}),t.set(t.next(),{size:i,origin:[.5,.5],rotate:[Math.PI/2,0,0],translate:[0,i[1]/2,0]})}},{}],15:[function(t,e,i){console.warn&&console.warn("GridLayout has been deprecated and will be removed in the future, use CollectionLayout instead"),e.exports=t("./CollectionLayout")},{"./CollectionLayout":12}],16:[function(t,e,i){var n=t("../helpers/LayoutDockHelper");e.exports=function(t,e){var i=new n(t,e);i.top("header",e.headerSize||e.headerHeight),i.bottom("footer",e.footerSize||e.footerHeight),i.fill("content")}},{"../helpers/LayoutDockHelper":11}],17:[function(t,e,i){(function(i){function n(t,e){var i,n,o,s,u,l,h,p,f,d,v,y,_,g=t.size,m=t.direction,S=t.alignment,w=m?0:1,b=r.normalizeMargins(e.margins),O=e.spacing||0,T=e.isSectionCallback;for(a.size[0]=g[0],a.size[1]=g[1],a.size[w]-=b[1-w]+b[3-w],a.translate[0]=0,a.translate[1]=0,a.translate[2]=0,a.translate[w]=b[m?3:0],e.itemSize!==!0&&e.hasOwnProperty("itemSize")?e.itemSize instanceof Function?u=e.itemSize:s=void 0===e.itemSize?g[m]:e.itemSize:s=!0,c[0]=b[m?0:3],c[1]=-b[m?2:1],i=t.scrollOffset+c[S],_=t.scrollEnd+c[S];_>i;){if(v=n,n=t.next(),!n){v&&!S&&(a.scrollLength=o+c[0]+-c[1],t.set(v,a));break}o=u?u(n.renderNode):s,o=o===!0?t.resolveSize(n,g)[m]:o,a.size[m]=o,a.translate[m]=i+(S?O:0),a.scrollLength=o+O,t.set(n,a),i+=a.scrollLength,T&&T(n.renderNode)?(a.translate[m]=Math.max(c[0],a.translate[m]),t.set(n,a),d?void 0===y&&(y=i-o):(l=n,h=i-o,p=o,f=o)):!d&&i>=0&&(d=n)}for(n=void 0,i=t.scrollOffset+c[S],_=t.scrollStart+c[S];i>_;){if(v=n,n=t.prev(),!n){v&&S&&(a.scrollLength=o+c[0]+-c[1],t.set(v,a),l===v&&(f=a.scrollLength));break}o=u?u(n.renderNode):s,o=o===!0?t.resolveSize(n,g)[m]:o,a.scrollLength=o+O,i-=a.scrollLength,a.size[m]=o,a.translate[m]=i+(S?O:0),t.set(n,a),T&&T(n.renderNode)?(a.translate[m]=Math.max(c[0],a.translate[m]),t.set(n,a),l||(l=n,h=i,p=o,f=a.scrollLength)):i+o>=0&&(d=n,l&&(y=i+o),l=void 0)}if(T&&!l)for(n=t.prev();n;){if(T(n.renderNode)){l=n,o=e.itemSize||t.resolveSize(n,g)[m],h=i-o,p=o,f=void 0;break}n=t.prev()}if(l){var E=Math.max(c[0],h);void 0!==y&&p>y-c[0]&&(E=y-p),a.size[m]=p,a.translate[m]=E,a.scrollLength=f,t.set(l,a)}}var o="undefined"!=typeof window?window.famous.utilities.Utility:"undefined"!=typeof i?i.famous.utilities.Utility:null,r=t("../LayoutUtility"),s={sequence:!0,direction:[o.Direction.Y,o.Direction.X],scrolling:!0,trueSize:!0,sequentialScrollingOptimized:!0},a={size:[0,0],translate:[0,0,0],scrollLength:void 0},c=[0,0];n.Capabilities=s,n.Name="ListLayout",n.Description="List-layout with margins, spacing and sticky headers",e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../LayoutUtility":8}],18:[function(t,e,i){var n=t("../helpers/LayoutDockHelper");e.exports=function(t,e){var i=new n(t,{margins:e.margins,translateZ:1});t.set("background",{size:t.size});var o,r,s=t.get("rightItems");if(s)for(r=0;r<s.length;r++)o=t.get(s[r]),i.right(o,e.rightItemWidth||e.itemWidth),i.right(void 0,e.rightItemSpacer||e.itemSpacer);var a=t.get("leftItems");if(a)for(r=0;r<a.length;r++)o=t.get(a[r]),i.left(o,e.leftItemWidth||e.itemWidth),i.left(void 0,e.leftItemSpacer||e.itemSpacer);i.fill("title")}},{"../helpers/LayoutDockHelper":11}],19:[function(t,e,i){(function(t){function i(t,e){for(o=t.size,n=t.direction,r=e.ratios,s=0,c=0;c<r.length;c++)s+=r[c];for(p.size[0]=o[0],p.size[1]=o[1],p.translate[0]=0,p.translate[1]=0,u=t.next(),a=0,c=0;u&&c<r.length;)p.size[n]=(o[n]-a)/s*r[c],p.translate[n]=a,t.set(u,p),a+=p.size[n],s-=r[c],c++,u=t.next()}var n,o,r,s,a,c,u,l="undefined"!=typeof window?window.famous.utilities.Utility:"undefined"!=typeof t?t.famous.utilities.Utility:null,h={sequence:!0,direction:[l.Direction.Y,l.Direction.X],scrolling:!1},p={size:[0,0],translate:[0,0,0]};i.Capabilities=h,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(t,e,i){(function(i){function n(t,e){o=t.size,r=t.direction,s=r?0:1,l=e.spacing||0,a=t.get("items"),c=t.get("spacers"),u=v.normalizeMargins(e.margins),_.size[0]=t.size[0],_.size[1]=t.size[1],_.size[s]-=u[1-s]+u[3-s],_.translate[0]=0,_.translate[1]=0,_.translate[2]=.001,_.translate[s]=u[r?3:0],_.align[0]=0,_.align[1]=0,_.origin[0]=0,_.origin[1]=0,f=r?u[0]:u[3],h=o[r]-(f+(r?u[2]:u[1])),h-=(a.length-1)*l;for(var i=0;i<a.length;i++)p=void 0===e.itemSize?Math.round(h/(a.length-i)):e.itemSize===!0?t.resolveSize(a[i],o)[r]:e.itemSize,_.scrollLength=p,0===i&&(_.scrollLength+=r?u[0]:u[3]),i===a.length-1?_.scrollLength+=r?u[2]:u[1]:_.scrollLength+=l,_.size[r]=p,_.translate[r]=f,t.set(a[i],_),f+=p,h-=p,i===e.selectedItemIndex&&(_.scrollLength=0,_.translate[r]+=p/2,_.translate[2]=.002,_.origin[r]=.5,t.set("selectedItemOverlay",_),_.origin[r]=0,_.translate[2]=.001),i<a.length-1?(c&&i<c.length&&(_.size[r]=l,_.translate[r]=f,t.set(c[i],_)),f+=l):f+=r?u[2]:u[1];_.scrollLength=0,_.size[0]=o[0],_.size[1]=o[1],_.size[r]=o[r],_.translate[0]=0,_.translate[1]=0,_.translate[2]=0,_.translate[r]=0,t.set("background",_)}var o,r,s,a,c,u,l,h,p,f,d="undefined"!=typeof window?window.famous.utilities.Utility:"undefined"!=typeof i?i.famous.utilities.Utility:null,v=t("../LayoutUtility"),y={sequence:!0,direction:[d.Direction.X,d.Direction.Y],trueSize:!0},_={size:[0,0],translate:[0,0,0],align:[0,0],origin:[0,0]};n.Capabilities=y,n.Name="TabBarLayout",n.Description="TabBar widget layout",e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../LayoutUtility":8}],21:[function(t,e,i){(function(t){function i(t,e){for(n=t.size,o=t.direction,r=o?0:1,a=e.itemSize||n[o]/2,c=e.diameter||3*a,p=c/2,f=2*Math.atan2(a/2,p),d=void 0===e.radialOpacity?1:e.radialOpacity,_.opacity=1,_.size[0]=n[0],_.size[1]=n[1],_.size[r]=n[r],_.size[o]=a,_.translate[0]=0,_.translate[1]=0,_.translate[2]=0,_.rotate[0]=0,_.rotate[1]=0,_.rotate[2]=0,_.scrollLength=a,u=t.scrollOffset,l=Math.PI/2/f*a+a;l>=u&&(s=t.next());)u>=-l&&(h=u/a*f,_.translate[o]=p*Math.sin(h),_.translate[2]=p*Math.cos(h)-p,_.rotate[r]=o?-h:h,_.opacity=1-Math.abs(h)/(Math.PI/2)*(1-d),t.set(s,_)),u+=a;for(u=t.scrollOffset-a;u>=-l&&(s=t.prev());)l>=u&&(h=u/a*f,_.translate[o]=p*Math.sin(h),_.translate[2]=p*Math.cos(h)-p,_.rotate[r]=o?-h:h,_.opacity=1-Math.abs(h)/(Math.PI/2)*(1-d),t.set(s,_)),u-=a}var n,o,r,s,a,c,u,l,h,p,f,d,v="undefined"!=typeof window?window.famous.utilities.Utility:"undefined"!=typeof t?t.famous.utilities.Utility:null,y={sequence:!0,direction:[v.Direction.Y,v.Direction.X],scrolling:!0,trueSize:!0},_={opacity:1,size:[0,0],translate:[0,0,0],rotate:[0,0,0],origin:[.5,.5],align:[.5,.5],scrollLength:void 0};i.Capabilities=y,i.Name="WheelLayout",i.Description="Spinner-wheel/slot-machine layout",e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(t,e,i){(function(i){function n(t){v.apply(this,arguments),t=t||{},this._date=new Date(t.date?t.date.getTime():void 0),this._components=[],this.classes=t.classes?this.classes.concat(t.classes):this.classes,a.call(this),p.call(this),this._overlayRenderables={top:o.call(this,"top"),middle:o.call(this,"middle"),bottom:o.call(this,"bottom")},d.call(this),this.setOptions(this.options)}function o(t,e){var i=this.options.createRenderables[Array.isArray(t)?t[0]:t];if(i instanceof Function)return i.call(this,t,e);if(i){if(void 0!==e&&e instanceof Object)return e;var n=new y({classes:this.classes,content:e?"<div>"+e+"</div>":void 0});if(Array.isArray(t))for(var o=0;o<t.length;o++)n.addClass(t[o]);else n.addClass(t);return n}}function r(t){for(var e=0;e<this.scrollWheels.length;e++){var i=this.scrollWheels[e],n=i.component,o=i.scrollController.getFirstVisibleItem();if(o&&o.viewSequence){var r=o.viewSequence,s=o.viewSequence.get(),a=n.getComponent(s.date),c=n.getComponent(t),u=0;if(a!==c&&(u=c-a,n.loop)){var l=0>u?u+n.upperBound:u-n.upperBound;Math.abs(l)<Math.abs(u)&&(u=l)}if(u)for(;a!==c&&(r=u>0?r.getNext():r.getPrevious(),s=r?r.get():void 0);)a=n.getComponent(s.date),u>0?i.scrollController.goToNextPage():i.scrollController.goToPreviousPage();else i.scrollController.goToRenderNode(s)}}}function s(){for(var t=new Date(this._date),e=0;e<this.scrollWheels.length;e++){var i=this.scrollWheels[e],n=i.component,o=i.scrollController.getFirstVisibleItem();o&&o.renderNode&&n.setComponent(t,n.getComponent(o.renderNode.date))}return t}function a(){this.container=new g(this.options.container),this.container.setClasses(this.classes),this.layout=new m({layout:b,layoutOptions:{ratios:[]},direction:_.Direction.X}),this.container.add(this.layout),this.add(this.container)}function c(t,e){}function u(){this._scrollingCount++,1===this._scrollingCount&&this._eventOutput.emit("scrollstart",{target:this})}function l(){this._scrollingCount--,0===this._scrollingCount&&this._eventOutput.emit("scrollend",{target:this,date:this._date})}function h(){this._date=s.call(this),this._eventOutput.emit("datechange",{target:this,date:this._date})}function p(){this.scrollWheels=[],this._scrollingCount=0;for(var t=[],e=[],i=0;i<this._components.length;i++){var n=this._components[i];n.createRenderable=o.bind(this);var r=new O({factory:n,value:n.create(this._date)}),s=E.combineOptions(this.options.scrollController,{layout:w,layoutOptions:this.options.wheelLayout,flow:!1,direction:_.Direction.Y,dataSource:r,autoPipeEvents:!0}),a=new S(s);a.on("scrollstart",u.bind(this)),a.on("scrollend",l.bind(this)),a.on("pagechange",h.bind(this));var p={component:n,scrollController:a,viewSequence:r};this.scrollWheels.push(p),n.on("click",c.bind(this,p)),t.push(a),e.push(n.sizeRatio)}this.layout.setDataSource(t),this.layout.setLayoutOptions({ratios:e})}function f(t,e){var i=(t.size[1]-e.itemSize)/2;t.set("top",{size:[t.size[0],i],translate:[0,0,1]}),t.set("middle",{size:[t.size[0],t.size[1]-2*i],translate:[0,i,1]}),t.set("bottom",{size:[t.size[0],i],translate:[0,t.size[1]-i,1]})}function d(){this.overlay=new m({layout:f,layoutOptions:{itemSize:this.options.wheelLayout.itemSize},dataSource:this._overlayRenderables}),this.add(this.overlay)}var v="undefined"!=typeof window?window.famous.core.View:"undefined"!=typeof i?i.famous.core.View:null,y="undefined"!=typeof window?window.famous.core.Surface:"undefined"!=typeof i?i.famous.core.Surface:null,_="undefined"!=typeof window?window.famous.utilities.Utility:"undefined"!=typeof i?i.famous.utilities.Utility:null,g="undefined"!=typeof window?window.famous.surfaces.ContainerSurface:"undefined"!=typeof i?i.famous.surfaces.ContainerSurface:null,m=t("../LayoutController"),S=t("../ScrollController"),w=t("../layouts/WheelLayout"),b=t("../layouts/ProportionalLayout"),O=t("../VirtualViewSequence"),T=t("./DatePickerComponents"),E=t("../LayoutUtility");n.prototype=Object.create(v.prototype),n.prototype.constructor=n,n.prototype.classes=["ff-widget","ff-datepicker"],n.Component=T,n.DEFAULT_OPTIONS={perspective:500,wheelLayout:{itemSize:100,diameter:500},createRenderables:{item:!0,top:!1,middle:!1,bottom:!1},scrollController:{enabled:!0,paginated:!0,paginationMode:S.PaginationMode.SCROLL,mouseMove:!0,scrollSpring:{dampingRatio:1,period:800}}},n.prototype.setOptions=function(t){if(v.prototype.setOptions.call(this,t),!this.layout)return this;void 0!==t.perspective&&this.container.context.setPerspective(t.perspective);var e;if(void 0!==t.wheelLayout){for(e=0;e<this.scrollWheels.length;e++)this.scrollWheels[e].scrollController.setLayoutOptions(t.wheelLayout);this.overlay.setLayoutOptions({itemSize:this.options.wheelLayout.itemSize})}if(void 0!==t.scrollController)for(e=0;e<this.scrollWheels.length;e++)this.scrollWheels[e].scrollController.setOptions(t.scrollController);return this},n.prototype.setComponents=function(t){return this._components=t,p.call(this),this},n.prototype.getComponents=function(){return this._components},n.prototype.setDate=function(t){return this._date.setTime(t.getTime()),r.call(this,this._date),this},n.prototype.getDate=function(){return this._date},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../LayoutController":5,"../LayoutUtility":8,"../ScrollController":9,"../VirtualViewSequence":10,"../layouts/ProportionalLayout":19,"../layouts/WheelLayout":21,"./DatePickerComponents":23}],23:[function(t,e,i){(function(t){function i(t){return""+t[this.get]()}function n(t){return("0"+t[this.get]()).slice(-2)}function o(t){return("00"+t[this.get]()).slice(-3)}function r(t){return("000"+t[this.get]()).slice(-4)}function s(t){if(this._eventOutput=new _,this._pool=[],_.setOutputHandler(this,this._eventOutput),t)for(var e in t)this[e]=t[e]}function a(){s.apply(this,arguments)}function c(){s.apply(this,arguments)}function u(){s.apply(this,arguments)}function l(){s.apply(this,arguments)}function h(){s.apply(this,arguments)}function p(){s.apply(this,arguments)}function f(){s.apply(this,arguments)}function d(){s.apply(this,arguments)}function v(){s.apply(this,arguments)}var y="undefined"!=typeof window?window.famous.core.Surface:"undefined"!=typeof t?t.famous.core.Surface:null,_="undefined"!=typeof window?window.famous.core.EventHandler:"undefined"!=typeof t?t.famous.core.EventHandler:null;s.prototype.step=1,s.prototype.classes=["item"],s.prototype.getComponent=function(t){return t[this.get]()},s.prototype.setComponent=function(t,e){return t[this.set](e)},s.prototype.format=function(t){return"overide to implement"},s.prototype.createNext=function(t){var e=this.getNext(t.date);return e?this.create(e):void 0},s.prototype.getNext=function(t){t=new Date(t.getTime());var e=this.getComponent(t)+this.step;if(void 0!==this.upperBound&&e>=this.upperBound){if(!this.loop)return;e=Math.max(e%this.upperBound,this.lowerBound||0)}return this.setComponent(t,e),t},s.prototype.createPrevious=function(t){var e=this.getPrevious(t.date);return e?this.create(e):void 0},s.prototype.getPrevious=function(t){t=new Date(t.getTime());var e=this.getComponent(t)-this.step;if(void 0!==this.lowerBound&&e<this.lowerBound){if(!this.loop)return;e%=this.upperBound}return this.setComponent(t,e),t},s.prototype.installClickHandler=function(t){t.on("click",function(e){this._eventOutput.emit("click",{target:t,event:e})}.bind(this))},s.prototype.createRenderable=function(t,e){return new y({classes:t,content:"<div>"+e+"</div>"})},s.prototype.create=function(t){t=t||new Date;var e;return this._pool.length?(e=this._pool[0],this._pool.splice(0,1),e.setContent(this.format(t))):(e=this.createRenderable(this.classes,this.format(t)),this.installClickHandler(e)),e.date=t,e},s.prototype.destroy=function(t){this._pool.push(t)},a.prototype=Object.create(s.prototype),a.prototype.constructor=a,a.prototype.classes=["item","year"],a.prototype.format=r,a.prototype.sizeRatio=1,a.prototype.step=1,a.prototype.loop=!1,a.prototype.set="setFullYear",a.prototype.get="getFullYear",c.prototype=Object.create(s.prototype),c.prototype.constructor=c,c.prototype.classes=["item","month"],c.prototype.sizeRatio=2,c.prototype.lowerBound=0,c.prototype.upperBound=12,c.prototype.step=1,c.prototype.loop=!0,c.prototype.set="setMonth",c.prototype.get="getMonth",c.prototype.strings=["January","February","March","April","May","June","July","August","September","October","November","December"],c.prototype.format=function(t){return this.strings[t.getMonth()]},u.prototype=Object.create(s.prototype),u.prototype.constructor=u,u.prototype.classes=["item","fullday"],u.prototype.sizeRatio=2,u.prototype.step=1,u.prototype.set="setDate",u.prototype.get="getDate",u.prototype.format=function(t){return t.toLocaleDateString()},l.prototype=Object.create(s.prototype),l.prototype.constructor=l,l.prototype.classes=["item","weekday"],l.prototype.sizeRatio=2,l.prototype.lowerBound=0,l.prototype.upperBound=7,l.prototype.step=1,l.prototype.loop=!0,l.prototype.set="setDate",l.prototype.get="getDate",l.prototype.strings=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l.prototype.format=function(t){return this.strings[t.getDay()]},h.prototype=Object.create(s.prototype),h.prototype.constructor=h,h.prototype.classes=["item","day"],h.prototype.format=i,h.prototype.sizeRatio=1,h.prototype.lowerBound=1,h.prototype.upperBound=32,h.prototype.step=1,h.prototype.loop=!0,h.prototype.set="setDate",h.prototype.get="getDate",p.prototype=Object.create(s.prototype),p.prototype.constructor=p,p.prototype.classes=["item","hour"],p.prototype.format=n,p.prototype.sizeRatio=1,p.prototype.lowerBound=0,p.prototype.upperBound=24,p.prototype.step=1,p.prototype.loop=!0,p.prototype.set="setHours",p.prototype.get="getHours",f.prototype=Object.create(s.prototype),f.prototype.constructor=f,f.prototype.classes=["item","minute"],f.prototype.format=n,f.prototype.sizeRatio=1,f.prototype.lowerBound=0,f.prototype.upperBound=60,f.prototype.step=1,f.prototype.loop=!0,f.prototype.set="setMinutes",f.prototype.get="getMinutes",d.prototype=Object.create(s.prototype),d.prototype.constructor=d,d.prototype.classes=["item","second"],d.prototype.format=n,d.prototype.sizeRatio=1,d.prototype.lowerBound=0,d.prototype.upperBound=60,d.prototype.step=1,d.prototype.loop=!0,d.prototype.set="setSeconds",d.prototype.get="getSeconds",v.prototype=Object.create(s.prototype),v.prototype.constructor=v,v.prototype.classes=["item","millisecond"],v.prototype.format=o,v.prototype.sizeRatio=1,v.prototype.lowerBound=0,v.prototype.upperBound=1e3,v.prototype.step=1,v.prototype.loop=!0,v.prototype.set="setMilliseconds",v.prototype.get="getMilliseconds",e.exports={Base:s,Year:a,Month:c,FullDay:u,WeekDay:l,Day:h,Hour:p,Minute:f,Second:d,Millisecond:v}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],24:[function(t,e,i){(function(i){function n(t){a.apply(this,arguments),this._selectedItemIndex=-1,t=t||{},this.classes=t.classes?this.classes.concat(t.classes):this.classes,this.layout=new c(this.options.layoutController),this.add(this.layout),this.layout.pipe(this._eventOutput),this._renderables={items:[],spacers:[],background:r.call(this,"background"),selectedItemOverlay:r.call(this,"selectedItemOverlay")},this.setOptions(this.options)}function o(t){if(t!==this._selectedItemIndex){var e=this._selectedItemIndex;this._selectedItemIndex=t,this.layout.setLayoutOptions({selectedItemIndex:t}),e>=0&&this._renderables.items[e].removeClass&&this._renderables.items[e].removeClass("selected"),this._renderables.items[t].addClass&&this._renderables.items[t].addClass("selected"),e>=0&&this._eventOutput.emit("tabchange",{target:this,index:t,oldIndex:e,item:this._renderables.items[t]})}}function r(t,e){var i=this.options.createRenderables[t];if(i instanceof Function)return i.call(this,t,e);if(i){if(void 0!==e&&e instanceof Object)return e;var n=new s({classes:this.classes,content:e?"<div>"+e+"</div>":void 0});return n.addClass(t),"item"===t&&this.options.tabBarLayout&&this.options.tabBarLayout.itemSize&&this.options.tabBarLayout.itemSize===!0&&n.setSize(this.layout.getDirection()?[void 0,!0]:[!0,void 0]),n}}var s="undefined"!=typeof window?window.famous.core.Surface:"undefined"!=typeof i?i.famous.core.Surface:null,a="undefined"!=typeof window?window.famous.core.View:"undefined"!=typeof i?i.famous.core.View:null,c=t("../LayoutController"),u=t("../layouts/TabBarLayout");
n.prototype=Object.create(a.prototype),n.prototype.constructor=n,n.prototype.classes=["ff-widget","ff-tabbar"],n.DEFAULT_OPTIONS={tabBarLayout:{margins:[0,0,0,0],spacing:0},createRenderables:{item:!0,background:!1,selectedItemOverlay:!1,spacer:!1},layoutController:{autoPipeEvents:!0,layout:u,flow:!0,reflowOnResize:!1,nodeSpring:{dampingRatio:.8,period:300}}},n.prototype.setOptions=function(t){return a.prototype.setOptions.call(this,t),this.layout?(void 0!==t.tabBarLayout&&this.layout.setLayoutOptions(t.tabBarLayout),t.layoutController&&this.layout.setOptions(t.layoutController),this):this},n.prototype.setItems=function(t){var e=this._selectedItemIndex;if(this._selectedItemIndex=-1,this._renderables.items=[],this._renderables.spacers=[],t)for(var i=0;i<t.length;i++){var n=r.call(this,"item",t[i]);if(n.on&&n.on("click",o.bind(this,i)),this._renderables.items.push(n),i<t.length-1){var s=r.call(this,"spacer"," ");s&&this._renderables.spacers.push(s)}}return this.layout.setDataSource(this._renderables),this._renderables.items.length&&o.call(this,Math.max(Math.min(e,this._renderables.items.length-1),0)),this},n.prototype.getItems=function(){return this._renderables.items},n.prototype.getItemSpec=function(t,e){return this.layout.getSpec(this._renderables.items[t],e)},n.prototype.setSelectedItemIndex=function(t){return o.call(this,t),this},n.prototype.getSelectedItemIndex=function(){return this._selectedItemIndex},n.prototype.getSize=function(){return this.options.size||(this.layout?this.layout.getSize():a.prototype.getSize.call(this))},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../LayoutController":5,"../layouts/TabBarLayout":20}]},{},[1]),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.PouchDB=t()}}(function(){var t;return function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[s]={exports:{}};t[s][0].call(l.exports,function(e){var i=t[s][1][e];return o(i?i:e)},l,l.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){"use strict";function n(t){return function(){var e=arguments.length;if(e){for(var i=[],n=-1;++n<e;)i[n]=arguments[n];return t.call(this,i)}return t.call(this,[])}}e.exports=n},{}],2:[function(t,e,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(t){return"function"==typeof t}function r(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!r(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,i,n,r,c,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[t],a(i))return!1;if(o(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),i.apply(this,r)}else if(s(i))for(r=Array.prototype.slice.call(arguments,1),u=i.slice(),n=u.length,c=0;n>c;c++)u[c].apply(this,r);return!0},n.prototype.addListener=function(t,e){var i;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(i=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}if(!o(e))throw TypeError("listener must be a function");var n=!1;return i.listener=e,this.on(t,i),this},n.prototype.removeListener=function(t,e){var i,n,r,a;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],r=i.length,n=-1,i===e||o(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(i)){for(a=r;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){n=a;break}if(0>n)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],o(i))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},{}],3:[function(t,e,i){function n(){l=!1,a.length?u=a.concat(u):h=-1,u.length&&o()}function o(){if(!l){var t=setTimeout(n);l=!0;for(var e=u.length;e;){for(a=u,u=[];++h<e;)a&&a[h].run();h=-1,e=u.length}a=null,l=!1,clearTimeout(t)}}function r(t,e){this.fun=t,this.array=e}function s(){}var a,c=e.exports={},u=[],l=!1,h=-1;c.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new r(t,e)),1!==u.length||l||setTimeout(o,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=s,c.addListener=s,c.once=s,c.off=s,c.removeListener=s,c.removeAllListeners=s,c.emit=s,c.binding=function(t){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(t){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],4:[function(t,e,i){function n(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var t=arguments,e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+i.humanize(this.diff),!e)return t;var n="color: "+this.color;t=[t[0],n,"color: inherit"].concat(Array.prototype.slice.call(t,1));var o=0,r=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(r=o))}),t.splice(r,0,n),t}function r(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(t){try{null==t?i.storage.removeItem("debug"):i.storage.debug=t}catch(e){}}function a(){var t;try{t=i.storage.debug}catch(e){}return t}function c(){try{return window.localStorage}catch(t){}}i=e.exports=t(5),i.log=r,i.formatArgs=o,i.save=s,i.load=a,i.useColors=n,i.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),i.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],i.formatters.j=function(t){return JSON.stringify(t)},i.enable(a())},{5:5}],5:[function(t,e,i){function n(){return i.colors[l++%i.colors.length]}function o(t){function e(){}function o(){var t=o,e=+new Date,r=e-(u||e);t.diff=r,t.prev=u,t.curr=e,u=e,null==t.useColors&&(t.useColors=i.useColors()),null==t.color&&t.useColors&&(t.color=n());var s=Array.prototype.slice.call(arguments);s[0]=i.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(e,n){if("%%"===e)return e;a++;var o=i.formatters[n];if("function"==typeof o){var r=s[a];e=o.call(t,r),s.splice(a,1),a--}return e}),"function"==typeof i.formatArgs&&(s=i.formatArgs.apply(t,s));var c=o.log||i.log||console.log.bind(console);c.apply(t,s)}e.enabled=!1,o.enabled=!0;var r=i.enabled(t)?o:e;return r.namespace=t,r}function r(t){i.save(t);for(var e=(t||"").split(/[\s,]+/),n=e.length,o=0;n>o;o++)e[o]&&(t=e[o].replace(/\*/g,".*?"),"-"===t[0]?i.skips.push(new RegExp("^"+t.substr(1)+"$")):i.names.push(new RegExp("^"+t+"$")))}function s(){i.enable("")}function a(t){var e,n;for(e=0,n=i.skips.length;n>e;e++)if(i.skips[e].test(t))return!1;for(e=0,n=i.names.length;n>e;e++)if(i.names[e].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}i=e.exports=o,i.coerce=c,i.disable=s,i.enable=r,i.enabled=a,i.humanize=t(6),i.names=[],i.skips=[],i.formatters={};var u,l=0},{6:6}],6:[function(t,e,i){function n(t){if(t=""+t,!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var i=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return i*h;case"days":case"day":case"d":return i*l;case"hours":case"hour":case"hrs":case"hr":case"h":return i*u;case"minutes":case"minute":case"mins":case"min":case"m":return i*c;case"seconds":case"second":case"secs":case"sec":case"s":return i*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i}}}}function o(t){return t>=l?Math.round(t/l)+"d":t>=u?Math.round(t/u)+"h":t>=c?Math.round(t/c)+"m":t>=a?Math.round(t/a)+"s":t+"ms"}function r(t){return s(t,l,"day")||s(t,u,"hour")||s(t,c,"minute")||s(t,a,"second")||t+" ms"}function s(t,e,i){return e>t?void 0:1.5*e>t?Math.floor(t/e)+" "+i:Math.ceil(t/e)+" "+i+"s"}var a=1e3,c=60*a,u=60*c,l=24*u,h=365.25*l;e.exports=function(t,e){return e=e||{},"string"==typeof t?n(t):e["long"]?r(t):o(t)}},{}],7:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],8:[function(t,e,i){(function(t){t("object"==typeof i?i:this)}).call(this,function(t){var e=Array.prototype.slice,i=Array.prototype.forEach,n=function(t){if("object"!=typeof t)throw t+" is not an object";var o=e.call(arguments,1);return i.call(o,function(e){if(e)for(var i in e)"object"==typeof e[i]&&t[i]?n.call(t,t[i],e[i]):t[i]=e[i]}),t};t.extend=n})},{}],9:[function(t,e,i){"use strict";function n(){}function o(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,t!==n&&c(this,t)}function r(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function s(t,e,i){d(function(){var n;try{n=e(i)}catch(o){return v.reject(t,o)}n===t?v.reject(t,new TypeError("Cannot resolve promise with itself")):v.resolve(t,n)})}function a(t){var e=t&&t.then;return t&&"object"==typeof t&&"function"==typeof e?function(){e.apply(t,arguments)}:void 0}function c(t,e){function i(e){r||(r=!0,v.reject(t,e))}function n(e){r||(r=!0,v.resolve(t,e))}function o(){e(n,i)}var r=!1,s=u(o);"error"===s.status&&i(s.value)}function u(t,e){var i={};try{i.value=t(e),i.status="success"}catch(n){i.status="error",i.value=n}return i}function l(t){return t instanceof this?t:v.resolve(new this(n),t)}function h(t){var e=new this(n);return v.reject(e,t)}function p(t){function e(t,e){function n(t){s[e]=t,++a!==o||r||(r=!0,v.resolve(u,s))}i.resolve(t).then(n,function(t){r||(r=!0,v.reject(u,t))})}var i=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,r=!1;if(!o)return this.resolve([]);for(var s=new Array(o),a=0,c=-1,u=new this(n);++c<o;)e(t[c],c);return u}function f(t){function e(t){i.resolve(t).then(function(t){r||(r=!0,v.resolve(a,t))},function(t){r||(r=!0,v.reject(a,t))})}var i=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var o=t.length,r=!1;if(!o)return this.resolve([]);for(var s=-1,a=new this(n);++s<o;)e(t[s]);return a}var d=t(10),v={},y=["REJECTED"],_=["FULFILLED"],g=["PENDING"];e.exports=o,o.prototype["catch"]=function(t){return this.then(null,t)},o.prototype.then=function(t,e){if("function"!=typeof t&&this.state===_||"function"!=typeof e&&this.state===y)return this;var i=new this.constructor(n);if(this.state!==g){var o=this.state===_?t:e;s(i,o,this.outcome)}else this.queue.push(new r(i,t,e));return i},r.prototype.callFulfilled=function(t){v.resolve(this.promise,t)},r.prototype.otherCallFulfilled=function(t){s(this.promise,this.onFulfilled,t)},r.prototype.callRejected=function(t){v.reject(this.promise,t)},r.prototype.otherCallRejected=function(t){s(this.promise,this.onRejected,t)},v.resolve=function(t,e){var i=u(a,e);if("error"===i.status)return v.reject(t,i.value);var n=i.value;if(n)c(t,n);else{t.state=_,t.outcome=e;for(var o=-1,r=t.queue.length;++o<r;)t.queue[o].callFulfilled(e)}return t},v.reject=function(t,e){t.state=y,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},o.resolve=l,o.reject=h,o.all=p,o.race=f},{10:10}],10:[function(t,e,i){(function(t){"use strict";function i(){l=!0;for(var t,e,i=h.length;i;){for(e=h,h=[],t=-1;++t<i;)e[t]();i=h.length}l=!1}function n(t){1!==h.push(t)||l||o()}var o,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var s=0,a=new r(i),c=t.document.createTextNode("");a.observe(c,{characterData:!0}),o=function(){c.data=s=++s%2}}else if(t.setImmediate||"undefined"==typeof t.MessageChannel)o="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){i(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(i,0)};else{var u=new t.MessageChannel;u.port1.onmessage=i,o=function(){u.port2.postMessage(0)}}var l,h=[];e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(t,e,i){"use strict";function n(t){if(null!==t)switch(typeof t){case"boolean":return t?1:0;case"number":return l(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),o=-1,r=n.length,s="";if(e)for(;++o<r;)s+=i.toIndexableString(n[o]);else for(;++o<r;){var a=n[o];s+=i.toIndexableString(a)+i.toIndexableString(t[a])}return s}return""}function o(t,e){var i,n=e,o="1"===t[e];if(o)i=0,e++;else{var r="0"===t[e];e++;var s="",a=t.substring(e,e+p),c=parseInt(a,10)+h;for(r&&(c=-c),e+=p;;){var u=t[e];if("\x00"===u)break;s+=u,e++}s=s.split("."),i=1===s.length?parseInt(s,10):parseFloat(s[0]+"."+s[1]),r&&(i-=10),0!==c&&(i=parseFloat(i+"e"+c))}return{num:i,length:e-n}}function r(t,e){var i=t.pop();if(e.length){var n=e[e.length-1];i===n.element&&(e.pop(),n=e[e.length-1]);var o=n.element,r=n.index;if(Array.isArray(o))o.push(i);else if(r===t.length-2){var s=t.pop();o[s]=i}else t.push(i)}}function s(t,e){for(var n=Math.min(t.length,e.length),o=0;n>o;o++){var r=i.collate(t[o],e[o]);if(0!==r)return r}return t.length===e.length?0:t.length>e.length?1:-1}function a(t,e){return t===e?0:t>e?1:-1}function c(t,e){for(var n=Object.keys(t),o=Object.keys(e),r=Math.min(n.length,o.length),s=0;r>s;s++){var a=i.collate(n[s],o[s]);if(0!==a)return a;if(a=i.collate(t[n[s]],e[o[s]]),0!==a)return a}return n.length===o.length?0:n.length>o.length?1:-1}function u(t){var e=["boolean","number","string","object"],i=e.indexOf(typeof t);return~i?null===t?1:Array.isArray(t)?5:3>i?i+2:i+3:Array.isArray(t)?5:void 0}function l(t){if(0===t)return"1";var e=t.toExponential().split(/e\+?/),i=parseInt(e[1],10),n=0>t,o=n?"0":"2",r=(n?-i:i)-h,s=d.padLeft(r.toString(),"0",p);o+=f+s;var a=Math.abs(parseFloat(e[0]));n&&(a=10-a);var c=a.toFixed(20);return c=c.replace(/\.?0+$/,""),o+=f+c}var h=-324,p=3,f="",d=t(12);i.collate=function(t,e){if(t===e)return 0;t=i.normalizeKey(t),e=i.normalizeKey(e);var n=u(t),o=u(e);if(n-o!==0)return n-o;if(null===t)return 0;switch(typeof t){case"number":return t-e;case"boolean":return t===e?0:e>t?-1:1;case"string":return a(t,e)}return Array.isArray(t)?s(t,e):c(t,e)},i.normalizeKey=function(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-(1/0)||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var o=0;n>o;o++)t[o]=i.normalizeKey(e[o])}else{if(t instanceof Date)return t.toJSON();if(null!==t){t={};for(var r in e)if(e.hasOwnProperty(r)){var s=e[r];"undefined"!=typeof s&&(t[r]=i.normalizeKey(s))}}}}return t},i.toIndexableString=function(t){var e="\x00";return t=i.normalizeKey(t),u(t)+f+n(t)+e},i.parseIndexableString=function(t){for(var e=[],i=[],n=0;;){var s=t[n++];if("\x00"!==s)switch(s){case"1":e.push(null);break;case"2":e.push("1"===t[n]),n++;break;case"3":var a=o(t,n);e.push(a.num),n+=a.length;break;case"4":for(var c="";;){var u=t[n];if("\x00"===u)break;c+=u,n++}c=c.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(c);break;case"5":var l={element:[],index:e.length};e.push(l.element),i.push(l);break;case"6":var h={element:{},index:e.length};e.push(h.element),i.push(h);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+s)}else{if(1===e.length)return e.pop();r(e,i)}}}},{12:12}],12:[function(t,e,i){"use strict";function n(t,e,i){for(var n="",o=i-t.length;n.length<o;)n+=e;return n}i.padLeft=function(t,e,i){var o=n(t,e,i);return o+t},i.padRight=function(t,e,i){var o=n(t,e,i);return t+o},i.stringLexCompare=function(t,e){var i,n=t.length,o=e.length;for(i=0;n>i;i++){if(i===o)return 1;var r=t.charAt(i),s=e.charAt(i);if(r!==s)return s>r?-1:1}return o>n?-1:0},i.intToDecimalForm=function(t){var e=0>t,i="";do{var n=e?-Math.ceil(t%10):Math.floor(t%10);i=n+i,t=e?Math.ceil(t/10):Math.floor(t/10)}while(t);return e&&"0"!==i&&(i="-"+i),i}},{}],13:[function(t,e,i){"use strict";function n(){this.store={}}function o(t){if(this.store=new n,t&&Array.isArray(t))for(var e=0,i=t.length;i>e;e++)this.add(t[e])}i.Map=n,i.Set=o,n.prototype.mangle=function(t){if("string"!=typeof t)throw new TypeError("key must be a string but Got "+t);return"$"+t},n.prototype.unmangle=function(t){return t.substring(1)},n.prototype.get=function(t){var e=this.mangle(t);return e in this.store?this.store[e]:void 0},n.prototype.set=function(t,e){var i=this.mangle(t);return this.store[i]=e,!0},n.prototype.has=function(t){var e=this.mangle(t);return e in this.store},n.prototype["delete"]=function(t){var e=this.mangle(t);return e in this.store?(delete this.store[e],!0):!1},n.prototype.forEach=function(t){for(var e=Object.keys(this.store),i=0,n=e.length;n>i;i++){var o=e[i],r=this.store[o];o=this.unmangle(o),t(r,o)}},o.prototype.add=function(t){return this.store.set(t,!0)},o.prototype.has=function(t){return this.store.has(t)},o.prototype["delete"]=function(t){return this.store["delete"](t)}},{}],14:[function(t,e,i){(function(){var t={}.hasOwnProperty,i=[].slice;e.exports=function(e,n){var o,r,s,a;r=[],a=[];for(o in n)t.call(n,o)&&(s=n[o],"this"!==o&&(r.push(o),a.push(s)));return Function.apply(null,i.call(r).concat([e])).apply(n["this"],a)}}).call(this)},{}],15:[function(e,i,n){!function(e){if("object"==typeof n)i.exports=e();else if("function"==typeof t&&t.amd)t(e);else{var o;try{o=window}catch(r){o=self}o.SparkMD5=e()}}(function(t){"use strict";function e(t,e,i,n,o,r){return e=m(m(e,t),m(n,r)),m(e<<o|e>>>32-o,i)}function i(t,i,n,o,r,s,a){return e(i&n|~i&o,t,i,r,s,a)}function n(t,i,n,o,r,s,a){return e(i&o|n&~o,t,i,r,s,a)}function o(t,i,n,o,r,s,a){return e(i^n^o,t,i,r,s,a)}function r(t,i,n,o,r,s,a){return e(n^(i|~o),t,i,r,s,a)}function s(t,e){var s=t[0],a=t[1],c=t[2],u=t[3];s=i(s,a,c,u,e[0],7,-680876936),u=i(u,s,a,c,e[1],12,-389564586),c=i(c,u,s,a,e[2],17,606105819),a=i(a,c,u,s,e[3],22,-1044525330),s=i(s,a,c,u,e[4],7,-176418897),u=i(u,s,a,c,e[5],12,1200080426),c=i(c,u,s,a,e[6],17,-1473231341),a=i(a,c,u,s,e[7],22,-45705983),s=i(s,a,c,u,e[8],7,1770035416),u=i(u,s,a,c,e[9],12,-1958414417),c=i(c,u,s,a,e[10],17,-42063),a=i(a,c,u,s,e[11],22,-1990404162),s=i(s,a,c,u,e[12],7,1804603682),u=i(u,s,a,c,e[13],12,-40341101),c=i(c,u,s,a,e[14],17,-1502002290),a=i(a,c,u,s,e[15],22,1236535329),s=n(s,a,c,u,e[1],5,-165796510),u=n(u,s,a,c,e[6],9,-1069501632),c=n(c,u,s,a,e[11],14,643717713),a=n(a,c,u,s,e[0],20,-373897302),s=n(s,a,c,u,e[5],5,-701558691),u=n(u,s,a,c,e[10],9,38016083),c=n(c,u,s,a,e[15],14,-660478335),a=n(a,c,u,s,e[4],20,-405537848),s=n(s,a,c,u,e[9],5,568446438),u=n(u,s,a,c,e[14],9,-1019803690),c=n(c,u,s,a,e[3],14,-187363961),a=n(a,c,u,s,e[8],20,1163531501),s=n(s,a,c,u,e[13],5,-1444681467),u=n(u,s,a,c,e[2],9,-51403784),c=n(c,u,s,a,e[7],14,1735328473),a=n(a,c,u,s,e[12],20,-1926607734),s=o(s,a,c,u,e[5],4,-378558),u=o(u,s,a,c,e[8],11,-2022574463),c=o(c,u,s,a,e[11],16,1839030562),a=o(a,c,u,s,e[14],23,-35309556),s=o(s,a,c,u,e[1],4,-1530992060),u=o(u,s,a,c,e[4],11,1272893353),c=o(c,u,s,a,e[7],16,-155497632),a=o(a,c,u,s,e[10],23,-1094730640),s=o(s,a,c,u,e[13],4,681279174),u=o(u,s,a,c,e[0],11,-358537222),c=o(c,u,s,a,e[3],16,-722521979),a=o(a,c,u,s,e[6],23,76029189),s=o(s,a,c,u,e[9],4,-640364487),u=o(u,s,a,c,e[12],11,-421815835),c=o(c,u,s,a,e[15],16,530742520),a=o(a,c,u,s,e[2],23,-995338651),s=r(s,a,c,u,e[0],6,-198630844),u=r(u,s,a,c,e[7],10,1126891415),c=r(c,u,s,a,e[14],15,-1416354905),a=r(a,c,u,s,e[5],21,-57434055),s=r(s,a,c,u,e[12],6,1700485571),u=r(u,s,a,c,e[3],10,-1894986606),c=r(c,u,s,a,e[10],15,-1051523),a=r(a,c,u,s,e[1],21,-2054922799),s=r(s,a,c,u,e[8],6,1873313359),u=r(u,s,a,c,e[15],10,-30611744),c=r(c,u,s,a,e[6],15,-1560198380),a=r(a,c,u,s,e[13],21,1309151649),s=r(s,a,c,u,e[4],6,-145523070),u=r(u,s,a,c,e[11],10,-1120210379),c=r(c,u,s,a,e[2],15,718787259),a=r(a,c,u,s,e[9],21,-343485551),t[0]=m(s,t[0]),t[1]=m(a,t[1]),t[2]=m(c,t[2]),t[3]=m(u,t[3])}function a(t){var e,i=[];for(e=0;64>e;e+=4)i[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return i}function c(t){var e,i=[];for(e=0;64>e;e+=4)i[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return i}function u(t){var e,i,n,o,r,c,u=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(e=64;u>=e;e+=64)s(l,a(t.substring(e-64,e)));for(t=t.substring(e-64),i=t.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;i>e;e+=1)n[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(s(l,n),e=0;16>e;e+=1)n[e]=0;return o=8*u,o=o.toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(o[2],16),c=parseInt(o[1],16)||0,n[14]=r,n[15]=c,s(l,n),l}function l(t){var e,i,n,o,r,a,u=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(e=64;u>=e;e+=64)s(l,c(t.subarray(e-64,e)));for(t=u>e-64?t.subarray(e-64):new Uint8Array(0),i=t.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;i>e;e+=1)n[e>>2]|=t[e]<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(s(l,n),e=0;16>e;e+=1)n[e]=0;return o=8*u,o=o.toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(o[2],16),a=parseInt(o[1],16)||0,n[14]=r,n[15]=a,s(l,n),l}function h(t){var e,i="";for(e=0;4>e;e+=1)i+=S[t>>8*e+4&15]+S[t>>8*e&15];return i}function p(t){var e;for(e=0;e<t.length;e+=1)t[e]=h(t[e]);return t.join("")}function f(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function d(t,e){var i,n=t.length,o=new ArrayBuffer(n),r=new Uint8Array(o);for(i=0;n>i;i+=1)r[i]=t.charCodeAt(i);return e?r:o}function v(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function y(t,e,i){var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t)),n.set(new Uint8Array(e),t.byteLength),i?n:n.buffer}function _(t){var e,i=[],n=t.length;for(e=0;n-1>e;e+=2)i.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,i)}function g(){this.reset()}var m=function(t,e){return t+e&4294967295},S=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==p(u("hello"))&&(m=function(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function e(t,e){return t=0|t||0,0>t?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(i,n){var o,r,s,a,c=this.byteLength,u=e(i,c),l=c;return n!==t&&(l=e(n,c)),u>l?new ArrayBuffer(0):(o=l-u,r=new ArrayBuffer(o),s=new Uint8Array(r),a=new Uint8Array(this,u,o),s.set(a),r)}}(),g.prototype.append=function(t){return this.appendBinary(f(t)),this},g.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,i=this._buff.length;for(e=64;i>=e;e+=64)s(this._hash,a(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},g.prototype.end=function(t){var e,i,n=this._buff,o=n.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;o>e;e+=1)r[e>>2]|=n.charCodeAt(e)<<(e%4<<3);return this._finish(r,o),i=p(this._hash),t&&(i=_(i)),this.reset(),i},g.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},g.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},g.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},g.prototype._finish=function(t,e){var i,n,o,r=e;if(t[r>>2]|=128<<(r%4<<3),r>55)for(s(this._hash,t),r=0;16>r;r+=1)t[r]=0;i=8*this._length,i=i.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),o=parseInt(i[1],16)||0,t[14]=n,t[15]=o,s(this._hash,t)},g.hash=function(t,e){return g.hashBinary(f(t),e)},g.hashBinary=function(t,e){var i=u(t),n=p(i);return e?_(n):n},g.ArrayBuffer=function(){this.reset()},g.ArrayBuffer.prototype.append=function(t){var e,i=y(this._buff.buffer,t,!0),n=i.length;for(this._length+=t.byteLength,e=64;n>=e;e+=64)s(this._hash,c(i.subarray(e-64,e)));return this._buff=n>e-64?new Uint8Array(i.buffer.slice(e-64)):new Uint8Array(0),this},g.ArrayBuffer.prototype.end=function(t){var e,i,n=this._buff,o=n.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;o>e;e+=1)r[e>>2]|=n[e]<<(e%4<<3);return this._finish(r,o),i=p(this._hash),t&&(i=_(i)),this.reset(),i},g.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.ArrayBuffer.prototype.getState=function(){var t=g.prototype.getState.call(this);return t.buff=v(t.buff),t},g.ArrayBuffer.prototype.setState=function(t){return t.buff=d(t.buff,!0),g.prototype.setState.call(this,t)},g.ArrayBuffer.prototype.destroy=g.prototype.destroy,g.ArrayBuffer.prototype._finish=g.prototype._finish,g.ArrayBuffer.hash=function(t,e){var i=l(new Uint8Array(t)),n=p(i);return e?_(n):n},g})},{}],16:[function(t,e,i){"use strict";function n(t,e,i){var n=i[i.length-1];t===n.element&&(i.pop(),n=i[i.length-1]);var o=n.element,r=n.index;if(Array.isArray(o))o.push(t);else if(r===e.length-2){var s=e.pop();o[s]=t}else e.push(t)}i.stringify=function(t){var e=[];e.push({obj:t});for(var i,n,o,r,s,a,c,u,l,h,p,f="";i=e.pop();)if(n=i.obj,o=i.prefix||"",r=i.val||"",f+=o,r)f+=r;else if("object"!=typeof n)f+="undefined"==typeof n?null:JSON.stringify(n);else if(null===n)f+="null";else if(Array.isArray(n)){for(e.push({val:"]"}),s=n.length-1;s>=0;s--)a=0===s?"":",",e.push({obj:n[s],prefix:a});e.push({val:"["})}else{c=[];for(u in n)n.hasOwnProperty(u)&&c.push(u);for(e.push({val:"}"}),s=c.length-1;s>=0;s--)l=c[s],h=n[l],p=s>0?",":"",p+=JSON.stringify(l)+":",e.push({obj:h,prefix:p});e.push({val:"{"})}return f},i.parse=function(t){for(var e,i,o,r,s,a,c,u,l,h=[],p=[],f=0;;)if(e=t[f++],"}"!==e&&"]"!==e&&"undefined"!=typeof e)switch(e){case" ":case"	":case"\n":case":":case",":break;case"n":f+=3,n(null,h,p);break;case"t":f+=3,n(!0,h,p);break;case"f":f+=4,n(!1,h,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(i="",f--;;){if(o=t[f++],!/[\d\.\-e\+]/.test(o)){f--;break}i+=o}n(parseFloat(i),h,p);break;case'"':for(r="",s=void 0,a=0;c=t[f++],'"'!==c||"\\"===s&&a%2===1;)r+=c,s=c,"\\"===s?a++:a=0;n(JSON.parse('"'+r+'"'),h,p);break;case"[":u={element:[],index:h.length},h.push(u.element),p.push(u);break;case"{":l={element:{},index:h.length},h.push(l.element),p.push(l);break;default:throw new Error("unexpectedly reached end of input: "+e)}else{if(1===h.length)return h.pop();n(h.pop(),h,p)}}},{}],17:[function(t,e,i){(function(i,n){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t["default"]:t}function r(t,e){for(var i={},n=0,o=e.length;o>n;n++){var r=e[n];r in t&&(i[r]=t[r])}return i}function s(t){return t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob}function a(t){if("function"==typeof t.slice)return t.slice(0);var e=new ArrayBuffer(t.byteLength),i=new Uint8Array(e),n=new Uint8Array(t);return i.set(n),e}function c(t){if(t instanceof ArrayBuffer)return a(t);var e=t.size,i=t.type;return"function"==typeof t.slice?t.slice(0,e,i):t.webkitSlice(0,e,i)}function u(t){var e,i,n;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(e=[],i=0,n=t.length;n>i;i++)e[i]=u(t[i]);return e}if(t instanceof Date)return t.toISOString();if(s(t))return c(t);e={};for(i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var o=u(t[i]);"undefined"!=typeof o&&(e[i]=o)}return e}function l(t){var e=!1;return on(function(i){if(e)throw new Error("once called more than once");e=!0,t.apply(this,i)})}function h(t){return on(function(e){e=u(e);var n,o=this,r="function"==typeof e[e.length-1]?e.pop():!1;r&&(n=function(t,e){i.nextTick(function(){r(t,e)})});var s=new hn(function(i,n){var r;try{var s=l(function(t,e){t?n(t):i(e)});e.push(s),r=t.apply(o,e),r&&"function"==typeof r.then&&i(r)}catch(a){n(a)}});return n&&s.then(function(t){n(null,t)},n),s})}function p(t,e){function i(t,e,i){if(pn.enabled){for(var n=[t._db_name,e],o=0;o<i.length-1;o++)n.push(i[o]);pn.apply(null,n);var r=i[i.length-1];i[i.length-1]=function(i,n){var o=[t._db_name,e];o=o.concat(i?["error",i]:["success",n]),pn.apply(null,o),r(i,n)}}}return h(on(function(n){if(this._closed)return hn.reject(new Error("database is closed"));if(this._destroyed)return hn.reject(new Error("database is destroyed"));var o=this;return i(o,t,n),this.taskqueue.isReady?e.apply(this,n):new hn(function(e,i){o.taskqueue.addTask(function(r){r?i(r):e(o[t].apply(o,n))})})}))}function f(t,e,i){return new hn(function(n,o){t.get(e,function(r,s){if(r){if(404!==r.status)return o(r);s={}}var a=s._rev,c=i(s);return c?(c._id=e,c._rev=a,void n(d(t,c,i))):n({updated:!1,rev:a})})})}function d(t,e,i){return t.put(e).then(function(t){return{updated:!0,rev:t.rev}},function(n){if(409!==n.status)throw n;return f(t,e._id,i);
})}function v(t){for(var e,i,n,o,r=t.rev_tree.slice();o=r.pop();){var s=o.ids,a=s[2],c=o.pos;if(a.length)for(var u=0,l=a.length;l>u;u++)r.push({pos:c+1,ids:a[u]});else{var h=!!s[1].deleted,p=s[0];(!e||(n!==h?n:i!==c?c>i:p>e))&&(e=p,i=c,n=h)}}return i+"-"+e}function y(t){return t.ids}function _(t,e){e||(e=v(t));for(var i,n=e.substring(e.indexOf("-")+1),o=t.rev_tree.map(y);i=o.pop();){if(i[0]===n)return!!i[1].deleted;o=o.concat(i[2])}}function g(t){return sn("return "+t+";",{})}function m(t){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+t+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function S(t){if(!t)return null;var e=t.split("/");return 2===e.length?e:1===e.length?[t,t]:null}function w(t){var e=S(t);return e?e.join("/"):null}function b(t,e){for(var i,n=t.slice();i=n.pop();)for(var o=i.pos,r=i.ids,s=r[2],a=e(0===s.length,o,r[0],i.ctx,r[1]),c=0,u=s.length;u>c;c++)n.push({pos:o+1,ids:s[c],ctx:a})}function O(t,e){return t.pos-e.pos}function T(t){var e=[];b(t,function(t,i,n,o,r){t&&e.push({rev:i+"-"+n,pos:i,opts:r})}),e.sort(O).reverse();for(var i=0,n=e.length;n>i;i++)delete e[i].pos;return e}function E(t){for(var e=v(t),i=T(t.rev_tree),n=[],o=0,r=i.length;r>o;o++){var s=i[o];s.rev===e||s.opts.deleted||n.push(s.rev)}return n}function x(t){Error.call(this,t.reason),this.status=t.status,this.name=t.error,this.message=t.reason,this.error=!0}function I(t,e,i){function n(e){for(var n in t)"function"!=typeof t[n]&&(this[n]=t[n]);void 0!==i&&(this.name=i),void 0!==e&&(this.reason=e)}return n.prototype=x.prototype,new n(e)}function C(t){var e,i,n,o,r;return i=t.error===!0&&"string"==typeof t.name?t.name:t.error,r=t.reason,n=Pn("name",i,r),t.missing||"missing"===r||"deleted"===r||"not_found"===i?n=vn:"doc_validation"===i?(n=En,o=r):"bad_request"===i&&n.message!==r&&(n=xn),n||(n=Pn("status",t.status,r)||wn),e=I(n,r,i),o&&(e.message=o),t.id&&(e.id=t.id),t.status&&(e.status=t.status),t.missing&&(e.missing=t.missing),e}function k(t,e,i){function n(){o.cancel()}rn.EventEmitter.call(this);var o=this;this.db=t,e=e?u(e):{};var r=e.complete=l(function(e,i){e?o.emit("error",e):o.emit("complete",i),o.removeAllListeners(),t.removeListener("destroyed",n)});i&&(o.on("complete",function(t){i(null,t)}),o.on("error",i)),t.once("destroyed",n),e.onChange=function(t){e.isCancelled||(o.emit("change",t),o.startSeq&&o.startSeq<=t.seq&&(o.startSeq=!1))};var s=new hn(function(t,i){e.complete=function(e,n){e?i(e):t(n)}});o.once("cancel",function(){t.removeListener("destroyed",n),e.complete(null,{status:"cancelled"})}),this.then=s.then.bind(s),this["catch"]=s["catch"].bind(s),this.then(function(t){r(null,t)},r),t.taskqueue.isReady?o.doChanges(e):t.taskqueue.addTask(function(){o.isCancelled?o.emit("cancel"):o.doChanges(e)})}function N(t,e,i){var n=[{rev:t._rev}];"all_docs"===i.style&&(n=T(e.rev_tree).map(function(t){return{rev:t.rev}}));var o={id:e.id,changes:n,doc:t};return _(e,t._rev)&&(o.deleted=!0),i.conflicts&&(o.doc._conflicts=E(e),o.doc._conflicts.length||delete o.doc._conflicts),o}function D(t,e,i){function n(){var t=[];h.forEach(function(e){e.docs.forEach(function(i){t.push({id:e.id,docs:[i]})})}),i(null,{results:t})}function o(){++l===u&&n()}function s(t,e,i){h[t]={id:e,docs:i},o()}var a=Array.isArray(e)?e:e.docs,c={};a.forEach(function(t){t.id in c?c[t.id].push(t):c[t.id]=[t]});var u=Object.keys(c).length,l=0,h=new Array(u);Object.keys(c).forEach(function(i,n){var o=c[i],a=r(o[0],["atts_since","attachments"]);a.open_revs=o.map(function(t){return t.rev}),a.open_revs=a.open_revs.filter(function(t){return t});var u=function(t){return t};0===a.open_revs.length&&(delete a.open_revs,u=function(t){return[{ok:t}]}),["revs","attachments","binary","ajax"].forEach(function(t){t in e&&(a[t]=e[t])}),t.get(i,a,function(t,e){s(n,i,t?[{error:t}]:u(e))})})}function z(t){return/^_local/.test(t)}function A(t){for(var e,i=[],n=t.slice();e=n.pop();){var o=e.pos,r=e.ids,s=r[0],a=r[1],c=r[2],u=0===c.length,l=e.history?e.history.slice():[];l.push({id:s,opts:a}),u&&i.push({pos:o+1-l.length,ids:l});for(var h=0,p=c.length;p>h;h++)n.push({pos:o+1,ids:c[h],history:l})}return i.reverse()}function L(t){return 0|Math.random()*t}function M(t,e){e=e||qn.length;var i="",n=-1;if(t){for(;++n<t;)i+=qn[L(e)];return i}for(;++n<36;)switch(n){case 8:case 13:case 18:case 23:i+="-";break;case 19:i+=qn[3&L(16)|8];break;default:i+=qn[L(16)]}return i}function F(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}function R(t){var e;if(t?"string"!=typeof t?e=I(_n):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=I(mn)):e=I(gn),e)throw e}function P(t){if(!/^\d+\-./.test(t))return I(An);var e=t.indexOf("-"),i=t.substring(0,e),n=t.substring(e+1);return{prefix:parseInt(i,10),id:n}}function q(t,e){for(var i=t.start-t.ids.length+1,n=t.ids,o=[n[0],e,[]],r=1,s=n.length;s>r;r++)o=[n[r],{status:"missing"},[o]];return[{pos:i,ids:o}]}function j(t,e){var i,n,o,r={status:"available"};if(t._deleted&&(r.deleted=!0),e)if(t._id||(t._id=M()),n=M(32,16).toLowerCase(),t._rev){if(o=P(t._rev),o.error)return o;t._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[n,r,[]]]]}],i=o.prefix+1}else t._rev_tree=[{pos:1,ids:[n,r,[]]}],i=1;else if(t._revisions&&(t._rev_tree=q(t._revisions,r),i=t._revisions.start,n=t._revisions.ids[0]),!t._rev_tree){if(o=P(t._rev),o.error)return o;i=o.prefix,n=o.id,t._rev_tree=[{pos:i,ids:[n,r,[]]}]}R(t._id),t._rev=i+"-"+n;var s={metadata:{},data:{}};for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var c="_"===a[0];if(c&&!jn[a]){var u=I(En,a);throw u.message=En.message+": "+a,u}c&&!Vn[a]?s.metadata[a.slice(1)]=t[a]:s.data[a]=t[a]}return s}function V(t,e){return e>t?-1:t>e?1:0}function U(t,e){for(var i=0;i<t.length;i++)if(e(t[i],i)===!0)return t[i]}function B(t){return function(e,i){e||i[0]&&i[0].error?t(e||i[0]):t(null,i.length?i[0]:i)}}function H(t){for(var e=0;e<t.length;e++){var i=t[e];if(i._deleted)delete i._attachments;else if(i._attachments)for(var n=Object.keys(i._attachments),o=0;o<n.length;o++){var s=n[o];i._attachments[s]=r(i._attachments[s],["data","digest","content_type","length","revpos","stub"])}}}function G(t,e){var i=V(t._id,e._id);if(0!==i)return i;var n=t._revisions?t._revisions.start:0,o=e._revisions?e._revisions.start:0;return V(n,o)}function X(t){var e={},i=[];return b(t,function(t,n,o,r){var s=n+"-"+o;return t&&(e[s]=0),void 0!==r&&i.push({from:r,to:s}),s}),i.reverse(),i.forEach(function(t){void 0===e[t.from]?e[t.from]=1+e[t.to]:e[t.from]=Math.min(e[t.from],1+e[t.to])}),e}function W(t,e,i){var n="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;if(e.descending&&n.reverse(),!n.length)return t._allDocs({limit:0},i);var o={offset:e.skip};return hn.all(n.map(function(i){var n=Qi.extend({key:i,deleted:"ok"},e);return["limit","skip","keys"].forEach(function(t){delete n[t]}),new hn(function(e,r){t._allDocs(n,function(t,n){return t?r(t):(o.total_rows=n.total_rows,void e(n.rows[0]||{key:i,error:"not_found"}))})})})).then(function(t){return o.rows=t,o})}function Y(t){var e=t._compactionQueue[0],n=e.opts,o=e.callback;t.get("_local/compaction")["catch"](function(){return!1}).then(function(e){e&&e.last_seq&&(n.last_seq=e.last_seq),t._compact(n,function(e,n){e?o(e):o(null,n),i.nextTick(function(){t._compactionQueue.shift(),t._compactionQueue.length&&Y(t)})})})}function J(t){return"_"===t.charAt(0)?t+"is not a valid attachment name, attachment names cannot start with '_'":!1}function K(){rn.EventEmitter.call(this)}function Q(){this.isReady=!1,this.failed=!1,this.queue=[]}function $(t){t&&n.debug&&console.error(t)}function Z(t,e){function i(){r.emit("destroyed",o)}function n(){t.removeListener("destroyed",i),t.emit("destroyed",t)}var o=e.originalName,r=t.constructor,s=r._destructionListeners;t.once("destroyed",i),s.has(o)||s.set(o,[]),s.get(o).push(n)}function tt(t,e,i){if(!(this instanceof tt))return new tt(t,e,i);var n=this;("function"==typeof e||"undefined"==typeof e)&&(i=e,e={}),t&&"object"==typeof t&&(e=t,t=void 0),"undefined"==typeof i&&(i=$),t=t||e.name,e=u(e),delete e.name,this.__opts=e;var o=i;n.auto_compaction=e.auto_compaction,n.prefix=tt.prefix,K.call(n),n.taskqueue=new Q;var r=new hn(function(o,r){i=function(t,e){return t?r(t):(delete e.then,void o(e))},e=u(e);var s,a,c=e.name||t;return function(){try{if("string"!=typeof c)throw a=new Error("Missing/invalid DB name"),a.code=400,a;if(s=tt.parseAdapter(c,e),e.originalName=c,e.name=s.name,e.prefix&&"http"!==s.adapter&&"https"!==s.adapter&&(e.name=e.prefix+e.name),e.adapter=e.adapter||s.adapter,n._adapter=e.adapter,Zi("pouchdb:adapter")("Picked adapter: "+e.adapter),n._db_name=c,!tt.adapters[e.adapter])throw a=new Error("Adapter is missing"),a.code=404,a;if(!tt.adapters[e.adapter].valid())throw a=new Error("Invalid Adapter"),a.code=404,a}catch(t){n.taskqueue.fail(t)}}(),a?r(a):(n.adapter=e.adapter,n.replicate={},n.replicate.from=function(t,e,i){return n.constructor.replicate(t,n,e,i)},n.replicate.to=function(t,e,i){return n.constructor.replicate(n,t,e,i)},n.sync=function(t,e,i){return n.constructor.sync(n,t,e,i)},n.replicate.sync=n.sync,void tt.adapters[e.adapter].call(n,e,function(t){return t?(n.taskqueue.fail(t),void i(t)):(Z(n,e),n.emit("created",n),tt.emit("created",e.originalName),n.taskqueue.ready(n),void i(null,n))}))});r.then(function(t){o(null,t)},o),n.then=r.then.bind(r),n["catch"]=r["catch"].bind(r)}function et(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function it(){return Un}function nt(t){Object.keys(rn.EventEmitter.prototype).forEach(function(e){"function"==typeof rn.EventEmitter.prototype[e]&&(t[e]=Hn[e].bind(Hn))});var e=t._destructionListeners=new nn.Map;t.on("destroyed",function(t){e.has(t)&&(e.get(t).forEach(function(t){t()}),e["delete"](t))})}function ot(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(i){if("TypeError"!==i.name)throw i;for(var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,o=new n,r=0;r<t.length;r+=1)o.append(t[r]);return o.getBlob(e.type)}}function rt(t,e){if("undefined"==typeof FileReader)return e((new FileReaderSync).readAsArrayBuffer(t));var i=new FileReader;i.onloadend=function(t){var i=t.target.result||new ArrayBuffer(0);e(i)},i.readAsArrayBuffer(t)}function st(){for(var t={},e=new hn(function(e,i){t.resolve=e,t.reject=i}),i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];return t.promise=e,hn.resolve().then(function(){return fetch.apply(null,i)}).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t}function at(t,e){var i,n,o,r=new Headers,s={method:t.method,credentials:"include",headers:r};return t.json&&(r.set("Accept","application/json"),r.set("Content-Type",t.headers["Content-Type"]||"application/json")),t.body&&t.body instanceof Blob?rt(t.body,function(t){s.body=t}):t.body&&t.processData&&"string"!=typeof t.body?s.body=JSON.stringify(t.body):"body"in t?s.body=t.body:s.body=null,Object.keys(t.headers).forEach(function(e){t.headers.hasOwnProperty(e)&&r.set(e,t.headers[e])}),i=st(t.url,s),t.timeout>0&&(n=setTimeout(function(){i.reject(new Error("Load timeout for resource: "+t.url))},t.timeout)),i.promise.then(function(e){return o={statusCode:e.status},t.timeout>0&&clearTimeout(n),o.statusCode>=200&&o.statusCode<300?t.binary?e.blob():e.text():e.json()}).then(function(t){o.statusCode>=200&&o.statusCode<300?e(null,o,t):e(t,o)})["catch"](function(t){e(t,o)}),{abort:i.reject}}function ct(t,e){var i,n,o=!1,r=function(){i.abort()},s=function(){o=!0,i.abort()};i=t.xhr?new t.xhr:new XMLHttpRequest;try{i.open(t.method,t.url)}catch(a){e(a,{statusCode:413})}i.withCredentials="withCredentials"in t?t.withCredentials:!0,"GET"===t.method?delete t.headers["Content-Type"]:t.json&&(t.headers.Accept="application/json",t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.body&&t.processData&&"string"!=typeof t.body&&(t.body=JSON.stringify(t.body))),t.binary&&(i.responseType="arraybuffer"),"body"in t||(t.body=null);for(var c in t.headers)t.headers.hasOwnProperty(c)&&i.setRequestHeader(c,t.headers[c]);return t.timeout>0&&(n=setTimeout(s,t.timeout),i.onprogress=function(){clearTimeout(n),4!==i.readyState&&(n=setTimeout(s,t.timeout))},"undefined"!=typeof i.upload&&(i.upload.onprogress=i.onprogress)),i.onreadystatechange=function(){if(4===i.readyState){var n={statusCode:i.status};if(i.status>=200&&i.status<300){var r;r=t.binary?ot([i.response||""],{type:i.getResponseHeader("Content-Type")}):i.responseText,e(null,n,r)}else{var s={};if(o)s=new Error("ETIMEDOUT"),n.statusCode=400;else try{s=JSON.parse(i.response)}catch(a){}e(s,n)}}},t.body&&t.body instanceof Blob?rt(t.body,function(t){i.send(t)}):i.send(t.body),{abort:r}}function ut(){try{return new XMLHttpRequest,!0}catch(t){return!1}}function lt(t,e){return Gn||t.xhr?ct(t,e):at(t,e)}function ht(){return""}function pt(t,e){function i(e,i,n){if(!t.binary&&t.json&&"string"==typeof e)try{e=JSON.parse(e)}catch(o){return n(o)}Array.isArray(e)&&(e=e.map(function(t){return t.error||t.missing?C(t):t})),t.binary&&Xn(e,i),n(null,e,i)}function n(t,e){var i,n;if(t.code&&t.status){var o=new Error(t.message||t.code);return o.status=t.status,e(o)}if(t.message&&"ETIMEDOUT"===t.message)return e(t);try{i=JSON.parse(t.responseText),n=C(i)}catch(r){n=C(t)}e(n)}t=u(t);var o={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return t=Qi.extend(o,t),t.json&&(t.binary||(t.headers.Accept="application/json"),t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),t.binary&&(t.encoding=null,t.json=!1),t.processData||(t.json=!1),lt(t,function(o,r,s){if(o)return o.status=r?r.statusCode:400,n(o,e);var a,c=r.headers&&r.headers["content-type"],u=s||ht();if(!t.binary&&(t.json||!t.processData)&&"object"!=typeof u&&(/json/.test(c)||/^[\s]*\{/.test(u)&&/\}[\s]*$/.test(u)))try{u=JSON.parse(u.toString())}catch(l){}r.statusCode>=200&&r.statusCode<300?i(u,r,e):(a=C(u),a.status=r.statusCode,e(a))})}function ft(t,e){var i=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==i.indexOf("safari")&&-1===i.indexOf("chrome"),o=-1!==i.indexOf("msie"),r=-1!==i.indexOf("edge"),s=n||(o||r)&&"GET"===t.method,a="cache"in t?t.cache:!0,c=/^blob:/.test(t.url);if(!c&&(s||!a)){var u=-1!==t.url.indexOf("?");t.url+=(u?"&":"?")+"_nonce="+Date.now()}return pt(t,e)}function dt(t){for(var e=Kn.exec(t),i={},n=14;n--;){var o=Wn[n],r=e[n]||"",s=-1!==["user","password"].indexOf(o);i[o]=s?decodeURIComponent(r):r}return i[Yn]={},i[Wn[12]].replace(Jn,function(t,e,n){e&&(i[Yn][e]=n)}),i}function vt(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),o=0;e>o;o++)n[o]=t.charCodeAt(o);return i}function yt(t,e){return ot([vt(t)],{type:e})}function _t(t,e,i){try{return!t(e,i)}catch(n){var o="Filter function threw: "+n.toString();return I(xn,o)}}function gt(t){var e={},i=t.filter&&"function"==typeof t.filter;return e.query=t.query_params,function(n){n.doc||(n.doc={});var o=i&&_t(t.filter,n.doc,e);if("object"==typeof o)return o;if(o)return!1;if(t.include_docs){if(!t.attachments)for(var r in n.doc._attachments)n.doc._attachments.hasOwnProperty(r)&&(n.doc._attachments[r].stub=!0)}else delete n.doc;return!0}}function mt(t,e){"console"in n&&"info"in console&&console.info("The above "+t+" is totally normal. "+e)}function St(t,e,i,n,o){return t.get(e)["catch"](function(i){if(404===i.status)return"http"===t.type()&&mt(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:n,_id:e,history:[],replicator:no,version:io};throw i}).then(function(r){return o.cancelled?void 0:(r.history=(r.history||[]).filter(function(t){return t.session_id!==n}),r.history.unshift({last_seq:i,session_id:n}),r.history=r.history.slice(0,oo),r.version=io,r.replicator=no,r.session_id=n,r.last_seq=i,t.put(r)["catch"](function(r){if(409===r.status)return St(t,e,i,n,o);throw r}))})}function wt(t,e,i,n){this.src=t,this.target=e,this.id=i,this.returnValue=n}function bt(t,e){if(t.session_id===e.session_id)return{last_seq:t.last_seq,history:t.history||[]};var i=t.history||[],n=e.history||[];return Ot(i,n)}function Ot(t,e){var i=t[0],n=t.slice(1),o=e[0],r=e.slice(1);if(!i||0===e.length)return{last_seq:ro,history:[]};var s=i.session_id;if(Tt(s,e))return{last_seq:i.last_seq,history:t};var a=o.session_id;return Tt(a,n)?{last_seq:o.last_seq,history:r}:Ot(n,r)}function Tt(t,e){var i=e[0],n=e.slice(1);return t&&0!==e.length?t===i.session_id?!0:Tt(t,n):!1}function Et(t){return"number"==typeof t.status&&4===Math.floor(t.status/100)}function xt(t,e){var i=6e5;t=parseInt(t,10)||0,e=parseInt(e,10),e!==e||t>=e?e=(t||1)<<1:e+=1,e>i&&(t=i>>1,e=i);var n=Math.random(),o=e-t;return~~(o*n+t)}function It(t){var e=0;return t||(e=2e3),xt(t,e)}function Ct(t,e,i,n){return t.retry===!1?(e.emit("error",i),void e.removeAllListeners()):("function"!=typeof t.back_off_function&&(t.back_off_function=It),e.emit("paused"),("active"===e.state||"pending"===e.state)&&(e.emit("paused"),e.state="stopped",e.once("active",function(){t.current_back_off=ao})),t.current_back_off=t.current_back_off||ao,t.current_back_off=t.back_off_function(t.current_back_off),void setTimeout(n,t.current_back_off))}function kt(t){return $n(t)}function Nt(t,e,i,n){(i>0||n<e.byteLength)&&(e=new Uint8Array(e,i,Math.min(n,e.byteLength)-i)),t.append(e)}function Dt(t,e,i,n){(i>0||n<e.length)&&(e=e.substring(i,n)),t.appendBinary(e)}function zt(t){return Object.keys(t).sort(an.collate).reduce(function(e,i){return e[i]=t[i],e},{})}function At(t,e,i){var n=i.doc_ids?i.doc_ids.sort(an.collate):"",o=i.filter?i.filter.toString():"",r="",s="";return i.filter&&i.query_params&&(r=JSON.stringify(zt(i.query_params))),i.filter&&"_view"===i.filter&&(s=i.view.toString()),hn.all([t.id(),e.id()]).then(function(t){var e=t[0]+t[1]+o+s+r+n;return lo(e)}).then(function(t){return t=t.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+t})}function Lt(t){for(var e=[],i=0,n=t.length;n>i;i++)e=e.concat(t[i]);return e}function Mt(t){return/^1-/.test(t)}function Ft(t,e,i){return!t._attachments||!t._attachments[i]||t._attachments[i].digest!==e._attachments[i].digest}function Rt(t,e){var i=Object.keys(e._attachments);return hn.all(i.map(function(i){return t.getAttachment(e._id,i,{rev:e._rev})}))}function Pt(t,e,i){var n="http"===e.type()&&"http"!==t.type(),o=Object.keys(i._attachments);return n?t.get(i._id).then(function(n){return hn.all(o.map(function(o){return Ft(n,i,o)?e.getAttachment(i._id,o):t.getAttachment(n._id,o)}))})["catch"](function(t){if(404!==t.status)throw t;return Rt(e,i)}):Rt(e,i)}function qt(t){var e=[];return Object.keys(t).forEach(function(i){var n=t[i].missing;n.forEach(function(t){e.push({id:i,rev:t})})}),{docs:e,revs:!0}}function jt(t,e,i,n){function o(){var o=qt(i);return o.docs.length?t.bulkGet(o).then(function(i){if(n.cancelled)throw new Error("cancelled");return hn.all(i.results.map(function(i){return hn.all(i.docs.map(function(i){var n=i.ok;return i.error&&(h=!1),n&&n._attachments?Pt(e,t,n).then(function(t){var e=Object.keys(n._attachments);return t.forEach(function(t,i){var o=n._attachments[e[i]];delete o.stub,delete o.length,o.data=t}),n}):n}))})).then(function(t){l=l.concat(Lt(t).filter(Boolean))})}):void 0}function r(t){return t._attachments&&Object.keys(t._attachments).length>0}function s(e){return t.allDocs({keys:e,include_docs:!0}).then(function(t){if(n.cancelled)throw new Error("cancelled");t.rows.forEach(function(t){!t.deleted&&t.doc&&Mt(t.value.rev)&&!r(t.doc)&&(l.push(t.doc),delete i[t.id])})})}function a(){var t=Object.keys(i).filter(function(t){var e=i[t].missing;return 1===e.length&&Mt(e[0])});return t.length>0?s(t):void 0}function c(){return{ok:h,docs:l}}i=u(i);var l=[],h=!0;return hn.resolve().then(a).then(o).then(c)}function Vt(t,e,i,n,o){function r(){return O?hn.resolve():At(t,e,i).then(function(i){b=i,O=new wt(t,e,b,n)})}function s(){if(R=[],0!==w.docs.length){var t=w.docs;return e.bulkDocs({docs:t,new_edits:!1}).then(function(e){if(n.cancelled)throw d(),new Error("cancelled");var i=[],r={};e.forEach(function(t){t.error&&(o.doc_write_failures++,i.push(t),r[t.id]=t)}),F=F.concat(i),o.docs_written+=w.docs.length-i.length;var s=i.filter(function(t){return"unauthorized"!==t.name&&"forbidden"!==t.name});if(t.forEach(function(t){var e=r[t._id];e?n.emit("denied",u(e)):R.push(t)}),s.length>0){var a=new Error("bulkDocs error");throw a.other_errors=i,f("target.bulkDocs failed to write docs",a),new Error("bulkWrite partial failure")}},function(e){throw o.doc_write_failures+=t.length,e})}}function a(){if(w.error)throw new Error("There was a problem getting docs.");o.last_seq=k=w.seq;var t=u(o);return R.length&&(t.docs=R,n.emit("change",t)),x=!0,O.writeCheckpoint(w.seq,P).then(function(){if(x=!1,n.cancelled)throw d(),new Error("cancelled");w=void 0,g()})["catch"](S)}function c(){var t={};return w.changes.forEach(function(e){"_user/"!==e.id&&(t[e.id]=e.changes.map(function(t){return t.rev}))}),e.revsDiff(t).then(function(t){if(n.cancelled)throw d(),new Error("cancelled");w.diffs=t})}function l(){return jt(t,e,w.diffs,n).then(function(t){w.error=!t.ok,t.docs.forEach(function(t){delete w.diffs[t._id],o.docs_read++,w.docs.push(t)})})}function h(){if(!n.cancelled&&!w){if(0===T.length)return void p(!0);w=T.shift(),c().then(l).then(s).then(a).then(h)["catch"](function(t){f("batch processing terminated with error",t)})}}function p(t){return 0===E.changes.length?void(0!==T.length||w||((N&&q.live||I)&&(n.state="pending",n.emit("active")),I&&d())):void((t||I||E.changes.length>=D)&&(T.push(E),E={seq:0,changes:[],docs:[]},("pending"===n.state||"stopped"===n.state)&&(n.state="active",n.emit("active")),h()))}function f(t,e){C||(e.message||(e.message=t),o.ok=!1,o.status="aborting",o.errors.push(e),F=F.concat(e),T=[],E={seq:0,changes:[],docs:[]},d())}function d(){if(!(C||n.cancelled&&(o.status="cancelled",x))){o.status=o.status||"complete",o.end_time=new Date,o.last_seq=k,C=!0;var r=F.filter(function(t){return"unauthorized"!==t.name&&"forbidden"!==t.name});if(r.length>0){var s=F.pop();F.length>0&&(s.other_errors=F),s.result=o,Ct(i,n,s,function(){Vt(t,e,i,n)})}else o.errors=F,n.emit("complete",o),n.removeAllListeners()}}function v(t){if(n.cancelled)return d();var e=gt(i)(t);e&&(E.seq=t.seq,E.changes.push(t),p(q.live))}function y(t){if(A=!1,n.cancelled)return d();if(t.results.length>0)q.since=t.last_seq,g(),p(!0);else{var e=function(){N?(n.emit("active"),q.live=!0,g()):I=!0,p(!0)};!w&&t.last_seq>k?(x=!0,O.writeCheckpoint(t.last_seq,P).then(function(){x=!1,o.last_seq=k=t.last_seq,e()})["catch"](S)):e()}}function _(t){return A=!1,n.cancelled?d():void f("changes rejected",t)}function g(){function e(){r.cancel()}function o(){n.removeListener("cancel",e)}if(!A&&!I&&T.length<z){A=!0,n._changes&&(n.removeListener("cancel",n._abortChanges),n._changes.cancel()),n.once("cancel",e);var r=t.changes(q).on("change",v);r.then(o,o),r.then(y)["catch"](_),i.retry&&(n._changes=r,n._abortChanges=e)}}function m(){r().then(function(){return n.cancelled?void d():O.getCheckpoint().then(function(t){k=t,q={since:k,limit:D,batch_size:D,style:"all_docs",doc_ids:L,return_docs:!0},i.filter&&("string"!=typeof i.filter?q.include_docs=!0:q.filter=i.filter),"heartbeat"in i&&(q.heartbeat=i.heartbeat),"timeout"in i&&(q.timeout=i.timeout),i.query_params&&(q.query_params=i.query_params),i.view&&(q.view=i.view),g()})})["catch"](function(t){f("getCheckpoint rejected with ",t)})}function S(t){throw x=!1,f("writeCheckpoint completed with error",t),t}var w,b,O,T=[],E={seq:0,changes:[],docs:[]},x=!1,I=!1,C=!1,k=0,N=i.continuous||i.live||!1,D=i.batch_size||100,z=i.batches_limit||10,A=!1,L=i.doc_ids,F=[],R=[],P=M();o=o||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var q={};return n.ready(t,e),n.cancelled?void d():(n._addedListeners||(n.once("cancel",d),"function"==typeof i.complete&&(n.once("error",i.complete),n.once("complete",function(t){i.complete(null,t)})),n._addedListeners=!0),void("undefined"==typeof i.since?m():r().then(function(){return x=!0,O.writeCheckpoint(i.since,P)}).then(function(){return x=!1,n.cancelled?void d():(k=i.since,void m())})["catch"](S)))}function Ut(){rn.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var t=this,e=new hn(function(e,i){t.once("complete",e),t.once("error",i)});t.then=function(t,i){return e.then(t,i)},t["catch"]=function(t){return e["catch"](t)},t["catch"](function(){})}function Bt(t,e){var i=e.PouchConstructor;return"string"==typeof t?new i(t,e):t}function Ht(t,e,i,n){if("function"==typeof i&&(n=i,i={}),"undefined"==typeof i&&(i={}),i.doc_ids&&!Array.isArray(i.doc_ids))throw I(xn,"`doc_ids` filter parameter is not a list.");i.complete=n,i=u(i),i.continuous=i.continuous||i.live,i.retry="retry"in i?i.retry:!1,i.PouchConstructor=i.PouchConstructor||this;var o=new Ut(i),r=Bt(t,i),s=Bt(e,i);return Vt(r,s,i,o),o}function Gt(t,e,i,n){return"function"==typeof i&&(n=i,i={}),"undefined"==typeof i&&(i={}),i=u(i),i.PouchConstructor=i.PouchConstructor||this,t=ho.toPouch(t,i),e=ho.toPouch(e,i),new Xt(t,e,i,n)}function Xt(t,e,i,n){function o(t){f.emit("change",{direction:"pull",change:t})}function r(t){f.emit("change",{direction:"push",change:t})}function s(t){f.emit("denied",{direction:"push",doc:t})}function a(t){f.emit("denied",{direction:"pull",doc:t})}function c(){f.pushPaused=!0,f.pullPaused&&f.emit("paused")}function u(){f.pullPaused=!0,f.emit("paused")}function l(){f.pushPaused=!1,f.pullPaused&&f.emit("active",{direction:"push"})}function h(){f.pullPaused=!1,f.emit("active",{direction:"pull"})}function p(t){return function(e,i){var n="change"===e&&(i===o||i===r),p="denied"===e&&(i===a||i===s),d="paused"===e&&(i===u||i===c),v="active"===e&&(i===h||i===l);(n||p||d||v)&&(e in y||(y[e]={}),y[e][t]=!0,2===Object.keys(y[e]).length&&f.removeAllListeners(e))}}var f=this;this.canceled=!1;var d=i.push?Qi.extend({},i,i.push):i,v=i.pull?Qi.extend({},i,i.pull):i;this.push=po(t,e,d),this.pull=po(e,t,v),this.pushPaused=!0,this.pullPaused=!0;var y={};i.live&&(this.push.on("complete",f.pull.cancel.bind(f.pull)),this.pull.on("complete",f.push.cancel.bind(f.push))),this.on("newListener",function(t){"change"===t?(f.pull.on("change",o),f.push.on("change",r)):"denied"===t?(f.pull.on("denied",a),f.push.on("denied",s)):"active"===t?(f.pull.on("active",h),f.push.on("active",l)):"paused"===t&&(f.pull.on("paused",u),f.push.on("paused",c))}),this.on("removeListener",function(t){"change"===t?(f.pull.removeListener("change",o),f.push.removeListener("change",r)):"denied"===t?(f.pull.removeListener("denied",a),f.push.removeListener("denied",s)):"active"===t?(f.pull.removeListener("active",h),f.push.removeListener("active",l)):"paused"===t&&(f.pull.removeListener("paused",u),f.push.removeListener("paused",c))}),this.pull.on("removeListener",p("pull")),this.push.on("removeListener",p("push"));var _=hn.all([this.push,this.pull]).then(function(t){var e={push:t[0],pull:t[1]};return f.emit("complete",e),n&&n(null,e),f.removeAllListeners(),e},function(t){if(f.cancel(),n?n(t):f.emit("error",t),f.removeAllListeners(),n)throw t});this.then=function(t,e){return _.then(t,e)},this["catch"]=function(t){return _["catch"](t)}}function Wt(t,e){return yt(Qn(t),e)}function Yt(t){for(var e="",i=new Uint8Array(t),n=i.byteLength,o=0;n>o;o++)e+=String.fromCharCode(i[o]);return e}function Jt(t,e){if("undefined"==typeof FileReader)return e(Yt((new FileReaderSync).readAsArrayBuffer(t)));var i=new FileReader,n="function"==typeof i.readAsBinaryString;i.onloadend=function(t){var i=t.target.result||"";return n?e(i):void e(Yt(i))},n?i.readAsBinaryString(t):i.readAsArrayBuffer(t)}function Kt(t){return new hn(function(e){Jt(t,function(t){e($n(t))})})}function Qt(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var i=e[t];i.data=Wt(i.data,i.content_type)})}function $t(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):/^_local/.test(t)?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function Zt(t){return t._attachments&&Object.keys(t._attachments)?hn.all(Object.keys(t._attachments).map(function(e){var i=t._attachments[e];return i.data&&"string"!=typeof i.data?Kt(i.data).then(function(t){i.data=t}):void 0})):hn.resolve()}function te(t){var e=dt(t);(e.user||e.password)&&(e.auth={username:e.user,password:e.password});var i=e.path.replace(/(^\/|\/$)/g,"").split("/");return e.db=i.pop(),-1===e.db.indexOf("%")&&(e.db=encodeURIComponent(e.db)),e.path=i.join("/"),e}function ee(t,e){return ie(t,t.db+"/"+e)}function ie(t,e){var i=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+i+e}function ne(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function oe(t,e){function i(t,e,i){var n=t.ajax||{},o=Qi.extend(u(d),n,e);return go(o.method+" "+o.url),to.ajax(o,i)}function n(t,e){return new hn(function(n,o){i(t,e,function(t,e){return t?o(t):void n(e)})})}function o(t,e){return p(t,on(function(t){s().then(function(){return e.apply(this,t)})["catch"](function(e){var i=t.pop();i(e)})}))}function s(){if(t.skipSetup||t.skip_setup)return hn.resolve();if(g)return g;var e={method:"GET",url:f};return g=n({},e)["catch"](function(t){return t&&t.status&&404===t.status?(mt(404,"PouchDB is just detecting if the remote exists."),n({},{method:"PUT",url:f})):hn.reject(t)})["catch"](function(t){return t&&t.status&&412===t.status?!0:hn.reject(t)}),g["catch"](function(){g=null}),g}function a(t){return t.split("/").map(encodeURIComponent).join("/")}var c=this,l=te;t.getHost&&(l=t.getHost);var h=l(t.name,t),f=ee(h,"");t=u(t);var d=t.ajax||{};if(c.getUrl=function(){return f},c.getHeaders=function(){return d.headers||{}},t.auth||h.auth){var v=t.auth||h.auth,y=v.username+":"+v.password,_=$n(unescape(encodeURIComponent(y)));d.headers=d.headers||{},d.headers.Authorization="Basic "+_}var g;setTimeout(function(){e(null,c)}),c.type=function(){return"http"},c.id=o("id",function(t){i({},{method:"GET",url:ie(h,"")},function(e,i){var n=i&&i.uuid?i.uuid+h.db:ee(h,"");t(null,n)})}),c.request=o("request",function(t,e){t.url=ee(h,t.url),i({},t,e)}),c.compact=o("compact",function(t,e){"function"==typeof t&&(e=t,t={}),t=u(t),i(t,{url:ee(h,"_compact"),method:"POST"},function(){function i(){c.info(function(n,o){o&&!o.compact_running?e(null,{ok:!0}):setTimeout(i,t.interval||200)})}i()})}),c.bulkGet=p("bulkGet",function(t,e){function n(e){var n={};t.revs&&(n.revs=!0),t.attachments&&(n.attachments=!0),i({},{url:ee(h,"_bulk_get"+ne(n)),method:"POST",body:{docs:t.docs}},e)}function o(){function i(t){return function(i,n){c[t]=n.results,++a===o&&e(null,{results:Lt(c)})}}for(var n=vo,o=Math.ceil(t.docs.length/n),a=0,c=new Array(o),u=0;o>u;u++){var l=r(t,["revs","attachments"]);l.ajax=d,l.docs=t.docs.slice(u*n,Math.min(t.docs.length,(u+1)*n)),D(s,l,i(u))}}var s=this,a=ie(h,""),c=yo[a];"boolean"!=typeof c?n(function(t,i){if(t){var n=Math.floor(t.status/100);4===n||5===n?(yo[a]=!1,mt(t.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):e(t)}else yo[a]=!0,e(null,i)}):c?n(e):o()}),c._info=function(t){s().then(function(){i({},{method:"GET",url:ee(h,"")},function(e,i){return e?t(e):(i.host=ee(h,""),void t(null,i))})})["catch"](t)},c.get=o("get",function(t,e,i){function o(t){var i=t._attachments,o=i&&Object.keys(i);return i&&o.length?hn.all(o.map(function(o){var r=i[o],s=$t(t._id)+"/"+a(o)+"?rev="+t._rev;return n(e,{method:"GET",url:ee(h,s),binary:!0}).then(function(t){return e.binary?t:Kt(t)}).then(function(t){delete r.stub,delete r.length,r.data=t})})):void 0}function r(t){return Array.isArray(t)?hn.all(t.map(function(t){return t.ok?o(t.ok):void 0})):o(t)}"function"==typeof e&&(i=e,e={}),e=u(e);var s={};e.revs&&(s.revs=!0),e.revs_info&&(s.revs_info=!0),e.open_revs&&("all"!==e.open_revs&&(e.open_revs=JSON.stringify(e.open_revs)),s.open_revs=e.open_revs),e.rev&&(s.rev=e.rev),e.conflicts&&(s.conflicts=e.conflicts),
t=$t(t);var c={method:"GET",url:ee(h,t+ne(s))};n(e,c).then(function(t){return hn.resolve().then(function(){return e.attachments?r(t):void 0}).then(function(){i(null,t)})})["catch"](i)}),c.remove=o("remove",function(t,e,n,o){var r;"string"==typeof e?(r={_id:t,_rev:e},"function"==typeof n&&(o=n,n={})):(r=t,"function"==typeof e?(o=e,n={}):(o=n,n=e));var s=r._rev||n.rev;i(n,{method:"DELETE",url:ee(h,$t(r._id))+"?rev="+s},o)}),c.getAttachment=o("getAttachment",function(t,e,n,o){"function"==typeof n&&(o=n,n={});var r=n.rev?"?rev="+n.rev:"",s=ee(h,$t(t))+"/"+a(e)+r;i(n,{method:"GET",url:s,binary:!0},o)}),c.removeAttachment=o("removeAttachment",function(t,e,n,o){var r=ee(h,$t(t)+"/"+a(e))+"?rev="+n;i({},{method:"DELETE",url:r},o)}),c.putAttachment=o("putAttachment",function(t,e,n,o,r,s){"function"==typeof r&&(s=r,r=o,o=n,n=null);var c=$t(t)+"/"+a(e),u=ee(h,c);if(n&&(u+="?rev="+n),"string"==typeof o){var l;try{l=Qn(o)}catch(p){return s(I(bn,"Attachment is not a valid base64 string"))}o=l?yt(l,r):""}var f={headers:{"Content-Type":r},method:"PUT",url:u,processData:!1,body:o,timeout:d.timeout||6e4};i({},f,s)}),c._bulkDocs=function(t,e,n){t.new_edits=e.new_edits,s().then(function(){return hn.all(t.docs.map(Zt))}).then(function(){i(e,{method:"POST",url:ee(h,"_bulk_docs"),body:t},function(t,e){return t?n(t):(e.forEach(function(t){t.ok=!0}),void n(null,e))})})["catch"](n)},c.allDocs=o("allDocs",function(t,e){"function"==typeof t&&(e=t,t={}),t=u(t);var i,o={},r="GET";t.conflicts&&(o.conflicts=!0),t.descending&&(o.descending=!0),t.include_docs&&(o.include_docs=!0),t.attachments&&(o.attachments=!0),t.key&&(o.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(o.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(o.endkey=JSON.stringify(t.endkey)),"undefined"!=typeof t.inclusive_end&&(o.inclusive_end=!!t.inclusive_end),"undefined"!=typeof t.limit&&(o.limit=t.limit),"undefined"!=typeof t.skip&&(o.skip=t.skip);var s=ne(o);if("undefined"!=typeof t.keys){var a="keys="+encodeURIComponent(JSON.stringify(t.keys));a.length+s.length+1<=_o?s+="&"+a:(r="POST",i={keys:t.keys})}n(t,{method:r,url:ee(h,"_all_docs"+s),body:i}).then(function(i){t.include_docs&&t.attachments&&t.binary&&i.rows.forEach(Qt),e(null,i)})["catch"](e)}),c._changes=function(t){var e="batch_size"in t?t.batch_size:fo;t=u(t),t.timeout="timeout"in t?t.timeout:"timeout"in d?d.timeout:3e4;var n,o=t.timeout?{timeout:t.timeout-5e3}:{},r="undefined"!=typeof t.limit?t.limit:!1;n="return_docs"in t?t.return_docs:"returnDocs"in t?t.returnDocs:!0;var a=r;if(t.style&&(o.style=t.style),(t.include_docs||t.filter&&"function"==typeof t.filter)&&(o.include_docs=!0),t.attachments&&(o.attachments=!0),t.continuous&&(o.feed="longpoll"),t.conflicts&&(o.conflicts=!0),t.descending&&(o.descending=!0),"heartbeat"in t?t.heartbeat&&(o.heartbeat=t.heartbeat):o.heartbeat=1e4,t.filter&&"string"==typeof t.filter&&(o.filter=t.filter,"_view"===t.filter&&t.view&&"string"==typeof t.view&&(o.view=t.view)),t.query_params&&"object"==typeof t.query_params)for(var c in t.query_params)t.query_params.hasOwnProperty(c)&&(o[c]=t.query_params[c]);var l,p="GET";if(t.doc_ids){o.filter="_doc_ids";var f=JSON.stringify(t.doc_ids);f.length<_o?o.doc_ids=f:(p="POST",l={doc_ids:t.doc_ids})}var v,y,_=function(n,c){if(!t.aborted){o.since=n,"object"==typeof o.since&&(o.since=JSON.stringify(o.since)),t.descending?r&&(o.limit=a):o.limit=!r||a>e?e:a;var u={method:p,url:ee(h,"_changes"+ne(o)),timeout:t.timeout,body:l};y=n,t.aborted||s().then(function(){v=i(t,u,c)})["catch"](c)}},g={results:[]},m=function(i,o){if(!t.aborted){var s=0;if(o&&o.results){s=o.results.length,g.last_seq=o.last_seq;var c={};c.query=t.query_params,o.results=o.results.filter(function(e){a--;var i=gt(t)(e);return i&&(t.include_docs&&t.attachments&&t.binary&&Qt(e),n&&g.results.push(e),t.onChange(e)),i})}else if(i)return t.aborted=!0,void t.complete(i);o&&o.last_seq&&(y=o.last_seq);var u=r&&0>=a||o&&e>s||t.descending;(!t.continuous||r&&0>=a)&&u?t.complete(null,g):setTimeout(function(){_(y,m)},0)}};return _(t.since||0,m),{cancel:function(){t.aborted=!0,v&&v.abort()}}},c.revsDiff=o("revsDiff",function(t,e,n){"function"==typeof e&&(n=e,e={}),i(e,{method:"POST",url:ee(h,"_revs_diff"),body:t},n)}),c._close=function(t){t()},c._destroy=function(e,n){i(e,{url:ee(h,""),method:"DELETE"},function(e,i){return e&&e.status&&404!==e.status?n(e):(c.emit("destroyed"),c.constructor.emit("destroyed",t.name),void n(null,i))})}}function re(){this.promise=new hn(function(t){t()})}function se(t){return un.hash(t)}function ae(t){var e=t.db,i=t.viewName,n=t.map,o=t.reduce,r=t.temporary,s=n.toString()+(o&&o.toString())+"undefined";if(!r&&e._cachedViews){var a=e._cachedViews[s];if(a)return hn.resolve(a)}return e.info().then(function(t){function a(t){t.views=t.views||{};var e=i;-1===e.indexOf("/")&&(e=i+"/"+i);var n=t.views[e]=t.views[e]||{};return n[c]?void 0:(n[c]=!0,t)}var c=t.db_name+"-mrview-"+(r?"temp":se(s));return f(e,"_local/mrviews",a).then(function(){return e.registerDependentDatabase(c).then(function(t){var i=t.db;i.auto_compaction=!0;var a={name:c,db:i,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:o};return a.db.get("_local/lastSeq")["catch"](function(t){if(404!==t.status)throw t}).then(function(t){return a.seq=t?t.seq:0,r||(e._cachedViews=e._cachedViews||{},e._cachedViews[s]=a,a.db.once("destroyed",function(){delete e._cachedViews[s]})),a})})})})}function ce(t,e,i,n,o,r){return sn("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:i,log:n,isArray:o,toJSON:r})}function ue(t){return-1===t.indexOf("/")?[t,t]:t.split("/")}function le(t){return 1===t.length&&/^1-/.test(t[0].rev)}function he(t,e){try{t.emit("error",e)}catch(i){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(e)}}function pe(t,e,i){try{return{output:e.apply(null,i)}}catch(n){return he(t,n),{error:n}}}function fe(t,e){var i=xo(t.key,e.key);return 0!==i?i:xo(t.value,e.value)}function de(t,e,i){return i=i||0,"number"==typeof e?t.slice(i,e+i):i>0?t.slice(i):t}function ve(t){var e=t.value,i=e&&"object"==typeof e&&e._id||t.id;return i}function ye(t){t.rows.forEach(function(t){var e=t.doc&&t.doc._attachments;e&&Object.keys(e).forEach(function(t){var i=e[t];e[t].data=Wt(i.data,i.content_type)})})}function _e(t){return function(e){return t.include_docs&&t.attachments&&t.binary&&ye(e),e}}function ge(t){var e="builtin "+t+" function requires map values to be numbers or number arrays";return new Ue(e)}function me(t){for(var e=0,i=0,n=t.length;n>i;i++){var o=t[i];if("number"!=typeof o){if(!Array.isArray(o))throw ge("_sum");e="number"==typeof e?[e]:e;for(var r=0,s=o.length;s>r;r++){var a=o[r];if("number"!=typeof a)throw ge("_sum");"undefined"==typeof e[r]?e.push(a):e[r]+=a}}else"number"==typeof e?e+=o:e[0]+=o}return e}function Se(t,e,i,n){var o=e[t];"undefined"!=typeof o&&(n&&(o=encodeURIComponent(JSON.stringify(o))),i.push(t+"="+o))}function we(t){if("undefined"!=typeof t){var e=Number(t);return isNaN(e)||e!==parseInt(t,10)?t:e}}function be(t){return t.group_level=we(t.group_level),t.limit=we(t.limit),t.skip=we(t.skip),t}function Oe(t){if(t){if("number"!=typeof t)return new je('Invalid value for integer: "'+t+'"');if(0>t)return new je('Invalid value for positive integer: "'+t+'"')}}function Te(t,e){var i=t.descending?"endkey":"startkey",n=t.descending?"startkey":"endkey";if("undefined"!=typeof t[i]&&"undefined"!=typeof t[n]&&xo(t[i],t[n])>0)throw new je("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&t.reduce!==!1){if(t.include_docs)throw new je("{include_docs:true} is invalid for reduce");if(t.keys&&t.keys.length>1&&!t.group&&!t.group_level)throw new je("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(e){var i=Oe(t[e]);if(i)throw i})}function Ee(t,e,i){var n,o=[],r="GET";if(Se("reduce",i,o),Se("include_docs",i,o),Se("attachments",i,o),Se("limit",i,o),Se("descending",i,o),Se("group",i,o),Se("group_level",i,o),Se("skip",i,o),Se("stale",i,o),Se("conflicts",i,o),Se("startkey",i,o,!0),Se("start_key",i,o,!0),Se("endkey",i,o,!0),Se("end_key",i,o,!0),Se("inclusive_end",i,o),Se("key",i,o,!0),o=o.join("&"),o=""===o?"":"?"+o,"undefined"!=typeof i.keys){var s=2e3,a="keys="+encodeURIComponent(JSON.stringify(i.keys));a.length+o.length+1<=s?o+=("?"===o[0]?"&":"?")+a:(r="POST","string"==typeof e?n={keys:i.keys}:e.keys=i.keys)}if("string"==typeof e){var c=ue(e);return t.request({method:r,url:"_design/"+c[0]+"/_view/"+c[1]+o,body:n}).then(_e(i))}return n=n||{},Object.keys(e).forEach(function(t){Array.isArray(e[t])?n[t]=e[t]:n[t]=e[t].toString()}),t.request({method:"POST",url:"_temp_view"+o,body:n}).then(_e(i))}function xe(t,e,i){return new hn(function(n,o){t._query(e,i,function(t,e){return t?o(t):void n(e)})})}function Ie(t){return new hn(function(e,i){t._viewCleanup(function(t,n){return t?i(t):void e(n)})})}function Ce(t){return function(e){if(404===e.status)return t;throw e}}function ke(t,e,i){function n(){return le(l)?hn.resolve(a):e.db.get(s)["catch"](Ce(a))}function o(t){return t.keys.length?e.db.allDocs({keys:t.keys,include_docs:!0}):hn.resolve({rows:[]})}function r(t,e){for(var i=[],n={},o=0,r=e.rows.length;r>o;o++){var s=e.rows[o],a=s.doc;if(a&&(i.push(a),n[a._id]=!0,a._deleted=!u[a._id],!a._deleted)){var c=u[a._id];"value"in c&&(a.value=c.value)}}var l=Object.keys(u);return l.forEach(function(t){if(!n[t]){var e={_id:t},o=u[t];"value"in o&&(e.value=o.value),i.push(e)}}),t.keys=zo(l.concat(t.keys)),i.push(t),i}var s="_local/doc_"+t,a={_id:s,keys:[]},c=i[t],u=c.indexableKeysToKeyValues,l=c.changes;return n().then(function(t){return o(t).then(function(e){return r(t,e)})})}function Ne(t,e,i){var n="_local/lastSeq";return t.db.get(n)["catch"](Ce({_id:n,seq:0})).then(function(n){var o=Object.keys(e);return hn.all(o.map(function(i){return ke(i,t,e)})).then(function(e){var o=Lt(e);return n.seq=i,o.push(n),t.db.bulkDocs({docs:o})})})}function De(t){var e="string"==typeof t?t:t.name,i=Mo[e];return i||(i=Mo[e]=new re),i}function ze(t){return Do(De(t),function(){return Ae(t)})()}function Ae(t){function e(t,e){var i={id:o._id,key:Co(t)};"undefined"!=typeof e&&null!==e&&(i.value=Co(e)),n.push(i)}function i(e,i){return function(){return Ne(t,e,i)}}var n,o,r;if("function"==typeof t.mapFun&&2===t.mapFun.length){var s=t.mapFun;r=function(t){return s(t,e)}}else r=ce(t.mapFun.toString(),e,me,mo,Array.isArray,JSON.parse);var a=t.seq||0,c=new re;return new hn(function(e,s){function u(){c.finish().then(function(){t.seq=a,e()})}function l(){function e(t){s(t)}t.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:a,limit:Ro}).on("complete",function(e){var s=e.results;if(!s.length)return u();for(var h={},p=0,f=s.length;f>p;p++){var d=s[p];if("_"!==d.doc._id[0]){n=[],o=d.doc,o._deleted||pe(t.sourceDB,r,[o]),n.sort(fe);for(var v,y={},_=0,g=n.length;g>_;_++){var m=n[_],S=[m.key,m.id];0===xo(m.key,v)&&S.push(_);var w=Io(S);y[w]=m,v=m.key}h[d.doc._id]={indexableKeysToKeyValues:y,changes:d.changes}}a=d.seq}return c.add(i(h,a)),s.length<Ro?u():l()}).on("error",e)}l()})}function Le(t,e,i){0===i.group_level&&delete i.group_level;var n,o=i.group||i.group_level;n=Po[t.reduceFun]?Po[t.reduceFun]:ce(t.reduceFun.toString(),null,me,mo,Array.isArray,JSON.parse);var r=[],s=isNaN(i.group_level)?Number.POSITIVE_INFINITY:i.group_level;e.forEach(function(t){var e=r[r.length-1],i=o?t.key:null;return o&&Array.isArray(i)&&(i=i.slice(0,s)),e&&0===xo(e.groupKey,i)?(e.keys.push([t.key,t.id]),void e.values.push(t.value)):void r.push({keys:[[t.key,t.id]],values:[t.value],groupKey:i})}),e=[];for(var a=0,c=r.length;c>a;a++){var u=r[a],l=pe(t.sourceDB,n,[u.keys,u.values,!1]);if(l.error&&l.error instanceof Ue)throw l.error;e.push({value:l.error?null:l.output,key:u.groupKey})}return{rows:de(e,i.limit,i.skip)}}function Me(t,e){return Do(De(t),function(){return Fe(t,e)})()}function Fe(t,e){function i(e){return e.include_docs=!0,t.db.allDocs(e).then(function(t){return o=t.total_rows,t.rows.map(function(t){if("value"in t.doc&&"object"==typeof t.doc.value&&null!==t.doc.value){var e=Object.keys(t.doc.value).sort(),i=["id","key","value"];if(!(i>e||e>i))return t.doc.value}var n=ko(t.doc._id);return{key:n[0],id:n[1],value:"value"in t.doc?t.doc.value:null}})})}function n(i){var n;if(n=r?Le(t,i,e):{total_rows:o,offset:s,rows:i},e.include_docs){var a=zo(i.map(ve));return t.sourceDB.allDocs({keys:a,include_docs:!0,conflicts:e.conflicts,attachments:e.attachments,binary:e.binary}).then(function(t){var e={};return t.rows.forEach(function(t){t.doc&&(e["$"+t.id]=t.doc)}),i.forEach(function(t){var i=ve(t),n=e["$"+i];n&&(t.doc=n)}),n})}return n}var o,r=t.reduceFun&&e.reduce!==!1,s=e.skip||0;if("undefined"==typeof e.keys||e.keys.length||(e.limit=0,delete e.keys),"undefined"!=typeof e.keys){var a=e.keys,c=a.map(function(t){var e={startkey:Io([t]),endkey:Io([t,{}])};return i(e)});return hn.all(c).then(Lt).then(n)}var u={descending:e.descending};if(e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"undefined"!=typeof e.startkey&&(u.startkey=Io(e.descending?[e.startkey,{}]:[e.startkey])),"undefined"!=typeof e.endkey){var l=e.inclusive_end!==!1;e.descending&&(l=!l),u.endkey=Io(l?[e.endkey,{}]:[e.endkey])}if("undefined"!=typeof e.key){var h=Io([e.key]),p=Io([e.key,{}]);u.descending?(u.endkey=h,u.startkey=p):(u.startkey=h,u.endkey=p)}return r||("number"==typeof e.limit&&(u.limit=e.limit),u.skip=s),i(u).then(n)}function Re(t){return t.request({method:"POST",url:"_view_cleanup"})}function Pe(t){return t.get("_local/mrviews").then(function(e){var i={};Object.keys(e.views).forEach(function(t){var e=ue(t),n="_design/"+e[0],o=e[1];i[n]=i[n]||{},i[n][o]=!0});var n={keys:Object.keys(i),include_docs:!0};return t.allDocs(n).then(function(n){var o={};n.rows.forEach(function(t){var n=t.key.substring(8);Object.keys(i[t.key]).forEach(function(i){var r=n+"/"+i;e.views[r]||(r=i);var s=Object.keys(e.views[r]),a=t.doc&&t.doc.views&&t.doc.views[i];s.forEach(function(t){o[t]=o[t]||a})})});var r=Object.keys(o).filter(function(t){return!o[t]}),s=r.map(function(e){return Do(De(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return hn.all(s).then(function(){return{ok:!0}})})},Ce({ok:!0}))}function qe(t,e,n){if("http"===t.type())return Ee(t,e,n);if("function"==typeof t._query)return xe(t,e,n);if("string"!=typeof e){Te(n,e);var o={db:t,viewName:"temp_view/temp_view",map:e.map,reduce:e.reduce,temporary:!0};return Fo.add(function(){return ae(o).then(function(t){function e(){return t.db.destroy()}return Ao(ze(t).then(function(){return Me(t,n)}),e)})}),Fo.finish()}var r=e,s=ue(r),a=s[0],c=s[1];return t.get("_design/"+a).then(function(e){var o=e.views&&e.views[c];if(!o||"string"!=typeof o.map)throw new Ve("ddoc "+a+" has no view named "+c);Te(n,o);var s={db:t,viewName:r,map:o.map,reduce:o.reduce};return ae(s).then(function(t){return"ok"===n.stale||"update_after"===n.stale?("update_after"===n.stale&&i.nextTick(function(){ze(t)}),Me(t,n)):ze(t).then(function(){return Me(t,n)})})})}function je(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,je)}catch(e){}}function Ve(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Ve)}catch(e){}}function Ue(t){this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Ue)}catch(e){}}function Be(t){return $n(Yt(t))}function He(t,e,i){function n(t){try{return Qn(t)}catch(e){var i=I(bn,"Attachment is not a valid base64 string");return{error:i}}}function o(t,i){if(t.stub)return i();if("string"==typeof t.data){var o=n(t.data);if(o.error)return i(o.error);t.length=o.length,"blob"===e?t.data=yt(o,t.content_type):"base64"===e?t.data=$n(o):t.data=o,lo(o).then(function(e){t.digest="md5-"+e,i()})}else rt(t.data,function(n){"binary"===e?t.data=Yt(n):"base64"===e&&(t.data=Be(n)),lo(n).then(function(e){t.digest="md5-"+e,t.length=n.byteLength,i()})})}function r(){a++,t.length===a&&(s?i(s):i())}if(!t.length)return i();var s,a=0;t.forEach(function(t){function e(t){s=t,n++,n===i.length&&r()}var i=t.data&&t.data._attachments?Object.keys(t.data._attachments):[],n=0;if(!i.length)return r();for(var a in t.data._attachments)t.data._attachments.hasOwnProperty(a)&&o(t.data._attachments[a],e)})}function Ge(t,e){return t.pos-e.pos}function Xe(t,e,i){for(var n,o=0,r=t.length;r>o;)n=o+r>>>1,i(t[n],e)<0?o=n+1:r=n;return o}function We(t,e,i){var n=Xe(t,e,i);t.splice(n,0,e)}function Ye(t,e){for(var i,n,o=e,r=t.length;r>o;o++){var s=t[o],a=[s.id,s.opts,[]];n?(n[2].push(a),n=a):i=n=a}return i}function Je(t,e){return t[0]<e[0]?-1:1}function Ke(t,e){for(var i=[{tree1:t,tree2:e}],n=!1;i.length>0;){var o=i.pop(),r=o.tree1,s=o.tree2;(r[1].status||s[1].status)&&(r[1].status="available"===r[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(r[2][0]){for(var c=!1,u=0;u<r[2].length;u++)r[2][u][0]===s[2][a][0]&&(i.push({tree1:r[2][u],tree2:s[2][a]}),c=!0);c||(n="new_branch",We(r[2],s[2][a],Je))}else n="new_leaf",r[2][0]=s[2][a]}return{conflicts:n,tree:t}}function Qe(t,e,i){var n,o=[],r=!1,s=!1;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var a=0,c=t.length;c>a;a++){var u=t[a];if(u.pos===e.pos&&u.ids[0]===e.ids[0])n=Ke(u.ids,e.ids),o.push({pos:u.pos,ids:n.tree}),r=r||n.conflicts,s=!0;else if(i!==!0){var l=u.pos<e.pos?u:e,h=u.pos<e.pos?e:u,p=h.pos-l.pos,f=[],d=[];for(d.push({ids:l.ids,diff:p,parent:null,parentIdx:null});d.length>0;){var v=d.pop();if(0!==v.diff)for(var y=v.ids[2],_=0,g=y.length;g>_;_++)d.push({ids:y[_],diff:v.diff-1,parent:v.ids,parentIdx:_});else v.ids[0]===h.ids[0]&&f.push(v)}var m=f[0];m?(n=Ke(m.ids,h.ids),m.parent[2][m.parentIdx]=n.tree,o.push({pos:l.pos,ids:l.ids}),r=r||n.conflicts,s=!0):o.push(u)}else o.push(u)}return s||o.push(e),o.sort(Ge),{tree:o,conflicts:r||"internal_node"}}function $e(t,e){for(var i,n=A(t),o={},r=0,s=n.length;s>r;r++){for(var a=n[r],c=a.ids,u=Math.max(0,c.length-e),l={pos:a.pos+u,ids:Ye(c,u)},h=0;u>h;h++){var p=a.pos+h+"-"+c[h].id;o[p]=!0}i=i?Qe(i,l,!0).tree:[l]}return b(i,function(t,e,i){delete o[e+"-"+i]}),{tree:i,revs:Object.keys(o)}}function Ze(t,e,i){var n=Qe(t,e),o=$e(n.tree,i);return{tree:o.tree,stemmedRevs:o.revs,conflicts:n.conflicts}}function ti(t,e){for(var i,n=t.slice(),o=e.split("-"),r=parseInt(o[0],10),s=o[1];i=n.pop();){if(i.pos===r&&i.ids[0]===s)return!0;for(var a=i.ids[2],c=0,u=a.length;u>c;c++)n.push({pos:i.pos+1,ids:a[c]})}return!1}function ei(t,e,i,n,o,r,s,a){if(ti(e.rev_tree,i.metadata.rev))return n[o]=i,r();var c=e.winningRev||v(e),u="deleted"in e?e.deleted:_(e,c),l="deleted"in i.metadata?i.metadata.deleted:_(i.metadata),h=/^1-/.test(i.metadata.rev);if(u&&!l&&a&&h){var p=i.data;p._rev=c,p._id=i.metadata.id,i=j(p,a)}var f=Ze(e.rev_tree,i.metadata.rev_tree[0],t),d=a&&(u&&l||!u&&"new_leaf"!==f.conflicts||u&&!l&&"new_branch"===f.conflicts);if(d){var y=I(yn);return n[o]=y,r()}var g=i.metadata.rev;i.metadata.rev_tree=f.tree,i.stemmedRevs=f.stemmedRevs||[],e.rev_map&&(i.metadata.rev_map=e.rev_map);var m,S=v(i.metadata),w=_(i.metadata,S),b=u===w?0:w>u?-1:1;m=g===S?w:_(i.metadata,g),s(i,S,w,m,!0,b,o,r)}function ii(t){return"missing"===t.metadata.rev_tree[0].ids[1].status}function ni(t,e,i,n,o,r,s,a,c){function u(t,e,i){var n=v(t.metadata),o=_(t.metadata,n);if("was_delete"in a&&o)return r[e]=I(vn,"deleted"),i();var c=h&&ii(t);if(c){var u=I(yn);return r[e]=u,i()}var l=o?0:1;s(t,n,o,o,!1,l,e,i)}function l(){++f===d&&c&&c()}t=t||1e3;var h=a.new_edits,p=new nn.Map,f=0,d=e.length;e.forEach(function(t,e){if(t._id&&z(t._id)){var n=t._deleted?"_removeLocal":"_putLocal";return void i[n](t,{ctx:o},function(t,i){r[e]=t||i,l()})}var s=t.metadata.id;p.has(s)?(d--,p.get(s).push([t,e])):p.set(s,[[t,e]])}),p.forEach(function(e,i){function o(){++c<e.length?a():l()}function a(){var a=e[c],l=a[0],p=a[1];if(n.has(i))ei(t,n.get(i),l,r,p,o,s,h);else{var f=Ze([],l.metadata.rev_tree[0],t);l.metadata.rev_tree=f.tree,l.stemmedRevs=f.stemmedRevs||[],u(l,p,o)}}var c=0;a()})}function oi(t){var e=[];return b(t.rev_tree,function(t,i,n,o,r){"available"!==r.status||t||(e.push(i+"-"+n),r.status="missing")}),e}function ri(t){try{return JSON.parse(t)}catch(e){return ln.parse(t)}}function si(t){return t.length<5e4?JSON.parse(t):ri(t)}function ai(t){try{return JSON.stringify(t)}catch(e){return ln.stringify(t)}}function ci(t,e,i,n){try{t.apply(e,i)}catch(o){n.emit("error",o)}}function ui(t){if(!Ko.running&&Ko.queue.length){Ko.running=!0;var e=Ko.queue.shift();e.action(function(n,o){ci(e.callback,this,[n,o],t),Ko.running=!1,i.nextTick(function(){ui(t)})})}}function li(t){return function(e){var i="unknown_error";e.target&&e.target.error&&(i=e.target.error.name||e.target.error.message),t(I(kn,i,e.type))}}function hi(t,e,i){return{data:ai(t),winningRev:e,deletedOrLocal:i?"1":"0",seq:t.seq,id:t.id}}function pi(t){if(!t)return null;var e=si(t.data);return e.winningRev=t.winningRev,e.deleted="1"===t.deletedOrLocal,e.seq=t.seq,e}function fi(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function di(t,e,i,n){i?n(t?"string"!=typeof t?t:Wt(t,e):ot([""],{type:e})):t?"string"!=typeof t?Jt(t,function(t){n($n(t))}):n(t):n("")}function vi(t,e,i,n){function o(){++a===s.length&&n&&n()}function r(t,e){var n=t._attachments[e],r=n.digest,s=i.objectStore(Go).get(r);s.onsuccess=function(t){n.body=t.target.result.body,o()}}var s=Object.keys(t._attachments||{});if(!s.length)return n&&n();var a=0;s.forEach(function(i){e.attachments&&e.include_docs?r(t,i):(t._attachments[i].stub=!0,o())})}function yi(t,e){return hn.all(t.map(function(t){if(t.doc&&t.doc._attachments){var i=Object.keys(t.doc._attachments);return hn.all(i.map(function(i){var n=t.doc._attachments[i];if("body"in n){var o=n.body,s=n.content_type;return new hn(function(a){di(o,s,e,function(e){t.doc._attachments[i]=Qi.extend(r(n,["digest","content_type"]),{data:e}),a()})})}}))}}))}function _i(t,e,i){function n(){u--,u||o()}function o(){r.length&&r.forEach(function(t){var e=c.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::",!1,!1));e.onsuccess=function(e){var i=e.target.result;i||a["delete"](t)}})}var r=[],s=i.objectStore(Ho),a=i.objectStore(Go),c=i.objectStore(Xo),u=t.length;t.forEach(function(t){var i=s.index("_doc_id_rev"),o=e+"::"+t;i.getKey(o).onsuccess=function(t){var e=t.target.result;if("number"!=typeof e)return n();s["delete"](e);var i=c.index("seq").openCursor(IDBKeyRange.only(e));i.onsuccess=function(t){var e=t.target.result;if(e){var i=e.value.digestSeq.split("::")[0];r.push(i),c["delete"](e.primaryKey),e["continue"]()}else n()}}})}function gi(t,e,i){try{return{txn:t.transaction(e,i)}}catch(n){return{error:n}}}function mi(t,e,i,n,o,r,s){function a(){var t=[Bo,Ho,Go,Yo,Xo],e=gi(o,t,"readwrite");return e.error?s(e.error):(m=e.txn,m.onabort=li(s),m.ontimeout=li(s),m.oncomplete=l,S=m.objectStore(Bo),w=m.objectStore(Ho),b=m.objectStore(Go),O=m.objectStore(Xo),void p(function(t){return t?(L=!0,s(t)):void u()}))}function c(){ni(t.revs_limit,E,n,A,m,D,f,i)}function u(){function t(){++i===E.length&&c()}function e(e){var i=pi(e.target.result);i&&A.set(i.id,i),t()}if(E.length)for(var i=0,n=0,o=E.length;o>n;n++){var r=E[n];if(r._id&&z(r._id))t();else{var s=S.get(r.metadata.id);s.onsuccess=e}}}function l(){L||(r.notify(n._meta.name),n._meta.docCount+=x,s(null,D))}function h(t,e){var i=b.get(t);i.onsuccess=function(i){if(i.target.result)e();else{var n=I(Mn,"unknown stub attachment with digest "+t);n.status=412,e(n)}}}function p(t){function e(){++o===i.length&&t(n)}var i=[];if(E.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var n=t.data._attachments[e];n.stub&&i.push(n.digest)})}),!i.length)return t();var n,o=0;i.forEach(function(t){h(t,function(t){t&&!n&&(n=t),e()})})}function f(t,e,i,n,o,r,s,a){x+=r,t.metadata.winningRev=e,t.metadata.deleted=i;var c=t.data;c._id=t.metadata.id,c._rev=t.metadata.rev,n&&(c._deleted=!0);var u=c._attachments&&Object.keys(c._attachments).length;return u?y(t,e,i,o,s,a):void v(t,e,i,o,s,a)}function d(t){var e=oi(t.metadata);_i(e,t.metadata.id,m)}function v(t,e,i,o,r,s){function a(r){o&&n.auto_compaction?d(t):t.stemmedRevs.length&&_i(t.stemmedRevs,t.metadata.id,m),h.seq=r.target.result,delete h.rev;var s=hi(h,e,i),a=S.put(s);a.onsuccess=u}function c(t){t.preventDefault(),t.stopPropagation();var e=w.index("_doc_id_rev"),i=e.getKey(l._doc_id_rev);i.onsuccess=function(t){var e=w.put(l,t.target.result);e.onsuccess=a}}function u(){D[r]={ok:!0,id:h.id,rev:e},A.set(t.metadata.id,t.metadata),_(t,h.seq,s)}var l=t.data,h=t.metadata;l._doc_id_rev=h.id+"::"+h.rev,delete l._id,delete l._rev;var p=w.put(l);p.onsuccess=a,p.onerror=c}function y(t,e,i,n,o,r){function s(){u===l.length&&v(t,e,i,n,o,r)}function a(){u++,s()}var c=t.data,u=0,l=Object.keys(c._attachments);l.forEach(function(i){var n=t.data._attachments[i];if(n.stub)u++,s();else{var o=n.data;delete n.data,n.revpos=parseInt(e,10);var r=n.digest;g(r,o,a)}})}function _(t,e,i){function n(){++r===s.length&&i()}function o(i){var o=t.data._attachments[i].digest,r=O.put({seq:e,digestSeq:o+"::"+e});r.onsuccess=n,r.onerror=function(t){t.preventDefault(),t.stopPropagation(),n()}}var r=0,s=Object.keys(t.data._attachments||{});if(!s.length)return i();for(var a=0;a<s.length;a++)o(s[a])}function g(t,e,i){var n=b.count(t);n.onsuccess=function(n){var o=n.target.result;if(o)return i();var r={digest:t,body:e},s=b.put(r);s.onsuccess=i}}for(var m,S,w,b,O,T,E=e.docs,x=0,C=0,k=E.length;k>C;C++){var N=E[C];N._id&&z(N._id)||(N=E[C]=j(N,i.new_edits),N.error&&!T&&(T=N))}if(T)return s(T);var D=new Array(E.length),A=new nn.Map,L=!1,M=n._meta.blobSupport?"blob":"base64";He(E,M,function(t){return t?s(t):void a()})}function Si(t,e,i,n,o){try{if(t&&e)return o?IDBKeyRange.bound(e,t,!i,!1):IDBKeyRange.bound(t,e,!1,!i);if(t)return o?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return o?IDBKeyRange.lowerBound(e,!i):IDBKeyRange.upperBound(e,!i);if(n)return IDBKeyRange.only(n)}catch(r){return{error:r}}return null}function wi(t,e,i,n){return"DataError"===i.name&&0===i.code?n(null,{total_rows:t._meta.docCount,offset:e.skip,rows:[]}):void n(I(kn,i.name,i.message))}function bi(t,e,i,n){function o(t,n){function o(e,i,n){var o=e.id+"::"+n;O.get(o).onsuccess=function(n){i.doc=fi(n.target.result),t.conflicts&&(i.doc._conflicts=E(e)),vi(i.doc,t,m)}}function r(e,i,n){var r={id:n.id,key:n.id,value:{rev:i}},s=n.deleted;if("ok"===t.deleted)T.push(r),s?(r.value.deleted=!0,r.doc=null):t.include_docs&&o(n,r,i);else if(!s&&p--<=0&&(T.push(r),t.include_docs&&o(n,r,i),0===--f))return;e["continue"]()}function s(t){x=e._meta.docCount;var i=t.target.result;if(i){var n=pi(i.value),o=n.winningRev;r(i,o,n)}}function a(){n(null,{total_rows:x,offset:t.skip,rows:T})}function c(){t.attachments?yi(T,t.binary).then(a):a()}var u="startkey"in t?t.startkey:!1,l="endkey"in t?t.endkey:!1,h="key"in t?t.key:!1,p=t.skip||0,f="number"==typeof t.limit?t.limit:-1,d=t.inclusive_end!==!1,v="descending"in t&&t.descending?"prev":null,y=Si(u,l,d,h,v);if(y&&y.error)return wi(e,t,y.error,n);var _=[Bo,Ho];t.attachments&&_.push(Go);var g=gi(i,_,"readonly");if(g.error)return n(g.error);var m=g.txn,S=m.objectStore(Bo),w=m.objectStore(Ho),b=v?S.openCursor(y,v):S.openCursor(y),O=w.index("_doc_id_rev"),T=[],x=0;m.oncomplete=c,b.onsuccess=s}function r(t,i){return 0===t.limit?i(null,{total_rows:e._meta.docCount,offset:t.skip,rows:[]}):void o(t,i)}r(t,n)}function Oi(t){return new hn(function(e){var i=ot([""]);t.objectStore(Jo).put(i,"key"),t.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},t.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43)}})["catch"](function(){return!1})}function Ti(t){et()?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&t.emit(e.dbName.newValue)}):it()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){t.emit(e.key)}):window.attachEvent("storage",function(e){t.emit(e.key)}))}function Ei(){rn.EventEmitter.call(this),this._listeners={},Ti(this)}function xi(t,e){var i=this;Ko.queue.push({action:function(e){Ii(i,t,e)},callback:e}),ui(i.constructor)}function Ii(t,e,n){function o(t){var e=t.createObjectStore(Bo,{keyPath:"id"});t.createObjectStore(Ho,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),t.createObjectStore(Go,{keyPath:"digest"}),t.createObjectStore(Wo,{keyPath:"id",autoIncrement:!1}),t.createObjectStore(Jo),e.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),t.createObjectStore(Yo,{keyPath:"_id"});var i=t.createObjectStore(Xo,{autoIncrement:!0});i.createIndex("seq","seq"),i.createIndex("digestSeq","digestSeq",{unique:!0})}function r(t,e){var i=t.objectStore(Bo);i.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),i.openCursor().onsuccess=function(t){var n=t.target.result;if(n){var o=n.value,r=_(o);o.deletedOrLocal=r?"1":"0",i.put(o),n["continue"]()}else e()}}function s(t){t.createObjectStore(Yo,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function a(t,e){var i=t.objectStore(Yo),n=t.objectStore(Bo),o=t.objectStore(Ho),r=n.openCursor();r.onsuccess=function(t){var r=t.target.result;if(r){var s=r.value,a=s.id,c=z(a),u=v(s);if(c){var l=a+"::"+u,h=a+"::",p=a+"::~",f=o.index("_doc_id_rev"),d=IDBKeyRange.bound(h,p,!1,!1),y=f.openCursor(d);y.onsuccess=function(t){if(y=t.target.result){var e=y.value;e._doc_id_rev===l&&i.put(e),o["delete"](y.primaryKey),y["continue"]()}else n["delete"](r.primaryKey),r["continue"]()}}else r["continue"]()}else e&&e()}}function c(t){var e=t.createObjectStore(Xo,{autoIncrement:!0});e.createIndex("seq","seq"),e.createIndex("digestSeq","digestSeq",{unique:!0})}function l(t,e){var i=t.objectStore(Ho),n=t.objectStore(Go),o=t.objectStore(Xo),r=n.count();r.onsuccess=function(t){var n=t.target.result;return n?void(i.openCursor().onsuccess=function(t){var i=t.target.result;if(!i)return e();for(var n=i.value,r=i.primaryKey,s=Object.keys(n._attachments||{}),a={},c=0;c<s.length;c++){var u=n._attachments[s[c]];a[u.digest]=!0}var l=Object.keys(a);for(c=0;c<l.length;c++){var h=l[c];o.put({seq:r,digestSeq:h+"::"+r})}i["continue"]()}):e()}}function p(t){function e(t){return t.data?pi(t):(t.deleted="1"===t.deletedOrLocal,t)}var i=t.objectStore(Ho),n=t.objectStore(Bo),o=n.openCursor();o.onsuccess=function(t){function o(){var t=a.id+"::",e=a.id+"::",n=i.index("_doc_id_rev").openCursor(IDBKeyRange.bound(t,e)),o=0;n.onsuccess=function(t){var e=t.target.result;if(!e)return a.seq=o,r();var i=e.primaryKey;i>o&&(o=i),e["continue"]()}}function r(){var t=hi(a,a.winningRev,a.deleted),e=n.put(t);e.onsuccess=function(){s["continue"]()}}var s=t.target.result;if(s){var a=e(s.value);return a.winningRev=a.winningRev||v(a),a.seq?r():void o()}}}var f=e.name,d=null;t._meta=null,t.type=function(){return"idb"},t._id=h(function(e){e(null,t._meta.instanceId)}),t._bulkDocs=function(i,n,o){mi(e,i,n,t,d,Zo,o)},t._get=function(t,e,i){function n(){i(s,{doc:o,metadata:r,ctx:a})}var o,r,s,a=e.ctx;if(!a){var c=gi(d,[Bo,Ho,Go],"readonly");if(c.error)return i(c.error);a=c.txn}a.objectStore(Bo).get(t).onsuccess=function(t){if(r=pi(t.target.result),!r)return s=I(vn,"missing"),n();if(_(r)&&!e.rev)return s=I(vn,"deleted"),n();var i=a.objectStore(Ho),c=e.rev||r.winningRev,u=r.id+"::"+c;i.index("_doc_id_rev").get(u).onsuccess=function(t){return o=t.target.result,o&&(o=fi(o)),o?void n():(s=I(vn,"missing"),n())}}},t._getAttachment=function(t,e,i){var n;if(e.ctx)n=e.ctx;else{var o=gi(d,[Bo,Ho,Go],"readonly");if(o.error)return i(o.error);n=o.txn}var r=t.digest,s=t.content_type;n.objectStore(Go).get(r).onsuccess=function(t){
var n=t.target.result.body;di(n,s,e.binary,function(t){i(null,t)})}},t._info=function(e){if(null===d||!$o.has(f)){var i=new Error("db isn't open");return i.id="idbNull",e(i)}var n,o,r=gi(d,[Ho],"readonly");if(r.error)return e(r.error);var s=r.txn,a=s.objectStore(Ho).openCursor(null,"prev");a.onsuccess=function(e){var i=e.target.result;n=i?i.key:0,o=t._meta.docCount},s.oncomplete=function(){e(null,{doc_count:o,update_seq:n,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(e,i){bi(e,t,d,i)},t._changes=function(e){function i(t){function i(){return u.seq!==s?t["continue"]():(c=s,u.winningRev===r._rev?o(r):void n())}function n(){var t=r._id+"::"+u.winningRev,e=_.get(t);e.onsuccess=function(t){o(fi(t.target.result))}}function o(i){var n=e.processChange(i,u,e);n.seq=u.seq;var o=S(n);return"object"==typeof o?e.complete(o):(o&&(m++,h&&g.push(n),e.attachments&&e.include_docs?vi(i,e,p,function(){yi([n],e.binary).then(function(){e.onChange(n)})}):e.onChange(n)),void(m!==l&&t["continue"]()))}var r=fi(t.value),s=t.key;if(a&&!a.has(r._id))return t["continue"]();var u;return(u=w.get(r._id))?i():void(y.get(r._id).onsuccess=function(t){u=pi(t.target.result),w.set(r._id,u),i()})}function n(t){var e=t.target.result;e&&i(e)}function o(){var t=[Bo,Ho];e.attachments&&t.push(Go);var i=gi(d,t,"readonly");if(i.error)return e.complete(i.error);p=i.txn,p.onabort=li(e.complete),p.oncomplete=r,v=p.objectStore(Ho),y=p.objectStore(Bo),_=v.index("_doc_id_rev");var o;o=e.descending?v.openCursor(null,"prev"):v.openCursor(IDBKeyRange.lowerBound(e.since,!0)),o.onsuccess=n}function r(){function t(){e.complete(null,{results:g,last_seq:c})}!e.continuous&&e.attachments?yi(g).then(t):t()}if(e=u(e),e.continuous){var s=f+":"+M();return Zo.addListener(f,s,t,e),Zo.notify(f),{cancel:function(){Zo.removeListener(f,s)}}}var a=e.doc_ids&&new nn.Set(e.doc_ids);e.since=e.since||0;var c=e.since,l="limit"in e?e.limit:-1;0===l&&(l=1);var h;h="return_docs"in e?e.return_docs:"returnDocs"in e?e.returnDocs:!0;var p,v,y,_,g=[],m=0,S=gt(e),w=new nn.Map;o()},t._close=function(t){return null===d?t(I(Sn)):(d.close(),$o["delete"](f),d=null,void t())},t._getRevisionTree=function(t,e){var i=gi(d,[Bo],"readonly");if(i.error)return e(i.error);var n=i.txn,o=n.objectStore(Bo).get(t);o.onsuccess=function(t){var i=pi(t.target.result);i?e(null,i.rev_tree):e(I(vn))}},t._doCompaction=function(t,e,i){var n=[Bo,Ho,Go,Xo],o=gi(d,n,"readwrite");if(o.error)return i(o.error);var r=o.txn,s=r.objectStore(Bo);s.get(t).onsuccess=function(i){var n=pi(i.target.result);b(n.rev_tree,function(t,i,n,o,r){var s=i+"-"+n;-1!==e.indexOf(s)&&(r.status="missing")}),_i(e,t,r);var o=n.winningRev,s=n.deleted;r.objectStore(Bo).put(hi(n,o,s))},r.onabort=li(i),r.oncomplete=function(){i()}},t._getLocal=function(t,e){var i=gi(d,[Yo],"readonly");if(i.error)return e(i.error);var n=i.txn,o=n.objectStore(Yo).get(t);o.onerror=li(e),o.onsuccess=function(t){var i=t.target.result;i?(delete i._doc_id_rev,e(null,i)):e(I(vn))}},t._putLocal=function(t,e,i){"function"==typeof e&&(i=e,e={}),delete t._revisions;var n=t._rev,o=t._id;n?t._rev="0-"+(parseInt(n.split("-")[1],10)+1):t._rev="0-1";var r,s=e.ctx;if(!s){var a=gi(d,[Yo],"readwrite");if(a.error)return i(a.error);s=a.txn,s.onerror=li(i),s.oncomplete=function(){r&&i(null,r)}}var c,u=s.objectStore(Yo);n?(c=u.get(o),c.onsuccess=function(o){var s=o.target.result;if(s&&s._rev===n){var a=u.put(t);a.onsuccess=function(){r={ok:!0,id:t._id,rev:t._rev},e.ctx&&i(null,r)}}else i(I(yn))}):(c=u.add(t),c.onerror=function(t){i(I(yn)),t.preventDefault(),t.stopPropagation()},c.onsuccess=function(){r={ok:!0,id:t._id,rev:t._rev},e.ctx&&i(null,r)})},t._removeLocal=function(t,e,i){"function"==typeof e&&(i=e,e={});var n=e.ctx;if(!n){var o=gi(d,[Yo],"readwrite");if(o.error)return i(o.error);n=o.txn,n.oncomplete=function(){r&&i(null,r)}}var r,s=t._id,a=n.objectStore(Yo),c=a.get(s);c.onerror=li(i),c.onsuccess=function(n){var o=n.target.result;o&&o._rev===t._rev?(a["delete"](s),r={ok:!0,id:s,rev:"0-0"},e.ctx&&i(null,r)):i(I(vn))}},t._destroy=function(t,e){Zo.removeAllListeners(f);var i=tr.get(f);i&&i.result&&(i.result.close(),$o["delete"](f));var n=indexedDB.deleteDatabase(f);n.onsuccess=function(){tr["delete"](f),it()&&f in localStorage&&delete localStorage[f],e(null,{ok:!0})},n.onerror=li(e)};var y=$o.get(f);if(y)return d=y.idb,t._meta=y.global,void i.nextTick(function(){n(null,t)});var g;g=e.storage?Ci(f,e.storage):indexedDB.open(f,Uo),tr.set(f,g),g.onupgradeneeded=function(t){function e(){var t=u[h-1];h++,t&&t(n,e)}var i=t.target.result;if(t.oldVersion<1)return o(i);var n=t.currentTarget.transaction;t.oldVersion<3&&s(i),t.oldVersion<4&&c(i);var u=[r,a,l,p],h=t.oldVersion;e()},g.onsuccess=function(e){d=e.target.result,d.onversionchange=function(){d.close(),$o["delete"](f)},d.onabort=function(t){console.error("Database has a global failure",t.target.error),d.close(),$o["delete"](f)};var i=d.transaction([Wo,Jo,Bo],"readwrite"),o=i.objectStore(Wo).get(Wo),r=null,s=null,a=null;o.onsuccess=function(e){var o=function(){null!==r&&null!==s&&null!==a&&(t._meta={name:f,instanceId:a,blobSupport:r,docCount:s},$o.set(f,{idb:d,global:t._meta}),n(null,t))},c=e.target.result||{id:Wo};f+"_id"in c?(a=c[f+"_id"],o()):(a=M(),c[f+"_id"]=a,i.objectStore(Wo).put(c).onsuccess=function(){o()}),Qo||(Qo=Oi(i)),Qo.then(function(t){r=t,o()});var u=i.objectStore(Bo).index("deletedOrLocal");u.count(IDBKeyRange.only("0")).onsuccess=function(t){s=t.target.result,o()}}},g.onerror=function(){var t="Failed to open indexedDB, are you in private browsing mode?";console.error(t),n(I(kn,t))}}function Ci(t,e){try{return indexedDB.open(t,{version:Uo,storage:e})}catch(i){return indexedDB.open(t,Uo)}}function ki(t){return decodeURIComponent(window.escape(t))}function Ni(t){return 65>t?t-48:t-55}function Di(t,e,i){for(var n="";i>e;)n+=String.fromCharCode(Ni(t.charCodeAt(e++))<<4|Ni(t.charCodeAt(e++)));return n}function zi(t,e,i){for(var n="";i>e;)n+=String.fromCharCode(Ni(t.charCodeAt(e+2))<<12|Ni(t.charCodeAt(e+3))<<8|Ni(t.charCodeAt(e))<<4|Ni(t.charCodeAt(e+1))),e+=4;return n}function Ai(t,e){return"UTF-8"===e?ki(Di(t,0,t.length)):zi(t,0,t.length)}function Li(t){return"'"+t+"'"}function Mi(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(t){return openDatabase(t.name,t.version,t.description,t.size)}:void 0}function Fi(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function Ri(t){return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function Pi(t){return t.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function qi(t){return delete t._id,delete t._rev,JSON.stringify(t)}function ji(t,e,i){return t=JSON.parse(t),t._id=e,t._rev=i,t}function Vi(t){for(var e="(";t--;)e+="?",t&&(e+=",");return e+")"}function Ui(t,e,i,n,o){return"SELECT "+t+" FROM "+("string"==typeof e?e:e.join(" JOIN "))+(i?" ON "+i:"")+(n?" WHERE "+("string"==typeof n?n:n.join(" AND ")):"")+(o?" ORDER BY "+o:"")}function Bi(t,e,i){function n(){++r===t.length&&o()}function o(){if(s.length){var t="SELECT DISTINCT digest AS digest FROM "+ar+" WHERE seq IN "+Vi(s.length);i.executeSql(t,s,function(t,e){for(var i=[],n=0;n<e.rows.length;n++)i.push(e.rows.item(n).digest);if(i.length){var o="DELETE FROM "+ar+" WHERE seq IN ("+s.map(function(){return"?"}).join(",")+")";t.executeSql(o,s,function(t){var e="SELECT digest FROM "+ar+" WHERE digest IN ("+i.map(function(){return"?"}).join(",")+")";t.executeSql(e,i,function(t,e){for(var n=new nn.Set,o=0;o<e.rows.length;o++)n.add(e.rows.item(o).digest);i.forEach(function(e){n.has(e)||(t.executeSql("DELETE FROM "+ar+" WHERE digest=?",[e]),t.executeSql("DELETE FROM "+or+" WHERE digest=?",[e]))})})})}})}}if(t.length){var r=0,s=[];t.forEach(function(t){var o="SELECT seq FROM "+nr+" WHERE doc_id=? AND rev=?";i.executeSql(o,[e,t],function(t,e){if(!e.rows.length)return n();var i=e.rows.item(0).seq;s.push(i),t.executeSql("DELETE FROM "+nr+" WHERE seq=?",[i],n)})})}}function Hi(t){return function(e){console.error("WebSQL threw an error",e);var i=e&&e.constructor.toString().match(/function ([^\(]+)/),n=i&&i[1]||e.type,o=e.target||e.message;t(I(Nn,o,n))}}function Gi(t){if("size"in t)return 1e6*t.size;var e="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return e?5e6:1}function Xi(t,e){try{return{db:t(e)}}catch(i){return{error:i}}}function Wi(t){var e=cr.get(t.name);if(!e){var i=Mi();e=Xi(i,t),cr.set(t.name,e),e.db&&(e.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return e}function Yi(t,e,i,n,o,r,s){function a(){return m?s(m):(r.notify(n._name),n._docCount=-1,void s(null,S))}function c(t,e){var i="SELECT count(*) as cnt FROM "+or+" WHERE digest=?";g.executeSql(i,[t],function(i,n){if(0===n.rows.item(0).cnt){var o=I(Mn,"unknown stub attachment with digest "+t);e(o)}else e()})}function u(t){function e(){++o===i.length&&t(n)}var i=[];if(y.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){var n=t.data._attachments[e];n.stub&&i.push(n.digest)})}),!i.length)return t();var n,o=0;i.forEach(function(t){c(t,function(t){t&&!n&&(n=t),e()})})}function l(t,e,i,o,r,s,a,c){function u(){function e(t,e){function n(){return++r===s.length&&e(),!1}function o(e){var o="INSERT INTO "+ar+" (digest, seq) VALUES (?,?)",r=[i._attachments[e].digest,t];g.executeSql(o,r,n,n)}var r=0,s=Object.keys(i._attachments||{});if(!s.length)return e();for(var a=0;a<s.length;a++)o(s[a])}var i=t.data,n=o?1:0,r=i._id,s=i._rev,a=qi(i),c="INSERT INTO "+nr+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",u=[r,s,a,n];g.executeSql(c,u,function(t,i){var n=i.insertId;e(n,function(){p(t,n)})},function(){var t=Ui("seq",nr,null,"doc_id=? AND rev=?");return g.executeSql(t,[r,s],function(t,i){var o=i.rows.item(0).seq,c="UPDATE "+nr+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",u=[a,n,r,s];t.executeSql(c,u,function(t){e(o,function(){p(t,o)})})}),!1})}function l(t){d||(t?(d=t,c(d)):v===y.length&&u())}function h(t){v++,l(t)}function p(i,o){var s=t.metadata.id;r&&n.auto_compaction?Bi(oi(t.metadata),s,i):t.stemmedRevs.length&&Bi(t.stemmedRevs,s,i),t.metadata.seq=o,delete t.metadata.rev;var u=r?"UPDATE "+ir+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+nr+" WHERE doc_id="+ir+".id AND rev=?) WHERE id=?":"INSERT INTO "+ir+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",l=ai(t.metadata),h=r?[l,o,e,s]:[s,o,o,l];i.executeSql(u,h,function(){S[a]={ok:!0,id:t.metadata.id,rev:e},w.set(s,t.metadata),c()})}var d=null,v=0;t.data._id=t.metadata.id,t.data._rev=t.metadata.rev;var y=Object.keys(t.data._attachments||{});o&&(t.data._deleted=!0),y.forEach(function(i){var n=t.data._attachments[i];if(n.stub)v++,l();else{var o=n.data;delete n.data,n.revpos=parseInt(e,10);var r=n.digest;f(r,o,h)}}),y.length||u()}function h(){ni(t.revs_limit,y,n,w,g,S,l,i)}function p(t){function e(){++i===y.length&&t()}if(!y.length)return t();var i=0;y.forEach(function(t){if(t._id&&z(t._id))return e();var i=t.metadata.id;g.executeSql("SELECT json FROM "+ir+" WHERE id = ?",[i],function(t,n){if(n.rows.length){var o=si(n.rows.item(0).json);w.set(i,o)}e()})})}function f(t,e,i){var n="SELECT digest FROM "+or+" WHERE digest=?";g.executeSql(n,[t],function(o,r){return r.rows.length?i():(n="INSERT INTO "+or+" (digest, body, escaped) VALUES (?,?,1)",void o.executeSql(n,[t,Ri(e)],function(){i()},function(){return i(),!1}))})}var d=i.new_edits,v=e.docs,y=v.map(function(t){if(t._id&&z(t._id))return t;var e=j(t,d);return e}),_=y.filter(function(t){return t.error});if(_.length)return s(_[0]);var g,m,S=new Array(y.length),w=new nn.Map;He(y,"binary",function(t){return t?s(t):void o.transaction(function(t){g=t,u(function(t){t?m=t:p(h)})},Hi(s),a)})}function Ji(t,e,i,n,o){function s(){++u===c.length&&o&&o()}function a(t,o){var a=t._attachments[o],c={binary:e.binary,ctx:n};i._getAttachment(a,c,function(e,i){t._attachments[o]=Qi.extend(r(a,["digest","content_type"]),{data:i}),s()})}var c=Object.keys(t._attachments||{});if(!c.length)return o&&o();var u=0;c.forEach(function(i){e.attachments&&e.include_docs?a(t,i):(t._attachments[i].stub=!0,s())})}function Ki(t,e){function i(){it()&&(window.localStorage["_pouch__websqldb_"+m._name]=!0),e(null,m)}function n(t,e){t.executeSql(fr),t.executeSql("ALTER TABLE "+nr+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){t.executeSql(hr),t.executeSql("ALTER TABLE "+ir+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){t.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+ir+" (local, id)");var i="SELECT "+ir+".winningseq AS seq, "+ir+".json AS metadata FROM "+nr+" JOIN "+ir+" ON "+nr+".seq = "+ir+".winningseq";t.executeSql(i,[],function(t,i){for(var n=[],o=[],r=0;r<i.rows.length;r++){var s=i.rows.item(r),a=s.seq,c=JSON.parse(s.metadata);_(c)&&n.push(a),z(c.id)&&o.push(c.id)}t.executeSql("UPDATE "+ir+"SET local = 1 WHERE id IN "+Vi(o.length),o,function(){t.executeSql("UPDATE "+nr+" SET deleted = 1 WHERE seq IN "+Vi(n.length),n,e)})})})})}function o(t,e){var i="CREATE TABLE IF NOT EXISTS "+rr+" (id UNIQUE, rev, json)";t.executeSql(i,[],function(){var i="SELECT "+ir+".id AS id, "+nr+".json AS data FROM "+nr+" JOIN "+ir+" ON "+nr+".seq = "+ir+".winningseq WHERE local = 1";t.executeSql(i,[],function(t,i){function n(){if(!o.length)return e(t);var i=o.shift(),r=JSON.parse(i.data)._rev;t.executeSql("INSERT INTO "+rr+" (id, rev, json) VALUES (?,?,?)",[i.id,r,i.data],function(t){t.executeSql("DELETE FROM "+ir+" WHERE id=?",[i.id],function(t){t.executeSql("DELETE FROM "+nr+" WHERE seq=?",[i.seq],function(){n()})})})}for(var o=[],r=0;r<i.rows.length;r++)o.push(i.rows.item(r));n()})})}function r(t,e){function i(i){function n(){if(!i.length)return e(t);var o=i.shift(),r=Ai(o.hex,g),s=r.lastIndexOf("::"),a=r.substring(0,s),c=r.substring(s+2),u="UPDATE "+nr+" SET doc_id=?, rev=? WHERE doc_id_rev=?";t.executeSql(u,[a,c,r],function(){n()})}n()}var n="ALTER TABLE "+nr+" ADD COLUMN doc_id";t.executeSql(n,[],function(t){var e="ALTER TABLE "+nr+" ADD COLUMN rev";t.executeSql(e,[],function(t){t.executeSql(pr,[],function(t){var e="SELECT hex(doc_id_rev) as hex FROM "+nr;t.executeSql(e,[],function(t,e){for(var n=[],o=0;o<e.rows.length;o++)n.push(e.rows.item(o));i(n)})})})})}function s(t,e){function i(t){var i="SELECT COUNT(*) AS cnt FROM "+or;t.executeSql(i,[],function(t,i){function n(){var i=Ui(_r+", "+ir+".id AS id",[ir,nr],yr,null,ir+".id ");i+=" LIMIT "+s+" OFFSET "+r,r+=s,t.executeSql(i,[],function(t,i){function o(t,e){var i=r[t]=r[t]||[];-1===i.indexOf(e)&&i.push(e)}if(!i.rows.length)return e(t);for(var r={},s=0;s<i.rows.length;s++)for(var a=i.rows.item(s),c=ji(a.data,a.id,a.rev),u=Object.keys(c._attachments||{}),l=0;l<u.length;l++){var h=c._attachments[u[l]];o(h.digest,a.seq)}var p=[];if(Object.keys(r).forEach(function(t){var e=r[t];e.forEach(function(e){p.push([t,e])})}),!p.length)return n();var f=0;p.forEach(function(e){var i="INSERT INTO "+ar+" (digest, seq) VALUES (?,?)";t.executeSql(i,e,function(){++f===p.length&&n()})})})}var o=i.rows.item(0).cnt;if(!o)return e(t);var r=0,s=10;n()})}var n="CREATE TABLE IF NOT EXISTS "+ar+" (digest, seq INTEGER)";t.executeSql(n,[],function(t){t.executeSql(vr,[],function(t){t.executeSql(dr,[],i)})})}function a(t,e){var i="ALTER TABLE "+or+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";t.executeSql(i,[],e)}function c(t,e){var i="ALTER TABLE "+ir+" ADD COLUMN max_seq INTEGER";t.executeSql(i,[],function(t){var i="UPDATE "+ir+" SET max_seq=(SELECT MAX(seq) FROM "+nr+" WHERE doc_id=id)";t.executeSql(i,[],function(t){var i="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+ir+" (max_seq)";t.executeSql(i,[],e)})})}function l(t,e){t.executeSql('SELECT HEX("a") AS hex',[],function(t,i){var n=i.rows.item(0).hex;g=2===n.length?"UTF-8":"UTF-16",e()})}function p(){for(;O.length>0;){var t=O.pop();t(null,S)}}function f(t,e){if(0===e){var i="CREATE TABLE IF NOT EXISTS "+sr+" (dbid, db_version INTEGER)",u="CREATE TABLE IF NOT EXISTS "+or+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",l="CREATE TABLE IF NOT EXISTS "+ar+" (digest, seq INTEGER)",h="CREATE TABLE IF NOT EXISTS "+ir+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",f="CREATE TABLE IF NOT EXISTS "+nr+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",d="CREATE TABLE IF NOT EXISTS "+rr+" (id UNIQUE, rev, json)";t.executeSql(u),t.executeSql(d),t.executeSql(l,[],function(){t.executeSql(dr),t.executeSql(vr)}),t.executeSql(h,[],function(){t.executeSql(fr),t.executeSql(f,[],function(){t.executeSql(hr),t.executeSql(pr),t.executeSql(i,[],function(){var e="INSERT INTO "+sr+" (db_version, dbid) VALUES (?,?)";S=M();var i=[er,S];t.executeSql(e,i,function(){p()})})})})}else{var v=function(){var i=er>e;i&&t.executeSql("UPDATE "+sr+" SET db_version = "+er);var n="SELECT dbid FROM "+sr;t.executeSql(n,[],function(t,e){S=e.rows.item(0).dbid,p()})},y=[n,o,r,s,a,c,v],_=e,g=function(t){y[_-1](t,g),_++};g(t)}}function d(){C.transaction(function(t){l(t,function(){v(t)})},Hi(e),i)}function v(t){var e="SELECT sql FROM sqlite_master WHERE tbl_name = "+sr;t.executeSql(e,[],function(t,e){e.rows.length?/db_version/.test(e.rows.item(0).sql)?t.executeSql("SELECT db_version FROM "+sr,[],function(t,e){var i=e.rows.item(0).db_version;f(t,i)}):t.executeSql("ALTER TABLE "+sr+" ADD COLUMN db_version INTEGER",[],function(){f(t,1)}):f(t,0)})}function y(t,e){if(-1!==m._docCount)return e(m._docCount);var i=Ui("COUNT("+ir+".id) AS 'num'",[ir,nr],yr,nr+".deleted=0");t.executeSql(i,[],function(t,i){m._docCount=i.rows.item(0).num,e(m._docCount)})}var g,m=this,S=null,w=Gi(t),O=[];m._docCount=-1,m._name=t.name;var T=Qi.extend({},t,{size:w,version:lr}),x=Wi(T);if(x.error)return Hi(e)(x.error);var C=x.db;"function"!=typeof C.readTransaction&&(C.readTransaction=C.transaction),d(),m.type=function(){return"websql"},m._id=h(function(t){t(null,S)}),m._info=function(t){C.readTransaction(function(e){y(e,function(i){var n="SELECT MAX(seq) AS seq FROM "+nr;e.executeSql(n,[],function(e,n){var o=n.rows.item(0).seq||0;t(null,{doc_count:i,update_seq:o,sqlite_plugin:C._sqlitePlugin,websql_encoding:g})})})},Hi(t))},m._bulkDocs=function(e,i,n){Yi(t,e,i,m,C,ur,n)},m._get=function(t,e,i){function n(){i(s,{doc:o,metadata:r,ctx:a})}var o,r,s,a=e.ctx;if(!a)return C.readTransaction(function(n){m._get(t,Qi.extend({ctx:n},e),i)});var c,u;e.rev?(c=Ui(_r,[ir,nr],ir+".id="+nr+".doc_id",[nr+".doc_id=?",nr+".rev=?"]),u=[t,e.rev]):(c=Ui(_r,[ir,nr],yr,ir+".id=?"),u=[t]),a.executeSql(c,u,function(t,i){if(!i.rows.length)return s=I(vn,"missing"),n();var a=i.rows.item(0);return r=si(a.metadata),a.deleted&&!e.rev?(s=I(vn,"deleted"),n()):(o=ji(a.data,r.id,a.rev),void n())})},m._allDocs=function(t,e){var i,n=[],o="startkey"in t?t.startkey:!1,r="endkey"in t?t.endkey:!1,s="key"in t?t.key:!1,a="descending"in t?t.descending:!1,c="limit"in t?t.limit:-1,u="skip"in t?t.skip:0,l=t.inclusive_end!==!1,h=[],p=[];if(s!==!1)p.push(ir+".id = ?"),h.push(s);else if(o!==!1||r!==!1){if(o!==!1&&(p.push(ir+".id "+(a?"<=":">=")+" ?"),h.push(o)),r!==!1){var f=a?">":"<";l&&(f+="="),p.push(ir+".id "+f+" ?"),h.push(r)}s!==!1&&(p.push(ir+".id = ?"),h.push(s))}"ok"!==t.deleted&&p.push(nr+".deleted = 0"),C.readTransaction(function(e){y(e,function(o){if(i=o,0!==c){var r=Ui(_r,[ir,nr],yr,p,ir+".id "+(a?"DESC":"ASC"));r+=" LIMIT "+c+" OFFSET "+u,e.executeSql(r,h,function(e,i){for(var o=0,r=i.rows.length;r>o;o++){var s=i.rows.item(o),a=si(s.metadata),c=a.id,u=ji(s.data,c,s.rev),l=u._rev,h={id:c,key:c,value:{rev:l}};if(t.include_docs&&(h.doc=u,h.doc._rev=l,t.conflicts&&(h.doc._conflicts=E(a)),Ji(h.doc,t,m,e)),s.deleted){if("ok"!==t.deleted)continue;h.value.deleted=!0,h.doc=null}n.push(h)}})}})},Hi(e),function(){e(null,{total_rows:i,offset:t.skip,rows:n})})},m._changes=function(t){function e(){var e=ir+".json AS metadata, "+ir+".max_seq AS maxSeq, "+nr+".json AS winningDoc, "+nr+".rev AS winningRev ",i=ir+" JOIN "+nr,c=ir+".id="+nr+".doc_id AND "+ir+".winningseq="+nr+".seq",u=["maxSeq > ?"],l=[t.since];t.doc_ids&&(u.push(ir+".id IN "+Vi(t.doc_ids.length)),l=l.concat(t.doc_ids));var h="maxSeq "+(n?"DESC":"ASC"),p=Ui(e,i,c,u,h),f=gt(t);t.view||t.filter||(p+=" LIMIT "+o);var d=t.since||0;C.readTransaction(function(e){e.executeSql(p,l,function(e,i){function n(e){return function(){t.onChange(e)}}for(var c=0,u=i.rows.length;u>c;c++){var l=i.rows.item(c),h=si(l.metadata);d=l.maxSeq;var p=ji(l.winningDoc,h.id,l.winningRev),v=t.processChange(p,h,t);v.seq=l.maxSeq;var y=f(v);if("object"==typeof y)return t.complete(y);if(y&&(a++,r&&s.push(v),t.attachments&&t.include_docs?Ji(p,t,m,e,n(v)):n(v)()),a===o)break}})},Hi(t.complete),function(){t.continuous||t.complete(null,{results:s,last_seq:d})})}if(t=u(t),t.continuous){var i=m._name+":"+M();return ur.addListener(m._name,i,m,t),ur.notify(m._name),{cancel:function(){ur.removeListener(m._name,i)}}}var n=t.descending;t.since=t.since&&!n?t.since:0;var o="limit"in t?t.limit:-1;0===o&&(o=1);var r;r="return_docs"in t?t.return_docs:"returnDocs"in t?t.returnDocs:!0;var s=[],a=0;e()},m._close=function(t){t()},m._getAttachment=function(t,e,i){var n,o=e.ctx,r=t.digest,s=t.content_type,a="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+or+" WHERE digest=?";o.executeSql(a,[r],function(t,o){var r=o.rows.item(0),a=r.escaped?Pi(r.body):Ai(r.body,g);n=e.binary?yt(a,s):$n(a),i(null,n)})},m._getRevisionTree=function(t,e){C.readTransaction(function(i){var n="SELECT json AS metadata FROM "+ir+" WHERE id = ?";i.executeSql(n,[t],function(t,i){if(i.rows.length){var n=si(i.rows.item(0).metadata);e(null,n.rev_tree)}else e(I(vn))})})},m._doCompaction=function(t,e,i){return e.length?void C.transaction(function(i){var n="SELECT json AS metadata FROM "+ir+" WHERE id = ?";i.executeSql(n,[t],function(i,n){var o=si(n.rows.item(0).metadata);b(o.rev_tree,function(t,i,n,o,r){var s=i+"-"+n;-1!==e.indexOf(s)&&(r.status="missing")});var r="UPDATE "+ir+" SET json = ? WHERE id = ?";i.executeSql(r,[ai(o),t])}),Bi(e,t,i)},Hi(i),function(){i()}):i()},m._getLocal=function(t,e){C.readTransaction(function(i){var n="SELECT json, rev FROM "+rr+" WHERE id=?";i.executeSql(n,[t],function(i,n){if(n.rows.length){var o=n.rows.item(0),r=ji(o.json,t,o.rev);e(null,r)}else e(I(vn))})})},m._putLocal=function(t,e,i){function n(t){var n,u;r?(n="UPDATE "+rr+" SET rev=?, json=? WHERE id=? AND rev=?",u=[o,c,s,r]):(n="INSERT INTO "+rr+" (id, rev, json) VALUES (?,?,?)",u=[s,o,c]),t.executeSql(n,u,function(t,n){n.rowsAffected?(a={ok:!0,id:s,rev:o},e.ctx&&i(null,a)):i(I(yn))},function(){return i(I(yn)),!1})}"function"==typeof e&&(i=e,e={}),delete t._revisions;var o,r=t._rev,s=t._id;o=r?t._rev="0-"+(parseInt(r.split("-")[1],10)+1):t._rev="0-1";var a,c=qi(t);e.ctx?n(e.ctx):C.transaction(n,Hi(i),function(){a&&i(null,a)})},m._removeLocal=function(t,e,i){function n(n){var r="DELETE FROM "+rr+" WHERE id=? AND rev=?",s=[t._id,t._rev];n.executeSql(r,s,function(n,r){return r.rowsAffected?(o={ok:!0,id:t._id,rev:"0-0"},void(e.ctx&&i(null,o))):i(I(vn))})}"function"==typeof e&&(i=e,e={});var o;e.ctx?n(e.ctx):C.transaction(n,Hi(i),function(){o&&i(null,o)})},m._destroy=function(t,e){ur.removeAllListeners(m._name),C.transaction(function(t){var e=[ir,nr,or,sr,rr,ar];e.forEach(function(e){t.executeSql("DROP TABLE IF EXISTS "+e,[])})},Hi(e),function(){it()&&(delete window.localStorage["_pouch__websqldb_"+m._name],delete window.localStorage[m._name]),e(null,{ok:!0})})}}var Qi=t(8),$i=o(Qi),Zi=o(t(4)),tn=o(t(7)),en=o(t(9)),nn=t(13),on=o(t(1)),rn=t(2),sn=o(t(14)),an=t(11),cn=o(an),un=o(t(15)),ln=o(t(16)),hn="function"==typeof Promise?Promise:en,pn=Zi("pouchdb:api");tn(x,Error),x.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var fn=new x({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),dn=new x({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),vn=new x({status:404,error:"not_found",reason:"missing"}),yn=new x({status:409,error:"conflict",reason:"Document update conflict"}),_n=new x({status:400,error:"invalid_id",reason:"_id field must contain a string"}),gn=new x({status:412,error:"missing_id",reason:"_id is required for puts"}),mn=new x({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),Sn=new x({status:412,error:"precondition_failed",reason:"Database not open"}),wn=new x({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),bn=new x({status:500,error:"badarg",reason:"Some query argument is invalid"}),On=new x({status:400,error:"invalid_request",reason:"Request was invalid"}),Tn=new x({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),En=new x({status:500,error:"doc_validation",reason:"Bad special document member"}),xn=new x({status:400,error:"bad_request",reason:"Something wrong with the request"}),In=new x({status:400,error:"bad_request",reason:"Document must be a JSON object"}),Cn=new x({status:404,error:"not_found",reason:"Database not found"}),kn=new x({status:500,error:"indexed_db_went_bad",reason:"unknown"}),Nn=new x({status:500,error:"web_sql_went_bad",reason:"unknown"}),Dn=new x({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),zn=new x({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),An=new x({status:400,error:"bad_request",reason:"Invalid rev format"}),Ln=new x({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),Mn=new x({status:412,error:"missing_stub"}),Fn=new x({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),Rn={UNAUTHORIZED:fn,MISSING_BULK_DOCS:dn,MISSING_DOC:vn,REV_CONFLICT:yn,INVALID_ID:_n,MISSING_ID:gn,RESERVED_ID:mn,NOT_OPEN:Sn,UNKNOWN_ERROR:wn,BAD_ARG:bn,INVALID_REQUEST:On,QUERY_PARSE_ERROR:Tn,DOC_VALIDATION:En,BAD_REQUEST:xn,NOT_AN_OBJECT:In,DB_MISSING:Cn,WSQ_ERROR:Nn,LDB_ERROR:Dn,FORBIDDEN:zn,INVALID_REV:An,FILE_EXISTS:Ln,MISSING_STUB:Mn,IDB_ERROR:kn,INVALID_URL:Fn},Pn=function(t,e,i){var n=Object.keys(Rn).filter(function(i){var n=Rn[i];return"function"!=typeof n&&n[t]===e}),o=i&&n.filter(function(t){var e=Rn[t];return e.message===i})[0]||n[0];return o?Rn[o]:null};tn(k,rn.EventEmitter),k.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},k.prototype.doChanges=function(t){var e=this,i=t.complete;if(t=u(t),"live"in t&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=N,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"===t.since)return void this.db.info().then(function(n){return e.isCancelled?void i(null,{status:"cancelled"}):(t.since=n.update_seq,void e.doChanges(t))},i);if(t.continuous&&"now"!==t.since&&this.db.info().then(function(t){e.startSeq=t.update_seq},function(t){if("idbNull"!==t.id)throw t}),t.filter&&"string"==typeof t.filter&&("_view"===t.filter?t.view=w(t.view):t.filter=w(t.filter),"http"!==this.db.type()&&!t.doc_ids))return this.filterChanges(t);"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=i;var n=this.db._changes(t);if(n&&"function"==typeof n.cancel){var o=e.cancel;e.cancel=on(function(t){n.cancel(),o.apply(this,t)})}},k.prototype.filterChanges=function(t){var e=this,i=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var n=I(xn,"`view` filter parameter not found or invalid.");return i(n)}var o=S(t.view);this.db.get("_design/"+o[0],function(n,r){if(e.isCancelled)return i(null,{status:"cancelled"});if(n)return i(C(n));var s=r&&r.views&&r.views[o[1]]&&r.views[o[1]].map;return s?(t.filter=m(s),void e.doChanges(t)):i(I(vn,r.views?"missing json key: "+o[1]:"missing json key: views"))})}else{var r=S(t.filter);if(!r)return e.doChanges(t);this.db.get("_design/"+r[0],function(n,o){if(e.isCancelled)return i(null,{status:"cancelled"});if(n)return i(C(n));var s=o&&o.filters&&o.filters[r[1]];return s?(t.filter=g(s),void e.doChanges(t)):i(I(vn,o&&o.filters?"missing json key: "+r[1]:"missing json key: filters"))})}};var qn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),jn=F(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Vn=F(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);tn(K,rn.EventEmitter),K.prototype.post=p("post",function(t,e,i){return"function"==typeof e&&(i=e,e={}),"object"!=typeof t||Array.isArray(t)?i(I(In)):void this.bulkDocs({docs:[t]},e,B(i))}),K.prototype.put=p("put",on(function(t){var e,i,n,o,r=t.shift(),s="_id"in r;if("object"!=typeof r||Array.isArray(r))return(o=t.pop())(I(In));for(;e=t.shift(),i=typeof e,"string"!==i||s?"string"!==i||!s||"_rev"in r?"object"===i?n=e:"function"===i&&(o=e):r._rev=e:(r._id=e,s=!0),t.length;);return n=n||{},R(r._id),z(r._id)&&"function"==typeof this._putLocal?r._deleted?this._removeLocal(r,o):this._putLocal(r,o):void this.bulkDocs({docs:[r]},n,B(o))})),K.prototype.putAttachment=p("putAttachment",function(t,e,i,n,o){function r(t){var i="_rev"in t?parseInt(t._rev,10):0;return t._attachments=t._attachments||{},t._attachments[e]={content_type:o,data:n,revpos:++i},s.put(t)}var s=this;return"function"==typeof o&&(o=n,n=i,i=null),"undefined"==typeof o&&(o=n,n=i,i=null),s.get(t).then(function(t){if(t._rev!==i)throw I(yn);return r(t)},function(e){if(e.reason===vn.message)return r({_id:t});throw e})}),K.prototype.removeAttachment=p("removeAttachment",function(t,e,i,n){var o=this;o.get(t,function(t,r){return t?void n(t):r._rev!==i?void n(I(yn)):r._attachments?(delete r._attachments[e],0===Object.keys(r._attachments).length&&delete r._attachments,void o.put(r,n)):n()})}),K.prototype.remove=p("remove",function(t,e,i,n){var o;"string"==typeof e?(o={_id:t,_rev:e},"function"==typeof i&&(n=i,i={})):(o=t,"function"==typeof e?(n=e,i={}):(n=i,i=e)),i=i||{},i.was_delete=!0;var r={_id:o._id,_rev:o._rev||i.rev};return r._deleted=!0,z(r._id)&&"function"==typeof this._removeLocal?this._removeLocal(o,n):void this.bulkDocs({docs:[r]},i,B(n))}),K.prototype.revsDiff=p("revsDiff",function(t,e,i){function n(t,e){a.has(t)||a.set(t,{missing:[]}),a.get(t).missing.push(e)}function o(e,i){var o=t[e].slice(0);b(i,function(t,i,r,s,a){var c=i+"-"+r,u=o.indexOf(c);-1!==u&&(o.splice(u,1),"available"!==a.status&&n(e,c))}),o.forEach(function(t){n(e,t)})}"function"==typeof e&&(i=e,e={});var r=Object.keys(t);if(!r.length)return i(null,{});var s=0,a=new nn.Map;r.map(function(e){this._getRevisionTree(e,function(n,c){if(n&&404===n.status&&"missing"===n.message)a.set(e,{missing:t[e]});else{if(n)return i(n);o(e,c)}if(++s===r.length){var u={};return a.forEach(function(t,e){u[e]=t}),i(null,u)}})},this)}),K.prototype.bulkGet=p("bulkGet",function(t,e){D(this,t,e)}),K.prototype.compactDocument=p("compactDocument",function(t,e,i){var n=this;this._getRevisionTree(t,function(o,r){if(o)return i(o);var s=X(r),a=[],c=[];Object.keys(s).forEach(function(t){s[t]>e&&a.push(t)}),b(r,function(t,e,i,n,o){var r=e+"-"+i;"available"===o.status&&-1!==a.indexOf(r)&&c.push(r)}),n._doCompaction(t,c,i)})}),K.prototype.compact=p("compact",function(t,e){"function"==typeof t&&(e=t,t={});var i=this;t=t||{},i._compactionQueue=i._compactionQueue||[],i._compactionQueue.push({opts:t,callback:e}),1===i._compactionQueue.length&&Y(i)}),K.prototype._compact=function(t,e){function i(t){s.push(o.compactDocument(t.id,0))}function n(t){var i=t.last_seq;hn.all(s).then(function(){return f(o,"_local/compaction",function(t){return!t.last_seq||t.last_seq<i?(t.last_seq=i,t):!1})}).then(function(){e(null,{ok:!0})})["catch"](e)}var o=this,r={return_docs:!1,last_seq:t.last_seq||0},s=[];o.changes(r).on("change",i).on("complete",n).on("error",e)},K.prototype.get=p("get",function(t,e,i){
function n(){var n=[],s=o.length;return s?void o.forEach(function(o){r.get(t,{rev:o,revs:e.revs,attachments:e.attachments},function(t,e){t?n.push({missing:o}):n.push({ok:e}),s--,s||i(null,n)})}):i(null,n)}if("function"==typeof e&&(i=e,e={}),"string"!=typeof t)return i(I(_n));if(z(t)&&"function"==typeof this._getLocal)return this._getLocal(t,i);var o=[],r=this;if(!e.open_revs)return this._get(t,e,function(t,n){if(t)return i(t);var o=n.doc,s=n.metadata,a=n.ctx;if(e.conflicts){var c=E(s);c.length&&(o._conflicts=c)}if(_(s,o._rev)&&(o._deleted=!0),e.revs||e.revs_info){var u=A(s.rev_tree),l=U(u,function(t){return-1!==t.ids.map(function(t){return t.id}).indexOf(o._rev.split("-")[1])}),h=l.ids.map(function(t){return t.id}).indexOf(o._rev.split("-")[1])+1,p=l.ids.length-h;if(l.ids.splice(h,p),l.ids.reverse(),e.revs&&(o._revisions={start:l.pos+l.ids.length-1,ids:l.ids.map(function(t){return t.id})}),e.revs_info){var f=l.pos+l.ids.length;o._revs_info=l.ids.map(function(t){return f--,{rev:f+"-"+t.id,status:t.opts.status}})}}if(e.attachments&&o._attachments){var d=o._attachments,v=Object.keys(d).length;if(0===v)return i(null,o);Object.keys(d).forEach(function(t){this._getAttachment(d[t],{binary:e.binary,ctx:a},function(e,n){var r=o._attachments[t];r.data=n,delete r.stub,delete r.length,--v||i(null,o)})},r)}else{if(o._attachments)for(var y in o._attachments)o._attachments.hasOwnProperty(y)&&(o._attachments[y].stub=!0);i(null,o)}});if("all"===e.open_revs)this._getRevisionTree(t,function(t,e){return t?i(t):(o=T(e).map(function(t){return t.rev}),void n())});else{if(!Array.isArray(e.open_revs))return i(I(wn,"function_clause"));o=e.open_revs;for(var s=0;s<o.length;s++){var a=o[s];if("string"!=typeof a||!/^\d+-/.test(a))return i(I(An))}n()}}),K.prototype.getAttachment=p("getAttachment",function(t,e,i,n){var o=this;i instanceof Function&&(n=i,i={}),this._get(t,i,function(t,r){return t?n(t):r.doc._attachments&&r.doc._attachments[e]?(i.ctx=r.ctx,i.binary=!0,void o._getAttachment(r.doc._attachments[e],i,n)):n(I(vn))})}),K.prototype.allDocs=p("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip="undefined"!=typeof t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var i=["startkey","endkey","key"].filter(function(e){return e in t})[0];if(i)return void e(I(Tn,"Query parameter `"+i+"` is not compatible with multi-get"));if("http"!==this.type())return W(this,t,e)}return this._allDocs(t,e)}),K.prototype.changes=function(t,e){return"function"==typeof t&&(e=t,t={}),new k(this,t,e)},K.prototype.close=p("close",function(t){return this._closed=!0,this._close(t)}),K.prototype.info=p("info",function(t){var e=this;this._info(function(i,n){return i?t(i):(n.db_name=n.db_name||e._db_name,n.auto_compaction=!(!e.auto_compaction||"http"===e.type()),n.adapter=e.type(),void t(null,n))})}),K.prototype.id=p("id",function(t){return this._id(t)}),K.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},K.prototype.bulkDocs=p("bulkDocs",function(t,e,i){if("function"==typeof e&&(i=e,e={}),e=e||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return i(I(dn));for(var n=0;n<t.docs.length;++n)if("object"!=typeof t.docs[n]||Array.isArray(t.docs[n]))return i(I(In));var o;return t.docs.forEach(function(t){t._attachments&&Object.keys(t._attachments).forEach(function(t){o=o||J(t)})}),o?i(I(xn,o)):("new_edits"in e||("new_edits"in t?e.new_edits=t.new_edits:e.new_edits=!0),e.new_edits||"http"===this.type()||t.docs.sort(G),H(t.docs),this._bulkDocs(t,e,function(t,n){return t?i(t):(e.new_edits||(n=n.filter(function(t){return t.error})),void i(null,n))}))}),K.prototype.registerDependentDatabase=p("registerDependentDatabase",function(t,e){function i(e){return e.dependentDbs=e.dependentDbs||{},e.dependentDbs[t]?!1:(e.dependentDbs[t]=!0,e)}var n=new this.constructor(t,this.__opts);f(this,"_local/_pouch_dependentDbs",i).then(function(){e(null,{db:n})})["catch"](e)}),K.prototype.destroy=p("destroy",function(t,e){function i(){n._destroy(t,function(t,i){return t?e(t):(n._destroyed=!0,n.emit("destroyed"),void e(null,i||{ok:!0}))})}"function"==typeof t&&(e=t,t={});var n=this,o="use_prefix"in n?n.use_prefix:!0;return"http"===n.type()?i():void n.get("_local/_pouch_dependentDbs",function(t,r){if(t)return 404!==t.status?e(t):i();var s=r.dependentDbs,a=n.constructor,c=Object.keys(s).map(function(t){var e=o?t.replace(new RegExp("^"+a.prefix),""):t;return new a(e,n.__opts).destroy()});hn.all(c).then(i,e)})}),Q.prototype.execute=function(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()},Q.prototype.fail=function(t){this.failed=t,this.execute()},Q.prototype.ready=function(t){this.isReady=!0,this.db=t,this.execute()},Q.prototype.addTask=function(t){this.queue.push(t),this.failed&&this.execute()},tn(tt,K),tt.debug=Zi;var Un;if(et())Un=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),Un=!!localStorage.getItem("_pouch_check_localstorage")}catch(Bn){Un=!1}tt.adapters={},tt.preferredAdapters=[],tt.prefix="_pouch_";var Hn=new rn.EventEmitter;nt(tt),tt.parseAdapter=function(t,e){var i,n,o=t.match(/([a-z\-]*):\/\/(.*)/);if(o){if(t=/http(s?)/.test(o[1])?o[1]+"://"+o[2]:o[2],i=o[1],!tt.adapters[i].valid())throw"Invalid adapter";return{name:t,adapter:o[1]}}var r="idb"in tt.adapters&&"websql"in tt.adapters&&it()&&localStorage["_pouch__websqldb_"+tt.prefix+t];if(e.adapter)n=e.adapter;else if("undefined"!=typeof e&&e.db)n="leveldb";else for(var s=0;s<tt.preferredAdapters.length;++s)if(n=tt.preferredAdapters[s],n in tt.adapters){if(r&&"idb"===n){console.log('PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}i=tt.adapters[n];var a=i&&"use_prefix"in i?i.use_prefix:!0;return{name:a?tt.prefix+t:t,adapter:n}},tt.adapter=function(t,e,i){e.valid()&&(tt.adapters[t]=e,i&&tt.preferredAdapters.push(t))},tt.plugin=function(t){return Object.keys(t).forEach(function(e){tt.prototype[e]=t[e]}),tt},tt.defaults=function(t){function e(i,n,o){return this instanceof e?(("function"==typeof n||"undefined"==typeof n)&&(o=n,n={}),i&&"object"==typeof i&&(n=i,i=void 0),n=Qi.extend({},t,n),void tt.call(this,i,n,o)):new e(i,n,o)}return tn(e,tt),nt(e),e.preferredAdapters=tt.preferredAdapters.slice(),Object.keys(tt).forEach(function(t){t in e||(e[t]=tt[t])}),e};var Gn=ut(),Xn=function(){},Wn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Yn="queryKey",Jn=/(?:^|&)([^&=]*)=?([^&]*)/g,Kn=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Qn=function(t){return atob(t)},$n=function(t){return btoa(t)},Zn=$i.extend,to={ajax:ft,parseUri:dt,uuid:M,Promise:hn,atob:Qn,btoa:$n,binaryStringToBlobOrBuffer:yt,clone:u,extend:Zn,createError:I},eo=cn.collate,io=1,no="pouchdb",oo=5,ro=0;wt.prototype.writeCheckpoint=function(t,e){var i=this;return this.updateTarget(t,e).then(function(){return i.updateSource(t,e)})},wt.prototype.updateTarget=function(t,e){return St(this.target,this.id,t,e,this.returnValue)},wt.prototype.updateSource=function(t,e){var i=this;return this.readOnlySource?hn.resolve(!0):St(this.src,this.id,t,e,this.returnValue)["catch"](function(t){if(Et(t))return i.readOnlySource=!0,!0;throw t})};var so={undefined:function(t,e){return 0===eo(t.last_seq,e.last_seq)?e.last_seq:0},1:function(t,e){return bt(e,t).last_seq}};wt.prototype.getCheckpoint=function(){var t=this;return t.target.get(t.id).then(function(e){return t.readOnlySource?hn.resolve(e.last_seq):t.src.get(t.id).then(function(t){if(e.version!==t.version)return ro;var i;return i=e.version?e.version.toString():"undefined",i in so?so[i](e,t):ro},function(i){if(404===i.status&&e.last_seq)return t.src.put({_id:t.id,last_seq:ro}).then(function(){return ro},function(i){return Et(i)?(t.readOnlySource=!0,e.last_seq):ro});throw i})})["catch"](function(t){if(404!==t.status)throw t;return ro})};var ao=0,co=n.setImmediate||n.setTimeout,uo=32768,lo=h(function(t,e){function i(){var n=a*r,o=n+r;if(a++,s>a)u(c,t,n,o),co(i);else{u(c,t,n,o);var l=c.end(!0),h=kt(l);e(null,h),c.destroy()}}var n="string"==typeof t,o=n?t.length:t.byteLength,r=Math.min(uo,o),s=Math.ceil(o/r),a=0,c=n?new un:new un.ArrayBuffer,u=n?Dt:Nt;i()});tn(Ut,rn.EventEmitter),Ut.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Ut.prototype.ready=function(t,e){function i(){o.cancel()}function n(){t.removeListener("destroyed",i),e.removeListener("destroyed",i)}var o=this;o._readyCalled||(o._readyCalled=!0,t.once("destroyed",i),e.once("destroyed",i),o.once("complete",n))};var ho={replicate:Ht,toPouch:Bt},po=ho.replicate;tn(Xt,rn.EventEmitter),Xt.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var fo=25,vo=50,yo={},_o=1800,go=Zi("pouchdb:http");oe.valid=function(){return!0},re.prototype.add=function(t){return this.promise=this.promise["catch"](function(){}).then(function(){return t()}),this.promise},re.prototype.finish=function(){return this.promise};var mo,So=function(t,e){return e&&t.then(function(t){i.nextTick(function(){e(null,t)})},function(t){i.nextTick(function(){e(t)})}),t},wo=function(t){return on(function(e){var i=e.pop(),n=t.apply(this,e);return"function"==typeof i&&So(n,i),n})},bo=function(t,e){return t.then(function(t){return e().then(function(){return t})},function(t){return e().then(function(){throw t})})},Oo=function(t,e){return function(){var i=arguments,n=this;return t.add(function(){return e.apply(n,i)})}},To=function(t){for(var e={},i=0,n=t.length;n>i;i++)e["$"+t[i]]=!0;var o=Object.keys(e),r=new Array(o.length);for(i=0,n=o.length;n>i;i++)r[i]=o[i].substring(1);return r},Eo={uniq:To,sequentialize:Oo,fin:bo,callbackify:wo,promisedCallback:So},xo=cn.collate,Io=cn.toIndexableString,Co=cn.normalizeKey,ko=cn.parseIndexableString;mo="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var No=Eo.callbackify,Do=Eo.sequentialize,zo=Eo.uniq,Ao=Eo.fin,Lo=Eo.promisedCallback,Mo={},Fo=new re,Ro=50,Po={_sum:function(t,e){return me(e)},_count:function(t,e){return e.length},_stats:function(t,e){function i(t){for(var e=0,i=0,n=t.length;n>i;i++){var o=t[i];e+=o*o}return e}return{sum:me(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:i(e)}}},qo=No(function(){var t=this;return"http"===t.type()?Re(t):"function"==typeof t._viewCleanup?Ie(t):Pe(t)}),jo=function(t,e,i){"function"==typeof e&&(i=e,e={}),e=e?be(e):{},"function"==typeof t&&(t={map:t});var n=this,o=hn.resolve().then(function(){return qe(n,t,e)});return Lo(o,i),o};tn(je,Error),tn(Ve,Error),tn(Ue,Error);var Vo={query:jo,viewCleanup:qo},Uo=5,Bo="document-store",Ho="by-sequence",Go="attach-store",Xo="attach-seq-store",Wo="meta-store",Yo="local-store",Jo="detect-blob-support",Ko={running:!1,queue:[]};tn(Ei,rn.EventEmitter),Ei.prototype.addListener=function(t,e,i,n){function o(){function t(){a=!1}if(s._listeners[e]){if(a)return void(a="waiting");a=!0;var c=r(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);i.changes(c).on("change",function(t){t.seq>n.since&&!n.cancelled&&(n.since=t.seq,n.onChange(t))}).on("complete",function(){"waiting"===a&&setTimeout(function(){o()},0),a=!1}).on("error",t)}}if(!this._listeners[e]){var s=this,a=!1;this._listeners[e]=o,this.on(t,o)}},Ei.prototype.removeListener=function(t,e){e in this._listeners&&rn.EventEmitter.prototype.removeListener.call(this,t,this._listeners[e])},Ei.prototype.notifyLocalWindows=function(t){et()?chrome.storage.local.set({dbName:t}):it()&&(localStorage[t]="a"===localStorage[t]?"b":"a")},Ei.prototype.notify=function(t){this.emit(t),this.notifyLocalWindows(t)};var Qo,$o=new nn.Map,Zo=new Ei,tr=new nn.Map;xi.valid=function(){var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return!t&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var er=7,ir=Li("document-store"),nr=Li("by-sequence"),or=Li("attach-store"),rr=Li("local-store"),sr=Li("metadata-store"),ar=Li("attach-seq-store"),cr=new nn.Map,ur=new Ei,lr=1,hr="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+nr+" (seq, deleted)",pr="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+nr+" (doc_id, rev)",fr="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+ir+" (winningseq)",dr="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+ar+" (seq)",vr="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+ar+" (digest, seq)",yr=nr+".seq = "+ir+".winningseq",_r=nr+".seq AS seq, "+nr+".deleted AS deleted, "+nr+".json AS data, "+nr+".rev AS rev, "+ir+".json AS metadata";Ki.use_prefix=!("undefined"!=typeof i&&!i.browser),Ki.valid=Fi;var gr={idb:xi,websql:Ki};tt.ajax=ft,tt.utils=to,tt.Errors=Rn,tt.replicate=ho.replicate,tt.sync=Gt,tt.version="5.3.3-prerelease",tt.adapter("http",oe),tt.adapter("https",oe),tt.plugin(Vo),Object.keys(gr).forEach(function(t){tt.adapter(t,gr[t],!0)}),e.exports=tt}).call(this,t(3),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,11:11,13:13,14:14,15:15,16:16,2:2,3:3,4:4,7:7,8:8,9:9}]},{},[17])(17)}),function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return o(i?i:e)},u,u.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){function n(t,e){return t+e}function o(t,e){return t=t.replace(/<(?:.|\n)*?>/gm," "),e.pipeline.run(d.tokenizer(t))}function r(t,e){var i;if(t.deepField){i=e;for(var n=0,o=t.deepField.length;o>n;n++)i=i&&i[t.deepField[n]]}else i=e[t.field];return i&&(Array.isArray(i)?i=i.join(" "):"string"!=typeof i&&(i=i.toString())),i}function s(t,e,i,n){return function(s,a){if(!l(s,i,n)){for(var c=[],u=0,h=t.length;h>u;u++){var p,f=t[u],d=r(f,s);if(d){for(var v=o(d,e),y=0,_=v.length;_>y;y++)if(v[y].length>2){var S=v[y],w=t.length>1?u:void 0;a(g+S,w)}p=Math.sqrt(v.length)}else p=0;c.push(p)}a(m+s._id,c)}}}function a(t,e,i,o,r){var s=Object.keys(i).map(function(s){var a=i[s],c=o[s],u=t.map(function(t){return a.map(function(i,n){var o=c[n];if(!(t in i))return 0;var s=e[t],a=i[t],u=a/s,l=1/s,h=r[n].boost;return u*l*h/o}).reduce(n,0)}),l=0;return u.forEach(function(t){t>l&&(l=t)}),{id:s,score:l}});return s.sort(function(t,e){return t.score<e.score?1:t.score>e.score?-1:0}),s}function c(t,e){return y.all(e.map(function(e){return t.get(e.id)})).then(function(t){t.forEach(function(t,i){e[i].doc=t})}).then(function(){return e})}function u(t,e,i,n,o){var s=e.highlighting_pre||"<strong>",a=e.highlighting_post||"</strong>";return y.all(i.map(function(e){return y.resolve().then(function(){return e.doc?e.doc:t.get(e.id)}).then(function(t){e.highlighting={},o[e.id].forEach(function(i,o){var c=n[o],u=c.field,l=r(c,t);Object.keys(i).forEach(function(t){var i=new RegExp("("+t+"[a-z]*)","gi"),n=s+"$1"+a;l=l.replace(i,n),e.highlighting[u]=l})})})})).then(function(){return i})}function l(t,e,i){try{return!(!e||e(t))}catch(n){return i.emit("error",n),!0}}var h="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},p=t("pouchdb-mapreduce-no-ddocs");Object.keys(p).forEach(function(t){i[t]=p[t]});var f=t("./pouch-utils"),d=t("lunr"),v=t("uniq"),y=f.Promise,_={},g="a",m="b";i.search=f.toPromise(function(t,e){var i=this;t=f.extend(!0,{},t);var n=t.query||t.q,r="mm"in t?parseFloat(t.mm)/100:1,l=t.fields,p=t.highlighting,y=t.include_docs,S=t.destroy,w=t.stale,b=t.limit,O=t.build,T=t.skip||0,E=t.language||"en",x=t.filter;if(Array.isArray(l)){var I={};l.forEach(function(t){I[t]=1}),l=I}var C=Object.keys(l).map(function(t){var e=-1!==t.indexOf(".")&&t.split(".");return{field:t,deepField:e,boost:l[t]}}),k=_[E];k||(k=_[E]=d(),"en"!==E&&k.use(h.lunr[E]));var N={language:E,fields:C.map(function(t){return t.field}).sort()};x&&(N.filter=x.toString());var D="search-"+f.MD5(JSON.stringify(N)),z=s(C,k,x,i),A={saveAs:D};if(S)return A.destroy=!0,i._search_query(z,A,e);if(O)return delete A.stale,A.limit=0,void i._search_query(z,A).then(function(){e(null,{ok:!0})})["catch"](e);var L=v(o(n,k));return L.length?(A.keys=L.map(function(t){return g+t}),"string"==typeof w&&(A.stale=w),void i._search_query(z,A).then(function(n){if(!n.rows.length)return e(null,{rows:[]});var o={},s={};if(n.rows.forEach(function(t){var e=t.key.substring(1),i=t.value||0;if(e in s?s[e]++:s[e]=1,!(t.id in o))for(var n=o[t.id]=[],r=0;r<C.length;r++)n[r]={};var a=o[t.id][i];e in a?a[e]++:a[e]=1}),L.length>1&&Object.keys(o).forEach(function(t){var e={},i=o[t];Object.keys(i).forEach(function(t){Object.keys(i[t]).forEach(function(t){e[t]=!0})});var n=Object.keys(e).length,s=n/L.length;Math.floor(100*s)/100<r&&delete o[t]}),!Object.keys(o).length)return e(null,{rows:[]});var l=Object.keys(o).map(function(t){return m+t}),h={saveAs:D,keys:l};return i._search_query(z,h).then(function(t){var e={};t.rows.forEach(function(t){e[t.id]=t.value});var i=a(L,s,o,e,C);return i}).then(function(t){return"number"==typeof b&&b>=0?t.slice(T,T+b):T>0?t.slice(T):t}).then(function(t){return y?c(i,t):t}).then(function(e){return p?u(i,t,e,C,o):e}).then(function(t){e(null,{rows:t})})})["catch"](e)):e(null,{rows:[]})}),"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(i)},{"./pouch-utils":38,lunr:24,"pouchdb-mapreduce-no-ddocs":29,uniq:37}],2:[function(t,e,i){"use strict";function n(t){return function(){var e=arguments.length;if(e){for(var i=[],n=-1;++n<e;)i[n]=arguments[n];return t.call(this,i)}return t.call(this,[])}}e.exports=n},{}],3:[function(t,e,i){},{}],4:[function(t,e,i){var n=e.exports={};n.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var i=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(t){i.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")}},{}],5:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],6:[function(t,e,i){"use strict";function n(){}e.exports=n},{}],7:[function(t,e,i){"use strict";function n(t){function e(t,e){function o(t){u[e]=t,++l===i&!n&&(n=!0,c.resolve(p,u))}s(t).then(o,function(t){n||(n=!0,c.reject(p,t))})}if("[object Array]"!==Object.prototype.toString.call(t))return r(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return s([]);for(var u=new Array(i),l=0,h=-1,p=new o(a);++h<i;)e(t[h],h);return p}var o=t("./promise"),r=t("./reject"),s=t("./resolve"),a=t("./INTERNAL"),c=t("./handlers");e.exports=n},{"./INTERNAL":6,"./handlers":8,"./promise":10,"./reject":13,"./resolve":14}],8:[function(t,e,i){"use strict";function n(t){var e=t&&t.then;return t&&"object"==typeof t&&"function"==typeof e?function(){e.apply(t,arguments)}:void 0}var o=t("./tryCatch"),r=t("./resolveThenable"),s=t("./states");i.resolve=function(t,e){var a=o(n,e);if("error"===a.status)return i.reject(t,a.value);var c=a.value;if(c)r.safely(t,c);else{t.state=s.FULFILLED,t.outcome=e;for(var u=-1,l=t.queue.length;++u<l;)t.queue[u].callFulfilled(e)}return t},i.reject=function(t,e){t.state=s.REJECTED,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t}},{"./resolveThenable":15,"./states":16,"./tryCatch":17}],9:[function(t,e,i){e.exports=i=t("./promise"),i.resolve=t("./resolve"),i.reject=t("./reject"),i.all=t("./all"),i.race=t("./race")},{"./all":7,"./promise":10,"./race":12,"./reject":13,"./resolve":14}],10:[function(t,e,i){"use strict";function n(t){if(!(this instanceof n))return new n(t);if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=a.PENDING,this.queue=[],this.outcome=void 0,t!==r&&s.safely(this,t)}var o=t("./unwrap"),r=t("./INTERNAL"),s=t("./resolveThenable"),a=t("./states"),c=t("./queueItem");e.exports=n,n.prototype["catch"]=function(t){return this.then(null,t)},n.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a.FULFILLED||"function"!=typeof e&&this.state===a.REJECTED)return this;var i=new n(r);if(this.state!==a.PENDING){var s=this.state===a.FULFILLED?t:e;o(i,s,this.outcome)}else this.queue.push(new c(i,t,e));return i}},{"./INTERNAL":6,"./queueItem":11,"./resolveThenable":15,"./states":16,"./unwrap":18}],11:[function(t,e,i){"use strict";function n(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}var o=t("./handlers"),r=t("./unwrap");e.exports=n,n.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},n.prototype.otherCallFulfilled=function(t){r(this.promise,this.onFulfilled,t)},n.prototype.callRejected=function(t){o.reject(this.promise,t)},n.prototype.otherCallRejected=function(t){r(this.promise,this.onRejected,t)}},{"./handlers":8,"./unwrap":18}],12:[function(t,e,i){"use strict";function n(t){function e(t){s(t).then(function(t){n||(n=!0,c.resolve(l,t))},function(t){n||(n=!0,c.reject(l,t))})}if("[object Array]"!==Object.prototype.toString.call(t))return r(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return s([]);for(var u=-1,l=new o(a);++u<i;)e(t[u]);return l}var o=t("./promise"),r=t("./reject"),s=t("./resolve"),a=t("./INTERNAL"),c=t("./handlers");e.exports=n},{"./INTERNAL":6,"./handlers":8,"./promise":10,"./reject":13,"./resolve":14}],13:[function(t,e,i){"use strict";function n(t){var e=new o(r);return s.reject(e,t)}var o=t("./promise"),r=t("./INTERNAL"),s=t("./handlers");e.exports=n},{"./INTERNAL":6,"./handlers":8,"./promise":10}],14:[function(t,e,i){"use strict";function n(t){if(t)return t instanceof o?t:s.resolve(new o(r),t);var e=typeof t;switch(e){case"boolean":return a;case"undefined":return u;case"object":return c;case"number":return l;case"string":return h}}var o=t("./promise"),r=t("./INTERNAL"),s=t("./handlers");e.exports=n;var a=s.resolve(new o(r),!1),c=s.resolve(new o(r),null),u=s.resolve(new o(r),void 0),l=s.resolve(new o(r),0),h=s.resolve(new o(r),"")},{"./INTERNAL":6,"./handlers":8,"./promise":10}],15:[function(t,e,i){"use strict";function n(t,e){function i(e){a||(a=!0,o.reject(t,e))}function n(e){a||(a=!0,o.resolve(t,e))}function s(){e(n,i)}var a=!1,c=r(s);"error"===c.status&&i(c.value)}var o=t("./handlers"),r=t("./tryCatch");i.safely=n},{"./handlers":8,"./tryCatch":17}],16:[function(t,e,i){i.REJECTED=["REJECTED"],i.FULFILLED=["FULFILLED"],i.PENDING=["PENDING"]},{}],17:[function(t,e,i){"use strict";function n(t,e){var i={};try{i.value=t(e),i.status="success"}catch(n){i.status="error",i.value=n}return i}e.exports=n},{}],18:[function(t,e,i){"use strict";function n(t,e,i){o(function(){var n;try{n=e(i)}catch(o){return r.reject(t,o)}n===t?r.reject(t,new TypeError("Cannot resolve promise with itself")):r.resolve(t,n)})}var o=t("immediate"),r=t("./handlers");e.exports=n},{"./handlers":8,immediate:19}],19:[function(t,e,i){"use strict";function n(){r=!0;for(var t,e,i=c.length;i;){for(e=c,c=[],t=-1;++t<i;)e[t]();i=c.length}r=!1}function o(t){1!==c.push(t)||r||s()}for(var r,s,a=[t("./nextTick"),t("./mutation.js"),t("./messageChannel"),t("./stateChange"),t("./timeout")],c=[],u=-1,l=a.length;++u<l;)if(a[u]&&a[u].test&&a[u].test()){s=a[u].install(n);break}e.exports=o},{"./messageChannel":20,"./mutation.js":21,"./nextTick":3,"./stateChange":22,"./timeout":23}],20:[function(t,e,i){var n="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};i.test=function(){return n.setImmediate?!1:"undefined"!=typeof n.MessageChannel},i.install=function(t){var e=new n.MessageChannel;return e.port1.onmessage=t,function(){e.port2.postMessage(0)}}},{}],21:[function(t,e,i){var n="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},o=n.MutationObserver||n.WebKitMutationObserver;i.test=function(){return o},i.install=function(t){var e=0,i=new o(t),r=n.document.createTextNode("");return i.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}},{}],22:[function(t,e,i){var n="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};i.test=function(){return"document"in n&&"onreadystatechange"in n.document.createElement("script")},i.install=function(t){return function(){var e=n.document.createElement("script");return e.onreadystatechange=function(){t(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},n.document.documentElement.appendChild(e),t}}},{}],23:[function(t,e,i){"use strict";i.test=function(){return!0},i.install=function(t){return function(){setTimeout(t,0)}}},{}],24:[function(t,e,i){!function(){var t=function(e){var i=new t.Index;return i.pipeline.add(t.trimmer,t.stopWordFilter,t.stemmer),e&&e.call(i,i),i};t.version="0.5.5",t.utils={},t.utils.warn=function(t){return function(e){t.console&&console.warn&&console.warn(e)}}(this),t.EventEmitter=function(){this.events={}},t.EventEmitter.prototype.addListener=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),i=t;if("function"!=typeof e)throw new TypeError("last argument must be a function");i.forEach(function(t){this.hasHandler(t)||(this.events[t]=[]),this.events[t].push(e)},this)},t.EventEmitter.prototype.removeListener=function(t,e){if(this.hasHandler(t)){var i=this.events[t].indexOf(e);this.events[t].splice(i,1),this.events[t].length||delete this.events[t]}},t.EventEmitter.prototype.emit=function(t){if(this.hasHandler(t)){var e=Array.prototype.slice.call(arguments,1);this.events[t].forEach(function(t){t.apply(void 0,e)})}},t.EventEmitter.prototype.hasHandler=function(t){return t in this.events},t.tokenizer=function(t){if(!arguments.length||null==t||void 0==t)return[];if(Array.isArray(t))return t.map(function(t){return t.toLowerCase()});for(var e=t.toString().replace(/^\s+/,""),i=e.length-1;i>=0;i--)if(/\S/.test(e.charAt(i))){e=e.substring(0,i+1);break}return e.split(/(?:\s+|\-)/).filter(function(t){return!!t}).map(function(t){return t.toLowerCase()})},t.Pipeline=function(){this._stack=[]},t.Pipeline.registeredFunctions={},t.Pipeline.registerFunction=function(e,i){i in this.registeredFunctions&&t.utils.warn("Overwriting existing registered function: "+i),e.label=i,t.Pipeline.registeredFunctions[e.label]=e},t.Pipeline.warnIfFunctionNotRegistered=function(e){var i=e.label&&e.label in this.registeredFunctions;i||t.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",e)},t.Pipeline.load=function(e){var i=new t.Pipeline;return e.forEach(function(e){var n=t.Pipeline.registeredFunctions[e];if(!n)throw new Error("Cannot load un-registered function: "+e);i.add(n)}),i},t.Pipeline.prototype.add=function(){var e=Array.prototype.slice.call(arguments);e.forEach(function(e){t.Pipeline.warnIfFunctionNotRegistered(e),this._stack.push(e)},this)},t.Pipeline.prototype.after=function(e,i){t.Pipeline.warnIfFunctionNotRegistered(i);var n=this._stack.indexOf(e)+1;this._stack.splice(n,0,i)},t.Pipeline.prototype.before=function(e,i){t.Pipeline.warnIfFunctionNotRegistered(i);var n=this._stack.indexOf(e);this._stack.splice(n,0,i)},t.Pipeline.prototype.remove=function(t){var e=this._stack.indexOf(t);this._stack.splice(e,1)},t.Pipeline.prototype.run=function(t){for(var e=[],i=t.length,n=this._stack.length,o=0;i>o;o++){for(var r=t[o],s=0;n>s&&(r=this._stack[s](r,o,t),void 0!==r);s++);void 0!==r&&e.push(r)}return e},t.Pipeline.prototype.reset=function(){this._stack=[]},t.Pipeline.prototype.toJSON=function(){return this._stack.map(function(e){return t.Pipeline.warnIfFunctionNotRegistered(e),e.label})},t.Vector=function(){this._magnitude=null,this.list=void 0,this.length=0},t.Vector.Node=function(t,e,i){this.idx=t,this.val=e,this.next=i},t.Vector.prototype.insert=function(e,i){var n=this.list;if(!n)return this.list=new t.Vector.Node(e,i,n),this.length++;for(var o=n,r=n.next;void 0!=r;){if(e<r.idx)return o.next=new t.Vector.Node(e,i,r),this.length++;o=r,r=r.next}return o.next=new t.Vector.Node(e,i,r),this.length++},t.Vector.prototype.magnitude=function(){if(this._magniture)return this._magnitude;for(var t,e=this.list,i=0;e;)t=e.val,i+=t*t,e=e.next;return this._magnitude=Math.sqrt(i)},t.Vector.prototype.dot=function(t){for(var e=this.list,i=t.list,n=0;e&&i;)e.idx<i.idx?e=e.next:e.idx>i.idx?i=i.next:(n+=e.val*i.val,e=e.next,i=i.next);return n},t.Vector.prototype.similarity=function(t){return this.dot(t)/(this.magnitude()*t.magnitude())},t.SortedSet=function(){this.length=0,this.elements=[]},t.SortedSet.load=function(t){var e=new this;return e.elements=t,e.length=t.length,e},t.SortedSet.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(t){~this.indexOf(t)||this.elements.splice(this.locationFor(t),0,t)},this),this.length=this.elements.length},t.SortedSet.prototype.toArray=function(){return this.elements.slice()},t.SortedSet.prototype.map=function(t,e){return this.elements.map(t,e)},t.SortedSet.prototype.forEach=function(t,e){return this.elements.forEach(t,e)},t.SortedSet.prototype.indexOf=function(t,e,i){var e=e||0,i=i||this.elements.length,n=i-e,o=e+Math.floor(n/2),r=this.elements[o];return 1>=n?r===t?o:-1:t>r?this.indexOf(t,o,i):r>t?this.indexOf(t,e,o):r===t?o:void 0},t.SortedSet.prototype.locationFor=function(t,e,i){var e=e||0,i=i||this.elements.length,n=i-e,o=e+Math.floor(n/2),r=this.elements[o];if(1>=n){if(r>t)return o;if(t>r)return o+1}return t>r?this.locationFor(t,o,i):r>t?this.locationFor(t,e,o):void 0},t.SortedSet.prototype.intersect=function(e){for(var i=new t.SortedSet,n=0,o=0,r=this.length,s=e.length,a=this.elements,c=e.elements;;){if(n>r-1||o>s-1)break;a[n]!==c[o]?a[n]<c[o]?n++:a[n]>c[o]&&o++:(i.add(a[n]),n++,o++)}return i},t.SortedSet.prototype.clone=function(){var e=new t.SortedSet;return e.elements=this.toArray(),e.length=e.elements.length,e},t.SortedSet.prototype.union=function(t){var e,i,n;return this.length>=t.length?(e=this,i=t):(e=t,i=this),n=e.clone(),n.add.apply(n,i.toArray()),n},t.SortedSet.prototype.toJSON=function(){return this.toArray()},t.Index=function(){this._fields=[],this._ref="id",this.pipeline=new t.Pipeline,this.documentStore=new t.Store,this.tokenStore=new t.TokenStore,this.corpusTokens=new t.SortedSet,this.eventEmitter=new t.EventEmitter,this._idfCache={},this.on("add","remove","update",function(){this._idfCache={}}.bind(this))},t.Index.prototype.on=function(){var t=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,t)},t.Index.prototype.off=function(t,e){return this.eventEmitter.removeListener(t,e)},t.Index.load=function(e){e.version!==t.version&&t.utils.warn("version mismatch: current "+t.version+" importing "+e.version);var i=new this;return i._fields=e.fields,i._ref=e.ref,i.documentStore=t.Store.load(e.documentStore),i.tokenStore=t.TokenStore.load(e.tokenStore),i.corpusTokens=t.SortedSet.load(e.corpusTokens),i.pipeline=t.Pipeline.load(e.pipeline),
i},t.Index.prototype.field=function(t,e){var e=e||{},i={name:t,boost:e.boost||1};return this._fields.push(i),this},t.Index.prototype.ref=function(t){return this._ref=t,this},t.Index.prototype.add=function(e,i){var n={},o=new t.SortedSet,r=e[this._ref],i=void 0===i?!0:i;this._fields.forEach(function(i){var r=this.pipeline.run(t.tokenizer(e[i.name]));n[i.name]=r,t.SortedSet.prototype.add.apply(o,r)},this),this.documentStore.set(r,o),t.SortedSet.prototype.add.apply(this.corpusTokens,o.toArray());for(var s=0;s<o.length;s++){var a=o.elements[s],c=this._fields.reduce(function(t,e){var i=n[e.name].length;if(!i)return t;var o=n[e.name].filter(function(t){return t===a}).length;return t+o/i*e.boost},0);this.tokenStore.add(a,{ref:r,tf:c})}i&&this.eventEmitter.emit("add",e,this)},t.Index.prototype.remove=function(t,e){var i=t[this._ref],e=void 0===e?!0:e;if(this.documentStore.has(i)){var n=this.documentStore.get(i);this.documentStore.remove(i),n.forEach(function(t){this.tokenStore.remove(t,i)},this),e&&this.eventEmitter.emit("remove",t,this)}},t.Index.prototype.update=function(t,e){var e=void 0===e?!0:e;this.remove(t,!1),this.add(t,!1),e&&this.eventEmitter.emit("update",t,this)},t.Index.prototype.idf=function(t){var e="@"+t;if(Object.prototype.hasOwnProperty.call(this._idfCache,e))return this._idfCache[e];var i=this.tokenStore.count(t),n=1;return i>0&&(n=1+Math.log(this.tokenStore.length/i)),this._idfCache[e]=n},t.Index.prototype.search=function(e){var i=this.pipeline.run(t.tokenizer(e)),n=new t.Vector,o=[],r=this._fields.reduce(function(t,e){return t+e.boost},0),s=i.some(function(t){return this.tokenStore.has(t)},this);if(!s)return[];i.forEach(function(e,i,s){var a=1/s.length*this._fields.length*r,c=this,u=this.tokenStore.expand(e).reduce(function(i,o){var r=c.corpusTokens.indexOf(o),s=c.idf(o),u=1,l=new t.SortedSet;if(o!==e){var h=Math.max(3,o.length-e.length);u=1/Math.log(h)}return r>-1&&n.insert(r,a*s*u),Object.keys(c.tokenStore.get(o)).forEach(function(t){l.add(t)}),i.union(l)},new t.SortedSet);o.push(u)},this);var a=o.reduce(function(t,e){return t.intersect(e)});return a.map(function(t){return{ref:t,score:n.similarity(this.documentVector(t))}},this).sort(function(t,e){return e.score-t.score})},t.Index.prototype.documentVector=function(e){for(var i=this.documentStore.get(e),n=i.length,o=new t.Vector,r=0;n>r;r++){var s=i.elements[r],a=this.tokenStore.get(s)[e].tf,c=this.idf(s);o.insert(this.corpusTokens.indexOf(s),a*c)}return o},t.Index.prototype.toJSON=function(){return{version:t.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},t.Index.prototype.use=function(t){var e=Array.prototype.slice.call(arguments,1);e.unshift(this),t.apply(this,e)},t.Store=function(){this.store={},this.length=0},t.Store.load=function(e){var i=new this;return i.length=e.length,i.store=Object.keys(e.store).reduce(function(i,n){return i[n]=t.SortedSet.load(e.store[n]),i},{}),i},t.Store.prototype.set=function(t,e){this.store[t]=e,this.length=Object.keys(this.store).length},t.Store.prototype.get=function(t){return this.store[t]},t.Store.prototype.has=function(t){return t in this.store},t.Store.prototype.remove=function(t){this.has(t)&&(delete this.store[t],this.length--)},t.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},t.stemmer=function(){var t={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},e={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},i="[^aeiou]",n="[aeiouy]",o=i+"[^aeiouy]*",r=n+"[aeiou]*",s="^("+o+")?"+r+o,a="^("+o+")?"+r+o+"("+r+")?$",c="^("+o+")?"+r+o+r+o,u="^("+o+")?"+n;return function(i){var r,l,h,p,f,d,v;if(i.length<3)return i;if(h=i.substr(0,1),"y"==h&&(i=h.toUpperCase()+i.substr(1)),p=/^(.+?)(ss|i)es$/,f=/^(.+?)([^s])s$/,p.test(i)?i=i.replace(p,"$1$2"):f.test(i)&&(i=i.replace(f,"$1$2")),p=/^(.+?)eed$/,f=/^(.+?)(ed|ing)$/,p.test(i)){var y=p.exec(i);p=new RegExp(s),p.test(y[1])&&(p=/.$/,i=i.replace(p,""))}else if(f.test(i)){var y=f.exec(i);r=y[1],f=new RegExp(u),f.test(r)&&(i=r,f=/(at|bl|iz)$/,d=new RegExp("([^aeiouylsz])\\1$"),v=new RegExp("^"+o+n+"[^aeiouwxy]$"),f.test(i)?i+="e":d.test(i)?(p=/.$/,i=i.replace(p,"")):v.test(i)&&(i+="e"))}if(p=/^(.+?[^aeiou])y$/,p.test(i)){var y=p.exec(i);r=y[1],i=r+"i"}if(p=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,p.test(i)){var y=p.exec(i);r=y[1],l=y[2],p=new RegExp(s),p.test(r)&&(i=r+t[l])}if(p=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,p.test(i)){var y=p.exec(i);r=y[1],l=y[2],p=new RegExp(s),p.test(r)&&(i=r+e[l])}if(p=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,f=/^(.+?)(s|t)(ion)$/,p.test(i)){var y=p.exec(i);r=y[1],p=new RegExp(c),p.test(r)&&(i=r)}else if(f.test(i)){var y=f.exec(i);r=y[1]+y[2],f=new RegExp(c),f.test(r)&&(i=r)}if(p=/^(.+?)e$/,p.test(i)){var y=p.exec(i);r=y[1],p=new RegExp(c),f=new RegExp(a),d=new RegExp("^"+o+n+"[^aeiouwxy]$"),(p.test(r)||f.test(r)&&!d.test(r))&&(i=r)}return p=/ll$/,f=new RegExp(c),p.test(i)&&f.test(i)&&(p=/.$/,i=i.replace(p,"")),"y"==h&&(i=h.toLowerCase()+i.substr(1)),i}}(),t.Pipeline.registerFunction(t.stemmer,"stemmer"),t.stopWordFilter=function(e){return-1===t.stopWordFilter.stopWords.indexOf(e)?e:void 0},t.stopWordFilter.stopWords=new t.SortedSet,t.stopWordFilter.stopWords.length=119,t.stopWordFilter.stopWords.elements=["","a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],t.Pipeline.registerFunction(t.stopWordFilter,"stopWordFilter"),t.trimmer=function(t){return t.replace(/^\W+/,"").replace(/\W+$/,"")},t.Pipeline.registerFunction(t.trimmer,"trimmer"),t.TokenStore=function(){this.root={docs:{}},this.length=0},t.TokenStore.load=function(t){var e=new this;return e.root=t.root,e.length=t.length,e},t.TokenStore.prototype.add=function(t,e,i){var i=i||this.root,n=t[0],o=t.slice(1);return n in i||(i[n]={docs:{}}),0===o.length?(i[n].docs[e.ref]=e,void(this.length+=1)):this.add(o,e,i[n])},t.TokenStore.prototype.has=function(t){if(!t)return!1;for(var e=this.root,i=0;i<t.length;i++){if(!e[t[i]])return!1;e=e[t[i]]}return!0},t.TokenStore.prototype.getNode=function(t){if(!t)return{};for(var e=this.root,i=0;i<t.length;i++){if(!e[t[i]])return{};e=e[t[i]]}return e},t.TokenStore.prototype.get=function(t,e){return this.getNode(t,e).docs||{}},t.TokenStore.prototype.count=function(t,e){return Object.keys(this.get(t,e)).length},t.TokenStore.prototype.remove=function(t,e){if(t){for(var i=this.root,n=0;n<t.length;n++){if(!(t[n]in i))return;i=i[t[n]]}delete i.docs[e]}},t.TokenStore.prototype.expand=function(t,e){var i=this.getNode(t),n=i.docs||{},e=e||[];return Object.keys(n).length&&e.push(t),Object.keys(i).forEach(function(i){"docs"!==i&&e.concat(this.expand(t+i,e))},this),e},t.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},function(t,n){"function"==typeof define&&define.amd?define(n):"object"==typeof i?e.exports=n():t.lunr=n()}(this,function(){return t})}()},{}],25:[function(t,e,i){!function(t,n){"function"==typeof define&&define.amd?define(n):"object"==typeof i?e.exports=n():t.md5=n()}(this,function(){function t(t,e){var s=t[0],a=t[1],c=t[2],u=t[3];s=i(s,a,c,u,e[0],7,-680876936),u=i(u,s,a,c,e[1],12,-389564586),c=i(c,u,s,a,e[2],17,606105819),a=i(a,c,u,s,e[3],22,-1044525330),s=i(s,a,c,u,e[4],7,-176418897),u=i(u,s,a,c,e[5],12,1200080426),c=i(c,u,s,a,e[6],17,-1473231341),a=i(a,c,u,s,e[7],22,-45705983),s=i(s,a,c,u,e[8],7,1770035416),u=i(u,s,a,c,e[9],12,-1958414417),c=i(c,u,s,a,e[10],17,-42063),a=i(a,c,u,s,e[11],22,-1990404162),s=i(s,a,c,u,e[12],7,1804603682),u=i(u,s,a,c,e[13],12,-40341101),c=i(c,u,s,a,e[14],17,-1502002290),a=i(a,c,u,s,e[15],22,1236535329),s=n(s,a,c,u,e[1],5,-165796510),u=n(u,s,a,c,e[6],9,-1069501632),c=n(c,u,s,a,e[11],14,643717713),a=n(a,c,u,s,e[0],20,-373897302),s=n(s,a,c,u,e[5],5,-701558691),u=n(u,s,a,c,e[10],9,38016083),c=n(c,u,s,a,e[15],14,-660478335),a=n(a,c,u,s,e[4],20,-405537848),s=n(s,a,c,u,e[9],5,568446438),u=n(u,s,a,c,e[14],9,-1019803690),c=n(c,u,s,a,e[3],14,-187363961),a=n(a,c,u,s,e[8],20,1163531501),s=n(s,a,c,u,e[13],5,-1444681467),u=n(u,s,a,c,e[2],9,-51403784),c=n(c,u,s,a,e[7],14,1735328473),a=n(a,c,u,s,e[12],20,-1926607734),s=o(s,a,c,u,e[5],4,-378558),u=o(u,s,a,c,e[8],11,-2022574463),c=o(c,u,s,a,e[11],16,1839030562),a=o(a,c,u,s,e[14],23,-35309556),s=o(s,a,c,u,e[1],4,-1530992060),u=o(u,s,a,c,e[4],11,1272893353),c=o(c,u,s,a,e[7],16,-155497632),a=o(a,c,u,s,e[10],23,-1094730640),s=o(s,a,c,u,e[13],4,681279174),u=o(u,s,a,c,e[0],11,-358537222),c=o(c,u,s,a,e[3],16,-722521979),a=o(a,c,u,s,e[6],23,76029189),s=o(s,a,c,u,e[9],4,-640364487),u=o(u,s,a,c,e[12],11,-421815835),c=o(c,u,s,a,e[15],16,530742520),a=o(a,c,u,s,e[2],23,-995338651),s=r(s,a,c,u,e[0],6,-198630844),u=r(u,s,a,c,e[7],10,1126891415),c=r(c,u,s,a,e[14],15,-1416354905),a=r(a,c,u,s,e[5],21,-57434055),s=r(s,a,c,u,e[12],6,1700485571),u=r(u,s,a,c,e[3],10,-1894986606),c=r(c,u,s,a,e[10],15,-1051523),a=r(a,c,u,s,e[1],21,-2054922799),s=r(s,a,c,u,e[8],6,1873313359),u=r(u,s,a,c,e[15],10,-30611744),c=r(c,u,s,a,e[6],15,-1560198380),a=r(a,c,u,s,e[13],21,1309151649),s=r(s,a,c,u,e[4],6,-145523070),u=r(u,s,a,c,e[11],10,-1120210379),c=r(c,u,s,a,e[2],15,718787259),a=r(a,c,u,s,e[9],21,-343485551),t[0]=h(s,t[0]),t[1]=h(a,t[1]),t[2]=h(c,t[2]),t[3]=h(u,t[3])}function e(t,e,i,n,o,r){return e=h(h(e,t),h(n,r)),h(e<<o|e>>>32-o,i)}function i(t,i,n,o,r,s,a){return e(i&n|~i&o,t,i,r,s,a)}function n(t,i,n,o,r,s,a){return e(i&o|n&~o,t,i,r,s,a)}function o(t,i,n,o,r,s,a){return e(i^n^o,t,i,r,s,a)}function r(t,i,n,o,r,s,a){return e(n^(i|~o),t,i,r,s,a)}function s(e){txt="";var i,n=e.length,o=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=e.length;i+=64)t(o,a(e.substring(i-64,i)));e=e.substring(i-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<e.length;i++)r[i>>2]|=e.charCodeAt(i)<<(i%4<<3);if(r[i>>2]|=128<<(i%4<<3),i>55)for(t(o,r),i=0;16>i;i++)r[i]=0;return r[14]=8*n,t(o,r),o}function a(t){var e,i=[];for(e=0;64>e;e+=4)i[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return i}function c(t){for(var e="",i=0;4>i;i++)e+=p[t>>8*i+4&15]+p[t>>8*i&15];return e}function u(t){for(var e=0;e<t.length;e++)t[e]=c(t[e]);return t.join("")}function l(t){return u(s(t))}function h(t,e){return t+e&4294967295}function h(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i}var p="0123456789abcdef".split("");return"5d41402abc4b2a76b9719d911017c592"!=l("hello"),l})},{}],26:[function(t,e,i){"use strict";function n(t){return null===t?String(t):"object"==typeof t||"function"==typeof t?u[f.call(t)]||"object":typeof t}function o(t){return null!==t&&t===t.window}function r(t){if(!t||"object"!==n(t)||t.nodeType||o(t))return!1;try{if(t.constructor&&!d.call(t,"constructor")&&!d.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var i;for(i in t);return void 0===i||d.call(t,i)}function s(t){return"function"===n(t)}function a(){for(var t=[],e=-1,i=arguments.length,n=new Array(i);++e<i;)n[e]=arguments[e];var o={};t.push({args:n,result:{container:o,key:"key"}});for(var r;r=t.pop();)c(t,r.args,r.result);return o.key}function c(t,e,i){var n,o,a,c,u,l,h,p=e[0]||{},f=1,d=e.length,y=!1,_=/\d+/;for("boolean"==typeof p&&(y=p,p=e[1]||{},f=2),"object"==typeof p||s(p)||(p={}),d===f&&(p=this,--f);d>f;f++)if(null!=(n=e[f])){h=v(n);for(o in n)if(!(o in Object.prototype)){if(h&&!_.test(o))continue;if(a=p[o],c=n[o],p===c)continue;y&&c&&(r(c)||(u=v(c)))?(u?(u=!1,l=a&&v(a)?a:[]):l=a&&r(a)?a:{},t.push({args:[y,l,c],result:{container:p,key:o}})):void 0!==c&&(v(n)&&s(c)||(p[o]=c))}}i.container[i.key]=p}for(var u={},l=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],h=0;h<l.length;h++){var p=l[h];u["[object "+p+"]"]=p.toLowerCase()}var f=u.toString,d=u.hasOwnProperty,v=Array.isArray||function(t){return"array"===n(t)};e.exports=a},{}],27:[function(t,e,i){"use strict";var n=t("./upsert"),o=t("./utils"),r=o.Promise;e.exports=function(t){var e=t.db,i=t.viewName,s=t.map,a=t.reduce,c=t.temporary,u=t.saveAs,l=s.toString()+(a&&a.toString())+"undefined"+(u||"");if(!c&&e._cachedViews){var h=e._cachedViews[l];if(h)return r.resolve(h)}return e.info().then(function(t){function h(){function t(t){t.views=t.views||{};var e=i;-1===e.indexOf("/")&&(e=i+"/"+i);var n=t.views[e]=t.views[e]||{};if(!n[f])return n[f]=!0,t}return n(e,"_local/mrviews",t)}function p(){return e.registerDependentDatabase(f).then(function(t){var i=t.db;i.auto_compaction=!0;var n={name:f,db:i,sourceDB:e,adapter:e.adapter,mapFun:s,reduceFun:a};return n.db.get("_local/lastSeq")["catch"](function(t){if(404!==t.status)throw t}).then(function(t){return n.seq=t?t.seq:0,c||(e._cachedViews=e._cachedViews||{},e._cachedViews[l]=n,n.db.on("destroyed",function(){delete e._cachedViews[l]})),n})})}var f=t.db_name+"-";return f+=u?u:"mrview-"+(c?"temp":o.MD5(l)),r.resolve().then(function(){return i?h():r.resolve()}).then(p)})}},{"./upsert":35,"./utils":36}],28:[function(require,module,exports){"use strict";module.exports=function(func,emit,sum,log,isArray,toJSON){return eval("'use strict'; ("+func.replace(/;\s*$/,"")+");")}},{}],29:[function(t,e,i){function n(t){return-1===t.indexOf("/")?[t,t]:t.split("/")}function o(t){return 1===t.length&&/^1-/.test(t[0].rev)}function r(t,e,i){try{return{output:e.apply(null,i)}}catch(n){return t.emit("error",n),{error:n}}}function s(t,e){var i=L(t.key,e.key);return 0!==i?i:L(t.value,e.value)}function a(t,e,i){return i=i||0,"number"==typeof e?t.slice(i,e+i):i>0?t.slice(i):t}function c(t){var e=t.value,i=e&&"object"==typeof e&&e._id||t.id;return i}function u(t){var e=new Error("builtin "+t+" function requires map values to be numbers or number arrays");return e.name="invalid_value",e.status=500,e}function l(t){for(var e=0,i=0,n=t.length;n>i;i++){var o=t[i];if("number"!=typeof o){if(!Array.isArray(o))throw u("_sum");e="number"==typeof e?[e]:e;for(var r=0,s=o.length;s>r;r++){var a=o[r];if("number"!=typeof a)throw u("_sum");"undefined"==typeof e[r]?e.push(a):e[r]+=a}}else"number"==typeof e?e+=o:e[0]+=o}return e}function h(t,e,i,n){var o=e[t];"undefined"!=typeof o&&(n&&(o=encodeURIComponent(JSON.stringify(o))),i.push(t+"="+o))}function p(t,e){var i=t.descending?"endkey":"startkey",n=t.descending?"startkey":"endkey";if("undefined"!=typeof t[i]&&"undefined"!=typeof t[n]&&L(t[i],t[n])>0)throw new C("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&t.reduce!==!1){if(t.include_docs)throw new C("{include_docs:true} is invalid for reduce");if(t.keys&&t.keys.length>1&&!t.group&&!t.group_level)throw new C("Multi-key fetches for reduce views must use {group: true}")}if(t.group_level){if("number"!=typeof t.group_level)throw new C('Invalid value for integer: "'+t.group_level+'"');if(t.group_level<0)throw new C('Invalid value for positive integer: "'+t.group_level+'"')}}function f(t,e,i){var o,r=[],s="GET";if(h("reduce",i,r),h("include_docs",i,r),h("attachments",i,r),h("limit",i,r),h("descending",i,r),h("group",i,r),h("group_level",i,r),h("skip",i,r),h("stale",i,r),h("conflicts",i,r),h("startkey",i,r,!0),h("endkey",i,r,!0),h("inclusive_end",i,r),h("key",i,r,!0),r=r.join("&"),r=""===r?"":"?"+r,"undefined"!=typeof i.keys){var a=2e3,c="keys="+encodeURIComponent(JSON.stringify(i.keys));c.length+r.length+1<=a?r+=("?"===r[0]?"&":"?")+c:(s="POST","string"==typeof e?o=JSON.stringify({keys:i.keys}):e.keys=i.keys)}if("string"==typeof e){var u=n(e);return t.request({method:s,url:"_design/"+u[0]+"/_view/"+u[1]+r,body:o})}return o=o||{},Object.keys(e).forEach(function(t){Array.isArray(e[t])?o[t]=e[t]:o[t]=e[t].toString()}),t.request({method:"POST",url:"_temp_view"+r,body:o})}function d(t){return function(e){if(404===e.status)return t;throw e}}function v(t,e,i){function n(){return o(h)?j.resolve(c):e.db.get(a)["catch"](d(c))}function r(t){return t.keys.length?e.db.allDocs({keys:t.keys,include_docs:!0}):j.resolve({rows:[]})}function s(t,e){for(var i=[],n={},o=0,r=e.rows.length;r>o;o++){var s=e.rows[o],a=s.doc;if(a&&(i.push(a),n[a._id]=!0,a._deleted=!l[a._id],!a._deleted)){var c=l[a._id];"value"in c&&(a.value=c.value)}}var u=Object.keys(l);return u.forEach(function(t){if(!n[t]){var e={_id:t},o=l[t];"value"in o&&(e.value=o.value),i.push(e)}}),t.keys=q.uniq(u.concat(t.keys)),i.push(t),i}var a="_local/doc_"+t,c={_id:a,keys:[]},u=i[t],l=u.indexableKeysToKeyValues,h=u.changes;return n().then(function(t){return r(t).then(function(e){return s(t,e)})})}function y(t,e,i){var n="_local/lastSeq";return t.db.get(n)["catch"](d({_id:n,seq:0})).then(function(n){var o=Object.keys(e);return j.all(o.map(function(i){return v(i,t,e)})).then(function(e){var o=q.flatten(e);return n.seq=i,o.push(n),t.db.bulkDocs({docs:o})})})}function _(t){var e="string"==typeof t?t:t.name,i=V[e];return i||(i=V[e]=new A),i}function g(t){return q.sequentialize(_(t),function(){return m(t)})()}function m(t){function e(t,e){var i={id:o._id,key:F(t)};"undefined"!=typeof e&&null!==e&&(i.value=F(e)),n.push(i)}function i(e,i){return function(){return y(t,e,i)}}var n,o,a;if("function"==typeof t.mapFun&&2===t.mapFun.length){var c=t.mapFun;a=function(t){return c(t,e)}}else a=P(t.mapFun.toString(),e,l,N,Array.isArray,JSON.parse);var u=t.seq||0,h=new A;return new j(function(e,c){function l(){h.finish().then(function(){t.seq=u,e()})}function p(){function e(t){c(t)}t.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:u,limit:B}).on("complete",function(e){var c=e.results;if(!c.length)return l();for(var f={},d=0,v=c.length;v>d;d++){var y=c[d];if("_"!==y.doc._id[0]){n=[],o=y.doc,o._deleted||r(t.sourceDB,a,[o]),n.sort(s);for(var _,g={},m=0,S=n.length;S>m;m++){var w=n[m],b=[w.key,w.id];w.key===_&&b.push(m);var O=M(b);g[O]=w,_=w.key}f[y.doc._id]={indexableKeysToKeyValues:g,changes:y.changes}}u=y.seq}return h.add(i(f,u)),c.length<B?l():p()}).on("error",e)}p()})}function S(t,e,i){0===i.group_level&&delete i.group_level;var n,o=i.group||i.group_level;n=H[t.reduceFun]?H[t.reduceFun]:P(t.reduceFun.toString(),null,l,N,Array.isArray,JSON.parse);var s=[],c=i.group_level;e.forEach(function(t){var e=s[s.length-1],i=o?t.key:null;return o&&Array.isArray(i)&&"number"==typeof c&&(i=i.length>c?i.slice(0,c):i),e&&0===L(e.key[0][0],i)?(e.key.push([i,t.id]),void e.value.push(t.value)):void s.push({key:[[i,t.id]],value:[t.value]})});for(var u=0,h=s.length;h>u;u++){var p=s[u],f=r(t.sourceDB,n,[p.key,p.value,!1]);p.value=f.error?null:f.output,p.key=p.key[0][0]}return{rows:a(s,i.limit,i.skip)}}function w(t,e){return q.sequentialize(_(t),function(){return b(t,e)})()}function b(t,e){function i(e){return e.include_docs=!0,t.db.allDocs(e).then(function(t){return o=t.total_rows,t.rows.map(function(t){if("value"in t.doc&&"object"==typeof t.doc.value&&null!==t.doc.value){var e=Object.keys(t.doc.value).sort(),i=["id","key","value"];if(!(i>e||e>i))return t.doc.value}var n=z.parseIndexableString(t.doc._id);return{key:n[0],id:n[1],value:"value"in t.doc?t.doc.value:null}})})}function n(i){var n;if(n=r?S(t,i,e):{total_rows:o,offset:s,rows:i},e.include_docs){var a=q.uniq(i.map(c));return t.sourceDB.allDocs({keys:a,include_docs:!0,conflicts:e.conflicts,attachments:e.attachments}).then(function(t){var e={};return t.rows.forEach(function(t){t.doc&&(e["$"+t.id]=t.doc)}),i.forEach(function(t){var i=c(t),n=e["$"+i];n&&(t.doc=n)}),n})}return n}var o,r=t.reduceFun&&e.reduce!==!1,s=e.skip||0;"undefined"==typeof e.keys||e.keys.length||(e.limit=0,delete e.keys);var a=function(t){return t.reduce(function(t,e){return t.concat(e)})};if("undefined"!=typeof e.keys){var u=e.keys,l=u.map(function(t){var e={startkey:M([t]),endkey:M([t,{}])};return i(e)});return j.all(l).then(a).then(n)}var h={descending:e.descending};if("undefined"!=typeof e.startkey&&(h.startkey=M(e.descending?[e.startkey,{}]:[e.startkey])),"undefined"!=typeof e.endkey){var p=e.inclusive_end!==!1;e.descending&&(p=!p),h.endkey=M(p?[e.endkey,{}]:[e.endkey])}if("undefined"!=typeof e.key){var f=M([e.key]),d=M([e.key,{}]);h.descending?(h.endkey=f,h.startkey=d):(h.startkey=f,h.endkey=d)}return r||("number"==typeof e.limit&&(h.limit=e.limit),h.skip=s),i(h).then(n)}function O(t){return t.request({method:"POST",url:"_view_cleanup"})}function T(t){return t.get("_local/mrviews").then(function(e){var i={};Object.keys(e.views).forEach(function(t){var e=n(t),o="_design/"+e[0],r=e[1];i[o]=i[o]||{},i[o][r]=!0});var o={keys:Object.keys(i),include_docs:!0};return t.allDocs(o).then(function(n){var o={};n.rows.forEach(function(t){var n=t.key.substring(8);Object.keys(i[t.key]).forEach(function(i){var r=n+"/"+i;e.views[r]||(r=i);var s=Object.keys(e.views[r]),a=t.doc&&t.doc.views&&t.doc.views[i];s.forEach(function(t){o[t]=o[t]||a})})});var r=Object.keys(o).filter(function(t){return!o[t]}),s=r.map(function(e){return q.sequentialize(_(e),function(){return t.constructor.destroy(e,t.__opts)})()});return j.all(s).then(function(){return{ok:!0}})})},d({ok:!0}))}function E(t,e,i){p(i,e);var n={db:t,viewName:"temp_view/temp_view",map:e.map,reduce:e.reduce,temporary:!0};return U.add(function(){return R(n).then(function(t){function e(){return t.db.destroy()}return q.fin(g(t).then(function(){return w(t,i)}),e)})}),U.finish()}function x(t,e,i){function o(t){return"ok"===i.stale||"update_after"===i.stale?("update_after"===i.stale&&D.nextTick(function(){g(t)}),w(t,i)):g(t).then(function(){return w(t,i)})}if(i.saveAs){var r={db:t,saveAs:i.saveAs,map:e.map,reduce:e.reduce};return i.destroy?R(r).then(function(t){return t.db.destroy()}):(p(i,e),R(r).then(o))}var s=e,a=n(s),c=a[0],u=a[1];return t.get("_design/"+c).then(function(e){var n=e.views&&e.views[u];if(!n||"string"!=typeof n.map)throw new k("ddoc "+c+" has no view named "+u);p(i,n);var r={db:t,viewName:s,map:n.map,reduce:n.reduce};return R(r).then(o)})}function I(t,e,i){return"http"===t.type()?f(t,e,i):"string"==typeof e||i.saveAs?x(t,e,i):E(t,e,i)}function C(t){this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,C)}catch(e){}}function k(t){this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,k)}catch(e){}}var N,D=t("__browserify_process"),z=t("pouchdb-collate"),A=t("./taskqueue"),L=z.collate,M=z.toIndexableString,F=z.normalizeKey,R=t("./create-view"),P=t("./evalfunc");N="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var q=t("./utils"),j=q.Promise,V={},U=new A,B=50,H={_sum:function(t,e){return l(e)},_count:function(t,e){return e.length},_stats:function(t,e){function i(t){for(var e=0,i=0,n=t.length;n>i;i++){var o=t[i];e+=o*o}return e}return{sum:l(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:i(e)}}};i._search_viewCleanup=q.callbackify(function(){var t=this;return"http"===t.type()?O(t):T(t)}),i._search_query=function(t,e,i){"function"==typeof e&&(i=e,e={}),e=q.extend(!0,{},e),"function"==typeof t&&(t={map:t}),t.saveAs&&(e.saveAs=t.saveAs,delete t.saveAs);var n=this,o=j.resolve().then(function(){return I(n,t,e)});return q.promisedCallback(o,i),o},q.inherits(C,Error),q.inherits(k,Error)},{"./create-view":27,"./evalfunc":28,"./taskqueue":34,"./utils":36,__browserify_process:4,"pouchdb-collate":30}],30:[function(t,e,i){"use strict";function n(t){if(null!==t)switch(typeof t){case"boolean":return t?1:0;case"number":return l(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),o=-1,r=n.length,s="";if(e)for(;++o<r;)s+=i.toIndexableString(n[o]);else for(;++o<r;){var a=n[o];s+=i.toIndexableString(a)+i.toIndexableString(t[a])}return s}return""}function o(t,e){var i,n=e,o="1"===t[e];if(o)i=0,e++;else{var r="0"===t[e];e++;var s="",a=t.substring(e,e+p),c=parseInt(a,10)+h;for(r&&(c=-c),e+=p;;){var u=t[e];if("\x00"===u)break;s+=u,e++}s=s.split("."),i=1===s.length?parseInt(s,10):parseFloat(s[0]+"."+s[1]),r&&(i-=10),0!==c&&(i=parseFloat(i+"e"+c))}return{num:i,length:e-n}}function r(t,e){var i=t.pop();if(e.length){var n=e[e.length-1];i===n.element&&(e.pop(),n=e[e.length-1]);var o=n.element,r=n.index;if(Array.isArray(o))o.push(i);else if(r===t.length-2){var s=t.pop();o[s]=i}else t.push(i)}}function s(t,e){for(var n=Math.min(t.length,e.length),o=0;n>o;o++){var r=i.collate(t[o],e[o]);if(0!==r)return r}return t.length===e.length?0:t.length>e.length?1:-1}function a(t,e){return t===e?0:t>e?1:-1}function c(t,e){for(var n=Object.keys(t),o=Object.keys(e),r=Math.min(n.length,o.length),s=0;r>s;s++){var a=i.collate(n[s],o[s]);if(0!==a)return a;if(a=i.collate(t[n[s]],e[o[s]]),0!==a)return a}return n.length===o.length?0:n.length>o.length?1:-1}function u(t){var e=["boolean","number","string","object"],i=e.indexOf(typeof t);return~i?null===t?1:Array.isArray(t)?5:3>i?i+2:i+3:Array.isArray(t)?5:void 0}function l(t){if(0===t)return"1";var e=t.toExponential().split(/e\+?/),i=parseInt(e[1],10),n=0>t,o=n?"0":"2",r=(n?-i:i)-h,s=d.padLeft(r.toString(),"0",p);o+=f+s;var a=Math.abs(parseFloat(e[0]));n&&(a=10-a);var c=a.toFixed(20);return c=c.replace(/\.?0+$/,""),o+=f+c}var h=-324,p=3,f="",d=t("./utils");i.collate=function(t,e){if(t===e)return 0;t=i.normalizeKey(t),e=i.normalizeKey(e);var n=u(t),o=u(e);if(n-o!==0)return n-o;if(null===t)return 0;switch(typeof t){case"number":return t-e;case"boolean":return t===e?0:e>t?-1:1;case"string":return a(t,e)}return Array.isArray(t)?s(t,e):c(t,e)},i.normalizeKey=function(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-(1/0)||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var o=0;n>o;o++)t[o]=i.normalizeKey(e[o])}else{if(t instanceof Date)return t.toJSON();if(null!==t){t={};for(var r in e)if(e.hasOwnProperty(r)){var s=e[r];"undefined"!=typeof s&&(t[r]=i.normalizeKey(s))}}}}return t},i.toIndexableString=function(t){var e="\x00";return t=i.normalizeKey(t),u(t)+f+n(t)+e},i.parseIndexableString=function(t){for(var e=[],i=[],n=0;;){var s=t[n++];if("\x00"!==s)switch(s){case"1":e.push(null);break;case"2":e.push("1"===t[n]),n++;break;case"3":var a=o(t,n);e.push(a.num),n+=a.length;break;case"4":for(var c="";;){var u=t[n];if("\x00"===u)break;c+=u,n++}c=c.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(c);break;case"5":var l={element:[],index:e.length};e.push(l.element),i.push(l);break;case"6":var h={element:{},index:e.length};e.push(h.element),i.push(h);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+s)}else{if(1===e.length)return e.pop();r(e,i)}}}},{"./utils":31}],31:[function(t,e,i){"use strict";function n(t,e,i){for(var n="",o=i-t.length;n.length<o;)n+=e;return n}i.padLeft=function(t,e,i){var o=n(t,e,i);return o+t},i.padRight=function(t,e,i){var o=n(t,e,i);return t+o},i.stringLexCompare=function(t,e){var i,n=t.length,o=e.length;for(i=0;n>i;i++){if(i===o)return 1;var r=t.charAt(i),s=e.charAt(i);if(r!==s)return s>r?-1:1}return o>n?-1:0},i.intToDecimalForm=function(t){var e=0>t,i="";do{var n=e?-Math.ceil(t%10):Math.floor(t%10);i=n+i,t=e?Math.ceil(t/10):Math.floor(t/10)}while(t);return e&&"0"!==i&&(i="-"+i),i}},{}],32:[function(t,e,i){function n(t,e,i){return new r(function(n,r){return"string"!=typeof e?r(new Error("doc id is required")):void t.get(e,function(s,a){if(s){if(404!==s.status)return r(s);a={}}var c=i(a);return c?(c._id=e,c._rev=a._rev,void n(o(t,c,i))):n({updated:!1,rev:a._rev})})})}function o(t,e,i){return t.put(e).then(function(t){return{updated:!0,rev:t.rev}},function(o){if(409!==o.status)throw o;return n(t,e._id,i)})}var r,s="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};r="undefined"!=typeof window&&window.PouchDB?window.PouchDB.utils.Promise:"function"==typeof s.Promise?s.Promise:t("lie"),i.upsert=function(t,e,i){var o=this,r=n(o,t,e);return"function"!=typeof i?r:void r.then(function(t){i(null,t)},i)},i.putIfNotExists=function(t,e,i){var o=this;"string"!=typeof t&&(i=e,e=t,t=e._id);var r=function(t){return t._rev?!1:e},s=n(o,t,r);return"function"!=typeof i?s:void s.then(function(t){i(null,t)},i)},"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(i)},{lie:9}],33:[function(t,e,i){!function(t){if("object"==typeof i)e.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var n;try{n=window}catch(o){n=self}n.SparkMD5=t()}}(function(t){"use strict";var e=function(t,e){return t+e&4294967295},i=function(t,i,n,o,r,s){return i=e(e(i,t),e(o,s)),e(i<<r|i>>>32-r,n)},n=function(t,e,n,o,r,s,a){return i(e&n|~e&o,t,e,r,s,a)},o=function(t,e,n,o,r,s,a){return i(e&o|n&~o,t,e,r,s,a)},r=function(t,e,n,o,r,s,a){return i(e^n^o,t,e,r,s,a)},s=function(t,e,n,o,r,s,a){return i(n^(e|~o),t,e,r,s,a)},a=function(t,i){var a=t[0],c=t[1],u=t[2],l=t[3];a=n(a,c,u,l,i[0],7,-680876936),l=n(l,a,c,u,i[1],12,-389564586),u=n(u,l,a,c,i[2],17,606105819),c=n(c,u,l,a,i[3],22,-1044525330),a=n(a,c,u,l,i[4],7,-176418897),l=n(l,a,c,u,i[5],12,1200080426),u=n(u,l,a,c,i[6],17,-1473231341),c=n(c,u,l,a,i[7],22,-45705983),a=n(a,c,u,l,i[8],7,1770035416),l=n(l,a,c,u,i[9],12,-1958414417),u=n(u,l,a,c,i[10],17,-42063),c=n(c,u,l,a,i[11],22,-1990404162),a=n(a,c,u,l,i[12],7,1804603682),l=n(l,a,c,u,i[13],12,-40341101),u=n(u,l,a,c,i[14],17,-1502002290),c=n(c,u,l,a,i[15],22,1236535329),a=o(a,c,u,l,i[1],5,-165796510),l=o(l,a,c,u,i[6],9,-1069501632),u=o(u,l,a,c,i[11],14,643717713),c=o(c,u,l,a,i[0],20,-373897302),a=o(a,c,u,l,i[5],5,-701558691),l=o(l,a,c,u,i[10],9,38016083),u=o(u,l,a,c,i[15],14,-660478335),c=o(c,u,l,a,i[4],20,-405537848),a=o(a,c,u,l,i[9],5,568446438),l=o(l,a,c,u,i[14],9,-1019803690),u=o(u,l,a,c,i[3],14,-187363961),c=o(c,u,l,a,i[8],20,1163531501),a=o(a,c,u,l,i[13],5,-1444681467),l=o(l,a,c,u,i[2],9,-51403784),u=o(u,l,a,c,i[7],14,1735328473),c=o(c,u,l,a,i[12],20,-1926607734),a=r(a,c,u,l,i[5],4,-378558),l=r(l,a,c,u,i[8],11,-2022574463),u=r(u,l,a,c,i[11],16,1839030562),c=r(c,u,l,a,i[14],23,-35309556),a=r(a,c,u,l,i[1],4,-1530992060),l=r(l,a,c,u,i[4],11,1272893353),u=r(u,l,a,c,i[7],16,-155497632),c=r(c,u,l,a,i[10],23,-1094730640),a=r(a,c,u,l,i[13],4,681279174),l=r(l,a,c,u,i[0],11,-358537222),u=r(u,l,a,c,i[3],16,-722521979),c=r(c,u,l,a,i[6],23,76029189),a=r(a,c,u,l,i[9],4,-640364487),l=r(l,a,c,u,i[12],11,-421815835),u=r(u,l,a,c,i[15],16,530742520),c=r(c,u,l,a,i[2],23,-995338651),a=s(a,c,u,l,i[0],6,-198630844),l=s(l,a,c,u,i[7],10,1126891415),u=s(u,l,a,c,i[14],15,-1416354905),c=s(c,u,l,a,i[5],21,-57434055),a=s(a,c,u,l,i[12],6,1700485571),l=s(l,a,c,u,i[3],10,-1894986606),u=s(u,l,a,c,i[10],15,-1051523),c=s(c,u,l,a,i[1],21,-2054922799),a=s(a,c,u,l,i[8],6,1873313359),l=s(l,a,c,u,i[15],10,-30611744),u=s(u,l,a,c,i[6],15,-1560198380),c=s(c,u,l,a,i[13],21,1309151649),a=s(a,c,u,l,i[4],6,-145523070),l=s(l,a,c,u,i[11],10,-1120210379),u=s(u,l,a,c,i[2],15,718787259),c=s(c,u,l,a,i[9],21,-343485551),t[0]=e(a,t[0]),t[1]=e(c,t[1]),t[2]=e(u,t[2]),t[3]=e(l,t[3])},c=function(t){var e,i=[];for(e=0;64>e;e+=4)i[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);
return i},u=function(t){var e,i=[];for(e=0;64>e;e+=4)i[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return i},l=function(t){var e,i,n,o,r,s,u=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(e=64;u>=e;e+=64)a(l,c(t.substring(e-64,e)));for(t=t.substring(e-64),i=t.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;i>e;e+=1)n[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(a(l,n),e=0;16>e;e+=1)n[e]=0;return o=8*u,o=o.toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(o[2],16),s=parseInt(o[1],16)||0,n[14]=r,n[15]=s,a(l,n),l},h=function(t){var e,i,n,o,r,s,c=t.length,l=[1732584193,-271733879,-1732584194,271733878];for(e=64;c>=e;e+=64)a(l,u(t.subarray(e-64,e)));for(t=c>e-64?t.subarray(e-64):new Uint8Array(0),i=t.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;i>e;e+=1)n[e>>2]|=t[e]<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(a(l,n),e=0;16>e;e+=1)n[e]=0;return o=8*c,o=o.toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(o[2],16),s=parseInt(o[1],16)||0,n[14]=r,n[15]=s,a(l,n),l},p=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],f=function(t){var e,i="";for(e=0;4>e;e+=1)i+=p[t>>8*e+4&15]+p[t>>8*e&15];return i},d=function(t){var e;for(e=0;e<t.length;e+=1)t[e]=f(t[e]);return t.join("")},v=function(t){return d(l(t))},y=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==v("hello")&&(e=function(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i}),y.prototype.append=function(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),this.appendBinary(t),this},y.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,i=this._buff.length;for(e=64;i>=e;e+=64)a(this._state,c(this._buff.substring(e-64,e)));return this._buff=this._buff.substr(e-64),this},y.prototype.end=function(t){var e,i,n=this._buff,o=n.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;o>e;e+=1)r[e>>2]|=n.charCodeAt(e)<<(e%4<<3);return this._finish(r,o),i=t?this._state:d(this._state),this.reset(),i},y.prototype._finish=function(t,e){var i,n,o,r=e;if(t[r>>2]|=128<<(r%4<<3),r>55)for(a(this._state,t),r=0;16>r;r+=1)t[r]=0;i=8*this._length,i=i.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),o=parseInt(i[1],16)||0,t[14]=n,t[15]=o,a(this._state,t)},y.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},y.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},y.hash=function(t,e){/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t)));var i=l(t);return e?i:d(i)},y.hashBinary=function(t,e){var i=l(t);return e?i:d(i)},y.ArrayBuffer=function(){this.reset()},y.ArrayBuffer.prototype.append=function(t){var e,i=this._concatArrayBuffer(this._buff,t),n=i.length;for(this._length+=t.byteLength,e=64;n>=e;e+=64)a(this._state,u(i.subarray(e-64,e)));return this._buff=n>e-64?i.subarray(e-64):new Uint8Array(0),this},y.ArrayBuffer.prototype.end=function(t){var e,i,n=this._buff,o=n.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;o>e;e+=1)r[e>>2]|=n[e]<<(e%4<<3);return this._finish(r,o),i=t?this._state:d(this._state),this.reset(),i},y.ArrayBuffer.prototype._finish=y.prototype._finish,y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},y.ArrayBuffer.prototype.destroy=y.prototype.destroy,y.ArrayBuffer.prototype._concatArrayBuffer=function(t,e){var i=t.length,n=new Uint8Array(i+e.byteLength);return n.set(t),n.set(new Uint8Array(e),i),n},y.ArrayBuffer.hash=function(t,e){var i=h(new Uint8Array(t));return e?i:d(i)},y})},{}],34:[function(t,e,i){"use strict";function n(){this.promise=new o(function(t){t()})}var o=t("./utils").Promise;n.prototype.add=function(t){return this.promise=this.promise["catch"](function(){}).then(function(){return t()}),this.promise},n.prototype.finish=function(){return this.promise},e.exports=n},{"./utils":36}],35:[function(t,e,i){"use strict";var n=t("pouchdb-upsert").upsert;e.exports=function(t,e,i){return n.apply(t,[e,i])}},{"pouchdb-upsert":32}],36:[function(t,e,i){var n=t("__browserify_process"),o="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};"function"==typeof o.Promise?i.Promise=o.Promise:i.Promise=t("lie"),i.inherits=t("inherits"),i.extend=t("pouchdb-extend");var r=t("argsarray");i.promisedCallback=function(t,e){return e&&t.then(function(t){n.nextTick(function(){e(null,t)})},function(t){n.nextTick(function(){e(t)})}),t},i.callbackify=function(t){return r(function(e){var n=e.pop(),o=t.apply(this,e);return"function"==typeof n&&i.promisedCallback(o,n),o})},i.fin=function(t,e){return t.then(function(t){var i=e();return"function"==typeof i.then?i.then(function(){return t}):t},function(t){var i=e();if("function"==typeof i.then)return i.then(function(){throw t});throw t})},i.sequentialize=function(t,e){return function(){var i=arguments,n=this;return t.add(function(){return e.apply(n,i)})}},i.flatten=function(t){for(var e=[],i=0,n=t.length;n>i;i++)e=e.concat(t[i]);return e},i.uniq=function(t){for(var e={},i=0,n=t.length;n>i;i++)e["$"+t[i]]=!0;var o=Object.keys(e),r=new Array(o.length);for(i=0,n=o.length;n>i;i++)r[i]=o[i].substring(1);return r};var s=t("crypto"),a=t("spark-md5");i.MD5=function(t){return n.browser?a.hash(t):s.createHash("md5").update(t).digest("hex")}},{__browserify_process:4,argsarray:2,crypto:3,inherits:5,lie:9,"pouchdb-extend":26,"spark-md5":33}],37:[function(t,e,i){"use strict";function n(t,e){for(var i=1,n=t.length,o=t[0],r=t[0],s=1;n>s;++s)if(r=o,o=t[s],e(o,r)){if(s===i){i++;continue}t[i++]=o}return t.length=i,t}function o(t){for(var e=1,i=t.length,n=t[0],o=t[0],r=1;i>r;++r,o=n)if(o=n,n=t[r],n!==o){if(r===e){e++;continue}t[e++]=n}return t.length=e,t}function r(t,e,i){return 0===t.length?t:e?(i||t.sort(e),n(t,e)):(i||t.sort(),o(t))}e.exports=r},{}],38:[function(t,e,i){var n,o=t("__browserify_process"),r="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};n="undefined"!=typeof window&&window.PouchDB?window.PouchDB.utils.Promise:"function"==typeof r.Promise?r.Promise:t("lie"),i.once=function(t){var e=!1;return i.getArguments(function(i){if(e)throw console.trace(),new Error("once called  more than once");e=!0,t.apply(this,i)})},i.getArguments=function(t){return function(){for(var e=arguments.length,i=new Array(e),n=-1;++n<e;)i[n]=arguments[n];return t.call(this,i)}},i.toPromise=function(t){return i.getArguments(function(e){var r,s=this,a="function"==typeof e[e.length-1]?e.pop():!1;a&&(r=function(t,e){o.nextTick(function(){a(t,e)})});var c=new n(function(n,o){try{var r=i.once(function(t,e){t?o(t):n(e)});e.push(r),t.apply(s,e)}catch(a){o(a)}});return r&&c.then(function(t){r(null,t)},r),c.cancel=function(){return this},c})},i.inherits=t("inherits"),i.Promise=n;var s=t("crypto"),a=t("md5-jkmyers");i.MD5=function(t){return o.browser?a(t):s.createHash("md5").update(t).digest("hex")},i.extend=t("pouchdb-extend")},{__browserify_process:4,crypto:3,inherits:5,lie:9,"md5-jkmyers":25,"pouchdb-extend":26}]},{},[1]);